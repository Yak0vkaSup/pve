const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NodesSettings-BjQwavf3.js","assets/NodesSettings-BYPnmno0.css"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const Ne of document.querySelectorAll('link[rel="modulepreload"]'))Ae(Ne);new MutationObserver(Ne=>{for(const tr of Ne)if(tr.type==="childList")for(const er of tr.addedNodes)er.tagName==="LINK"&&er.rel==="modulepreload"&&Ae(er)}).observe(document,{childList:!0,subtree:!0});function n(Ne){const tr={};return Ne.integrity&&(tr.integrity=Ne.integrity),Ne.referrerPolicy&&(tr.referrerPolicy=Ne.referrerPolicy),Ne.crossOrigin==="use-credentials"?tr.credentials="include":Ne.crossOrigin==="anonymous"?tr.credentials="omit":tr.credentials="same-origin",tr}function Ae(Ne){if(Ne.ep)return;Ne.ep=!0;const tr=n(Ne);fetch(Ne.href,tr)}})();/**
* @vue/shared v3.5.3
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function makeMap(s,t){const n=new Set(s.split(","));return Ae=>n.has(Ae)}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,isOn=s=>s.charCodeAt(0)===111&&s.charCodeAt(1)===110&&(s.charCodeAt(2)>122||s.charCodeAt(2)<97),isModelListener=s=>s.startsWith("onUpdate:"),extend$1=Object.assign,remove=(s,t)=>{const n=s.indexOf(t);n>-1&&s.splice(n,1)},hasOwnProperty$2=Object.prototype.hasOwnProperty,hasOwn=(s,t)=>hasOwnProperty$2.call(s,t),isArray$2=Array.isArray,isMap=s=>toTypeString(s)==="[object Map]",isSet=s=>toTypeString(s)==="[object Set]",isDate$1=s=>toTypeString(s)==="[object Date]",isFunction$1=s=>typeof s=="function",isString$1=s=>typeof s=="string",isSymbol=s=>typeof s=="symbol",isObject$2=s=>s!==null&&typeof s=="object",isPromise=s=>(isObject$2(s)||isFunction$1(s))&&isFunction$1(s.then)&&isFunction$1(s.catch),objectToString=Object.prototype.toString,toTypeString=s=>objectToString.call(s),toRawType=s=>toTypeString(s).slice(8,-1),isPlainObject$2=s=>toTypeString(s)==="[object Object]",isIntegerKey=s=>isString$1(s)&&s!=="NaN"&&s[0]!=="-"&&""+parseInt(s,10)===s,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=s=>{const t=Object.create(null);return n=>t[n]||(t[n]=s(n))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(s=>s.replace(camelizeRE,(t,n)=>n?n.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(s=>s.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(s=>s.charAt(0).toUpperCase()+s.slice(1)),toHandlerKey=cacheStringFunction(s=>s?`on${capitalize(s)}`:""),hasChanged=(s,t)=>!Object.is(s,t),invokeArrayFns=(s,...t)=>{for(let n=0;n<s.length;n++)s[n](...t)},def=(s,t,n,Ae=!1)=>{Object.defineProperty(s,t,{configurable:!0,enumerable:!1,writable:Ae,value:n})},looseToNumber=s=>{const t=parseFloat(s);return isNaN(t)?s:t};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function normalizeStyle(s){if(isArray$2(s)){const t={};for(let n=0;n<s.length;n++){const Ae=s[n],Ne=isString$1(Ae)?parseStringStyle(Ae):normalizeStyle(Ae);if(Ne)for(const tr in Ne)t[tr]=Ne[tr]}return t}else if(isString$1(s)||isObject$2(s))return s}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*[^]*?\*\//g;function parseStringStyle(s){const t={};return s.replace(styleCommentRE,"").split(listDelimiterRE).forEach(n=>{if(n){const Ae=n.split(propertyDelimiterRE);Ae.length>1&&(t[Ae[0].trim()]=Ae[1].trim())}}),t}function normalizeClass(s){let t="";if(isString$1(s))t=s;else if(isArray$2(s))for(let n=0;n<s.length;n++){const Ae=normalizeClass(s[n]);Ae&&(t+=Ae+" ")}else if(isObject$2(s))for(const n in s)s[n]&&(t+=n+" ");return t.trim()}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(s){return!!s||s===""}function looseCompareArrays(s,t){if(s.length!==t.length)return!1;let n=!0;for(let Ae=0;n&&Ae<s.length;Ae++)n=looseEqual(s[Ae],t[Ae]);return n}function looseEqual(s,t){if(s===t)return!0;let n=isDate$1(s),Ae=isDate$1(t);if(n||Ae)return n&&Ae?s.getTime()===t.getTime():!1;if(n=isSymbol(s),Ae=isSymbol(t),n||Ae)return s===t;if(n=isArray$2(s),Ae=isArray$2(t),n||Ae)return n&&Ae?looseCompareArrays(s,t):!1;if(n=isObject$2(s),Ae=isObject$2(t),n||Ae){if(!n||!Ae)return!1;const Ne=Object.keys(s).length,tr=Object.keys(t).length;if(Ne!==tr)return!1;for(const er in s){const ir=s.hasOwnProperty(er),sr=t.hasOwnProperty(er);if(ir&&!sr||!ir&&sr||!looseEqual(s[er],t[er]))return!1}}return String(s)===String(t)}function looseIndexOf(s,t){return s.findIndex(n=>looseEqual(n,t))}const isRef$1=s=>!!(s&&s.__v_isRef===!0),toDisplayString=s=>isString$1(s)?s:s==null?"":isArray$2(s)||isObject$2(s)&&(s.toString===objectToString||!isFunction$1(s.toString))?isRef$1(s)?toDisplayString(s.value):JSON.stringify(s,replacer,2):String(s),replacer=(s,t)=>isRef$1(t)?replacer(s,t.value):isMap(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[Ae,Ne],tr)=>(n[stringifySymbol(Ae,tr)+" =>"]=Ne,n),{})}:isSet(t)?{[`Set(${t.size})`]:[...t.values()].map(n=>stringifySymbol(n))}:isSymbol(t)?stringifySymbol(t):isObject$2(t)&&!isArray$2(t)&&!isPlainObject$2(t)?String(t):t,stringifySymbol=(s,t="")=>{var n;return isSymbol(s)?`Symbol(${(n=s.description)!=null?n:t})`:s};/**
* @vue/reactivity v3.5.3
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let activeEffectScope;class EffectScope{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=activeEffectScope,!t&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].pause();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].resume();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].resume()}}run(t){if(this._active){const n=activeEffectScope;try{return activeEffectScope=this,t()}finally{activeEffectScope=n}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(t){if(this._active){let n,Ae;for(n=0,Ae=this.effects.length;n<Ae;n++)this.effects[n].stop();for(n=0,Ae=this.cleanups.length;n<Ae;n++)this.cleanups[n]();if(this.scopes)for(n=0,Ae=this.scopes.length;n<Ae;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!t){const Ne=this.parent.scopes.pop();Ne&&Ne!==this&&(this.parent.scopes[this.index]=Ne,Ne.index=this.index)}this.parent=void 0,this._active=!1}}}function effectScope(s){return new EffectScope(s)}function getCurrentScope(){return activeEffectScope}function onScopeDispose(s,t=!1){activeEffectScope&&activeEffectScope.cleanups.push(s)}let activeSub;const pausedQueueEffects=new WeakSet;class ReactiveEffect{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.nextEffect=void 0,this.cleanup=void 0,this.scheduler=void 0,activeEffectScope&&activeEffectScope.active&&activeEffectScope.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,pausedQueueEffects.has(this)&&(pausedQueueEffects.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||(this.flags|=8,this.nextEffect=batchedEffect,batchedEffect=this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,cleanupEffect(this),prepareDeps(this);const t=activeSub,n=shouldTrack;activeSub=this,shouldTrack=!0;try{return this.fn()}finally{cleanupDeps(this),activeSub=t,shouldTrack=n,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)removeSub(t);this.deps=this.depsTail=void 0,cleanupEffect(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?pausedQueueEffects.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){isDirty(this)&&this.run()}get dirty(){return isDirty(this)}}let batchDepth=0,batchedEffect;function startBatch(){batchDepth++}function endBatch(){if(--batchDepth>0)return;let s;for(;batchedEffect;){let t=batchedEffect;for(batchedEffect=void 0;t;){const n=t.nextEffect;if(t.nextEffect=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(Ae){s||(s=Ae)}t=n}}if(s)throw s}function prepareDeps(s){for(let t=s.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function cleanupDeps(s){let t,n=s.depsTail;for(let Ae=n;Ae;Ae=Ae.prevDep)Ae.version===-1?(Ae===n&&(n=Ae.prevDep),removeSub(Ae),removeDep(Ae)):t=Ae,Ae.dep.activeLink=Ae.prevActiveLink,Ae.prevActiveLink=void 0;s.deps=t,s.depsTail=n}function isDirty(s){for(let t=s.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&refreshComputed(t.dep.computed)===!1||t.dep.version!==t.version)return!0;return!!s._dirty}function refreshComputed(s){if(s.flags&2)return!1;if(s.flags&4&&!(s.flags&16)||(s.flags&=-17,s.globalVersion===globalVersion))return;s.globalVersion=globalVersion;const t=s.dep;if(s.flags|=2,t.version>0&&!s.isSSR&&!isDirty(s)){s.flags&=-3;return}const n=activeSub,Ae=shouldTrack;activeSub=s,shouldTrack=!0;try{prepareDeps(s);const Ne=s.fn(s._value);(t.version===0||hasChanged(Ne,s._value))&&(s._value=Ne,t.version++)}catch(Ne){throw t.version++,Ne}finally{activeSub=n,shouldTrack=Ae,cleanupDeps(s),s.flags&=-3}}function removeSub(s){const{dep:t,prevSub:n,nextSub:Ae}=s;if(n&&(n.nextSub=Ae,s.prevSub=void 0),Ae&&(Ae.prevSub=n,s.nextSub=void 0),t.subs===s&&(t.subs=n),!t.subs&&t.computed){t.computed.flags&=-5;for(let Ne=t.computed.deps;Ne;Ne=Ne.nextDep)removeSub(Ne)}}function removeDep(s){const{prevDep:t,nextDep:n}=s;t&&(t.nextDep=n,s.prevDep=void 0),n&&(n.prevDep=t,s.nextDep=void 0)}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const s=trackStack.pop();shouldTrack=s===void 0?!0:s}function cleanupEffect(s){const{cleanup:t}=s;if(s.cleanup=void 0,t){const n=activeSub;activeSub=void 0;try{t()}finally{activeSub=n}}}let globalVersion=0;class Dep{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0}track(t){if(!activeSub||!shouldTrack||activeSub===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==activeSub)n=this.activeLink={dep:this,sub:activeSub,version:this.version,nextDep:void 0,prevDep:void 0,nextSub:void 0,prevSub:void 0,prevActiveLink:void 0},activeSub.deps?(n.prevDep=activeSub.depsTail,activeSub.depsTail.nextDep=n,activeSub.depsTail=n):activeSub.deps=activeSub.depsTail=n,activeSub.flags&4&&addSub(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const Ae=n.nextDep;Ae.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=Ae),n.prevDep=activeSub.depsTail,n.nextDep=void 0,activeSub.depsTail.nextDep=n,activeSub.depsTail=n,activeSub.deps===n&&(activeSub.deps=Ae)}return n}trigger(t){this.version++,globalVersion++,this.notify(t)}notify(t){startBatch();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()}finally{endBatch()}}}function addSub(s){const t=s.dep.computed;if(t&&!s.dep.subs){t.flags|=20;for(let Ae=t.deps;Ae;Ae=Ae.nextDep)addSub(Ae)}const n=s.dep.subs;n!==s&&(s.prevSub=n,n&&(n.nextSub=s)),s.dep.subs=s}const targetMap=new WeakMap,ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol(""),ARRAY_ITERATE_KEY=Symbol("");function track(s,t,n){if(shouldTrack&&activeSub){let Ae=targetMap.get(s);Ae||targetMap.set(s,Ae=new Map);let Ne=Ae.get(n);Ne||Ae.set(n,Ne=new Dep),Ne.track()}}function trigger(s,t,n,Ae,Ne,tr){const er=targetMap.get(s);if(!er){globalVersion++;return}let ir=[];if(t==="clear")ir=[...er.values()];else{const sr=isArray$2(s),rr=sr&&isIntegerKey(n);if(sr&&n==="length"){const nr=Number(Ae);er.forEach((ar,or)=>{(or==="length"||or===ARRAY_ITERATE_KEY||!isSymbol(or)&&or>=nr)&&ir.push(ar)})}else{const nr=ar=>ar&&ir.push(ar);switch(n!==void 0&&nr(er.get(n)),rr&&nr(er.get(ARRAY_ITERATE_KEY)),t){case"add":sr?rr&&nr(er.get("length")):(nr(er.get(ITERATE_KEY)),isMap(s)&&nr(er.get(MAP_KEY_ITERATE_KEY)));break;case"delete":sr||(nr(er.get(ITERATE_KEY)),isMap(s)&&nr(er.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(s)&&nr(er.get(ITERATE_KEY));break}}}startBatch();for(const sr of ir)sr.trigger();endBatch()}function getDepFromReactive(s,t){var n;return(n=targetMap.get(s))==null?void 0:n.get(t)}function reactiveReadArray(s){const t=toRaw(s);return t===s?t:(track(t,"iterate",ARRAY_ITERATE_KEY),isShallow(s)?t:t.map(toReactive))}function shallowReadArray(s){return track(s=toRaw(s),"iterate",ARRAY_ITERATE_KEY),s}const arrayInstrumentations={__proto__:null,[Symbol.iterator](){return iterator(this,Symbol.iterator,toReactive)},concat(...s){return reactiveReadArray(this).concat(...s.map(t=>isArray$2(t)?reactiveReadArray(t):t))},entries(){return iterator(this,"entries",s=>(s[1]=toReactive(s[1]),s))},every(s,t){return apply(this,"every",s,t,void 0,arguments)},filter(s,t){return apply(this,"filter",s,t,n=>n.map(toReactive),arguments)},find(s,t){return apply(this,"find",s,t,toReactive,arguments)},findIndex(s,t){return apply(this,"findIndex",s,t,void 0,arguments)},findLast(s,t){return apply(this,"findLast",s,t,toReactive,arguments)},findLastIndex(s,t){return apply(this,"findLastIndex",s,t,void 0,arguments)},forEach(s,t){return apply(this,"forEach",s,t,void 0,arguments)},includes(...s){return searchProxy(this,"includes",s)},indexOf(...s){return searchProxy(this,"indexOf",s)},join(s){return reactiveReadArray(this).join(s)},lastIndexOf(...s){return searchProxy(this,"lastIndexOf",s)},map(s,t){return apply(this,"map",s,t,void 0,arguments)},pop(){return noTracking(this,"pop")},push(...s){return noTracking(this,"push",s)},reduce(s,...t){return reduce(this,"reduce",s,t)},reduceRight(s,...t){return reduce(this,"reduceRight",s,t)},shift(){return noTracking(this,"shift")},some(s,t){return apply(this,"some",s,t,void 0,arguments)},splice(...s){return noTracking(this,"splice",s)},toReversed(){return reactiveReadArray(this).toReversed()},toSorted(s){return reactiveReadArray(this).toSorted(s)},toSpliced(...s){return reactiveReadArray(this).toSpliced(...s)},unshift(...s){return noTracking(this,"unshift",s)},values(){return iterator(this,"values",toReactive)}};function iterator(s,t,n){const Ae=shallowReadArray(s),Ne=Ae[t]();return Ae!==s&&!isShallow(s)&&(Ne._next=Ne.next,Ne.next=()=>{const tr=Ne._next();return tr.value&&(tr.value=n(tr.value)),tr}),Ne}const arrayProto=Array.prototype;function apply(s,t,n,Ae,Ne,tr){const er=shallowReadArray(s),ir=er!==s&&!isShallow(s),sr=er[t];if(sr!==arrayProto[t]){const ar=sr.apply(s,tr);return ir?toReactive(ar):ar}let rr=n;er!==s&&(ir?rr=function(ar,or){return n.call(this,toReactive(ar),or,s)}:n.length>2&&(rr=function(ar,or){return n.call(this,ar,or,s)}));const nr=sr.call(er,rr,Ae);return ir&&Ne?Ne(nr):nr}function reduce(s,t,n,Ae){const Ne=shallowReadArray(s);let tr=n;return Ne!==s&&(isShallow(s)?n.length>3&&(tr=function(er,ir,sr){return n.call(this,er,ir,sr,s)}):tr=function(er,ir,sr){return n.call(this,er,toReactive(ir),sr,s)}),Ne[t](tr,...Ae)}function searchProxy(s,t,n){const Ae=toRaw(s);track(Ae,"iterate",ARRAY_ITERATE_KEY);const Ne=Ae[t](...n);return(Ne===-1||Ne===!1)&&isProxy(n[0])?(n[0]=toRaw(n[0]),Ae[t](...n)):Ne}function noTracking(s,t,n=[]){pauseTracking(),startBatch();const Ae=toRaw(s)[t].apply(s,n);return endBatch(),resetTracking(),Ae}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(s=>s!=="arguments"&&s!=="caller").map(s=>Symbol[s]).filter(isSymbol));function hasOwnProperty$1(s){isSymbol(s)||(s=String(s));const t=toRaw(this);return track(t,"has",s),t.hasOwnProperty(s)}class BaseReactiveHandler{constructor(t=!1,n=!1){this._isReadonly=t,this._isShallow=n}get(t,n,Ae){const Ne=this._isReadonly,tr=this._isShallow;if(n==="__v_isReactive")return!Ne;if(n==="__v_isReadonly")return Ne;if(n==="__v_isShallow")return tr;if(n==="__v_raw")return Ae===(Ne?tr?shallowReadonlyMap:readonlyMap:tr?shallowReactiveMap:reactiveMap).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(Ae)?t:void 0;const er=isArray$2(t);if(!Ne){let sr;if(er&&(sr=arrayInstrumentations[n]))return sr;if(n==="hasOwnProperty")return hasOwnProperty$1}const ir=Reflect.get(t,n,isRef(t)?t:Ae);return(isSymbol(n)?builtInSymbols.has(n):isNonTrackableKeys(n))||(Ne||track(t,"get",n),tr)?ir:isRef(ir)?er&&isIntegerKey(n)?ir:ir.value:isObject$2(ir)?Ne?readonly(ir):reactive(ir):ir}}class MutableReactiveHandler extends BaseReactiveHandler{constructor(t=!1){super(!1,t)}set(t,n,Ae,Ne){let tr=t[n];if(!this._isShallow){const sr=isReadonly(tr);if(!isShallow(Ae)&&!isReadonly(Ae)&&(tr=toRaw(tr),Ae=toRaw(Ae)),!isArray$2(t)&&isRef(tr)&&!isRef(Ae))return sr?!1:(tr.value=Ae,!0)}const er=isArray$2(t)&&isIntegerKey(n)?Number(n)<t.length:hasOwn(t,n),ir=Reflect.set(t,n,Ae,isRef(t)?t:Ne);return t===toRaw(Ne)&&(er?hasChanged(Ae,tr)&&trigger(t,"set",n,Ae):trigger(t,"add",n,Ae)),ir}deleteProperty(t,n){const Ae=hasOwn(t,n);t[n];const Ne=Reflect.deleteProperty(t,n);return Ne&&Ae&&trigger(t,"delete",n,void 0),Ne}has(t,n){const Ae=Reflect.has(t,n);return(!isSymbol(n)||!builtInSymbols.has(n))&&track(t,"has",n),Ae}ownKeys(t){return track(t,"iterate",isArray$2(t)?"length":ITERATE_KEY),Reflect.ownKeys(t)}}class ReadonlyReactiveHandler extends BaseReactiveHandler{constructor(t=!1){super(!0,t)}set(t,n){return!0}deleteProperty(t,n){return!0}}const mutableHandlers=new MutableReactiveHandler,readonlyHandlers=new ReadonlyReactiveHandler,shallowReactiveHandlers=new MutableReactiveHandler(!0),shallowReadonlyHandlers=new ReadonlyReactiveHandler(!0),toShallow=s=>s,getProto=s=>Reflect.getPrototypeOf(s);function get(s,t,n=!1,Ae=!1){s=s.__v_raw;const Ne=toRaw(s),tr=toRaw(t);n||(hasChanged(t,tr)&&track(Ne,"get",t),track(Ne,"get",tr));const{has:er}=getProto(Ne),ir=Ae?toShallow:n?toReadonly:toReactive;if(er.call(Ne,t))return ir(s.get(t));if(er.call(Ne,tr))return ir(s.get(tr));s!==Ne&&s.get(t)}function has(s,t=!1){const n=this.__v_raw,Ae=toRaw(n),Ne=toRaw(s);return t||(hasChanged(s,Ne)&&track(Ae,"has",s),track(Ae,"has",Ne)),s===Ne?n.has(s):n.has(s)||n.has(Ne)}function size$1(s,t=!1){return s=s.__v_raw,!t&&track(toRaw(s),"iterate",ITERATE_KEY),Reflect.get(s,"size",s)}function add(s,t=!1){!t&&!isShallow(s)&&!isReadonly(s)&&(s=toRaw(s));const n=toRaw(this);return getProto(n).has.call(n,s)||(n.add(s),trigger(n,"add",s,s)),this}function set(s,t,n=!1){!n&&!isShallow(t)&&!isReadonly(t)&&(t=toRaw(t));const Ae=toRaw(this),{has:Ne,get:tr}=getProto(Ae);let er=Ne.call(Ae,s);er||(s=toRaw(s),er=Ne.call(Ae,s));const ir=tr.call(Ae,s);return Ae.set(s,t),er?hasChanged(t,ir)&&trigger(Ae,"set",s,t):trigger(Ae,"add",s,t),this}function deleteEntry(s){const t=toRaw(this),{has:n,get:Ae}=getProto(t);let Ne=n.call(t,s);Ne||(s=toRaw(s),Ne=n.call(t,s)),Ae&&Ae.call(t,s);const tr=t.delete(s);return Ne&&trigger(t,"delete",s,void 0),tr}function clear(){const s=toRaw(this),t=s.size!==0,n=s.clear();return t&&trigger(s,"clear",void 0,void 0),n}function createForEach(s,t){return function(Ae,Ne){const tr=this,er=tr.__v_raw,ir=toRaw(er),sr=t?toShallow:s?toReadonly:toReactive;return!s&&track(ir,"iterate",ITERATE_KEY),er.forEach((rr,nr)=>Ae.call(Ne,sr(rr),sr(nr),tr))}}function createIterableMethod(s,t,n){return function(...Ae){const Ne=this.__v_raw,tr=toRaw(Ne),er=isMap(tr),ir=s==="entries"||s===Symbol.iterator&&er,sr=s==="keys"&&er,rr=Ne[s](...Ae),nr=n?toShallow:t?toReadonly:toReactive;return!t&&track(tr,"iterate",sr?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:ar,done:or}=rr.next();return or?{value:ar,done:or}:{value:ir?[nr(ar[0]),nr(ar[1])]:nr(ar),done:or}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(s){return function(...t){return s==="delete"?!1:s==="clear"?void 0:this}}function createInstrumentations(){const s={get(tr){return get(this,tr)},get size(){return size$1(this)},has,add,set,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},t={get(tr){return get(this,tr,!1,!0)},get size(){return size$1(this)},has,add(tr){return add.call(this,tr,!0)},set(tr,er){return set.call(this,tr,er,!0)},delete:deleteEntry,clear,forEach:createForEach(!1,!0)},n={get(tr){return get(this,tr,!0)},get size(){return size$1(this,!0)},has(tr){return has.call(this,tr,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},Ae={get(tr){return get(this,tr,!0,!0)},get size(){return size$1(this,!0)},has(tr){return has.call(this,tr,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(tr=>{s[tr]=createIterableMethod(tr,!1,!1),n[tr]=createIterableMethod(tr,!0,!1),t[tr]=createIterableMethod(tr,!1,!0),Ae[tr]=createIterableMethod(tr,!0,!0)}),[s,n,t,Ae]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(s,t){const n=t?s?shallowReadonlyInstrumentations:shallowInstrumentations:s?readonlyInstrumentations:mutableInstrumentations;return(Ae,Ne,tr)=>Ne==="__v_isReactive"?!s:Ne==="__v_isReadonly"?s:Ne==="__v_raw"?Ae:Reflect.get(hasOwn(n,Ne)&&Ne in Ae?n:Ae,Ne,tr)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},shallowReadonlyCollectionHandlers={get:createInstrumentationGetter(!0,!0)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(s){switch(s){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(s){return s.__v_skip||!Object.isExtensible(s)?0:targetTypeMap(toRawType(s))}function reactive(s){return isReadonly(s)?s:createReactiveObject(s,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(s){return createReactiveObject(s,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(s){return createReactiveObject(s,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function shallowReadonly(s){return createReactiveObject(s,!0,shallowReadonlyHandlers,shallowReadonlyCollectionHandlers,shallowReadonlyMap)}function createReactiveObject(s,t,n,Ae,Ne){if(!isObject$2(s)||s.__v_raw&&!(t&&s.__v_isReactive))return s;const tr=Ne.get(s);if(tr)return tr;const er=getTargetType(s);if(er===0)return s;const ir=new Proxy(s,er===2?Ae:n);return Ne.set(s,ir),ir}function isReactive(s){return isReadonly(s)?isReactive(s.__v_raw):!!(s&&s.__v_isReactive)}function isReadonly(s){return!!(s&&s.__v_isReadonly)}function isShallow(s){return!!(s&&s.__v_isShallow)}function isProxy(s){return s?!!s.__v_raw:!1}function toRaw(s){const t=s&&s.__v_raw;return t?toRaw(t):s}function markRaw(s){return Object.isExtensible(s)&&def(s,"__v_skip",!0),s}const toReactive=s=>isObject$2(s)?reactive(s):s,toReadonly=s=>isObject$2(s)?readonly(s):s;function isRef(s){return s?s.__v_isRef===!0:!1}function ref(s){return createRef(s,!1)}function shallowRef(s){return createRef(s,!0)}function createRef(s,t){return isRef(s)?s:new RefImpl(s,t)}class RefImpl{constructor(t,n){this.dep=new Dep,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?t:toRaw(t),this._value=n?t:toReactive(t),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(t){const n=this._rawValue,Ae=this.__v_isShallow||isShallow(t)||isReadonly(t);t=Ae?t:toRaw(t),hasChanged(t,n)&&(this._rawValue=t,this._value=Ae?t:toReactive(t),this.dep.trigger())}}function unref(s){return isRef(s)?s.value:s}const shallowUnwrapHandlers={get:(s,t,n)=>t==="__v_raw"?s:unref(Reflect.get(s,t,n)),set:(s,t,n,Ae)=>{const Ne=s[t];return isRef(Ne)&&!isRef(n)?(Ne.value=n,!0):Reflect.set(s,t,n,Ae)}};function proxyRefs(s){return isReactive(s)?s:new Proxy(s,shallowUnwrapHandlers)}function toRefs(s){const t=isArray$2(s)?new Array(s.length):{};for(const n in s)t[n]=propertyToRef(s,n);return t}class ObjectRefImpl{constructor(t,n,Ae){this._object=t,this._key=n,this._defaultValue=Ae,this.__v_isRef=!0,this._value=void 0}get value(){const t=this._object[this._key];return this._value=t===void 0?this._defaultValue:t}set value(t){this._object[this._key]=t}get dep(){return getDepFromReactive(toRaw(this._object),this._key)}}function propertyToRef(s,t,n){const Ae=s[t];return isRef(Ae)?Ae:new ObjectRefImpl(s,t,n)}class ComputedRefImpl{constructor(t,n,Ae){this.fn=t,this.setter=n,this._value=void 0,this.dep=new Dep(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=globalVersion-1,this.effect=this,this.__v_isReadonly=!n,this.isSSR=Ae}notify(){activeSub!==this&&(this.flags|=16,this.dep.notify())}get value(){const t=this.dep.track();return refreshComputed(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function computed$1(s,t,n=!1){let Ae,Ne;return isFunction$1(s)?Ae=s:(Ae=s.get,Ne=s.set),new ComputedRefImpl(Ae,Ne,n)}const INITIAL_WATCHER_VALUE={},cleanupMap=new WeakMap;let activeWatcher;function onWatcherCleanup(s,t=!1,n=activeWatcher){if(n){let Ae=cleanupMap.get(n);Ae||cleanupMap.set(n,Ae=[]),Ae.push(s)}}function watch$1(s,t,n=EMPTY_OBJ){const{immediate:Ae,deep:Ne,once:tr,scheduler:er,augmentJob:ir,call:sr}=n,rr=gr=>Ne?gr:isShallow(gr)||Ne===!1||Ne===0?traverse(gr,1):traverse(gr);let nr,ar,or,ur,hr=!1,cr=!1;if(isRef(s)?(ar=()=>s.value,hr=isShallow(s)):isReactive(s)?(ar=()=>rr(s),hr=!0):isArray$2(s)?(cr=!0,hr=s.some(gr=>isReactive(gr)||isShallow(gr)),ar=()=>s.map(gr=>{if(isRef(gr))return gr.value;if(isReactive(gr))return rr(gr);if(isFunction$1(gr))return sr?sr(gr,2):gr()})):isFunction$1(s)?t?ar=sr?()=>sr(s,2):s:ar=()=>{if(or){pauseTracking();try{or()}finally{resetTracking()}}const gr=activeWatcher;activeWatcher=nr;try{return sr?sr(s,3,[ur]):s(ur)}finally{activeWatcher=gr}}:ar=NOOP,t&&Ne){const gr=ar,fr=Ne===!0?1/0:Ne;ar=()=>traverse(gr(),fr)}const vr=getCurrentScope(),mr=()=>{nr.stop(),vr&&remove(vr.effects,nr)};if(tr)if(t){const gr=t;t=(...fr)=>{gr(...fr),mr()}}else{const gr=ar;ar=()=>{gr(),mr()}}let dr=cr?new Array(s.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const lr=gr=>{if(!(!(nr.flags&1)||!nr.dirty&&!gr))if(t){const fr=nr.run();if(Ne||hr||(cr?fr.some((yr,Er)=>hasChanged(yr,dr[Er])):hasChanged(fr,dr))){or&&or();const yr=activeWatcher;activeWatcher=nr;try{const Er=[fr,dr===INITIAL_WATCHER_VALUE?void 0:cr&&dr[0]===INITIAL_WATCHER_VALUE?[]:dr,ur];sr?sr(t,3,Er):t(...Er),dr=fr}finally{activeWatcher=yr}}}else nr.run()};return ir&&ir(lr),nr=new ReactiveEffect(ar),nr.scheduler=er?()=>er(lr,!1):lr,ur=gr=>onWatcherCleanup(gr,!1,nr),or=nr.onStop=()=>{const gr=cleanupMap.get(nr);if(gr){if(sr)sr(gr,4);else for(const fr of gr)fr();cleanupMap.delete(nr)}},t?Ae?lr(!0):dr=nr.run():er?er(lr.bind(null,!0),!0):nr.run(),mr.pause=nr.pause.bind(nr),mr.resume=nr.resume.bind(nr),mr.stop=mr,mr}function traverse(s,t=1/0,n){if(t<=0||!isObject$2(s)||s.__v_skip||(n=n||new Set,n.has(s)))return s;if(n.add(s),t--,isRef(s))traverse(s.value,t,n);else if(isArray$2(s))for(let Ae=0;Ae<s.length;Ae++)traverse(s[Ae],t,n);else if(isSet(s)||isMap(s))s.forEach(Ae=>{traverse(Ae,t,n)});else if(isPlainObject$2(s)){for(const Ae in s)traverse(s[Ae],t,n);for(const Ae of Object.getOwnPropertySymbols(s))Object.prototype.propertyIsEnumerable.call(s,Ae)&&traverse(s[Ae],t,n)}return s}/**
* @vue/runtime-core v3.5.3
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const stack=[];let isWarning=!1;function warn$1(s,...t){if(isWarning)return;isWarning=!0,pauseTracking();const n=stack.length?stack[stack.length-1].component:null,Ae=n&&n.appContext.config.warnHandler,Ne=getComponentTrace();if(Ae)callWithErrorHandling(Ae,n,11,[s+t.map(tr=>{var er,ir;return(ir=(er=tr.toString)==null?void 0:er.call(tr))!=null?ir:JSON.stringify(tr)}).join(""),n&&n.proxy,Ne.map(({vnode:tr})=>`at <${formatComponentName(n,tr.type)}>`).join(`
`),Ne]);else{const tr=[`[Vue warn]: ${s}`,...t];Ne.length&&tr.push(`
`,...formatTrace(Ne)),console.warn(...tr)}resetTracking(),isWarning=!1}function getComponentTrace(){let s=stack[stack.length-1];if(!s)return[];const t=[];for(;s;){const n=t[0];n&&n.vnode===s?n.recurseCount++:t.push({vnode:s,recurseCount:0});const Ae=s.component&&s.component.parent;s=Ae&&Ae.vnode}return t}function formatTrace(s){const t=[];return s.forEach((n,Ae)=>{t.push(...Ae===0?[]:[`
`],...formatTraceEntry(n))}),t}function formatTraceEntry({vnode:s,recurseCount:t}){const n=t>0?`... (${t} recursive calls)`:"",Ae=s.component?s.component.parent==null:!1,Ne=` at <${formatComponentName(s.component,s.type,Ae)}`,tr=">"+n;return s.props?[Ne,...formatProps(s.props),tr]:[Ne+tr]}function formatProps(s){const t=[],n=Object.keys(s);return n.slice(0,3).forEach(Ae=>{t.push(...formatProp(Ae,s[Ae]))}),n.length>3&&t.push(" ..."),t}function formatProp(s,t,n){return isString$1(t)?(t=JSON.stringify(t),n?t:[`${s}=${t}`]):typeof t=="number"||typeof t=="boolean"||t==null?n?t:[`${s}=${t}`]:isRef(t)?(t=formatProp(s,toRaw(t.value),!0),n?t:[`${s}=Ref<`,t,">"]):isFunction$1(t)?[`${s}=fn${t.name?`<${t.name}>`:""}`]:(t=toRaw(t),n?t:[`${s}=`,t])}function callWithErrorHandling(s,t,n,Ae){try{return Ae?s(...Ae):s()}catch(Ne){handleError(Ne,t,n)}}function callWithAsyncErrorHandling(s,t,n,Ae){if(isFunction$1(s)){const Ne=callWithErrorHandling(s,t,n,Ae);return Ne&&isPromise(Ne)&&Ne.catch(tr=>{handleError(tr,t,n)}),Ne}if(isArray$2(s)){const Ne=[];for(let tr=0;tr<s.length;tr++)Ne.push(callWithAsyncErrorHandling(s[tr],t,n,Ae));return Ne}}function handleError(s,t,n,Ae=!0){const Ne=t?t.vnode:null,{errorHandler:tr,throwUnhandledErrorInProduction:er}=t&&t.appContext.config||EMPTY_OBJ;if(t){let ir=t.parent;const sr=t.proxy,rr=`https://vuejs.org/error-reference/#runtime-${n}`;for(;ir;){const nr=ir.ec;if(nr){for(let ar=0;ar<nr.length;ar++)if(nr[ar](s,sr,rr)===!1)return}ir=ir.parent}if(tr){pauseTracking(),callWithErrorHandling(tr,null,10,[s,sr,rr]),resetTracking();return}}logError(s,n,Ne,Ae,er)}function logError(s,t,n,Ae=!0,Ne=!1){if(Ne)throw s;console.error(s)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick$1(s){const t=currentFlushPromise||resolvedPromise;return s?t.then(this?s.bind(this):s):t}function findInsertionIndex$1(s){let t=isFlushing?flushIndex+1:0,n=queue.length;for(;t<n;){const Ae=t+n>>>1,Ne=queue[Ae],tr=getId(Ne);tr<s||tr===s&&Ne.flags&2?t=Ae+1:n=Ae}return t}function queueJob(s){if(!(s.flags&1)){const t=getId(s),n=queue[queue.length-1];!n||!(s.flags&2)&&t>=getId(n)?queue.push(s):queue.splice(findInsertionIndex$1(t),0,s),s.flags|=1,queueFlush()}}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function queuePostFlushCb(s){isArray$2(s)?pendingPostFlushCbs.push(...s):activePostFlushCbs&&s.id===-1?activePostFlushCbs.splice(postFlushIndex+1,0,s):s.flags&1||(pendingPostFlushCbs.push(s),s.flags|=1),queueFlush()}function flushPreFlushCbs(s,t,n=isFlushing?flushIndex+1:0){for(;n<queue.length;n++){const Ae=queue[n];if(Ae&&Ae.flags&2){if(s&&Ae.id!==s.uid)continue;queue.splice(n,1),n--,Ae.flags&4&&(Ae.flags&=-2),Ae(),Ae.flags&=-2}}}function flushPostFlushCbs(s){if(pendingPostFlushCbs.length){const t=[...new Set(pendingPostFlushCbs)].sort((n,Ae)=>getId(n)-getId(Ae));if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...t);return}for(activePostFlushCbs=t,postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++){const n=activePostFlushCbs[postFlushIndex];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}activePostFlushCbs=null,postFlushIndex=0}}const getId=s=>s.id==null?s.flags&2?-1:1/0:s.id;function flushJobs(s){isFlushPending=!1,isFlushing=!0;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const t=queue[flushIndex];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),callWithErrorHandling(t,t.i,t.i?15:14),t.flags&=-2)}}finally{for(;flushIndex<queue.length;flushIndex++){const t=queue[flushIndex];t&&(t.flags&=-2)}flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(s){const t=currentRenderingInstance;return currentRenderingInstance=s,currentScopeId=s&&s.type.__scopeId||null,t}function withCtx(s,t=currentRenderingInstance,n){if(!t||s._n)return s;const Ae=(...Ne)=>{Ae._d&&setBlockTracking(-1);const tr=setCurrentRenderingInstance(t);let er;try{er=s(...Ne)}finally{setCurrentRenderingInstance(tr),Ae._d&&setBlockTracking(1)}return er};return Ae._n=!0,Ae._c=!0,Ae._d=!0,Ae}function withDirectives(s,t){if(currentRenderingInstance===null)return s;const n=getComponentPublicInstance(currentRenderingInstance),Ae=s.dirs||(s.dirs=[]);for(let Ne=0;Ne<t.length;Ne++){let[tr,er,ir,sr=EMPTY_OBJ]=t[Ne];tr&&(isFunction$1(tr)&&(tr={mounted:tr,updated:tr}),tr.deep&&traverse(er),Ae.push({dir:tr,instance:n,value:er,oldValue:void 0,arg:ir,modifiers:sr}))}return s}function invokeDirectiveHook(s,t,n,Ae){const Ne=s.dirs,tr=t&&t.dirs;for(let er=0;er<Ne.length;er++){const ir=Ne[er];tr&&(ir.oldValue=tr[er].value);let sr=ir.dir[Ae];sr&&(pauseTracking(),callWithAsyncErrorHandling(sr,n,8,[s.el,ir,s,t]),resetTracking())}}const TeleportEndKey=Symbol("_vte"),isTeleport=s=>s.__isTeleport;function setTransitionHooks(s,t){s.shapeFlag&6&&s.component?(s.transition=t,setTransitionHooks(s.component.subTree,t)):s.shapeFlag&128?(s.ssContent.transition=t.clone(s.ssContent),s.ssFallback.transition=t.clone(s.ssFallback)):s.transition=t}/*! #__NO_SIDE_EFFECTS__ */function defineComponent(s,t){return isFunction$1(s)?extend$1({name:s.name},t,{setup:s}):s}function markAsyncBoundary(s){s.ids=[s.ids[0]+s.ids[2]+++"-",0,0]}function setRef(s,t,n,Ae,Ne=!1){if(isArray$2(s)){s.forEach((hr,cr)=>setRef(hr,t&&(isArray$2(t)?t[cr]:t),n,Ae,Ne));return}if(isAsyncWrapper(Ae)&&!Ne)return;const tr=Ae.shapeFlag&4?getComponentPublicInstance(Ae.component):Ae.el,er=Ne?null:tr,{i:ir,r:sr}=s,rr=t&&t.r,nr=ir.refs===EMPTY_OBJ?ir.refs={}:ir.refs,ar=ir.setupState,or=toRaw(ar),ur=ar===EMPTY_OBJ?()=>!1:hr=>hasOwn(or,hr);if(rr!=null&&rr!==sr&&(isString$1(rr)?(nr[rr]=null,ur(rr)&&(ar[rr]=null)):isRef(rr)&&(rr.value=null)),isFunction$1(sr))callWithErrorHandling(sr,ir,12,[er,nr]);else{const hr=isString$1(sr),cr=isRef(sr);if(hr||cr){const vr=()=>{if(s.f){const mr=hr?ur(sr)?ar[sr]:nr[sr]:sr.value;Ne?isArray$2(mr)&&remove(mr,tr):isArray$2(mr)?mr.includes(tr)||mr.push(tr):hr?(nr[sr]=[tr],ur(sr)&&(ar[sr]=nr[sr])):(sr.value=[tr],s.k&&(nr[s.k]=sr.value))}else hr?(nr[sr]=er,ur(sr)&&(ar[sr]=er)):cr&&(sr.value=er,s.k&&(nr[s.k]=er))};er?(vr.id=-1,queuePostRenderEffect(vr,n)):vr()}}}const isComment=s=>s.nodeType===8;function forEachElement(s,t){if(isComment(s)&&s.data==="["){let n=1,Ae=s.nextSibling;for(;Ae;){if(Ae.nodeType===1)t(Ae);else if(isComment(Ae))if(Ae.data==="]"){if(--n===0)break}else Ae.data==="["&&n++;Ae=Ae.nextSibling}}else t(s)}const isAsyncWrapper=s=>!!s.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function defineAsyncComponent(s){isFunction$1(s)&&(s={loader:s});const{loader:t,loadingComponent:n,errorComponent:Ae,delay:Ne=200,hydrate:tr,timeout:er,suspensible:ir=!0,onError:sr}=s;let rr=null,nr,ar=0;const or=()=>(ar++,rr=null,ur()),ur=()=>{let hr;return rr||(hr=rr=t().catch(cr=>{if(cr=cr instanceof Error?cr:new Error(String(cr)),sr)return new Promise((vr,mr)=>{sr(cr,()=>vr(or()),()=>mr(cr),ar+1)});throw cr}).then(cr=>hr!==rr&&rr?rr:(cr&&(cr.__esModule||cr[Symbol.toStringTag]==="Module")&&(cr=cr.default),nr=cr,cr)))};return defineComponent({name:"AsyncComponentWrapper",__asyncLoader:ur,__asyncHydrate(hr,cr,vr){const mr=tr?()=>{const dr=tr(vr,lr=>forEachElement(hr,lr));dr&&(cr.bum||(cr.bum=[])).push(dr)}:vr;nr?mr():ur().then(()=>!cr.isUnmounted&&mr())},get __asyncResolved(){return nr},setup(){const hr=currentInstance;if(markAsyncBoundary(hr),nr)return()=>createInnerComp(nr,hr);const cr=lr=>{rr=null,handleError(lr,hr,13,!Ae)};if(ir&&hr.suspense||isInSSRComponentSetup)return ur().then(lr=>()=>createInnerComp(lr,hr)).catch(lr=>(cr(lr),()=>Ae?createVNode(Ae,{error:lr}):null));const vr=ref(!1),mr=ref(),dr=ref(!!Ne);return Ne&&setTimeout(()=>{dr.value=!1},Ne),er!=null&&setTimeout(()=>{if(!vr.value&&!mr.value){const lr=new Error(`Async component timed out after ${er}ms.`);cr(lr),mr.value=lr}},er),ur().then(()=>{vr.value=!0,hr.parent&&isKeepAlive(hr.parent.vnode)&&queueJob(hr.parent.update)}).catch(lr=>{cr(lr),mr.value=lr}),()=>{if(vr.value&&nr)return createInnerComp(nr,hr);if(mr.value&&Ae)return createVNode(Ae,{error:mr.value});if(n&&!dr.value)return createVNode(n)}}})}function createInnerComp(s,t){const{ref:n,props:Ae,children:Ne,ce:tr}=t.vnode,er=createVNode(s,Ae,Ne);return er.ref=n,er.ce=tr,delete t.vnode.ce,er}const isKeepAlive=s=>s.type.__isKeepAlive;function onActivated(s,t){registerKeepAliveHook(s,"a",t)}function onDeactivated(s,t){registerKeepAliveHook(s,"da",t)}function registerKeepAliveHook(s,t,n=currentInstance){const Ae=s.__wdc||(s.__wdc=()=>{let Ne=n;for(;Ne;){if(Ne.isDeactivated)return;Ne=Ne.parent}return s()});if(injectHook(t,Ae,n),n){let Ne=n.parent;for(;Ne&&Ne.parent;)isKeepAlive(Ne.parent.vnode)&&injectToKeepAliveRoot(Ae,t,n,Ne),Ne=Ne.parent}}function injectToKeepAliveRoot(s,t,n,Ae){const Ne=injectHook(t,s,Ae,!0);onUnmounted(()=>{remove(Ae[t],Ne)},n)}function injectHook(s,t,n=currentInstance,Ae=!1){if(n){const Ne=n[s]||(n[s]=[]),tr=t.__weh||(t.__weh=(...er)=>{pauseTracking();const ir=setCurrentInstance(n),sr=callWithAsyncErrorHandling(t,n,s,er);return ir(),resetTracking(),sr});return Ae?Ne.unshift(tr):Ne.push(tr),tr}}const createHook=s=>(t,n=currentInstance)=>{(!isInSSRComponentSetup||s==="sp")&&injectHook(s,(...Ae)=>t(...Ae),n)},onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(s,t=currentInstance){injectHook("ec",s,t)}const COMPONENTS="components";function resolveComponent(s,t){return resolveAsset(COMPONENTS,s,!0,t)||s}const NULL_DYNAMIC_COMPONENT=Symbol.for("v-ndc");function resolveDynamicComponent(s){return isString$1(s)?resolveAsset(COMPONENTS,s,!1)||s:s||NULL_DYNAMIC_COMPONENT}function resolveAsset(s,t,n=!0,Ae=!1){const Ne=currentRenderingInstance||currentInstance;if(Ne){const tr=Ne.type;{const ir=getComponentName(tr,!1);if(ir&&(ir===t||ir===camelize(t)||ir===capitalize(camelize(t))))return tr}const er=resolve(Ne[s]||tr[s],t)||resolve(Ne.appContext[s],t);return!er&&Ae?tr:er}}function resolve(s,t){return s&&(s[t]||s[camelize(t)]||s[capitalize(camelize(t))])}function renderList(s,t,n,Ae){let Ne;const tr=n,er=isArray$2(s);if(er||isString$1(s)){const ir=er&&isReactive(s);ir&&(s=shallowReadArray(s)),Ne=new Array(s.length);for(let sr=0,rr=s.length;sr<rr;sr++)Ne[sr]=t(ir?toReactive(s[sr]):s[sr],sr,void 0,tr)}else if(typeof s=="number"){Ne=new Array(s);for(let ir=0;ir<s;ir++)Ne[ir]=t(ir+1,ir,void 0,tr)}else if(isObject$2(s))if(s[Symbol.iterator])Ne=Array.from(s,(ir,sr)=>t(ir,sr,void 0,tr));else{const ir=Object.keys(s);Ne=new Array(ir.length);for(let sr=0,rr=ir.length;sr<rr;sr++){const nr=ir[sr];Ne[sr]=t(s[nr],nr,sr,tr)}}else Ne=[];return Ne}const getPublicInstance=s=>s?isStatefulComponent(s)?getComponentPublicInstance(s):getPublicInstance(s.parent):null,publicPropertiesMap=extend$1(Object.create(null),{$:s=>s,$el:s=>s.vnode.el,$data:s=>s.data,$props:s=>s.props,$attrs:s=>s.attrs,$slots:s=>s.slots,$refs:s=>s.refs,$parent:s=>getPublicInstance(s.parent),$root:s=>getPublicInstance(s.root),$host:s=>s.ce,$emit:s=>s.emit,$options:s=>resolveMergedOptions(s),$forceUpdate:s=>s.f||(s.f=()=>{queueJob(s.update)}),$nextTick:s=>s.n||(s.n=nextTick$1.bind(s.proxy)),$watch:s=>instanceWatch.bind(s)}),hasSetupBinding=(s,t)=>s!==EMPTY_OBJ&&!s.__isScriptSetup&&hasOwn(s,t),PublicInstanceProxyHandlers={get({_:s},t){if(t==="__v_skip")return!0;const{ctx:n,setupState:Ae,data:Ne,props:tr,accessCache:er,type:ir,appContext:sr}=s;let rr;if(t[0]!=="$"){const ur=er[t];if(ur!==void 0)switch(ur){case 1:return Ae[t];case 2:return Ne[t];case 4:return n[t];case 3:return tr[t]}else{if(hasSetupBinding(Ae,t))return er[t]=1,Ae[t];if(Ne!==EMPTY_OBJ&&hasOwn(Ne,t))return er[t]=2,Ne[t];if((rr=s.propsOptions[0])&&hasOwn(rr,t))return er[t]=3,tr[t];if(n!==EMPTY_OBJ&&hasOwn(n,t))return er[t]=4,n[t];shouldCacheAccess&&(er[t]=0)}}const nr=publicPropertiesMap[t];let ar,or;if(nr)return t==="$attrs"&&track(s.attrs,"get",""),nr(s);if((ar=ir.__cssModules)&&(ar=ar[t]))return ar;if(n!==EMPTY_OBJ&&hasOwn(n,t))return er[t]=4,n[t];if(or=sr.config.globalProperties,hasOwn(or,t))return or[t]},set({_:s},t,n){const{data:Ae,setupState:Ne,ctx:tr}=s;return hasSetupBinding(Ne,t)?(Ne[t]=n,!0):Ae!==EMPTY_OBJ&&hasOwn(Ae,t)?(Ae[t]=n,!0):hasOwn(s.props,t)||t[0]==="$"&&t.slice(1)in s?!1:(tr[t]=n,!0)},has({_:{data:s,setupState:t,accessCache:n,ctx:Ae,appContext:Ne,propsOptions:tr}},er){let ir;return!!n[er]||s!==EMPTY_OBJ&&hasOwn(s,er)||hasSetupBinding(t,er)||(ir=tr[0])&&hasOwn(ir,er)||hasOwn(Ae,er)||hasOwn(publicPropertiesMap,er)||hasOwn(Ne.config.globalProperties,er)},defineProperty(s,t,n){return n.get!=null?s._.accessCache[t]=0:hasOwn(n,"value")&&this.set(s,t,n.value,null),Reflect.defineProperty(s,t,n)}};function normalizePropsOrEmits(s){return isArray$2(s)?s.reduce((t,n)=>(t[n]=null,t),{}):s}let shouldCacheAccess=!0;function applyOptions(s){const t=resolveMergedOptions(s),n=s.proxy,Ae=s.ctx;shouldCacheAccess=!1,t.beforeCreate&&callHook(t.beforeCreate,s,"bc");const{data:Ne,computed:tr,methods:er,watch:ir,provide:sr,inject:rr,created:nr,beforeMount:ar,mounted:or,beforeUpdate:ur,updated:hr,activated:cr,deactivated:vr,beforeDestroy:mr,beforeUnmount:dr,destroyed:lr,unmounted:gr,render:fr,renderTracked:yr,renderTriggered:Er,errorCaptured:wr,serverPrefetch:Dr,expose:kr,inheritAttrs:zr,components:Vr,directives:Hr,filters:Sr}=t;if(rr&&resolveInjections(rr,Ae,null),er)for(const Nr in er){const Tr=er[Nr];isFunction$1(Tr)&&(Ae[Nr]=Tr.bind(n))}if(Ne){const Nr=Ne.call(n,n);isObject$2(Nr)&&(s.data=reactive(Nr))}if(shouldCacheAccess=!0,tr)for(const Nr in tr){const Tr=tr[Nr],Lr=isFunction$1(Tr)?Tr.bind(n,n):isFunction$1(Tr.get)?Tr.get.bind(n,n):NOOP,Ir=!isFunction$1(Tr)&&isFunction$1(Tr.set)?Tr.set.bind(n):NOOP,Gr=computed({get:Lr,set:Ir});Object.defineProperty(Ae,Nr,{enumerable:!0,configurable:!0,get:()=>Gr.value,set:Br=>Gr.value=Br})}if(ir)for(const Nr in ir)createWatcher(ir[Nr],Ae,n,Nr);if(sr){const Nr=isFunction$1(sr)?sr.call(n):sr;Reflect.ownKeys(Nr).forEach(Tr=>{provide(Tr,Nr[Tr])})}nr&&callHook(nr,s,"c");function _r(Nr,Tr){isArray$2(Tr)?Tr.forEach(Lr=>Nr(Lr.bind(n))):Tr&&Nr(Tr.bind(n))}if(_r(onBeforeMount,ar),_r(onMounted,or),_r(onBeforeUpdate,ur),_r(onUpdated,hr),_r(onActivated,cr),_r(onDeactivated,vr),_r(onErrorCaptured,wr),_r(onRenderTracked,yr),_r(onRenderTriggered,Er),_r(onBeforeUnmount,dr),_r(onUnmounted,gr),_r(onServerPrefetch,Dr),isArray$2(kr))if(kr.length){const Nr=s.exposed||(s.exposed={});kr.forEach(Tr=>{Object.defineProperty(Nr,Tr,{get:()=>n[Tr],set:Lr=>n[Tr]=Lr})})}else s.exposed||(s.exposed={});fr&&s.render===NOOP&&(s.render=fr),zr!=null&&(s.inheritAttrs=zr),Vr&&(s.components=Vr),Hr&&(s.directives=Hr),Dr&&markAsyncBoundary(s)}function resolveInjections(s,t,n=NOOP){isArray$2(s)&&(s=normalizeInject(s));for(const Ae in s){const Ne=s[Ae];let tr;isObject$2(Ne)?"default"in Ne?tr=inject(Ne.from||Ae,Ne.default,!0):tr=inject(Ne.from||Ae):tr=inject(Ne),isRef(tr)?Object.defineProperty(t,Ae,{enumerable:!0,configurable:!0,get:()=>tr.value,set:er=>tr.value=er}):t[Ae]=tr}}function callHook(s,t,n){callWithAsyncErrorHandling(isArray$2(s)?s.map(Ae=>Ae.bind(t.proxy)):s.bind(t.proxy),t,n)}function createWatcher(s,t,n,Ae){let Ne=Ae.includes(".")?createPathGetter(n,Ae):()=>n[Ae];if(isString$1(s)){const tr=t[s];isFunction$1(tr)&&watch(Ne,tr)}else if(isFunction$1(s))watch(Ne,s.bind(n));else if(isObject$2(s))if(isArray$2(s))s.forEach(tr=>createWatcher(tr,t,n,Ae));else{const tr=isFunction$1(s.handler)?s.handler.bind(n):t[s.handler];isFunction$1(tr)&&watch(Ne,tr,s)}}function resolveMergedOptions(s){const t=s.type,{mixins:n,extends:Ae}=t,{mixins:Ne,optionsCache:tr,config:{optionMergeStrategies:er}}=s.appContext,ir=tr.get(t);let sr;return ir?sr=ir:!Ne.length&&!n&&!Ae?sr=t:(sr={},Ne.length&&Ne.forEach(rr=>mergeOptions$1(sr,rr,er,!0)),mergeOptions$1(sr,t,er)),isObject$2(t)&&tr.set(t,sr),sr}function mergeOptions$1(s,t,n,Ae=!1){const{mixins:Ne,extends:tr}=t;tr&&mergeOptions$1(s,tr,n,!0),Ne&&Ne.forEach(er=>mergeOptions$1(s,er,n,!0));for(const er in t)if(!(Ae&&er==="expose")){const ir=internalOptionMergeStrats[er]||n&&n[er];s[er]=ir?ir(s[er],t[er]):t[er]}return s}const internalOptionMergeStrats={data:mergeDataFn,props:mergeEmitsOrPropsOptions,emits:mergeEmitsOrPropsOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(s,t){return t?s?function(){return extend$1(isFunction$1(s)?s.call(this,this):s,isFunction$1(t)?t.call(this,this):t)}:t:s}function mergeInject(s,t){return mergeObjectOptions(normalizeInject(s),normalizeInject(t))}function normalizeInject(s){if(isArray$2(s)){const t={};for(let n=0;n<s.length;n++)t[s[n]]=s[n];return t}return s}function mergeAsArray(s,t){return s?[...new Set([].concat(s,t))]:t}function mergeObjectOptions(s,t){return s?extend$1(Object.create(null),s,t):t}function mergeEmitsOrPropsOptions(s,t){return s?isArray$2(s)&&isArray$2(t)?[...new Set([...s,...t])]:extend$1(Object.create(null),normalizePropsOrEmits(s),normalizePropsOrEmits(t??{})):t}function mergeWatchOptions(s,t){if(!s)return t;if(!t)return s;const n=extend$1(Object.create(null),s);for(const Ae in t)n[Ae]=mergeAsArray(s[Ae],t[Ae]);return n}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(s,t){return function(Ae,Ne=null){isFunction$1(Ae)||(Ae=extend$1({},Ae)),Ne!=null&&!isObject$2(Ne)&&(Ne=null);const tr=createAppContext(),er=new WeakSet,ir=[];let sr=!1;const rr=tr.app={_uid:uid$1++,_component:Ae,_props:Ne,_container:null,_context:tr,_instance:null,version,get config(){return tr.config},set config(nr){},use(nr,...ar){return er.has(nr)||(nr&&isFunction$1(nr.install)?(er.add(nr),nr.install(rr,...ar)):isFunction$1(nr)&&(er.add(nr),nr(rr,...ar))),rr},mixin(nr){return tr.mixins.includes(nr)||tr.mixins.push(nr),rr},component(nr,ar){return ar?(tr.components[nr]=ar,rr):tr.components[nr]},directive(nr,ar){return ar?(tr.directives[nr]=ar,rr):tr.directives[nr]},mount(nr,ar,or){if(!sr){const ur=rr._ceVNode||createVNode(Ae,Ne);return ur.appContext=tr,or===!0?or="svg":or===!1&&(or=void 0),ar&&t?t(ur,nr):s(ur,nr,or),sr=!0,rr._container=nr,nr.__vue_app__=rr,getComponentPublicInstance(ur.component)}},onUnmount(nr){ir.push(nr)},unmount(){sr&&(callWithAsyncErrorHandling(ir,rr._instance,16),s(null,rr._container),delete rr._container.__vue_app__)},provide(nr,ar){return tr.provides[nr]=ar,rr},runWithContext(nr){const ar=currentApp;currentApp=rr;try{return nr()}finally{currentApp=ar}}};return rr}}let currentApp=null;function provide(s,t){if(currentInstance){let n=currentInstance.provides;const Ae=currentInstance.parent&&currentInstance.parent.provides;Ae===n&&(n=currentInstance.provides=Object.create(Ae)),n[s]=t}}function inject(s,t,n=!1){const Ae=currentInstance||currentRenderingInstance;if(Ae||currentApp){const Ne=currentApp?currentApp._context.provides:Ae?Ae.parent==null?Ae.vnode.appContext&&Ae.vnode.appContext.provides:Ae.parent.provides:void 0;if(Ne&&s in Ne)return Ne[s];if(arguments.length>1)return n&&isFunction$1(t)?t.call(Ae&&Ae.proxy):t}}function hasInjectionContext(){return!!(currentInstance||currentRenderingInstance||currentApp)}const internalObjectProto={},createInternalObject=()=>Object.create(internalObjectProto),isInternalObject=s=>Object.getPrototypeOf(s)===internalObjectProto;function initProps(s,t,n,Ae=!1){const Ne={},tr=createInternalObject();s.propsDefaults=Object.create(null),setFullProps(s,t,Ne,tr);for(const er in s.propsOptions[0])er in Ne||(Ne[er]=void 0);n?s.props=Ae?Ne:shallowReactive(Ne):s.type.props?s.props=Ne:s.props=tr,s.attrs=tr}function updateProps(s,t,n,Ae){const{props:Ne,attrs:tr,vnode:{patchFlag:er}}=s,ir=toRaw(Ne),[sr]=s.propsOptions;let rr=!1;if((Ae||er>0)&&!(er&16)){if(er&8){const nr=s.vnode.dynamicProps;for(let ar=0;ar<nr.length;ar++){let or=nr[ar];if(isEmitListener(s.emitsOptions,or))continue;const ur=t[or];if(sr)if(hasOwn(tr,or))ur!==tr[or]&&(tr[or]=ur,rr=!0);else{const hr=camelize(or);Ne[hr]=resolvePropValue(sr,ir,hr,ur,s,!1)}else ur!==tr[or]&&(tr[or]=ur,rr=!0)}}}else{setFullProps(s,t,Ne,tr)&&(rr=!0);let nr;for(const ar in ir)(!t||!hasOwn(t,ar)&&((nr=hyphenate(ar))===ar||!hasOwn(t,nr)))&&(sr?n&&(n[ar]!==void 0||n[nr]!==void 0)&&(Ne[ar]=resolvePropValue(sr,ir,ar,void 0,s,!0)):delete Ne[ar]);if(tr!==ir)for(const ar in tr)(!t||!hasOwn(t,ar))&&(delete tr[ar],rr=!0)}rr&&trigger(s.attrs,"set","")}function setFullProps(s,t,n,Ae){const[Ne,tr]=s.propsOptions;let er=!1,ir;if(t)for(let sr in t){if(isReservedProp(sr))continue;const rr=t[sr];let nr;Ne&&hasOwn(Ne,nr=camelize(sr))?!tr||!tr.includes(nr)?n[nr]=rr:(ir||(ir={}))[nr]=rr:isEmitListener(s.emitsOptions,sr)||(!(sr in Ae)||rr!==Ae[sr])&&(Ae[sr]=rr,er=!0)}if(tr){const sr=toRaw(n),rr=ir||EMPTY_OBJ;for(let nr=0;nr<tr.length;nr++){const ar=tr[nr];n[ar]=resolvePropValue(Ne,sr,ar,rr[ar],s,!hasOwn(rr,ar))}}return er}function resolvePropValue(s,t,n,Ae,Ne,tr){const er=s[n];if(er!=null){const ir=hasOwn(er,"default");if(ir&&Ae===void 0){const sr=er.default;if(er.type!==Function&&!er.skipFactory&&isFunction$1(sr)){const{propsDefaults:rr}=Ne;if(n in rr)Ae=rr[n];else{const nr=setCurrentInstance(Ne);Ae=rr[n]=sr.call(null,t),nr()}}else Ae=sr;Ne.ce&&Ne.ce._setProp(n,Ae)}er[0]&&(tr&&!ir?Ae=!1:er[1]&&(Ae===""||Ae===hyphenate(n))&&(Ae=!0))}return Ae}const mixinPropsCache=new WeakMap;function normalizePropsOptions(s,t,n=!1){const Ae=n?mixinPropsCache:t.propsCache,Ne=Ae.get(s);if(Ne)return Ne;const tr=s.props,er={},ir=[];let sr=!1;if(!isFunction$1(s)){const nr=ar=>{sr=!0;const[or,ur]=normalizePropsOptions(ar,t,!0);extend$1(er,or),ur&&ir.push(...ur)};!n&&t.mixins.length&&t.mixins.forEach(nr),s.extends&&nr(s.extends),s.mixins&&s.mixins.forEach(nr)}if(!tr&&!sr)return isObject$2(s)&&Ae.set(s,EMPTY_ARR),EMPTY_ARR;if(isArray$2(tr))for(let nr=0;nr<tr.length;nr++){const ar=camelize(tr[nr]);validatePropName(ar)&&(er[ar]=EMPTY_OBJ)}else if(tr)for(const nr in tr){const ar=camelize(nr);if(validatePropName(ar)){const or=tr[nr],ur=er[ar]=isArray$2(or)||isFunction$1(or)?{type:or}:extend$1({},or),hr=ur.type;let cr=!1,vr=!0;if(isArray$2(hr))for(let mr=0;mr<hr.length;++mr){const dr=hr[mr],lr=isFunction$1(dr)&&dr.name;if(lr==="Boolean"){cr=!0;break}else lr==="String"&&(vr=!1)}else cr=isFunction$1(hr)&&hr.name==="Boolean";ur[0]=cr,ur[1]=vr,(cr||hasOwn(ur,"default"))&&ir.push(ar)}}const rr=[er,ir];return isObject$2(s)&&Ae.set(s,rr),rr}function validatePropName(s){return s[0]!=="$"&&!isReservedProp(s)}const isInternalKey=s=>s[0]==="_"||s==="$stable",normalizeSlotValue=s=>isArray$2(s)?s.map(normalizeVNode):[normalizeVNode(s)],normalizeSlot$1=(s,t,n)=>{if(t._n)return t;const Ae=withCtx((...Ne)=>normalizeSlotValue(t(...Ne)),n);return Ae._c=!1,Ae},normalizeObjectSlots=(s,t,n)=>{const Ae=s._ctx;for(const Ne in s){if(isInternalKey(Ne))continue;const tr=s[Ne];if(isFunction$1(tr))t[Ne]=normalizeSlot$1(Ne,tr,Ae);else if(tr!=null){const er=normalizeSlotValue(tr);t[Ne]=()=>er}}},normalizeVNodeSlots=(s,t)=>{const n=normalizeSlotValue(t);s.slots.default=()=>n},assignSlots=(s,t,n)=>{for(const Ae in t)(n||Ae!=="_")&&(s[Ae]=t[Ae])},initSlots=(s,t,n)=>{const Ae=s.slots=createInternalObject();if(s.vnode.shapeFlag&32){const Ne=t._;Ne?(assignSlots(Ae,t,n),n&&def(Ae,"_",Ne,!0)):normalizeObjectSlots(t,Ae)}else t&&normalizeVNodeSlots(s,t)},updateSlots=(s,t,n)=>{const{vnode:Ae,slots:Ne}=s;let tr=!0,er=EMPTY_OBJ;if(Ae.shapeFlag&32){const ir=t._;ir?n&&ir===1?tr=!1:assignSlots(Ne,t,n):(tr=!t.$stable,normalizeObjectSlots(t,Ne)),er=t}else t&&(normalizeVNodeSlots(s,t),er={default:1});if(tr)for(const ir in Ne)!isInternalKey(ir)&&er[ir]==null&&delete Ne[ir]},queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(s){return baseCreateRenderer(s)}function baseCreateRenderer(s,t){const n=getGlobalThis();n.__VUE__=!0;const{insert:Ae,remove:Ne,patchProp:tr,createElement:er,createText:ir,createComment:sr,setText:rr,setElementText:nr,parentNode:ar,nextSibling:or,setScopeId:ur=NOOP,insertStaticContent:hr}=s,cr=(xr,Or,Pr,Ur=null,$r=null,Wr=null,Kr=void 0,Jr=null,Xr=!!Or.dynamicChildren)=>{if(xr===Or)return;xr&&!isSameVNodeType(xr,Or)&&(Ur=pr(xr),Br(xr,$r,Wr,!0),xr=null),Or.patchFlag===-2&&(Xr=!1,Or.dynamicChildren=null);const{type:qr,ref:io,shapeFlag:Zr}=Or;switch(qr){case Text:vr(xr,Or,Pr,Ur);break;case Comment:mr(xr,Or,Pr,Ur);break;case Static:xr==null&&dr(Or,Pr,Ur,Kr);break;case Fragment:Vr(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr);break;default:Zr&1?fr(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr):Zr&6?Hr(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr):(Zr&64||Zr&128)&&qr.process(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr,Rr)}io!=null&&$r&&setRef(io,xr&&xr.ref,Wr,Or||xr,!Or)},vr=(xr,Or,Pr,Ur)=>{if(xr==null)Ae(Or.el=ir(Or.children),Pr,Ur);else{const $r=Or.el=xr.el;Or.children!==xr.children&&rr($r,Or.children)}},mr=(xr,Or,Pr,Ur)=>{xr==null?Ae(Or.el=sr(Or.children||""),Pr,Ur):Or.el=xr.el},dr=(xr,Or,Pr,Ur)=>{[xr.el,xr.anchor]=hr(xr.children,Or,Pr,Ur,xr.el,xr.anchor)},lr=({el:xr,anchor:Or},Pr,Ur)=>{let $r;for(;xr&&xr!==Or;)$r=or(xr),Ae(xr,Pr,Ur),xr=$r;Ae(Or,Pr,Ur)},gr=({el:xr,anchor:Or})=>{let Pr;for(;xr&&xr!==Or;)Pr=or(xr),Ne(xr),xr=Pr;Ne(Or)},fr=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr)=>{Or.type==="svg"?Kr="svg":Or.type==="math"&&(Kr="mathml"),xr==null?yr(Or,Pr,Ur,$r,Wr,Kr,Jr,Xr):Dr(xr,Or,$r,Wr,Kr,Jr,Xr)},yr=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr)=>{let Xr,qr;const{props:io,shapeFlag:Zr,transition:eo,dirs:so}=xr;if(Xr=xr.el=er(xr.type,Wr,io&&io.is,io),Zr&8?nr(Xr,xr.children):Zr&16&&wr(xr.children,Xr,null,Ur,$r,resolveChildrenNamespace(xr,Wr),Kr,Jr),so&&invokeDirectiveHook(xr,null,Ur,"created"),Er(Xr,xr,xr.scopeId,Kr,Ur),io){for(const oo in io)oo!=="value"&&!isReservedProp(oo)&&tr(Xr,oo,null,io[oo],Wr,Ur);"value"in io&&tr(Xr,"value",null,io.value,Wr),(qr=io.onVnodeBeforeMount)&&invokeVNodeHook(qr,Ur,xr)}so&&invokeDirectiveHook(xr,null,Ur,"beforeMount");const ro=needTransition($r,eo);ro&&eo.beforeEnter(Xr),Ae(Xr,Or,Pr),((qr=io&&io.onVnodeMounted)||ro||so)&&queuePostRenderEffect(()=>{qr&&invokeVNodeHook(qr,Ur,xr),ro&&eo.enter(Xr),so&&invokeDirectiveHook(xr,null,Ur,"mounted")},$r)},Er=(xr,Or,Pr,Ur,$r)=>{if(Pr&&ur(xr,Pr),Ur)for(let Wr=0;Wr<Ur.length;Wr++)ur(xr,Ur[Wr]);if($r){let Wr=$r.subTree;if(Or===Wr||isSuspense(Wr.type)&&(Wr.ssContent===Or||Wr.ssFallback===Or)){const Kr=$r.vnode;Er(xr,Kr,Kr.scopeId,Kr.slotScopeIds,$r.parent)}}},wr=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr=0)=>{for(let qr=Xr;qr<xr.length;qr++){const io=xr[qr]=Jr?cloneIfMounted(xr[qr]):normalizeVNode(xr[qr]);cr(null,io,Or,Pr,Ur,$r,Wr,Kr,Jr)}},Dr=(xr,Or,Pr,Ur,$r,Wr,Kr)=>{const Jr=Or.el=xr.el;let{patchFlag:Xr,dynamicChildren:qr,dirs:io}=Or;Xr|=xr.patchFlag&16;const Zr=xr.props||EMPTY_OBJ,eo=Or.props||EMPTY_OBJ;let so;if(Pr&&toggleRecurse(Pr,!1),(so=eo.onVnodeBeforeUpdate)&&invokeVNodeHook(so,Pr,Or,xr),io&&invokeDirectiveHook(Or,xr,Pr,"beforeUpdate"),Pr&&toggleRecurse(Pr,!0),(Zr.innerHTML&&eo.innerHTML==null||Zr.textContent&&eo.textContent==null)&&nr(Jr,""),qr?kr(xr.dynamicChildren,qr,Jr,Pr,Ur,resolveChildrenNamespace(Or,$r),Wr):Kr||Tr(xr,Or,Jr,null,Pr,Ur,resolveChildrenNamespace(Or,$r),Wr,!1),Xr>0){if(Xr&16)zr(Jr,Zr,eo,Pr,$r);else if(Xr&2&&Zr.class!==eo.class&&tr(Jr,"class",null,eo.class,$r),Xr&4&&tr(Jr,"style",Zr.style,eo.style,$r),Xr&8){const ro=Or.dynamicProps;for(let oo=0;oo<ro.length;oo++){const no=ro[oo],lo=Zr[no],ao=eo[no];(ao!==lo||no==="value")&&tr(Jr,no,lo,ao,$r,Pr)}}Xr&1&&xr.children!==Or.children&&nr(Jr,Or.children)}else!Kr&&qr==null&&zr(Jr,Zr,eo,Pr,$r);((so=eo.onVnodeUpdated)||io)&&queuePostRenderEffect(()=>{so&&invokeVNodeHook(so,Pr,Or,xr),io&&invokeDirectiveHook(Or,xr,Pr,"updated")},Ur)},kr=(xr,Or,Pr,Ur,$r,Wr,Kr)=>{for(let Jr=0;Jr<Or.length;Jr++){const Xr=xr[Jr],qr=Or[Jr],io=Xr.el&&(Xr.type===Fragment||!isSameVNodeType(Xr,qr)||Xr.shapeFlag&70)?ar(Xr.el):Pr;cr(Xr,qr,io,null,Ur,$r,Wr,Kr,!0)}},zr=(xr,Or,Pr,Ur,$r)=>{if(Or!==Pr){if(Or!==EMPTY_OBJ)for(const Wr in Or)!isReservedProp(Wr)&&!(Wr in Pr)&&tr(xr,Wr,Or[Wr],null,$r,Ur);for(const Wr in Pr){if(isReservedProp(Wr))continue;const Kr=Pr[Wr],Jr=Or[Wr];Kr!==Jr&&Wr!=="value"&&tr(xr,Wr,Jr,Kr,$r,Ur)}"value"in Pr&&tr(xr,"value",Or.value,Pr.value,$r)}},Vr=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr)=>{const qr=Or.el=xr?xr.el:ir(""),io=Or.anchor=xr?xr.anchor:ir("");let{patchFlag:Zr,dynamicChildren:eo,slotScopeIds:so}=Or;so&&(Jr=Jr?Jr.concat(so):so),xr==null?(Ae(qr,Pr,Ur),Ae(io,Pr,Ur),wr(Or.children||[],Pr,io,$r,Wr,Kr,Jr,Xr)):Zr>0&&Zr&64&&eo&&xr.dynamicChildren?(kr(xr.dynamicChildren,eo,Pr,$r,Wr,Kr,Jr),(Or.key!=null||$r&&Or===$r.subTree)&&traverseStaticChildren(xr,Or,!0)):Tr(xr,Or,Pr,io,$r,Wr,Kr,Jr,Xr)},Hr=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr)=>{Or.slotScopeIds=Jr,xr==null?Or.shapeFlag&512?$r.ctx.activate(Or,Pr,Ur,Kr,Xr):Sr(Or,Pr,Ur,$r,Wr,Kr,Xr):Ar(xr,Or,Xr)},Sr=(xr,Or,Pr,Ur,$r,Wr,Kr)=>{const Jr=xr.component=createComponentInstance(xr,Ur,$r);if(isKeepAlive(xr)&&(Jr.ctx.renderer=Rr),setupComponent(Jr,!1,Kr),Jr.asyncDep){if($r&&$r.registerDep(Jr,_r,Kr),!xr.el){const Xr=Jr.subTree=createVNode(Comment);mr(null,Xr,Or,Pr)}}else _r(Jr,xr,Or,Pr,$r,Wr,Kr)},Ar=(xr,Or,Pr)=>{const Ur=Or.component=xr.component;if(shouldUpdateComponent(xr,Or,Pr))if(Ur.asyncDep&&!Ur.asyncResolved){Nr(Ur,Or,Pr);return}else Ur.next=Or,Ur.update();else Or.el=xr.el,Ur.vnode=Or},_r=(xr,Or,Pr,Ur,$r,Wr,Kr)=>{const Jr=()=>{if(xr.isMounted){let{next:Zr,bu:eo,u:so,parent:ro,vnode:oo}=xr;{const uo=locateNonHydratedAsyncRoot(xr);if(uo){Zr&&(Zr.el=oo.el,Nr(xr,Zr,Kr)),uo.asyncDep.then(()=>{xr.isUnmounted||Jr()});return}}let no=Zr,lo;toggleRecurse(xr,!1),Zr?(Zr.el=oo.el,Nr(xr,Zr,Kr)):Zr=oo,eo&&invokeArrayFns(eo),(lo=Zr.props&&Zr.props.onVnodeBeforeUpdate)&&invokeVNodeHook(lo,ro,Zr,oo),toggleRecurse(xr,!0);const ao=renderComponentRoot(xr),co=xr.subTree;xr.subTree=ao,cr(co,ao,ar(co.el),pr(co),xr,$r,Wr),Zr.el=ao.el,no===null&&updateHOCHostEl(xr,ao.el),so&&queuePostRenderEffect(so,$r),(lo=Zr.props&&Zr.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(lo,ro,Zr,oo),$r)}else{let Zr;const{el:eo,props:so}=Or,{bm:ro,m:oo,parent:no,root:lo,type:ao}=xr,co=isAsyncWrapper(Or);if(toggleRecurse(xr,!1),ro&&invokeArrayFns(ro),!co&&(Zr=so&&so.onVnodeBeforeMount)&&invokeVNodeHook(Zr,no,Or),toggleRecurse(xr,!0),eo&&Fr){const uo=()=>{xr.subTree=renderComponentRoot(xr),Fr(eo,xr.subTree,xr,$r,null)};co&&ao.__asyncHydrate?ao.__asyncHydrate(eo,xr,uo):uo()}else{lo.ce&&lo.ce._injectChildStyle(ao);const uo=xr.subTree=renderComponentRoot(xr);cr(null,uo,Pr,Ur,xr,$r,Wr),Or.el=uo.el}if(oo&&queuePostRenderEffect(oo,$r),!co&&(Zr=so&&so.onVnodeMounted)){const uo=Or;queuePostRenderEffect(()=>invokeVNodeHook(Zr,no,uo),$r)}(Or.shapeFlag&256||no&&isAsyncWrapper(no.vnode)&&no.vnode.shapeFlag&256)&&xr.a&&queuePostRenderEffect(xr.a,$r),xr.isMounted=!0,Or=Pr=Ur=null}};xr.scope.on();const Xr=xr.effect=new ReactiveEffect(Jr);xr.scope.off();const qr=xr.update=Xr.run.bind(Xr),io=xr.job=Xr.runIfDirty.bind(Xr);io.i=xr,io.id=xr.uid,Xr.scheduler=()=>queueJob(io),toggleRecurse(xr,!0),qr()},Nr=(xr,Or,Pr)=>{Or.component=xr;const Ur=xr.vnode.props;xr.vnode=Or,xr.next=null,updateProps(xr,Or.props,Ur,Pr),updateSlots(xr,Or.children,Pr),pauseTracking(),flushPreFlushCbs(xr),resetTracking()},Tr=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr=!1)=>{const qr=xr&&xr.children,io=xr?xr.shapeFlag:0,Zr=Or.children,{patchFlag:eo,shapeFlag:so}=Or;if(eo>0){if(eo&128){Ir(qr,Zr,Pr,Ur,$r,Wr,Kr,Jr,Xr);return}else if(eo&256){Lr(qr,Zr,Pr,Ur,$r,Wr,Kr,Jr,Xr);return}}so&8?(io&16&&Qr(qr,$r,Wr),Zr!==qr&&nr(Pr,Zr)):io&16?so&16?Ir(qr,Zr,Pr,Ur,$r,Wr,Kr,Jr,Xr):Qr(qr,$r,Wr,!0):(io&8&&nr(Pr,""),so&16&&wr(Zr,Pr,Ur,$r,Wr,Kr,Jr,Xr))},Lr=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr)=>{xr=xr||EMPTY_ARR,Or=Or||EMPTY_ARR;const qr=xr.length,io=Or.length,Zr=Math.min(qr,io);let eo;for(eo=0;eo<Zr;eo++){const so=Or[eo]=Xr?cloneIfMounted(Or[eo]):normalizeVNode(Or[eo]);cr(xr[eo],so,Pr,null,$r,Wr,Kr,Jr,Xr)}qr>io?Qr(xr,$r,Wr,!0,!1,Zr):wr(Or,Pr,Ur,$r,Wr,Kr,Jr,Xr,Zr)},Ir=(xr,Or,Pr,Ur,$r,Wr,Kr,Jr,Xr)=>{let qr=0;const io=Or.length;let Zr=xr.length-1,eo=io-1;for(;qr<=Zr&&qr<=eo;){const so=xr[qr],ro=Or[qr]=Xr?cloneIfMounted(Or[qr]):normalizeVNode(Or[qr]);if(isSameVNodeType(so,ro))cr(so,ro,Pr,null,$r,Wr,Kr,Jr,Xr);else break;qr++}for(;qr<=Zr&&qr<=eo;){const so=xr[Zr],ro=Or[eo]=Xr?cloneIfMounted(Or[eo]):normalizeVNode(Or[eo]);if(isSameVNodeType(so,ro))cr(so,ro,Pr,null,$r,Wr,Kr,Jr,Xr);else break;Zr--,eo--}if(qr>Zr){if(qr<=eo){const so=eo+1,ro=so<io?Or[so].el:Ur;for(;qr<=eo;)cr(null,Or[qr]=Xr?cloneIfMounted(Or[qr]):normalizeVNode(Or[qr]),Pr,ro,$r,Wr,Kr,Jr,Xr),qr++}}else if(qr>eo)for(;qr<=Zr;)Br(xr[qr],$r,Wr,!0),qr++;else{const so=qr,ro=qr,oo=new Map;for(qr=ro;qr<=eo;qr++){const ho=Or[qr]=Xr?cloneIfMounted(Or[qr]):normalizeVNode(Or[qr]);ho.key!=null&&oo.set(ho.key,qr)}let no,lo=0;const ao=eo-ro+1;let co=!1,uo=0;const go=new Array(ao);for(qr=0;qr<ao;qr++)go[qr]=0;for(qr=so;qr<=Zr;qr++){const ho=xr[qr];if(lo>=ao){Br(ho,$r,Wr,!0);continue}let po;if(ho.key!=null)po=oo.get(ho.key);else for(no=ro;no<=eo;no++)if(go[no-ro]===0&&isSameVNodeType(ho,Or[no])){po=no;break}po===void 0?Br(ho,$r,Wr,!0):(go[po-ro]=qr+1,po>=uo?uo=po:co=!0,cr(ho,Or[po],Pr,null,$r,Wr,Kr,Jr,Xr),lo++)}const _o=co?getSequence(go):EMPTY_ARR;for(no=_o.length-1,qr=ao-1;qr>=0;qr--){const ho=ro+qr,po=Or[ho],mo=ho+1<io?Or[ho+1].el:Ur;go[qr]===0?cr(null,po,Pr,mo,$r,Wr,Kr,Jr,Xr):co&&(no<0||qr!==_o[no]?Gr(po,Pr,mo,2):no--)}}},Gr=(xr,Or,Pr,Ur,$r=null)=>{const{el:Wr,type:Kr,transition:Jr,children:Xr,shapeFlag:qr}=xr;if(qr&6){Gr(xr.component.subTree,Or,Pr,Ur);return}if(qr&128){xr.suspense.move(Or,Pr,Ur);return}if(qr&64){Kr.move(xr,Or,Pr,Rr);return}if(Kr===Fragment){Ae(Wr,Or,Pr);for(let Zr=0;Zr<Xr.length;Zr++)Gr(Xr[Zr],Or,Pr,Ur);Ae(xr.anchor,Or,Pr);return}if(Kr===Static){lr(xr,Or,Pr);return}if(Ur!==2&&qr&1&&Jr)if(Ur===0)Jr.beforeEnter(Wr),Ae(Wr,Or,Pr),queuePostRenderEffect(()=>Jr.enter(Wr),$r);else{const{leave:Zr,delayLeave:eo,afterLeave:so}=Jr,ro=()=>Ae(Wr,Or,Pr),oo=()=>{Zr(Wr,()=>{ro(),so&&so()})};eo?eo(Wr,ro,oo):oo()}else Ae(Wr,Or,Pr)},Br=(xr,Or,Pr,Ur=!1,$r=!1)=>{const{type:Wr,props:Kr,ref:Jr,children:Xr,dynamicChildren:qr,shapeFlag:io,patchFlag:Zr,dirs:eo,cacheIndex:so}=xr;if(Zr===-2&&($r=!1),Jr!=null&&setRef(Jr,null,Pr,xr,!0),so!=null&&(Or.renderCache[so]=void 0),io&256){Or.ctx.deactivate(xr);return}const ro=io&1&&eo,oo=!isAsyncWrapper(xr);let no;if(oo&&(no=Kr&&Kr.onVnodeBeforeUnmount)&&invokeVNodeHook(no,Or,xr),io&6)to(xr.component,Pr,Ur);else{if(io&128){xr.suspense.unmount(Pr,Ur);return}ro&&invokeDirectiveHook(xr,null,Or,"beforeUnmount"),io&64?xr.type.remove(xr,Or,Pr,Rr,Ur):qr&&!qr.hasOnce&&(Wr!==Fragment||Zr>0&&Zr&64)?Qr(qr,Or,Pr,!1,!0):(Wr===Fragment&&Zr&384||!$r&&io&16)&&Qr(Xr,Or,Pr),Ur&&jr(xr)}(oo&&(no=Kr&&Kr.onVnodeUnmounted)||ro)&&queuePostRenderEffect(()=>{no&&invokeVNodeHook(no,Or,xr),ro&&invokeDirectiveHook(xr,null,Or,"unmounted")},Pr)},jr=xr=>{const{type:Or,el:Pr,anchor:Ur,transition:$r}=xr;if(Or===Fragment){Yr(Pr,Ur);return}if(Or===Static){gr(xr);return}const Wr=()=>{Ne(Pr),$r&&!$r.persisted&&$r.afterLeave&&$r.afterLeave()};if(xr.shapeFlag&1&&$r&&!$r.persisted){const{leave:Kr,delayLeave:Jr}=$r,Xr=()=>Kr(Pr,Wr);Jr?Jr(xr.el,Wr,Xr):Xr()}else Wr()},Yr=(xr,Or)=>{let Pr;for(;xr!==Or;)Pr=or(xr),Ne(xr),xr=Pr;Ne(Or)},to=(xr,Or,Pr)=>{const{bum:Ur,scope:$r,job:Wr,subTree:Kr,um:Jr,m:Xr,a:qr}=xr;invalidateMount(Xr),invalidateMount(qr),Ur&&invokeArrayFns(Ur),$r.stop(),Wr&&(Wr.flags|=8,Br(Kr,xr,Or,Pr)),Jr&&queuePostRenderEffect(Jr,Or),queuePostRenderEffect(()=>{xr.isUnmounted=!0},Or),Or&&Or.pendingBranch&&!Or.isUnmounted&&xr.asyncDep&&!xr.asyncResolved&&xr.suspenseId===Or.pendingId&&(Or.deps--,Or.deps===0&&Or.resolve())},Qr=(xr,Or,Pr,Ur=!1,$r=!1,Wr=0)=>{for(let Kr=Wr;Kr<xr.length;Kr++)Br(xr[Kr],Or,Pr,Ur,$r)},pr=xr=>{if(xr.shapeFlag&6)return pr(xr.component.subTree);if(xr.shapeFlag&128)return xr.suspense.next();const Or=or(xr.anchor||xr.el),Pr=Or&&Or[TeleportEndKey];return Pr?or(Pr):Or};let br=!1;const Cr=(xr,Or,Pr)=>{xr==null?Or._vnode&&Br(Or._vnode,null,null,!0):cr(Or._vnode||null,xr,Or,null,null,null,Pr),Or._vnode=xr,br||(br=!0,flushPreFlushCbs(),flushPostFlushCbs(),br=!1)},Rr={p:cr,um:Br,m:Gr,r:jr,mt:Sr,mc:wr,pc:Tr,pbc:kr,n:pr,o:s};let Mr,Fr;return{render:Cr,hydrate:Mr,createApp:createAppAPI(Cr,Mr)}}function resolveChildrenNamespace({type:s,props:t},n){return n==="svg"&&s==="foreignObject"||n==="mathml"&&s==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:n}function toggleRecurse({effect:s,job:t},n){n?(s.flags|=32,t.flags|=4):(s.flags&=-33,t.flags&=-5)}function needTransition(s,t){return(!s||s&&!s.pendingBranch)&&t&&!t.persisted}function traverseStaticChildren(s,t,n=!1){const Ae=s.children,Ne=t.children;if(isArray$2(Ae)&&isArray$2(Ne))for(let tr=0;tr<Ae.length;tr++){const er=Ae[tr];let ir=Ne[tr];ir.shapeFlag&1&&!ir.dynamicChildren&&((ir.patchFlag<=0||ir.patchFlag===32)&&(ir=Ne[tr]=cloneIfMounted(Ne[tr]),ir.el=er.el),!n&&ir.patchFlag!==-2&&traverseStaticChildren(er,ir)),ir.type===Text&&(ir.el=er.el)}}function getSequence(s){const t=s.slice(),n=[0];let Ae,Ne,tr,er,ir;const sr=s.length;for(Ae=0;Ae<sr;Ae++){const rr=s[Ae];if(rr!==0){if(Ne=n[n.length-1],s[Ne]<rr){t[Ae]=Ne,n.push(Ae);continue}for(tr=0,er=n.length-1;tr<er;)ir=tr+er>>1,s[n[ir]]<rr?tr=ir+1:er=ir;rr<s[n[tr]]&&(tr>0&&(t[Ae]=n[tr-1]),n[tr]=Ae)}}for(tr=n.length,er=n[tr-1];tr-- >0;)n[tr]=er,er=t[er];return n}function locateNonHydratedAsyncRoot(s){const t=s.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:locateNonHydratedAsyncRoot(t)}function invalidateMount(s){if(s)for(let t=0;t<s.length;t++)s[t].flags|=8}const ssrContextKey=Symbol.for("v-scx"),useSSRContext=()=>inject(ssrContextKey);function watchEffect(s,t){return doWatch(s,null,t)}function watch(s,t,n){return doWatch(s,t,n)}function doWatch(s,t,n=EMPTY_OBJ){const{immediate:Ae,deep:Ne,flush:tr,once:er}=n,ir=extend$1({},n);let sr;if(isInSSRComponentSetup)if(tr==="sync"){const or=useSSRContext();sr=or.__watcherHandles||(or.__watcherHandles=[])}else if(!t||Ae)ir.once=!0;else return{stop:NOOP,resume:NOOP,pause:NOOP};const rr=currentInstance;ir.call=(or,ur,hr)=>callWithAsyncErrorHandling(or,rr,ur,hr);let nr=!1;tr==="post"?ir.scheduler=or=>{queuePostRenderEffect(or,rr&&rr.suspense)}:tr!=="sync"&&(nr=!0,ir.scheduler=(or,ur)=>{ur?or():queueJob(or)}),ir.augmentJob=or=>{t&&(or.flags|=4),nr&&(or.flags|=2,rr&&(or.id=rr.uid,or.i=rr))};const ar=watch$1(s,t,ir);return sr&&sr.push(ar),ar}function instanceWatch(s,t,n){const Ae=this.proxy,Ne=isString$1(s)?s.includes(".")?createPathGetter(Ae,s):()=>Ae[s]:s.bind(Ae,Ae);let tr;isFunction$1(t)?tr=t:(tr=t.handler,n=t);const er=setCurrentInstance(this),ir=doWatch(Ne,tr.bind(Ae),n);return er(),ir}function createPathGetter(s,t){const n=t.split(".");return()=>{let Ae=s;for(let Ne=0;Ne<n.length&&Ae;Ne++)Ae=Ae[n[Ne]];return Ae}}const getModelModifiers=(s,t)=>t==="modelValue"||t==="model-value"?s.modelModifiers:s[`${t}Modifiers`]||s[`${camelize(t)}Modifiers`]||s[`${hyphenate(t)}Modifiers`];function emit(s,t,...n){if(s.isUnmounted)return;const Ae=s.vnode.props||EMPTY_OBJ;let Ne=n;const tr=t.startsWith("update:"),er=tr&&getModelModifiers(Ae,t.slice(7));er&&(er.trim&&(Ne=n.map(nr=>isString$1(nr)?nr.trim():nr)),er.number&&(Ne=n.map(looseToNumber)));let ir,sr=Ae[ir=toHandlerKey(t)]||Ae[ir=toHandlerKey(camelize(t))];!sr&&tr&&(sr=Ae[ir=toHandlerKey(hyphenate(t))]),sr&&callWithAsyncErrorHandling(sr,s,6,Ne);const rr=Ae[ir+"Once"];if(rr){if(!s.emitted)s.emitted={};else if(s.emitted[ir])return;s.emitted[ir]=!0,callWithAsyncErrorHandling(rr,s,6,Ne)}}function normalizeEmitsOptions(s,t,n=!1){const Ae=t.emitsCache,Ne=Ae.get(s);if(Ne!==void 0)return Ne;const tr=s.emits;let er={},ir=!1;if(!isFunction$1(s)){const sr=rr=>{const nr=normalizeEmitsOptions(rr,t,!0);nr&&(ir=!0,extend$1(er,nr))};!n&&t.mixins.length&&t.mixins.forEach(sr),s.extends&&sr(s.extends),s.mixins&&s.mixins.forEach(sr)}return!tr&&!ir?(isObject$2(s)&&Ae.set(s,null),null):(isArray$2(tr)?tr.forEach(sr=>er[sr]=null):extend$1(er,tr),isObject$2(s)&&Ae.set(s,er),er)}function isEmitListener(s,t){return!s||!isOn(t)?!1:(t=t.slice(2).replace(/Once$/,""),hasOwn(s,t[0].toLowerCase()+t.slice(1))||hasOwn(s,hyphenate(t))||hasOwn(s,t))}function markAttrsAccessed(){}function renderComponentRoot(s){const{type:t,vnode:n,proxy:Ae,withProxy:Ne,propsOptions:[tr],slots:er,attrs:ir,emit:sr,render:rr,renderCache:nr,props:ar,data:or,setupState:ur,ctx:hr,inheritAttrs:cr}=s,vr=setCurrentRenderingInstance(s);let mr,dr;try{if(n.shapeFlag&4){const gr=Ne||Ae,fr=gr;mr=normalizeVNode(rr.call(fr,gr,nr,ar,ur,or,hr)),dr=ir}else{const gr=t;mr=normalizeVNode(gr.length>1?gr(ar,{attrs:ir,slots:er,emit:sr}):gr(ar,null)),dr=t.props?ir:getFunctionalFallthrough(ir)}}catch(gr){blockStack.length=0,handleError(gr,s,1),mr=createVNode(Comment)}let lr=mr;if(dr&&cr!==!1){const gr=Object.keys(dr),{shapeFlag:fr}=lr;gr.length&&fr&7&&(tr&&gr.some(isModelListener)&&(dr=filterModelListeners(dr,tr)),lr=cloneVNode(lr,dr,!1,!0))}return n.dirs&&(lr=cloneVNode(lr,null,!1,!0),lr.dirs=lr.dirs?lr.dirs.concat(n.dirs):n.dirs),n.transition&&setTransitionHooks(lr,n.transition),mr=lr,setCurrentRenderingInstance(vr),mr}const getFunctionalFallthrough=s=>{let t;for(const n in s)(n==="class"||n==="style"||isOn(n))&&((t||(t={}))[n]=s[n]);return t},filterModelListeners=(s,t)=>{const n={};for(const Ae in s)(!isModelListener(Ae)||!(Ae.slice(9)in t))&&(n[Ae]=s[Ae]);return n};function shouldUpdateComponent(s,t,n){const{props:Ae,children:Ne,component:tr}=s,{props:er,children:ir,patchFlag:sr}=t,rr=tr.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&sr>=0){if(sr&1024)return!0;if(sr&16)return Ae?hasPropsChanged(Ae,er,rr):!!er;if(sr&8){const nr=t.dynamicProps;for(let ar=0;ar<nr.length;ar++){const or=nr[ar];if(er[or]!==Ae[or]&&!isEmitListener(rr,or))return!0}}}else return(Ne||ir)&&(!ir||!ir.$stable)?!0:Ae===er?!1:Ae?er?hasPropsChanged(Ae,er,rr):!0:!!er;return!1}function hasPropsChanged(s,t,n){const Ae=Object.keys(t);if(Ae.length!==Object.keys(s).length)return!0;for(let Ne=0;Ne<Ae.length;Ne++){const tr=Ae[Ne];if(t[tr]!==s[tr]&&!isEmitListener(n,tr))return!0}return!1}function updateHOCHostEl({vnode:s,parent:t},n){for(;t;){const Ae=t.subTree;if(Ae.suspense&&Ae.suspense.activeBranch===s&&(Ae.el=s.el),Ae===s)(s=t.vnode).el=n,t=t.parent;else break}}const isSuspense=s=>s.__isSuspense;function queueEffectWithSuspense(s,t){t&&t.pendingBranch?isArray$2(s)?t.effects.push(...s):t.effects.push(s):queuePostFlushCb(s)}const Fragment=Symbol.for("v-fgt"),Text=Symbol.for("v-txt"),Comment=Symbol.for("v-cmt"),Static=Symbol.for("v-stc"),blockStack=[];let currentBlock=null;function openBlock(s=!1){blockStack.push(currentBlock=s?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(s){isBlockTreeEnabled+=s,s<0&&currentBlock&&(currentBlock.hasOnce=!0)}function setupBlock(s){return s.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(s),s}function createElementBlock(s,t,n,Ae,Ne,tr){return setupBlock(createBaseVNode(s,t,n,Ae,Ne,tr,!0))}function createBlock(s,t,n,Ae,Ne){return setupBlock(createVNode(s,t,n,Ae,Ne,!0))}function isVNode(s){return s?s.__v_isVNode===!0:!1}function isSameVNodeType(s,t){return s.type===t.type&&s.key===t.key}const normalizeKey=({key:s})=>s??null,normalizeRef=({ref:s,ref_key:t,ref_for:n})=>(typeof s=="number"&&(s=""+s),s!=null?isString$1(s)||isRef(s)||isFunction$1(s)?{i:currentRenderingInstance,r:s,k:t,f:!!n}:s:null);function createBaseVNode(s,t=null,n=null,Ae=0,Ne=null,tr=s===Fragment?0:1,er=!1,ir=!1){const sr={__v_isVNode:!0,__v_skip:!0,type:s,props:t,key:t&&normalizeKey(t),ref:t&&normalizeRef(t),scopeId:currentScopeId,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:tr,patchFlag:Ae,dynamicProps:Ne,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return ir?(normalizeChildren(sr,n),tr&128&&s.normalize(sr)):n&&(sr.shapeFlag|=isString$1(n)?8:16),isBlockTreeEnabled>0&&!er&&currentBlock&&(sr.patchFlag>0||tr&6)&&sr.patchFlag!==32&&currentBlock.push(sr),sr}const createVNode=_createVNode;function _createVNode(s,t=null,n=null,Ae=0,Ne=null,tr=!1){if((!s||s===NULL_DYNAMIC_COMPONENT)&&(s=Comment),isVNode(s)){const ir=cloneVNode(s,t,!0);return n&&normalizeChildren(ir,n),isBlockTreeEnabled>0&&!tr&&currentBlock&&(ir.shapeFlag&6?currentBlock[currentBlock.indexOf(s)]=ir:currentBlock.push(ir)),ir.patchFlag=-2,ir}if(isClassComponent(s)&&(s=s.__vccOpts),t){t=guardReactiveProps(t);let{class:ir,style:sr}=t;ir&&!isString$1(ir)&&(t.class=normalizeClass(ir)),isObject$2(sr)&&(isProxy(sr)&&!isArray$2(sr)&&(sr=extend$1({},sr)),t.style=normalizeStyle(sr))}const er=isString$1(s)?1:isSuspense(s)?128:isTeleport(s)?64:isObject$2(s)?4:isFunction$1(s)?2:0;return createBaseVNode(s,t,n,Ae,Ne,er,tr,!0)}function guardReactiveProps(s){return s?isProxy(s)||isInternalObject(s)?extend$1({},s):s:null}function cloneVNode(s,t,n=!1,Ae=!1){const{props:Ne,ref:tr,patchFlag:er,children:ir,transition:sr}=s,rr=t?mergeProps(Ne||{},t):Ne,nr={__v_isVNode:!0,__v_skip:!0,type:s.type,props:rr,key:rr&&normalizeKey(rr),ref:t&&t.ref?n&&tr?isArray$2(tr)?tr.concat(normalizeRef(t)):[tr,normalizeRef(t)]:normalizeRef(t):tr,scopeId:s.scopeId,slotScopeIds:s.slotScopeIds,children:ir,target:s.target,targetStart:s.targetStart,targetAnchor:s.targetAnchor,staticCount:s.staticCount,shapeFlag:s.shapeFlag,patchFlag:t&&s.type!==Fragment?er===-1?16:er|16:er,dynamicProps:s.dynamicProps,dynamicChildren:s.dynamicChildren,appContext:s.appContext,dirs:s.dirs,transition:sr,component:s.component,suspense:s.suspense,ssContent:s.ssContent&&cloneVNode(s.ssContent),ssFallback:s.ssFallback&&cloneVNode(s.ssFallback),el:s.el,anchor:s.anchor,ctx:s.ctx,ce:s.ce};return sr&&Ae&&setTransitionHooks(nr,sr.clone(nr)),nr}function createTextVNode(s=" ",t=0){return createVNode(Text,null,s,t)}function createCommentVNode(s="",t=!1){return t?(openBlock(),createBlock(Comment,null,s)):createVNode(Comment,null,s)}function normalizeVNode(s){return s==null||typeof s=="boolean"?createVNode(Comment):isArray$2(s)?createVNode(Fragment,null,s.slice()):typeof s=="object"?cloneIfMounted(s):createVNode(Text,null,String(s))}function cloneIfMounted(s){return s.el===null&&s.patchFlag!==-1||s.memo?s:cloneVNode(s)}function normalizeChildren(s,t){let n=0;const{shapeFlag:Ae}=s;if(t==null)t=null;else if(isArray$2(t))n=16;else if(typeof t=="object")if(Ae&65){const Ne=t.default;Ne&&(Ne._c&&(Ne._d=!1),normalizeChildren(s,Ne()),Ne._c&&(Ne._d=!0));return}else{n=32;const Ne=t._;!Ne&&!isInternalObject(t)?t._ctx=currentRenderingInstance:Ne===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?t._=1:(t._=2,s.patchFlag|=1024))}else isFunction$1(t)?(t={default:t,_ctx:currentRenderingInstance},n=32):(t=String(t),Ae&64?(n=16,t=[createTextVNode(t)]):n=8);s.children=t,s.shapeFlag|=n}function mergeProps(...s){const t={};for(let n=0;n<s.length;n++){const Ae=s[n];for(const Ne in Ae)if(Ne==="class")t.class!==Ae.class&&(t.class=normalizeClass([t.class,Ae.class]));else if(Ne==="style")t.style=normalizeStyle([t.style,Ae.style]);else if(isOn(Ne)){const tr=t[Ne],er=Ae[Ne];er&&tr!==er&&!(isArray$2(tr)&&tr.includes(er))&&(t[Ne]=tr?[].concat(tr,er):er)}else Ne!==""&&(t[Ne]=Ae[Ne])}return t}function invokeVNodeHook(s,t,n,Ae=null){callWithAsyncErrorHandling(s,t,7,[n,Ae])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(s,t,n){const Ae=s.type,Ne=(t?t.appContext:s.appContext)||emptyAppContext,tr={uid:uid++,vnode:s,type:Ae,parent:t,appContext:Ne,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(Ne.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(Ae,Ne),emitsOptions:normalizeEmitsOptions(Ae,Ne),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:Ae.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return tr.ctx={_:tr},tr.root=t?t.root:tr,tr.emit=emit.bind(null,tr),s.ce&&s.ce(tr),tr}let currentInstance=null,internalSetCurrentInstance,setInSSRSetupState;{const s=getGlobalThis(),t=(n,Ae)=>{let Ne;return(Ne=s[n])||(Ne=s[n]=[]),Ne.push(Ae),tr=>{Ne.length>1?Ne.forEach(er=>er(tr)):Ne[0](tr)}};internalSetCurrentInstance=t("__VUE_INSTANCE_SETTERS__",n=>currentInstance=n),setInSSRSetupState=t("__VUE_SSR_SETTERS__",n=>isInSSRComponentSetup=n)}const setCurrentInstance=s=>{const t=currentInstance;return internalSetCurrentInstance(s),s.scope.on(),()=>{s.scope.off(),internalSetCurrentInstance(t)}},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),internalSetCurrentInstance(null)};function isStatefulComponent(s){return s.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(s,t=!1,n=!1){t&&setInSSRSetupState(t);const{props:Ae,children:Ne}=s.vnode,tr=isStatefulComponent(s);initProps(s,Ae,tr,t),initSlots(s,Ne,n);const er=tr?setupStatefulComponent(s,t):void 0;return t&&setInSSRSetupState(!1),er}function setupStatefulComponent(s,t){const n=s.type;s.accessCache=Object.create(null),s.proxy=new Proxy(s.ctx,PublicInstanceProxyHandlers);const{setup:Ae}=n;if(Ae){const Ne=s.setupContext=Ae.length>1?createSetupContext(s):null,tr=setCurrentInstance(s);pauseTracking();const er=callWithErrorHandling(Ae,s,0,[s.props,Ne]);if(resetTracking(),tr(),isPromise(er)){if(isAsyncWrapper(s)||markAsyncBoundary(s),er.then(unsetCurrentInstance,unsetCurrentInstance),t)return er.then(ir=>{handleSetupResult(s,ir,t)}).catch(ir=>{handleError(ir,s,0)});s.asyncDep=er}else handleSetupResult(s,er,t)}else finishComponentSetup(s,t)}function handleSetupResult(s,t,n){isFunction$1(t)?s.type.__ssrInlineRender?s.ssrRender=t:s.render=t:isObject$2(t)&&(s.setupState=proxyRefs(t)),finishComponentSetup(s,n)}let compile;function finishComponentSetup(s,t,n){const Ae=s.type;if(!s.render){if(!t&&compile&&!Ae.render){const Ne=Ae.template||resolveMergedOptions(s).template;if(Ne){const{isCustomElement:tr,compilerOptions:er}=s.appContext.config,{delimiters:ir,compilerOptions:sr}=Ae,rr=extend$1(extend$1({isCustomElement:tr,delimiters:ir},er),sr);Ae.render=compile(Ne,rr)}}s.render=Ae.render||NOOP}{const Ne=setCurrentInstance(s);pauseTracking();try{applyOptions(s)}finally{resetTracking(),Ne()}}}const attrsProxyHandlers={get(s,t){return track(s,"get",""),s[t]}};function createSetupContext(s){const t=n=>{s.exposed=n||{}};return{attrs:new Proxy(s.attrs,attrsProxyHandlers),slots:s.slots,emit:s.emit,expose:t}}function getComponentPublicInstance(s){return s.exposed?s.exposeProxy||(s.exposeProxy=new Proxy(proxyRefs(markRaw(s.exposed)),{get(t,n){if(n in t)return t[n];if(n in publicPropertiesMap)return publicPropertiesMap[n](s)},has(t,n){return n in t||n in publicPropertiesMap}})):s.proxy}const classifyRE=/(?:^|[-_])(\w)/g,classify=s=>s.replace(classifyRE,t=>t.toUpperCase()).replace(/[-_]/g,"");function getComponentName(s,t=!0){return isFunction$1(s)?s.displayName||s.name:s.name||t&&s.__name}function formatComponentName(s,t,n=!1){let Ae=getComponentName(t);if(!Ae&&t.__file){const Ne=t.__file.match(/([^/\\]+)\.\w+$/);Ne&&(Ae=Ne[1])}if(!Ae&&s&&s.parent){const Ne=tr=>{for(const er in tr)if(tr[er]===t)return er};Ae=Ne(s.components||s.parent.type.components)||Ne(s.appContext.components)}return Ae?classify(Ae):n?"App":"Anonymous"}function isClassComponent(s){return isFunction$1(s)&&"__vccOpts"in s}const computed=(s,t)=>computed$1(s,t,isInSSRComponentSetup);function h$1(s,t,n){const Ae=arguments.length;return Ae===2?isObject$2(t)&&!isArray$2(t)?isVNode(t)?createVNode(s,null,[t]):createVNode(s,t):createVNode(s,null,t):(Ae>3?n=Array.prototype.slice.call(arguments,2):Ae===3&&isVNode(n)&&(n=[n]),createVNode(s,t,n))}const version="3.5.3";/**
* @vue/runtime-dom v3.5.3
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let policy;const tt$2=typeof window<"u"&&window.trustedTypes;if(tt$2)try{policy=tt$2.createPolicy("vue",{createHTML:s=>s})}catch{}const unsafeToTrustedHTML=policy?s=>policy.createHTML(s):s=>s,svgNS="http://www.w3.org/2000/svg",mathmlNS="http://www.w3.org/1998/Math/MathML",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(s,t,n)=>{t.insertBefore(s,n||null)},remove:s=>{const t=s.parentNode;t&&t.removeChild(s)},createElement:(s,t,n,Ae)=>{const Ne=t==="svg"?doc.createElementNS(svgNS,s):t==="mathml"?doc.createElementNS(mathmlNS,s):n?doc.createElement(s,{is:n}):doc.createElement(s);return s==="select"&&Ae&&Ae.multiple!=null&&Ne.setAttribute("multiple",Ae.multiple),Ne},createText:s=>doc.createTextNode(s),createComment:s=>doc.createComment(s),setText:(s,t)=>{s.nodeValue=t},setElementText:(s,t)=>{s.textContent=t},parentNode:s=>s.parentNode,nextSibling:s=>s.nextSibling,querySelector:s=>doc.querySelector(s),setScopeId(s,t){s.setAttribute(t,"")},insertStaticContent(s,t,n,Ae,Ne,tr){const er=n?n.previousSibling:t.lastChild;if(Ne&&(Ne===tr||Ne.nextSibling))for(;t.insertBefore(Ne.cloneNode(!0),n),!(Ne===tr||!(Ne=Ne.nextSibling)););else{templateContainer.innerHTML=unsafeToTrustedHTML(Ae==="svg"?`<svg>${s}</svg>`:Ae==="mathml"?`<math>${s}</math>`:s);const ir=templateContainer.content;if(Ae==="svg"||Ae==="mathml"){const sr=ir.firstChild;for(;sr.firstChild;)ir.appendChild(sr.firstChild);ir.removeChild(sr)}t.insertBefore(ir,n)}return[er?er.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},vtcKey=Symbol("_vtc");function patchClass(s,t,n){const Ae=s[vtcKey];Ae&&(t=(t?[t,...Ae]:[...Ae]).join(" ")),t==null?s.removeAttribute("class"):n?s.setAttribute("class",t):s.className=t}const vShowOriginalDisplay=Symbol("_vod"),vShowHidden=Symbol("_vsh"),vShow={beforeMount(s,{value:t},{transition:n}){s[vShowOriginalDisplay]=s.style.display==="none"?"":s.style.display,n&&t?n.beforeEnter(s):setDisplay(s,t)},mounted(s,{value:t},{transition:n}){n&&t&&n.enter(s)},updated(s,{value:t,oldValue:n},{transition:Ae}){!t!=!n&&(Ae?t?(Ae.beforeEnter(s),setDisplay(s,!0),Ae.enter(s)):Ae.leave(s,()=>{setDisplay(s,!1)}):setDisplay(s,t))},beforeUnmount(s,{value:t}){setDisplay(s,t)}};function setDisplay(s,t){s.style.display=t?s[vShowOriginalDisplay]:"none",s[vShowHidden]=!t}const CSS_VAR_TEXT=Symbol(""),displayRE=/(^|;)\s*display\s*:/;function patchStyle(s,t,n){const Ae=s.style,Ne=isString$1(n);let tr=!1;if(n&&!Ne){if(t)if(isString$1(t))for(const er of t.split(";")){const ir=er.slice(0,er.indexOf(":")).trim();n[ir]==null&&setStyle(Ae,ir,"")}else for(const er in t)n[er]==null&&setStyle(Ae,er,"");for(const er in n)er==="display"&&(tr=!0),setStyle(Ae,er,n[er])}else if(Ne){if(t!==n){const er=Ae[CSS_VAR_TEXT];er&&(n+=";"+er),Ae.cssText=n,tr=displayRE.test(n)}}else t&&s.removeAttribute("style");vShowOriginalDisplay in s&&(s[vShowOriginalDisplay]=tr?Ae.display:"",s[vShowHidden]&&(Ae.display="none"))}const importantRE=/\s*!important$/;function setStyle(s,t,n){if(isArray$2(n))n.forEach(Ae=>setStyle(s,t,Ae));else if(n==null&&(n=""),t.startsWith("--"))s.setProperty(t,n);else{const Ae=autoPrefix(s,t);importantRE.test(n)?s.setProperty(hyphenate(Ae),n.replace(importantRE,""),"important"):s[Ae]=n}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(s,t){const n=prefixCache[t];if(n)return n;let Ae=camelize(t);if(Ae!=="filter"&&Ae in s)return prefixCache[t]=Ae;Ae=capitalize(Ae);for(let Ne=0;Ne<prefixes.length;Ne++){const tr=prefixes[Ne]+Ae;if(tr in s)return prefixCache[t]=tr}return t}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(s,t,n,Ae,Ne,tr=isSpecialBooleanAttr(t)){Ae&&t.startsWith("xlink:")?n==null?s.removeAttributeNS(xlinkNS,t.slice(6,t.length)):s.setAttributeNS(xlinkNS,t,n):n==null||tr&&!includeBooleanAttr(n)?s.removeAttribute(t):s.setAttribute(t,tr?"":isSymbol(n)?String(n):n)}function patchDOMProp(s,t,n,Ae){if(t==="innerHTML"||t==="textContent"){n!=null&&(s[t]=t==="innerHTML"?unsafeToTrustedHTML(n):n);return}const Ne=s.tagName;if(t==="value"&&Ne!=="PROGRESS"&&!Ne.includes("-")){const er=Ne==="OPTION"?s.getAttribute("value")||"":s.value,ir=n==null?s.type==="checkbox"?"on":"":String(n);(er!==ir||!("_value"in s))&&(s.value=ir),n==null&&s.removeAttribute(t),s._value=n;return}let tr=!1;if(n===""||n==null){const er=typeof s[t];er==="boolean"?n=includeBooleanAttr(n):n==null&&er==="string"?(n="",tr=!0):er==="number"&&(n=0,tr=!0)}try{s[t]=n}catch{}tr&&s.removeAttribute(t)}function addEventListener$1(s,t,n,Ae){s.addEventListener(t,n,Ae)}function removeEventListener$1(s,t,n,Ae){s.removeEventListener(t,n,Ae)}const veiKey=Symbol("_vei");function patchEvent(s,t,n,Ae,Ne=null){const tr=s[veiKey]||(s[veiKey]={}),er=tr[t];if(Ae&&er)er.value=Ae;else{const[ir,sr]=parseName(t);if(Ae){const rr=tr[t]=createInvoker(Ae,Ne);addEventListener$1(s,ir,rr,sr)}else er&&(removeEventListener$1(s,ir,er,sr),tr[t]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(s){let t;if(optionsModifierRE.test(s)){t={};let Ae;for(;Ae=s.match(optionsModifierRE);)s=s.slice(0,s.length-Ae[0].length),t[Ae[0].toLowerCase()]=!0}return[s[2]===":"?s.slice(3):hyphenate(s.slice(2)),t]}let cachedNow=0;const p$2=Promise.resolve(),getNow=()=>cachedNow||(p$2.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(s,t){const n=Ae=>{if(!Ae._vts)Ae._vts=Date.now();else if(Ae._vts<=n.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(Ae,n.value),t,5,[Ae])};return n.value=s,n.attached=getNow(),n}function patchStopImmediatePropagation(s,t){if(isArray$2(t)){const n=s.stopImmediatePropagation;return s.stopImmediatePropagation=()=>{n.call(s),s._stopped=!0},t.map(Ae=>Ne=>!Ne._stopped&&Ae&&Ae(Ne))}else return t}const isNativeOn=s=>s.charCodeAt(0)===111&&s.charCodeAt(1)===110&&s.charCodeAt(2)>96&&s.charCodeAt(2)<123,patchProp=(s,t,n,Ae,Ne,tr)=>{const er=Ne==="svg";t==="class"?patchClass(s,Ae,er):t==="style"?patchStyle(s,n,Ae):isOn(t)?isModelListener(t)||patchEvent(s,t,n,Ae,tr):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):shouldSetAsProp(s,t,Ae,er))?(patchDOMProp(s,t,Ae),!s.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&patchAttr(s,t,Ae,er,tr,t!=="value")):(t==="true-value"?s._trueValue=Ae:t==="false-value"&&(s._falseValue=Ae),patchAttr(s,t,Ae,er))};function shouldSetAsProp(s,t,n,Ae){if(Ae)return!!(t==="innerHTML"||t==="textContent"||t in s&&isNativeOn(t)&&isFunction$1(n));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&s.tagName==="INPUT"||t==="type"&&s.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const Ne=s.tagName;if(Ne==="IMG"||Ne==="VIDEO"||Ne==="CANVAS"||Ne==="SOURCE")return!1}return isNativeOn(t)&&isString$1(n)?!1:!!(t in s||s._isVueCE&&(/[A-Z]/.test(t)||!isString$1(n)))}const getModelAssigner=s=>{const t=s.props["onUpdate:modelValue"]||!1;return isArray$2(t)?n=>invokeArrayFns(t,n):t};function onCompositionStart(s){s.target.composing=!0}function onCompositionEnd(s){const t=s.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const assignKey=Symbol("_assign"),vModelText={created(s,{modifiers:{lazy:t,trim:n,number:Ae}},Ne){s[assignKey]=getModelAssigner(Ne);const tr=Ae||Ne.props&&Ne.props.type==="number";addEventListener$1(s,t?"change":"input",er=>{if(er.target.composing)return;let ir=s.value;n&&(ir=ir.trim()),tr&&(ir=looseToNumber(ir)),s[assignKey](ir)}),n&&addEventListener$1(s,"change",()=>{s.value=s.value.trim()}),t||(addEventListener$1(s,"compositionstart",onCompositionStart),addEventListener$1(s,"compositionend",onCompositionEnd),addEventListener$1(s,"change",onCompositionEnd))},mounted(s,{value:t}){s.value=t??""},beforeUpdate(s,{value:t,oldValue:n,modifiers:{lazy:Ae,trim:Ne,number:tr}},er){if(s[assignKey]=getModelAssigner(er),s.composing)return;const ir=(tr||s.type==="number")&&!/^0\d/.test(s.value)?looseToNumber(s.value):s.value,sr=t??"";ir!==sr&&(document.activeElement===s&&s.type!=="range"&&(Ae&&t===n||Ne&&s.value.trim()===sr)||(s.value=sr))}},vModelCheckbox={deep:!0,created(s,t,n){s[assignKey]=getModelAssigner(n),addEventListener$1(s,"change",()=>{const Ae=s._modelValue,Ne=getValue(s),tr=s.checked,er=s[assignKey];if(isArray$2(Ae)){const ir=looseIndexOf(Ae,Ne),sr=ir!==-1;if(tr&&!sr)er(Ae.concat(Ne));else if(!tr&&sr){const rr=[...Ae];rr.splice(ir,1),er(rr)}}else if(isSet(Ae)){const ir=new Set(Ae);tr?ir.add(Ne):ir.delete(Ne),er(ir)}else er(getCheckboxValue(s,tr))})},mounted:setChecked,beforeUpdate(s,t,n){s[assignKey]=getModelAssigner(n),setChecked(s,t,n)}};function setChecked(s,{value:t,oldValue:n},Ae){s._modelValue=t;let Ne;isArray$2(t)?Ne=looseIndexOf(t,Ae.props.value)>-1:isSet(t)?Ne=t.has(Ae.props.value):Ne=looseEqual(t,getCheckboxValue(s,!0)),s.checked!==Ne&&(s.checked=Ne)}const vModelSelect={deep:!0,created(s,{value:t,modifiers:{number:n}},Ae){const Ne=isSet(t);addEventListener$1(s,"change",()=>{const tr=Array.prototype.filter.call(s.options,er=>er.selected).map(er=>n?looseToNumber(getValue(er)):getValue(er));s[assignKey](s.multiple?Ne?new Set(tr):tr:tr[0]),s._assigning=!0,nextTick$1(()=>{s._assigning=!1})}),s[assignKey]=getModelAssigner(Ae)},mounted(s,{value:t,modifiers:{number:n}}){setSelected(s,t)},beforeUpdate(s,t,n){s[assignKey]=getModelAssigner(n)},updated(s,{value:t,modifiers:{number:n}}){s._assigning||setSelected(s,t)}};function setSelected(s,t,n){const Ae=s.multiple,Ne=isArray$2(t);if(!(Ae&&!Ne&&!isSet(t))){for(let tr=0,er=s.options.length;tr<er;tr++){const ir=s.options[tr],sr=getValue(ir);if(Ae)if(Ne){const rr=typeof sr;rr==="string"||rr==="number"?ir.selected=t.some(nr=>String(nr)===String(sr)):ir.selected=looseIndexOf(t,sr)>-1}else ir.selected=t.has(sr);else if(looseEqual(getValue(ir),t)){s.selectedIndex!==tr&&(s.selectedIndex=tr);return}}!Ae&&s.selectedIndex!==-1&&(s.selectedIndex=-1)}}function getValue(s){return"_value"in s?s._value:s.value}function getCheckboxValue(s,t){const n=t?"_trueValue":"_falseValue";return n in s?s[n]:t}const systemModifiers=["ctrl","shift","alt","meta"],modifierGuards={stop:s=>s.stopPropagation(),prevent:s=>s.preventDefault(),self:s=>s.target!==s.currentTarget,ctrl:s=>!s.ctrlKey,shift:s=>!s.shiftKey,alt:s=>!s.altKey,meta:s=>!s.metaKey,left:s=>"button"in s&&s.button!==0,middle:s=>"button"in s&&s.button!==1,right:s=>"button"in s&&s.button!==2,exact:(s,t)=>systemModifiers.some(n=>s[`${n}Key`]&&!t.includes(n))},withModifiers=(s,t)=>{const n=s._withMods||(s._withMods={}),Ae=t.join(".");return n[Ae]||(n[Ae]=(Ne,...tr)=>{for(let er=0;er<t.length;er++){const ir=modifierGuards[t[er]];if(ir&&ir(Ne,t))return}return s(Ne,...tr)})},rendererOptions=extend$1({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=(...s)=>{const t=ensureRenderer().createApp(...s),{mount:n}=t;return t.mount=Ae=>{const Ne=normalizeContainer(Ae);if(!Ne)return;const tr=t._component;!isFunction$1(tr)&&!tr.render&&!tr.template&&(tr.template=Ne.innerHTML),Ne.nodeType===1&&(Ne.textContent="");const er=n(Ne,!1,resolveRootNamespace(Ne));return Ne instanceof Element&&(Ne.removeAttribute("v-cloak"),Ne.setAttribute("data-v-app","")),er},t};function resolveRootNamespace(s){if(s instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&s instanceof MathMLElement)return"mathml"}function normalizeContainer(s){return isString$1(s)?document.querySelector(s):s}var isVue2=!1;/*!
 * pinia v2.2.4
 * (c) 2024 Eduardo San Martin Morote
 * @license MIT
 */let activePinia;const setActivePinia=s=>activePinia=s,piniaSymbol=Symbol();function isPlainObject$1(s){return s&&typeof s=="object"&&Object.prototype.toString.call(s)==="[object Object]"&&typeof s.toJSON!="function"}var MutationType;(function(s){s.direct="direct",s.patchObject="patch object",s.patchFunction="patch function"})(MutationType||(MutationType={}));function createPinia(){const s=effectScope(!0),t=s.run(()=>ref({}));let n=[],Ae=[];const Ne=markRaw({install(tr){setActivePinia(Ne),Ne._a=tr,tr.provide(piniaSymbol,Ne),tr.config.globalProperties.$pinia=Ne,Ae.forEach(er=>n.push(er)),Ae=[]},use(tr){return!this._a&&!isVue2?Ae.push(tr):n.push(tr),this},_p:n,_a:null,_e:s,_s:new Map,state:t});return Ne}const noop$2=()=>{};function addSubscription(s,t,n,Ae=noop$2){s.push(t);const Ne=()=>{const tr=s.indexOf(t);tr>-1&&(s.splice(tr,1),Ae())};return!n&&getCurrentScope()&&onScopeDispose(Ne),Ne}function triggerSubscriptions(s,...t){s.slice().forEach(n=>{n(...t)})}const fallbackRunWithContext=s=>s(),ACTION_MARKER=Symbol(),ACTION_NAME=Symbol();function mergeReactiveObjects(s,t){s instanceof Map&&t instanceof Map?t.forEach((n,Ae)=>s.set(Ae,n)):s instanceof Set&&t instanceof Set&&t.forEach(s.add,s);for(const n in t){if(!t.hasOwnProperty(n))continue;const Ae=t[n],Ne=s[n];isPlainObject$1(Ne)&&isPlainObject$1(Ae)&&s.hasOwnProperty(n)&&!isRef(Ae)&&!isReactive(Ae)?s[n]=mergeReactiveObjects(Ne,Ae):s[n]=Ae}return s}const skipHydrateSymbol=Symbol();function shouldHydrate(s){return!isPlainObject$1(s)||!s.hasOwnProperty(skipHydrateSymbol)}const{assign:assign$1}=Object;function isComputed(s){return!!(isRef(s)&&s.effect)}function createOptionsStore(s,t,n,Ae){const{state:Ne,actions:tr,getters:er}=t,ir=n.state.value[s];let sr;function rr(){ir||(n.state.value[s]=Ne?Ne():{});const nr=toRefs(n.state.value[s]);return assign$1(nr,tr,Object.keys(er||{}).reduce((ar,or)=>(ar[or]=markRaw(computed(()=>{setActivePinia(n);const ur=n._s.get(s);return er[or].call(ur,ur)})),ar),{}))}return sr=createSetupStore(s,rr,t,n,Ae,!0),sr}function createSetupStore(s,t,n={},Ae,Ne,tr){let er;const ir=assign$1({actions:{}},n),sr={deep:!0};let rr,nr,ar=[],or=[],ur;const hr=Ae.state.value[s];!tr&&!hr&&(Ae.state.value[s]={}),ref({});let cr;function vr(wr){let Dr;rr=nr=!1,typeof wr=="function"?(wr(Ae.state.value[s]),Dr={type:MutationType.patchFunction,storeId:s,events:ur}):(mergeReactiveObjects(Ae.state.value[s],wr),Dr={type:MutationType.patchObject,payload:wr,storeId:s,events:ur});const kr=cr=Symbol();nextTick$1().then(()=>{cr===kr&&(rr=!0)}),nr=!0,triggerSubscriptions(ar,Dr,Ae.state.value[s])}const mr=tr?function(){const{state:Dr}=n,kr=Dr?Dr():{};this.$patch(zr=>{assign$1(zr,kr)})}:noop$2;function dr(){er.stop(),ar=[],or=[],Ae._s.delete(s)}const lr=(wr,Dr="")=>{if(ACTION_MARKER in wr)return wr[ACTION_NAME]=Dr,wr;const kr=function(){setActivePinia(Ae);const zr=Array.from(arguments),Vr=[],Hr=[];function Sr(Nr){Vr.push(Nr)}function Ar(Nr){Hr.push(Nr)}triggerSubscriptions(or,{args:zr,name:kr[ACTION_NAME],store:fr,after:Sr,onError:Ar});let _r;try{_r=wr.apply(this&&this.$id===s?this:fr,zr)}catch(Nr){throw triggerSubscriptions(Hr,Nr),Nr}return _r instanceof Promise?_r.then(Nr=>(triggerSubscriptions(Vr,Nr),Nr)).catch(Nr=>(triggerSubscriptions(Hr,Nr),Promise.reject(Nr))):(triggerSubscriptions(Vr,_r),_r)};return kr[ACTION_MARKER]=!0,kr[ACTION_NAME]=Dr,kr},gr={_p:Ae,$id:s,$onAction:addSubscription.bind(null,or),$patch:vr,$reset:mr,$subscribe(wr,Dr={}){const kr=addSubscription(ar,wr,Dr.detached,()=>zr()),zr=er.run(()=>watch(()=>Ae.state.value[s],Vr=>{(Dr.flush==="sync"?nr:rr)&&wr({storeId:s,type:MutationType.direct,events:ur},Vr)},assign$1({},sr,Dr)));return kr},$dispose:dr},fr=reactive(gr);Ae._s.set(s,fr);const Er=(Ae._a&&Ae._a.runWithContext||fallbackRunWithContext)(()=>Ae._e.run(()=>(er=effectScope()).run(()=>t({action:lr}))));for(const wr in Er){const Dr=Er[wr];if(isRef(Dr)&&!isComputed(Dr)||isReactive(Dr))tr||(hr&&shouldHydrate(Dr)&&(isRef(Dr)?Dr.value=hr[wr]:mergeReactiveObjects(Dr,hr[wr])),Ae.state.value[s][wr]=Dr);else if(typeof Dr=="function"){const kr=lr(Dr,wr);Er[wr]=kr,ir.actions[wr]=Dr}}return assign$1(fr,Er),assign$1(toRaw(fr),Er),Object.defineProperty(fr,"$state",{get:()=>Ae.state.value[s],set:wr=>{vr(Dr=>{assign$1(Dr,wr)})}}),Ae._p.forEach(wr=>{assign$1(fr,er.run(()=>wr({store:fr,app:Ae._a,pinia:Ae,options:ir})))}),hr&&tr&&n.hydrate&&n.hydrate(fr.$state,hr),rr=!0,nr=!0,fr}function defineStore(s,t,n){let Ae,Ne;const tr=typeof t=="function";typeof s=="string"?(Ae=s,Ne=tr?n:t):(Ne=s,Ae=s.id);function er(ir,sr){const rr=hasInjectionContext();return ir=ir||(rr?inject(piniaSymbol,null):null),ir&&setActivePinia(ir),ir=activePinia,ir._s.has(Ae)||(tr?createSetupStore(Ae,t,Ne,ir):createOptionsStore(Ae,Ne,ir)),ir._s.get(Ae)}return er.$id=Ae,er}const H$1={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},M$1={LIGHT:"light",DARK:"dark",COLORED:"colored",AUTO:"auto"},g$1={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},_e$1={BOUNCE:"bounce",SLIDE:"slide",FLIP:"flip",ZOOM:"zoom",NONE:"none"},fe$1={dangerouslyHTMLString:!1,multiple:!0,position:H$1.TOP_RIGHT,autoClose:5e3,transition:"bounce",hideProgressBar:!1,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,className:"",bodyClassName:"",style:{},progressClassName:"",progressStyle:{},role:"alert",theme:"light"},Ie={rtl:!1,newestOnTop:!1,toastClassName:""},me$1={...fe$1,...Ie};({...fe$1,type:g$1.DEFAULT});var r$1=(s=>(s[s.COLLAPSE_DURATION=300]="COLLAPSE_DURATION",s[s.DEBOUNCE_DURATION=50]="DEBOUNCE_DURATION",s.CSS_NAMESPACE="Toastify",s))(r$1||{}),J$1=(s=>(s.ENTRANCE_ANIMATION_END="d",s))(J$1||{});const he$1={enter:"Toastify--animate Toastify__bounce-enter",exit:"Toastify--animate Toastify__bounce-exit",appendPosition:!0},Oe={enter:"Toastify--animate Toastify__slide-enter",exit:"Toastify--animate Toastify__slide-exit",appendPosition:!0},be$1={enter:"Toastify--animate Toastify__zoom-enter",exit:"Toastify--animate Toastify__zoom-exit"},Pe$1={enter:"Toastify--animate Toastify__flip-enter",exit:"Toastify--animate Toastify__flip-exit"},ie$1="Toastify--animate Toastify__none-enter";function ge$1(s,t=!1){var n;let Ae=he$1;if(!s||typeof s=="string")switch(s){case"flip":Ae=Pe$1;break;case"zoom":Ae=be$1;break;case"slide":Ae=Oe;break}else Ae=s;if(t)Ae.enter=ie$1;else if(Ae.enter===ie$1){const Ne=(n=Ae.exit.split("__")[1])==null?void 0:n.split("-")[0];Ae.enter=`Toastify--animate Toastify__${Ne}-enter`}return Ae}function Le(s){return s.containerId||String(s.position)}const K$1="will-unmount";function $e(s=H$1.TOP_RIGHT){return!!document.querySelector(`.${r$1.CSS_NAMESPACE}__toast-container--${s}`)}function qe(s=H$1.TOP_RIGHT){return`${r$1.CSS_NAMESPACE}__toast-container--${s}`}function Be(s,t,n=!1){const Ae=[`${r$1.CSS_NAMESPACE}__toast-container`,`${r$1.CSS_NAMESPACE}__toast-container--${s}`,n?`${r$1.CSS_NAMESPACE}__toast-container--rtl`:null].filter(Boolean).join(" ");return B$1(t)?t({position:s,rtl:n,defaultClassName:Ae}):`${Ae} ${t||""}`}function Me$1(s){var t;const{position:n,containerClassName:Ae,rtl:Ne=!1,style:tr={}}=s,er=r$1.CSS_NAMESPACE,ir=qe(n),sr=document.querySelector(`.${er}`),rr=document.querySelector(`.${ir}`),nr=!!rr&&!((t=rr.className)!=null&&t.includes(K$1)),ar=sr||document.createElement("div"),or=document.createElement("div");or.className=Be(n,Ae,Ne),or.dataset.testid=`${r$1.CSS_NAMESPACE}__toast-container--${n}`,or.id=Le(s);for(const ur in tr)if(Object.prototype.hasOwnProperty.call(tr,ur)){const hr=tr[ur];or.style[ur]=hr}return sr||(ar.className=r$1.CSS_NAMESPACE,document.body.appendChild(ar)),nr||ar.appendChild(or),or}function ee$1(s){var t,n,Ae;const Ne=typeof s=="string"?s:((t=s.currentTarget)==null?void 0:t.id)||((n=s.target)==null?void 0:n.id),tr=document.getElementById(Ne);tr&&tr.removeEventListener("animationend",ee$1,!1);try{k$1[Ne].unmount(),(Ae=document.getElementById(Ne))==null||Ae.remove(),delete k$1[Ne],delete c$1[Ne]}catch{}}const k$1=reactive({});function we$1(s,t){const n=document.getElementById(String(t));n&&(k$1[n.id]=s)}function te$1(s,t=!0){const n=String(s);if(!k$1[n])return;const Ae=document.getElementById(n);Ae&&Ae.classList.add(K$1),t?(Re$1(s),Ae&&Ae.addEventListener("animationend",ee$1,!1)):ee$1(n),N$1.items=N$1.items.filter(Ne=>Ne.containerId!==s)}function Fe(s){for(const t in k$1)te$1(t,s);N$1.items=[]}function Ce$1(s,t){const n=document.getElementById(s.toastId);if(n){let Ae=s;Ae={...Ae,...ge$1(Ae.transition)};const Ne=Ae.appendPosition?`${Ae.exit}--${Ae.position}`:Ae.exit;n.className+=` ${Ne}`,t&&t(n)}}function Re$1(s){for(const t in c$1)if(t===s)for(const n of c$1[t]||[])Ce$1(n)}function Ue(s){const t=w$1().find(n=>n.toastId===s);return t==null?void 0:t.containerId}function re$2(s){return document.getElementById(s)}function xe$1(s){const t=re$2(s.containerId);return t&&t.classList.contains(K$1)}function le$1(s){var t;const n=isVNode(s.content)?toRaw(s.content.props):null;return n??toRaw((t=s.data)!=null?t:{})}function De$1(s){return s?N$1.items.filter(t=>t.containerId===s).length>0:N$1.items.length>0}function ke$1(){if(N$1.items.length>0){const s=N$1.items.shift();j$1(s==null?void 0:s.toastContent,s==null?void 0:s.toastProps)}}const c$1=reactive({}),N$1=reactive({items:[]});function w$1(){const s=toRaw(c$1);return Object.values(s).reduce((t,n)=>[...t,...n],[])}function He(s){return w$1().find(t=>t.toastId===s)}function j$1(s,t={}){if(xe$1(t)){const n=re$2(t.containerId);n&&n.addEventListener("animationend",ne$1.bind(null,s,t),!1)}else ne$1(s,t)}function ne$1(s,t={}){const n=re$2(t.containerId);n&&n.removeEventListener("animationend",ne$1.bind(null,s,t),!1);const Ae=c$1[t.containerId]||[],Ne=Ae.length>0;if(!Ne&&!$e(t.position)){const tr=Me$1(t),er=createApp(it$1,t);er.mount(tr),we$1(er,tr.id)}Ne&&!t.updateId&&(t.position=Ae[0].position),nextTick$1(()=>{t.updateId?C$1.update(t):C$1.add(s,t)})}const C$1={add(s,t){const{containerId:n=""}=t;n&&(c$1[n]=c$1[n]||[],c$1[n].find(Ae=>Ae.toastId===t.toastId)||setTimeout(()=>{var Ae,Ne;t.newestOnTop?(Ae=c$1[n])==null||Ae.unshift(t):(Ne=c$1[n])==null||Ne.push(t),t.onOpen&&t.onOpen(le$1(t))},t.delay||0))},remove(s){if(s){const t=Ue(s);if(t){const n=c$1[t];let Ae=n.find(Ne=>Ne.toastId===s);c$1[t]=n.filter(Ne=>Ne.toastId!==s),!c$1[t].length&&!De$1(t)&&te$1(t,!1),ke$1(),nextTick$1(()=>{Ae!=null&&Ae.onClose&&(Ae.onClose(le$1(Ae)),Ae=void 0)})}}},update(s={}){const{containerId:t=""}=s;if(t&&s.updateId){c$1[t]=c$1[t]||[];const n=c$1[t].find(tr=>tr.toastId===s.toastId),Ae=(n==null?void 0:n.position)!==s.position||(n==null?void 0:n.transition)!==s.transition,Ne={...s,disabledEnterTransition:!Ae,updateId:void 0};C$1.dismissForce(s==null?void 0:s.toastId),setTimeout(()=>{i$2(Ne.content,Ne)},s.delay||0)}},clear(s,t=!0){s?te$1(s,t):Fe(t)},dismissCallback(s){var t;const n=(t=s.currentTarget)==null?void 0:t.id,Ae=document.getElementById(n);Ae&&(Ae.removeEventListener("animationend",C$1.dismissCallback,!1),setTimeout(()=>{C$1.remove(n)}))},dismiss(s){if(s){const t=w$1();for(const n of t)if(n.toastId===s){Ce$1(n,Ae=>{Ae.addEventListener("animationend",C$1.dismissCallback,!1)});break}}},dismissForce(s){if(s){const t=w$1();for(const n of t)if(n.toastId===s){const Ae=document.getElementById(s);Ae&&(Ae.remove(),Ae.removeEventListener("animationend",C$1.dismissCallback,!1),C$1.remove(s));break}}}},Ee=reactive({}),Q$1=reactive({});function ye$1(){return Math.random().toString(36).substring(2,9)}function ze(s){return typeof s=="number"&&!isNaN(s)}function ae$1(s){return typeof s=="string"}function B$1(s){return typeof s=="function"}function Y$1(...s){return mergeProps(...s)}function G$1(s){return typeof s=="object"&&(!!(s!=null&&s.render)||!!(s!=null&&s.setup)||typeof(s==null?void 0:s.type)=="object")}function je(s={}){Ee[`${r$1.CSS_NAMESPACE}-default-options`]=s}function Ge(){return Ee[`${r$1.CSS_NAMESPACE}-default-options`]||me$1}function Ve$1(){return document.documentElement.classList.contains("dark")?"dark":"light"}var V$1=(s=>(s[s.Enter=0]="Enter",s[s.Exit=1]="Exit",s))(V$1||{});const Te$1={containerId:{type:[String,Number],required:!1,default:""},clearOnUrlChange:{type:Boolean,required:!1,default:!0},disabledEnterTransition:{type:Boolean,required:!1,default:!1},dangerouslyHTMLString:{type:Boolean,required:!1,default:!1},multiple:{type:Boolean,required:!1,default:!0},limit:{type:Number,required:!1,default:void 0},position:{type:String,required:!1,default:H$1.TOP_LEFT},bodyClassName:{type:String,required:!1,default:""},autoClose:{type:[Number,Boolean],required:!1,default:!1},closeButton:{type:[Boolean,Function,Object],required:!1,default:void 0},transition:{type:[String,Object],required:!1,default:"bounce"},hideProgressBar:{type:Boolean,required:!1,default:!1},pauseOnHover:{type:Boolean,required:!1,default:!0},pauseOnFocusLoss:{type:Boolean,required:!1,default:!0},closeOnClick:{type:Boolean,required:!1,default:!0},progress:{type:Number,required:!1,default:void 0},progressClassName:{type:String,required:!1,default:""},toastStyle:{type:Object,required:!1,default(){return{}}},progressStyle:{type:Object,required:!1,default(){return{}}},role:{type:String,required:!1,default:"alert"},theme:{type:String,required:!1,default:M$1.AUTO},content:{type:[String,Object,Function],required:!1,default:""},toastId:{type:[String,Number],required:!1,default:""},data:{type:[Object,String],required:!1,default(){return{}}},type:{type:String,required:!1,default:g$1.DEFAULT},icon:{type:[Boolean,String,Number,Object,Function],required:!1,default:void 0},delay:{type:Number,required:!1,default:void 0},onOpen:{type:Function,required:!1,default:void 0},onClose:{type:Function,required:!1,default:void 0},onClick:{type:Function,required:!1,default:void 0},isLoading:{type:Boolean,required:!1,default:void 0},rtl:{type:Boolean,required:!1,default:!1},toastClassName:{type:String,required:!1,default:""},updateId:{type:[String,Number],required:!1,default:""},contentProps:{type:Object,required:!1,default:null}},Qe={autoClose:{type:[Number,Boolean],required:!0},isRunning:{type:Boolean,required:!1,default:void 0},type:{type:String,required:!1,default:g$1.DEFAULT},theme:{type:String,required:!1,default:M$1.AUTO},hide:{type:Boolean,required:!1,default:void 0},className:{type:[String,Function],required:!1,default:""},controlledProgress:{type:Boolean,required:!1,default:void 0},rtl:{type:Boolean,required:!1,default:void 0},isIn:{type:Boolean,required:!1,default:void 0},progress:{type:Number,required:!1,default:void 0},closeToast:{type:Function,required:!1,default:void 0}},We=defineComponent({name:"ProgressBar",props:Qe,setup(s,{attrs:t}){const n=ref(),Ae=computed(()=>s.hide?"true":"false"),Ne=computed(()=>({...t.style||{},animationDuration:`${s.autoClose===!0?5e3:s.autoClose}ms`,animationPlayState:s.isRunning?"running":"paused",opacity:s.hide||s.autoClose===!1?0:1,transform:s.controlledProgress?`scaleX(${s.progress})`:"none"})),tr=computed(()=>[`${r$1.CSS_NAMESPACE}__progress-bar`,s.controlledProgress?`${r$1.CSS_NAMESPACE}__progress-bar--controlled`:`${r$1.CSS_NAMESPACE}__progress-bar--animated`,`${r$1.CSS_NAMESPACE}__progress-bar-theme--${s.theme}`,`${r$1.CSS_NAMESPACE}__progress-bar--${s.type}`,s.rtl?`${r$1.CSS_NAMESPACE}__progress-bar--rtl`:null].filter(Boolean).join(" ")),er=computed(()=>`${tr.value} ${(t==null?void 0:t.class)||""}`),ir=()=>{n.value&&(n.value.onanimationend=null,n.value.ontransitionend=null)},sr=()=>{s.isIn&&s.closeToast&&s.autoClose!==!1&&(s.closeToast(),ir())},rr=computed(()=>s.controlledProgress?null:sr),nr=computed(()=>s.controlledProgress?sr:null);return watchEffect(()=>{n.value&&(ir(),n.value.onanimationend=rr.value,n.value.ontransitionend=nr.value)}),()=>createVNode("div",{ref:n,role:"progressbar","aria-hidden":Ae.value,"aria-label":"notification timer",class:er.value,style:Ne.value},null)}}),Ke=defineComponent({name:"CloseButton",inheritAttrs:!1,props:{theme:{type:String,required:!1,default:M$1.AUTO},type:{type:String,required:!1,default:M$1.LIGHT},ariaLabel:{type:String,required:!1,default:"close"},closeToast:{type:Function,required:!1,default:void 0}},setup(s){return()=>createVNode("button",{class:`${r$1.CSS_NAMESPACE}__close-button ${r$1.CSS_NAMESPACE}__close-button--${s.theme}`,type:"button",onClick:t=>{t.stopPropagation(),s.closeToast&&s.closeToast(t)},"aria-label":s.ariaLabel},[createVNode("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},[createVNode("path",{"fill-rule":"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"},null)])])}}),Z$1=({theme:s,type:t,path:n,...Ae})=>createVNode("svg",mergeProps({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:s==="colored"?"currentColor":`var(--toastify-icon-color-${t})`},Ae),[createVNode("path",{d:n},null)]);function Ye(s){return createVNode(Z$1,mergeProps(s,{path:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}),null)}function Ze(s){return createVNode(Z$1,mergeProps(s,{path:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}),null)}function Xe(s){return createVNode(Z$1,mergeProps(s,{path:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}),null)}function Je(s){return createVNode(Z$1,mergeProps(s,{path:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}),null)}function et$1(){return createVNode("div",{class:`${r$1.CSS_NAMESPACE}__spinner`},null)}const oe$1={info:Ze,warning:Ye,success:Xe,error:Je,spinner:et$1},tt$1=s=>s in oe$1;function nt$1({theme:s,type:t,isLoading:n,icon:Ae}){let Ne;const tr={theme:s,type:t};return n?Ne=oe$1.spinner():Ae===!1?Ne=void 0:G$1(Ae)?Ne=toRaw(Ae):B$1(Ae)?Ne=Ae(tr):isVNode(Ae)?Ne=cloneVNode(Ae,tr):ae$1(Ae)||ze(Ae)?Ne=Ae:tt$1(t)&&(Ne=oe$1[t](tr)),Ne}const at$1=()=>{};function ot$1(s,t,n=r$1.COLLAPSE_DURATION){const{scrollHeight:Ae,style:Ne}=s,tr=n;requestAnimationFrame(()=>{Ne.minHeight="initial",Ne.height=Ae+"px",Ne.transition=`all ${tr}ms`,requestAnimationFrame(()=>{Ne.height="0",Ne.padding="0",Ne.margin="0",setTimeout(t,tr)})})}function st$1(s){const t=ref(!1),n=ref(!1),Ae=ref(!1),Ne=ref(V$1.Enter),tr=reactive({...s,appendPosition:s.appendPosition||!1,collapse:typeof s.collapse>"u"?!0:s.collapse,collapseDuration:s.collapseDuration||r$1.COLLAPSE_DURATION}),er=tr.done||at$1,ir=computed(()=>tr.appendPosition?`${tr.enter}--${tr.position}`:tr.enter),sr=computed(()=>tr.appendPosition?`${tr.exit}--${tr.position}`:tr.exit),rr=computed(()=>s.pauseOnHover?{onMouseenter:vr,onMouseleave:cr}:{});function nr(){const dr=ir.value.split(" ");or().addEventListener(J$1.ENTRANCE_ANIMATION_END,cr,{once:!0});const lr=fr=>{const yr=or();fr.target===yr&&(yr.dispatchEvent(new Event(J$1.ENTRANCE_ANIMATION_END)),yr.removeEventListener("animationend",lr),yr.removeEventListener("animationcancel",lr),Ne.value===V$1.Enter&&fr.type!=="animationcancel"&&yr.classList.remove(...dr))},gr=()=>{const fr=or();fr.classList.add(...dr),fr.addEventListener("animationend",lr),fr.addEventListener("animationcancel",lr)};s.pauseOnFocusLoss&&ur(),gr()}function ar(){if(!or())return;const dr=()=>{const gr=or();gr.removeEventListener("animationend",dr),tr.collapse?ot$1(gr,er,tr.collapseDuration):er()},lr=()=>{const gr=or();Ne.value=V$1.Exit,gr&&(gr.className+=` ${sr.value}`,gr.addEventListener("animationend",dr))};n.value||(Ae.value?dr():setTimeout(lr))}function or(){return s.toastRef.value}function ur(){document.hasFocus()||vr(),window.addEventListener("focus",cr),window.addEventListener("blur",vr)}function hr(){window.removeEventListener("focus",cr),window.removeEventListener("blur",vr)}function cr(){(!s.loading.value||s.isLoading===void 0)&&(t.value=!0)}function vr(){t.value=!1}function mr(dr){dr&&(dr.stopPropagation(),dr.preventDefault()),n.value=!1}return watchEffect(ar),watchEffect(()=>{const dr=w$1();n.value=dr.findIndex(lr=>lr.toastId===tr.toastId)>-1}),watchEffect(()=>{s.isLoading!==void 0&&(s.loading.value?vr():cr())}),onMounted(nr),onUnmounted(()=>{s.pauseOnFocusLoss&&hr()}),{isIn:n,isRunning:t,hideToast:mr,eventHandlers:rr}}const rt$1=defineComponent({name:"ToastItem",inheritAttrs:!1,props:Te$1,setup(s){const t=ref(),n=computed(()=>!!s.isLoading),Ae=computed(()=>s.progress!==void 0&&s.progress!==null),Ne=computed(()=>nt$1(s)),tr=computed(()=>[`${r$1.CSS_NAMESPACE}__toast`,`${r$1.CSS_NAMESPACE}__toast-theme--${s.theme}`,`${r$1.CSS_NAMESPACE}__toast--${s.type}`,s.rtl?`${r$1.CSS_NAMESPACE}__toast--rtl`:void 0,s.toastClassName||""].filter(Boolean).join(" ")),{isRunning:er,isIn:ir,hideToast:sr,eventHandlers:rr}=st$1({toastRef:t,loading:n,done:()=>{C$1.remove(s.toastId)},...ge$1(s.transition,s.disabledEnterTransition),...s});return()=>createVNode("div",mergeProps({id:s.toastId,class:tr.value,style:s.toastStyle||{},ref:t,"data-testid":`toast-item-${s.toastId}`,onClick:nr=>{s.closeOnClick&&sr(),s.onClick&&s.onClick(nr)}},rr.value),[createVNode("div",{role:s.role,"data-testid":"toast-body",class:`${r$1.CSS_NAMESPACE}__toast-body ${s.bodyClassName||""}`},[Ne.value!=null&&createVNode("div",{"data-testid":`toast-icon-${s.type}`,class:[`${r$1.CSS_NAMESPACE}__toast-icon`,s.isLoading?"":`${r$1.CSS_NAMESPACE}--animate-icon ${r$1.CSS_NAMESPACE}__zoom-enter`].join(" ")},[G$1(Ne.value)?h$1(toRaw(Ne.value),{theme:s.theme,type:s.type}):B$1(Ne.value)?Ne.value({theme:s.theme,type:s.type}):Ne.value]),s.contentProps?createVNode("div",{"data-testid":"toast-content"},[h$1(toRaw(s.content),{contentProps:s.contentProps})]):createVNode("div",{"data-testid":"toast-content"},[G$1(s.content)?h$1(toRaw(s.content),{toastProps:toRaw(s),closeToast:sr,data:s.data}):B$1(s.content)?s.content({toastProps:toRaw(s),closeToast:sr,data:s.data}):s.dangerouslyHTMLString?h$1("div",{innerHTML:s.content}):s.content])]),(s.closeButton===void 0||s.closeButton===!0)&&createVNode(Ke,{theme:s.theme,closeToast:nr=>{nr.stopPropagation(),nr.preventDefault(),sr()}},null),G$1(s.closeButton)?h$1(toRaw(s.closeButton),{closeToast:sr,type:s.type,theme:s.theme}):B$1(s.closeButton)?s.closeButton({closeToast:sr,type:s.type,theme:s.theme}):null,createVNode(We,{className:s.progressClassName,style:s.progressStyle,rtl:s.rtl,theme:s.theme,isIn:ir.value,type:s.type,hide:s.hideProgressBar,isRunning:er.value,autoClose:s.autoClose,controlledProgress:Ae.value,progress:s.progress,closeToast:s.isLoading?void 0:sr},null)])}});let D$1=0;function ve$1(){typeof window>"u"||(D$1&&window.cancelAnimationFrame(D$1),D$1=window.requestAnimationFrame(ve$1),Q$1.lastUrl!==window.location.href&&(Q$1.lastUrl=window.location.href,C$1.clear()))}const it$1=defineComponent({name:"ToastifyContainer",inheritAttrs:!1,props:Te$1,setup(s){const t=computed(()=>s.containerId),n=computed(()=>c$1[t.value]||[]),Ae=computed(()=>n.value.filter(Ne=>Ne.position===s.position));return onMounted(()=>{typeof window<"u"&&s.clearOnUrlChange&&window.requestAnimationFrame(ve$1)}),onUnmounted(()=>{typeof window<"u"&&D$1&&(window.cancelAnimationFrame(D$1),Q$1.lastUrl="")}),()=>createVNode(Fragment,null,[Ae.value.map(Ne=>{const{toastId:tr=""}=Ne;return createVNode(rt$1,mergeProps({key:tr},Ne),null)})])}});let X$1=!1;function Se$1(){const s=[];return w$1().forEach(t=>{const n=document.getElementById(t.containerId);n&&!n.classList.contains(K$1)&&s.push(t)}),s}function lt$1(s){const t=Se$1().length,n=s??0;return n>0&&t+N$1.items.length>=n}function dt$1(s){lt$1(s.limit)&&!s.updateId&&N$1.items.push({toastId:s.toastId,containerId:s.containerId,toastContent:s.content,toastProps:s})}function L$1(s,t,n={}){if(X$1)return;n=Y$1(Ge(),{type:t},toRaw(n)),(!n.toastId||typeof n.toastId!="string"&&typeof n.toastId!="number")&&(n.toastId=ye$1()),n={...n,content:s,containerId:n.containerId||String(n.position)};const Ae=Number(n==null?void 0:n.progress);return Ae<0&&(n.progress=0),Ae>1&&(n.progress=1),n.theme==="auto"&&(n.theme=Ve$1()),dt$1(n),Q$1.lastUrl=window.location.href,n.multiple?N$1.items.length?n.updateId&&j$1(s,n):j$1(s,n):(X$1=!0,i$2.clearAll(void 0,!1),setTimeout(()=>{j$1(s,n)},0),setTimeout(()=>{X$1=!1},390)),n.toastId}const i$2=(s,t)=>L$1(s,g$1.DEFAULT,t);i$2.info=(s,t)=>L$1(s,g$1.DEFAULT,{...t,type:g$1.INFO});i$2.error=(s,t)=>L$1(s,g$1.DEFAULT,{...t,type:g$1.ERROR});i$2.warning=(s,t)=>L$1(s,g$1.DEFAULT,{...t,type:g$1.WARNING});i$2.warn=i$2.warning;i$2.success=(s,t)=>L$1(s,g$1.DEFAULT,{...t,type:g$1.SUCCESS});i$2.loading=(s,t)=>L$1(s,g$1.DEFAULT,Y$1(t,{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1}));i$2.dark=(s,t)=>L$1(s,g$1.DEFAULT,Y$1(t,{theme:M$1.DARK}));i$2.remove=s=>{s?C$1.dismiss(s):C$1.clear()};i$2.clearAll=(s,t)=>{nextTick$1(()=>{C$1.clear(s,t)})};i$2.isActive=s=>{let t=!1;return t=Se$1().findIndex(n=>n.toastId===s)>-1,t};i$2.update=(s,t={})=>{setTimeout(()=>{const n=He(s);if(n){const Ae=toRaw(n),{content:Ne}=Ae,tr={...Ae,...t,toastId:t.toastId||s,updateId:ye$1()},er=tr.render||Ne;delete tr.render,L$1(er,tr.type,tr)}},0)};i$2.done=s=>{i$2.update(s,{isLoading:!1,progress:1})};i$2.promise=ut$1;function ut$1(s,{pending:t,error:n,success:Ae},Ne){var tr,er,ir;let sr;const rr={...Ne||{},autoClose:!1};t&&(sr=ae$1(t)?i$2.loading(t,rr):i$2.loading(t.render,{...rr,...t}));const nr={autoClose:(tr=Ne==null?void 0:Ne.autoClose)!=null?tr:!0,closeOnClick:(er=Ne==null?void 0:Ne.closeOnClick)!=null?er:!0,closeButton:(ir=Ne==null?void 0:Ne.autoClose)!=null?ir:null,isLoading:void 0,draggable:null,delay:100},ar=(ur,hr,cr)=>{if(hr==null){i$2.remove(sr);return}const vr={type:ur,...nr,...Ne,data:cr},mr=ae$1(hr)?{render:hr}:hr;return sr?i$2.update(sr,{...vr,...mr,isLoading:!1}):i$2(mr.render,{...vr,...mr,isLoading:!1}),cr},or=B$1(s)?s():s;return or.then(ur=>{ar("success",Ae,ur)}).catch(ur=>{ar("error",n,ur)}),or}i$2.POSITION=H$1;i$2.THEME=M$1;i$2.TYPE=g$1;i$2.TRANSITIONS=_e$1;const ct$1={install(s,t={}){ft$1(t)}};typeof window<"u"&&(window.Vue3Toastify=ct$1);function ft$1(s={}){const t=Y$1(me$1,s);je(t)}function bind(s,t){return function(){return s.apply(t,arguments)}}const{toString:toString$1}=Object.prototype,{getPrototypeOf}=Object,kindOf=(s=>t=>{const n=toString$1.call(t);return s[n]||(s[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=s=>(s=s.toLowerCase(),t=>kindOf(t)===s),typeOfTest=s=>t=>typeof t===s,{isArray:isArray$1}=Array,isUndefined=typeOfTest("undefined");function isBuffer(s){return s!==null&&!isUndefined(s)&&s.constructor!==null&&!isUndefined(s.constructor)&&isFunction(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&isArrayBuffer(s.buffer),t}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject$1=s=>s!==null&&typeof s=="object",isBoolean=s=>s===!0||s===!1,isPlainObject=s=>{if(kindOf(s)!=="object")return!1;const t=getPrototypeOf(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=s=>isObject$1(s)&&isFunction(s.pipe),isFormData=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||isFunction(s.append)&&((t=kindOf(s))==="formdata"||t==="object"&&isFunction(s.toString)&&s.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(s,t,{allOwnKeys:n=!1}={}){if(s===null||typeof s>"u")return;let Ae,Ne;if(typeof s!="object"&&(s=[s]),isArray$1(s))for(Ae=0,Ne=s.length;Ae<Ne;Ae++)t.call(null,s[Ae],Ae,s);else{const tr=n?Object.getOwnPropertyNames(s):Object.keys(s),er=tr.length;let ir;for(Ae=0;Ae<er;Ae++)ir=tr[Ae],t.call(null,s[ir],ir,s)}}function findKey(s,t){t=t.toLowerCase();const n=Object.keys(s);let Ae=n.length,Ne;for(;Ae-- >0;)if(Ne=n[Ae],t===Ne.toLowerCase())return Ne;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=s=>!isUndefined(s)&&s!==_global;function merge(){const{caseless:s}=isContextDefined(this)&&this||{},t={},n=(Ae,Ne)=>{const tr=s&&findKey(t,Ne)||Ne;isPlainObject(t[tr])&&isPlainObject(Ae)?t[tr]=merge(t[tr],Ae):isPlainObject(Ae)?t[tr]=merge({},Ae):isArray$1(Ae)?t[tr]=Ae.slice():t[tr]=Ae};for(let Ae=0,Ne=arguments.length;Ae<Ne;Ae++)arguments[Ae]&&forEach(arguments[Ae],n);return t}const extend=(s,t,n,{allOwnKeys:Ae}={})=>(forEach(t,(Ne,tr)=>{n&&isFunction(Ne)?s[tr]=bind(Ne,n):s[tr]=Ne},{allOwnKeys:Ae}),s),stripBOM=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),inherits=(s,t,n,Ae)=>{s.prototype=Object.create(t.prototype,Ae),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),n&&Object.assign(s.prototype,n)},toFlatObject=(s,t,n,Ae)=>{let Ne,tr,er;const ir={};if(t=t||{},s==null)return t;do{for(Ne=Object.getOwnPropertyNames(s),tr=Ne.length;tr-- >0;)er=Ne[tr],(!Ae||Ae(er,s,t))&&!ir[er]&&(t[er]=s[er],ir[er]=!0);s=n!==!1&&getPrototypeOf(s)}while(s&&(!n||n(s,t))&&s!==Object.prototype);return t},endsWith=(s,t,n)=>{s=String(s),(n===void 0||n>s.length)&&(n=s.length),n-=t.length;const Ae=s.indexOf(t,n);return Ae!==-1&&Ae===n},toArray$1=s=>{if(!s)return null;if(isArray$1(s))return s;let t=s.length;if(!isNumber(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=s[t];return n},isTypedArray=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(s,t)=>{const Ae=(s&&s[Symbol.iterator]).call(s);let Ne;for(;(Ne=Ae.next())&&!Ne.done;){const tr=Ne.value;t.call(s,tr[0],tr[1])}},matchAll=(s,t)=>{let n;const Ae=[];for(;(n=s.exec(t))!==null;)Ae.push(n);return Ae},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,Ae,Ne){return Ae.toUpperCase()+Ne}),hasOwnProperty=(({hasOwnProperty:s})=>(t,n)=>s.call(t,n))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(s,t)=>{const n=Object.getOwnPropertyDescriptors(s),Ae={};forEach(n,(Ne,tr)=>{let er;(er=t(Ne,tr,s))!==!1&&(Ae[tr]=er||Ne)}),Object.defineProperties(s,Ae)},freezeMethods=s=>{reduceDescriptors(s,(t,n)=>{if(isFunction(s)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const Ae=s[n];if(isFunction(Ae)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},toObjectSet=(s,t)=>{const n={},Ae=Ne=>{Ne.forEach(tr=>{n[tr]=!0})};return isArray$1(s)?Ae(s):Ae(String(s).split(t)),n},noop$1=()=>{},toFiniteNumber=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t,ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT,ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(s=16,t=ALPHABET.ALPHA_DIGIT)=>{let n="";const{length:Ae}=t;for(;s--;)n+=t[Math.random()*Ae|0];return n};function isSpecCompliantForm(s){return!!(s&&isFunction(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator])}const toJSONObject=s=>{const t=new Array(10),n=(Ae,Ne)=>{if(isObject$1(Ae)){if(t.indexOf(Ae)>=0)return;if(!("toJSON"in Ae)){t[Ne]=Ae;const tr=isArray$1(Ae)?[]:{};return forEach(Ae,(er,ir)=>{const sr=n(er,Ne+1);!isUndefined(sr)&&(tr[ir]=sr)}),t[Ne]=void 0,tr}}return Ae};return n(s,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=s=>s&&(isObject$1(s)||isFunction(s))&&isFunction(s.then)&&isFunction(s.catch),_setImmediate=((s,t)=>s?setImmediate:t?((n,Ae)=>(_global.addEventListener("message",({source:Ne,data:tr})=>{Ne===_global&&tr===n&&Ae.length&&Ae.shift()()},!1),Ne=>{Ae.push(Ne),_global.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",isFunction(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,utils$1={isArray:isArray$1,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject:isObject$1,isPlainObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray:toArray$1,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop:noop$1,toFiniteNumber,findKey,global:_global,isContextDefined,ALPHABET,generateString,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap};function AxiosError(s,t,n,Ae,Ne){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),Ae&&(this.request=Ae),Ne&&(this.response=Ne,this.status=Ne.status?Ne.status:null)}utils$1.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{descriptors[s]={value:s}});Object.defineProperties(AxiosError,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError.from=(s,t,n,Ae,Ne,tr)=>{const er=Object.create(prototype$1);return utils$1.toFlatObject(s,er,function(sr){return sr!==Error.prototype},ir=>ir!=="isAxiosError"),AxiosError.call(er,s.message,t,n,Ae,Ne),er.cause=s,er.name=s.name,tr&&Object.assign(er,tr),er};const httpAdapter=null;function isVisitable(s){return utils$1.isPlainObject(s)||utils$1.isArray(s)}function removeBrackets(s){return utils$1.endsWith(s,"[]")?s.slice(0,-2):s}function renderKey(s,t,n){return s?s.concat(t).map(function(Ne,tr){return Ne=removeBrackets(Ne),!n&&tr?"["+Ne+"]":Ne}).join(n?".":""):t}function isFlatArray(s){return utils$1.isArray(s)&&!s.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function(t){return/^is[A-Z]/.test(t)});function toFormData(s,t,n){if(!utils$1.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,n=utils$1.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(cr,vr){return!utils$1.isUndefined(vr[cr])});const Ae=n.metaTokens,Ne=n.visitor||nr,tr=n.dots,er=n.indexes,sr=(n.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(t);if(!utils$1.isFunction(Ne))throw new TypeError("visitor must be a function");function rr(hr){if(hr===null)return"";if(utils$1.isDate(hr))return hr.toISOString();if(!sr&&utils$1.isBlob(hr))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(hr)||utils$1.isTypedArray(hr)?sr&&typeof Blob=="function"?new Blob([hr]):Buffer.from(hr):hr}function nr(hr,cr,vr){let mr=hr;if(hr&&!vr&&typeof hr=="object"){if(utils$1.endsWith(cr,"{}"))cr=Ae?cr:cr.slice(0,-2),hr=JSON.stringify(hr);else if(utils$1.isArray(hr)&&isFlatArray(hr)||(utils$1.isFileList(hr)||utils$1.endsWith(cr,"[]"))&&(mr=utils$1.toArray(hr)))return cr=removeBrackets(cr),mr.forEach(function(lr,gr){!(utils$1.isUndefined(lr)||lr===null)&&t.append(er===!0?renderKey([cr],gr,tr):er===null?cr:cr+"[]",rr(lr))}),!1}return isVisitable(hr)?!0:(t.append(renderKey(vr,cr,tr),rr(hr)),!1)}const ar=[],or=Object.assign(predicates,{defaultVisitor:nr,convertValue:rr,isVisitable});function ur(hr,cr){if(!utils$1.isUndefined(hr)){if(ar.indexOf(hr)!==-1)throw Error("Circular reference detected in "+cr.join("."));ar.push(hr),utils$1.forEach(hr,function(mr,dr){(!(utils$1.isUndefined(mr)||mr===null)&&Ne.call(t,mr,utils$1.isString(dr)?dr.trim():dr,cr,or))===!0&&ur(mr,cr?cr.concat(dr):[dr])}),ar.pop()}}if(!utils$1.isObject(s))throw new TypeError("data must be an object");return ur(s),t}function encode$3(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(Ae){return t[Ae]})}function AxiosURLSearchParams(s,t){this._pairs=[],s&&toFormData(s,this,t)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function(t,n){this._pairs.push([t,n])};prototype.toString=function(t){const n=t?function(Ae){return t.call(this,Ae,encode$3)}:encode$3;return this._pairs.map(function(Ne){return n(Ne[0])+"="+n(Ne[1])},"").join("&")};function encode$2(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(s,t,n){if(!t)return s;const Ae=n&&n.encode||encode$2,Ne=n&&n.serialize;let tr;if(Ne?tr=Ne(t,n):tr=utils$1.isURLSearchParams(t)?t.toString():new AxiosURLSearchParams(t,n).toString(Ae),tr){const er=s.indexOf("#");er!==-1&&(s=s.slice(0,er)),s+=(s.indexOf("?")===-1?"?":"&")+tr}return s}class InterceptorManager{constructor(){this.handlers=[]}use(t,n,Ae){return this.handlers.push({fulfilled:t,rejected:n,synchronous:Ae?Ae.synchronous:!1,runWhen:Ae?Ae.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){utils$1.forEach(this.handlers,function(Ae){Ae!==null&&t(Ae)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(s,t){return toFormData(s,new platform.classes.URLSearchParams,Object.assign({visitor:function(n,Ae,Ne,tr){return platform.isNode&&utils$1.isBuffer(n)?(this.append(Ae,n.toString("base64")),!1):tr.defaultVisitor.apply(this,arguments)}},t))}function parsePropPath(s){return utils$1.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function arrayToObject(s){const t={},n=Object.keys(s);let Ae;const Ne=n.length;let tr;for(Ae=0;Ae<Ne;Ae++)tr=n[Ae],t[tr]=s[tr];return t}function formDataToJSON(s){function t(n,Ae,Ne,tr){let er=n[tr++];if(er==="__proto__")return!0;const ir=Number.isFinite(+er),sr=tr>=n.length;return er=!er&&utils$1.isArray(Ne)?Ne.length:er,sr?(utils$1.hasOwnProp(Ne,er)?Ne[er]=[Ne[er],Ae]:Ne[er]=Ae,!ir):((!Ne[er]||!utils$1.isObject(Ne[er]))&&(Ne[er]=[]),t(n,Ae,Ne[er],tr)&&utils$1.isArray(Ne[er])&&(Ne[er]=arrayToObject(Ne[er])),!ir)}if(utils$1.isFormData(s)&&utils$1.isFunction(s.entries)){const n={};return utils$1.forEachEntry(s,(Ae,Ne)=>{t(parsePropPath(Ae),Ne,n,0)}),n}return null}function stringifySafely(s,t,n){if(utils$1.isString(s))try{return(t||JSON.parse)(s),utils$1.trim(s)}catch(Ae){if(Ae.name!=="SyntaxError")throw Ae}return(0,JSON.stringify)(s)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const Ae=n.getContentType()||"",Ne=Ae.indexOf("application/json")>-1,tr=utils$1.isObject(t);if(tr&&utils$1.isHTMLForm(t)&&(t=new FormData(t)),utils$1.isFormData(t))return Ne?JSON.stringify(formDataToJSON(t)):t;if(utils$1.isArrayBuffer(t)||utils$1.isBuffer(t)||utils$1.isStream(t)||utils$1.isFile(t)||utils$1.isBlob(t)||utils$1.isReadableStream(t))return t;if(utils$1.isArrayBufferView(t))return t.buffer;if(utils$1.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let ir;if(tr){if(Ae.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(t,this.formSerializer).toString();if((ir=utils$1.isFileList(t))||Ae.indexOf("multipart/form-data")>-1){const sr=this.env&&this.env.FormData;return toFormData(ir?{"files[]":t}:t,sr&&new sr,this.formSerializer)}}return tr||Ne?(n.setContentType("application/json",!1),stringifySafely(t)):t}],transformResponse:[function(t){const n=this.transitional||defaults.transitional,Ae=n&&n.forcedJSONParsing,Ne=this.responseType==="json";if(utils$1.isResponse(t)||utils$1.isReadableStream(t))return t;if(t&&utils$1.isString(t)&&(Ae&&!this.responseType||Ne)){const er=!(n&&n.silentJSONParsing)&&Ne;try{return JSON.parse(t)}catch(ir){if(er)throw ir.name==="SyntaxError"?AxiosError.from(ir,AxiosError.ERR_BAD_RESPONSE,this,null,this.response):ir}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],s=>{defaults.headers[s]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=s=>{const t={};let n,Ae,Ne;return s&&s.split(`
`).forEach(function(er){Ne=er.indexOf(":"),n=er.substring(0,Ne).trim().toLowerCase(),Ae=er.substring(Ne+1).trim(),!(!n||t[n]&&ignoreDuplicateOf[n])&&(n==="set-cookie"?t[n]?t[n].push(Ae):t[n]=[Ae]:t[n]=t[n]?t[n]+", "+Ae:Ae)}),t},$internals=Symbol("internals");function normalizeHeader(s){return s&&String(s).trim().toLowerCase()}function normalizeValue(s){return s===!1||s==null?s:utils$1.isArray(s)?s.map(normalizeValue):String(s)}function parseTokens(s){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let Ae;for(;Ae=n.exec(s);)t[Ae[1]]=Ae[2];return t}const isValidHeaderName=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function matchHeaderValue(s,t,n,Ae,Ne){if(utils$1.isFunction(Ae))return Ae.call(this,t,n);if(Ne&&(t=n),!!utils$1.isString(t)){if(utils$1.isString(Ae))return t.indexOf(Ae)!==-1;if(utils$1.isRegExp(Ae))return Ae.test(t)}}function formatHeader(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,Ae)=>n.toUpperCase()+Ae)}function buildAccessors(s,t){const n=utils$1.toCamelCase(" "+t);["get","set","has"].forEach(Ae=>{Object.defineProperty(s,Ae+n,{value:function(Ne,tr,er){return this[Ae].call(this,t,Ne,tr,er)},configurable:!0})})}class AxiosHeaders{constructor(t){t&&this.set(t)}set(t,n,Ae){const Ne=this;function tr(ir,sr,rr){const nr=normalizeHeader(sr);if(!nr)throw new Error("header name must be a non-empty string");const ar=utils$1.findKey(Ne,nr);(!ar||Ne[ar]===void 0||rr===!0||rr===void 0&&Ne[ar]!==!1)&&(Ne[ar||sr]=normalizeValue(ir))}const er=(ir,sr)=>utils$1.forEach(ir,(rr,nr)=>tr(rr,nr,sr));if(utils$1.isPlainObject(t)||t instanceof this.constructor)er(t,n);else if(utils$1.isString(t)&&(t=t.trim())&&!isValidHeaderName(t))er(parseHeaders(t),n);else if(utils$1.isHeaders(t))for(const[ir,sr]of t.entries())tr(sr,ir,Ae);else t!=null&&tr(n,t,Ae);return this}get(t,n){if(t=normalizeHeader(t),t){const Ae=utils$1.findKey(this,t);if(Ae){const Ne=this[Ae];if(!n)return Ne;if(n===!0)return parseTokens(Ne);if(utils$1.isFunction(n))return n.call(this,Ne,Ae);if(utils$1.isRegExp(n))return n.exec(Ne);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=normalizeHeader(t),t){const Ae=utils$1.findKey(this,t);return!!(Ae&&this[Ae]!==void 0&&(!n||matchHeaderValue(this,this[Ae],Ae,n)))}return!1}delete(t,n){const Ae=this;let Ne=!1;function tr(er){if(er=normalizeHeader(er),er){const ir=utils$1.findKey(Ae,er);ir&&(!n||matchHeaderValue(Ae,Ae[ir],ir,n))&&(delete Ae[ir],Ne=!0)}}return utils$1.isArray(t)?t.forEach(tr):tr(t),Ne}clear(t){const n=Object.keys(this);let Ae=n.length,Ne=!1;for(;Ae--;){const tr=n[Ae];(!t||matchHeaderValue(this,this[tr],tr,t,!0))&&(delete this[tr],Ne=!0)}return Ne}normalize(t){const n=this,Ae={};return utils$1.forEach(this,(Ne,tr)=>{const er=utils$1.findKey(Ae,tr);if(er){n[er]=normalizeValue(Ne),delete n[tr];return}const ir=t?formatHeader(tr):String(tr).trim();ir!==tr&&delete n[tr],n[ir]=normalizeValue(Ne),Ae[ir]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return utils$1.forEach(this,(Ae,Ne)=>{Ae!=null&&Ae!==!1&&(n[Ne]=t&&utils$1.isArray(Ae)?Ae.join(", "):Ae)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const Ae=new this(t);return n.forEach(Ne=>Ae.set(Ne)),Ae}static accessor(t){const Ae=(this[$internals]=this[$internals]={accessors:{}}).accessors,Ne=this.prototype;function tr(er){const ir=normalizeHeader(er);Ae[ir]||(buildAccessors(Ne,er),Ae[ir]=!0)}return utils$1.isArray(t)?t.forEach(tr):tr(t),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders.prototype,({value:s},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(Ae){this[n]=Ae}}});utils$1.freezeMethods(AxiosHeaders);function transformData(s,t){const n=this||defaults,Ae=t||n,Ne=AxiosHeaders.from(Ae.headers);let tr=Ae.data;return utils$1.forEach(s,function(ir){tr=ir.call(n,tr,Ne.normalize(),t?t.status:void 0)}),Ne.normalize(),tr}function isCancel(s){return!!(s&&s.__CANCEL__)}function CanceledError(s,t,n){AxiosError.call(this,s??"canceled",AxiosError.ERR_CANCELED,t,n),this.name="CanceledError"}utils$1.inherits(CanceledError,AxiosError,{__CANCEL__:!0});function settle(s,t,n){const Ae=n.config.validateStatus;!n.status||!Ae||Ae(n.status)?s(n):t(new AxiosError("Request failed with status code "+n.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function parseProtocol(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function speedometer(s,t){s=s||10;const n=new Array(s),Ae=new Array(s);let Ne=0,tr=0,er;return t=t!==void 0?t:1e3,function(sr){const rr=Date.now(),nr=Ae[tr];er||(er=rr),n[Ne]=sr,Ae[Ne]=rr;let ar=tr,or=0;for(;ar!==Ne;)or+=n[ar++],ar=ar%s;if(Ne=(Ne+1)%s,Ne===tr&&(tr=(tr+1)%s),rr-er<t)return;const ur=nr&&rr-nr;return ur?Math.round(or*1e3/ur):void 0}}function throttle(s,t){let n=0,Ae=1e3/t,Ne,tr;const er=(rr,nr=Date.now())=>{n=nr,Ne=null,tr&&(clearTimeout(tr),tr=null),s.apply(null,rr)};return[(...rr)=>{const nr=Date.now(),ar=nr-n;ar>=Ae?er(rr,nr):(Ne=rr,tr||(tr=setTimeout(()=>{tr=null,er(Ne)},Ae-ar)))},()=>Ne&&er(Ne)]}const progressEventReducer=(s,t,n=3)=>{let Ae=0;const Ne=speedometer(50,250);return throttle(tr=>{const er=tr.loaded,ir=tr.lengthComputable?tr.total:void 0,sr=er-Ae,rr=Ne(sr),nr=er<=ir;Ae=er;const ar={loaded:er,total:ir,progress:ir?er/ir:void 0,bytes:sr,rate:rr||void 0,estimated:rr&&ir&&nr?(ir-er)/rr:void 0,event:tr,lengthComputable:ir!=null,[t?"download":"upload"]:!0};s(ar)},n)},progressEventDecorator=(s,t)=>{const n=s!=null;return[Ae=>t[0]({lengthComputable:n,total:s,loaded:Ae}),t[1]]},asyncDecorator=s=>(...t)=>utils$1.asap(()=>s(...t)),isURLSameOrigin=platform.hasStandardBrowserEnv?function(){const t=platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent),n=document.createElement("a");let Ae;function Ne(tr){let er=tr;return t&&(n.setAttribute("href",er),er=n.href),n.setAttribute("href",er),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return Ae=Ne(window.location.href),function(er){const ir=utils$1.isString(er)?Ne(er):er;return ir.protocol===Ae.protocol&&ir.host===Ae.host}}():function(){return function(){return!0}}(),cookies=platform.hasStandardBrowserEnv?{write(s,t,n,Ae,Ne,tr){const er=[s+"="+encodeURIComponent(t)];utils$1.isNumber(n)&&er.push("expires="+new Date(n).toGMTString()),utils$1.isString(Ae)&&er.push("path="+Ae),utils$1.isString(Ne)&&er.push("domain="+Ne),tr===!0&&er.push("secure"),document.cookie=er.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function combineURLs(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function buildFullPath(s,t){return s&&!isAbsoluteURL(t)?combineURLs(s,t):t}const headersToObject=s=>s instanceof AxiosHeaders?{...s}:s;function mergeConfig(s,t){t=t||{};const n={};function Ae(rr,nr,ar){return utils$1.isPlainObject(rr)&&utils$1.isPlainObject(nr)?utils$1.merge.call({caseless:ar},rr,nr):utils$1.isPlainObject(nr)?utils$1.merge({},nr):utils$1.isArray(nr)?nr.slice():nr}function Ne(rr,nr,ar){if(utils$1.isUndefined(nr)){if(!utils$1.isUndefined(rr))return Ae(void 0,rr,ar)}else return Ae(rr,nr,ar)}function tr(rr,nr){if(!utils$1.isUndefined(nr))return Ae(void 0,nr)}function er(rr,nr){if(utils$1.isUndefined(nr)){if(!utils$1.isUndefined(rr))return Ae(void 0,rr)}else return Ae(void 0,nr)}function ir(rr,nr,ar){if(ar in t)return Ae(rr,nr);if(ar in s)return Ae(void 0,rr)}const sr={url:tr,method:tr,data:tr,baseURL:er,transformRequest:er,transformResponse:er,paramsSerializer:er,timeout:er,timeoutMessage:er,withCredentials:er,withXSRFToken:er,adapter:er,responseType:er,xsrfCookieName:er,xsrfHeaderName:er,onUploadProgress:er,onDownloadProgress:er,decompress:er,maxContentLength:er,maxBodyLength:er,beforeRedirect:er,transport:er,httpAgent:er,httpsAgent:er,cancelToken:er,socketPath:er,responseEncoding:er,validateStatus:ir,headers:(rr,nr)=>Ne(headersToObject(rr),headersToObject(nr),!0)};return utils$1.forEach(Object.keys(Object.assign({},s,t)),function(nr){const ar=sr[nr]||Ne,or=ar(s[nr],t[nr],nr);utils$1.isUndefined(or)&&ar!==ir||(n[nr]=or)}),n}const resolveConfig=s=>{const t=mergeConfig({},s);let{data:n,withXSRFToken:Ae,xsrfHeaderName:Ne,xsrfCookieName:tr,headers:er,auth:ir}=t;t.headers=er=AxiosHeaders.from(er),t.url=buildURL(buildFullPath(t.baseURL,t.url),s.params,s.paramsSerializer),ir&&er.set("Authorization","Basic "+btoa((ir.username||"")+":"+(ir.password?unescape(encodeURIComponent(ir.password)):"")));let sr;if(utils$1.isFormData(n)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)er.setContentType(void 0);else if((sr=er.getContentType())!==!1){const[rr,...nr]=sr?sr.split(";").map(ar=>ar.trim()).filter(Boolean):[];er.setContentType([rr||"multipart/form-data",...nr].join("; "))}}if(platform.hasStandardBrowserEnv&&(Ae&&utils$1.isFunction(Ae)&&(Ae=Ae(t)),Ae||Ae!==!1&&isURLSameOrigin(t.url))){const rr=Ne&&tr&&cookies.read(tr);rr&&er.set(Ne,rr)}return t},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(s){return new Promise(function(n,Ae){const Ne=resolveConfig(s);let tr=Ne.data;const er=AxiosHeaders.from(Ne.headers).normalize();let{responseType:ir,onUploadProgress:sr,onDownloadProgress:rr}=Ne,nr,ar,or,ur,hr;function cr(){ur&&ur(),hr&&hr(),Ne.cancelToken&&Ne.cancelToken.unsubscribe(nr),Ne.signal&&Ne.signal.removeEventListener("abort",nr)}let vr=new XMLHttpRequest;vr.open(Ne.method.toUpperCase(),Ne.url,!0),vr.timeout=Ne.timeout;function mr(){if(!vr)return;const lr=AxiosHeaders.from("getAllResponseHeaders"in vr&&vr.getAllResponseHeaders()),fr={data:!ir||ir==="text"||ir==="json"?vr.responseText:vr.response,status:vr.status,statusText:vr.statusText,headers:lr,config:s,request:vr};settle(function(Er){n(Er),cr()},function(Er){Ae(Er),cr()},fr),vr=null}"onloadend"in vr?vr.onloadend=mr:vr.onreadystatechange=function(){!vr||vr.readyState!==4||vr.status===0&&!(vr.responseURL&&vr.responseURL.indexOf("file:")===0)||setTimeout(mr)},vr.onabort=function(){vr&&(Ae(new AxiosError("Request aborted",AxiosError.ECONNABORTED,s,vr)),vr=null)},vr.onerror=function(){Ae(new AxiosError("Network Error",AxiosError.ERR_NETWORK,s,vr)),vr=null},vr.ontimeout=function(){let gr=Ne.timeout?"timeout of "+Ne.timeout+"ms exceeded":"timeout exceeded";const fr=Ne.transitional||transitionalDefaults;Ne.timeoutErrorMessage&&(gr=Ne.timeoutErrorMessage),Ae(new AxiosError(gr,fr.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,s,vr)),vr=null},tr===void 0&&er.setContentType(null),"setRequestHeader"in vr&&utils$1.forEach(er.toJSON(),function(gr,fr){vr.setRequestHeader(fr,gr)}),utils$1.isUndefined(Ne.withCredentials)||(vr.withCredentials=!!Ne.withCredentials),ir&&ir!=="json"&&(vr.responseType=Ne.responseType),rr&&([or,hr]=progressEventReducer(rr,!0),vr.addEventListener("progress",or)),sr&&vr.upload&&([ar,ur]=progressEventReducer(sr),vr.upload.addEventListener("progress",ar),vr.upload.addEventListener("loadend",ur)),(Ne.cancelToken||Ne.signal)&&(nr=lr=>{vr&&(Ae(!lr||lr.type?new CanceledError(null,s,vr):lr),vr.abort(),vr=null)},Ne.cancelToken&&Ne.cancelToken.subscribe(nr),Ne.signal&&(Ne.signal.aborted?nr():Ne.signal.addEventListener("abort",nr)));const dr=parseProtocol(Ne.url);if(dr&&platform.protocols.indexOf(dr)===-1){Ae(new AxiosError("Unsupported protocol "+dr+":",AxiosError.ERR_BAD_REQUEST,s));return}vr.send(tr||null)})},composeSignals=(s,t)=>{const{length:n}=s=s?s.filter(Boolean):[];if(t||n){let Ae=new AbortController,Ne;const tr=function(rr){if(!Ne){Ne=!0,ir();const nr=rr instanceof Error?rr:this.reason;Ae.abort(nr instanceof AxiosError?nr:new CanceledError(nr instanceof Error?nr.message:nr))}};let er=t&&setTimeout(()=>{er=null,tr(new AxiosError(`timeout ${t} of ms exceeded`,AxiosError.ETIMEDOUT))},t);const ir=()=>{s&&(er&&clearTimeout(er),er=null,s.forEach(rr=>{rr.unsubscribe?rr.unsubscribe(tr):rr.removeEventListener("abort",tr)}),s=null)};s.forEach(rr=>rr.addEventListener("abort",tr));const{signal:sr}=Ae;return sr.unsubscribe=()=>utils$1.asap(ir),sr}},streamChunk=function*(s,t){let n=s.byteLength;if(n<t){yield s;return}let Ae=0,Ne;for(;Ae<n;)Ne=Ae+t,yield s.slice(Ae,Ne),Ae=Ne},readBytes=async function*(s,t){for await(const n of readStream(s))yield*streamChunk(n,t)},readStream=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:n,value:Ae}=await t.read();if(n)break;yield Ae}}finally{await t.cancel()}},trackStream=(s,t,n,Ae)=>{const Ne=readBytes(s,t);let tr=0,er,ir=sr=>{er||(er=!0,Ae&&Ae(sr))};return new ReadableStream({async pull(sr){try{const{done:rr,value:nr}=await Ne.next();if(rr){ir(),sr.close();return}let ar=nr.byteLength;if(n){let or=tr+=ar;n(or)}sr.enqueue(new Uint8Array(nr))}catch(rr){throw ir(rr),rr}},cancel(sr){return ir(sr),Ne.return()}},{highWaterMark:2})},isFetchSupported=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",isReadableStreamSupported=isFetchSupported&&typeof ReadableStream=="function",encodeText=isFetchSupported&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),test=(s,...t)=>{try{return!!s(...t)}catch{return!1}},supportsRequestStream=isReadableStreamSupported&&test(()=>{let s=!1;const t=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),DEFAULT_CHUNK_SIZE=64*1024,supportsResponseStream=isReadableStreamSupported&&test(()=>utils$1.isReadableStream(new Response("").body)),resolvers={stream:supportsResponseStream&&(s=>s.body)};isFetchSupported&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!resolvers[t]&&(resolvers[t]=utils$1.isFunction(s[t])?n=>n[t]():(n,Ae)=>{throw new AxiosError(`Response type '${t}' is not supported`,AxiosError.ERR_NOT_SUPPORT,Ae)})})})(new Response);const getBodyLength=async s=>{if(s==null)return 0;if(utils$1.isBlob(s))return s.size;if(utils$1.isSpecCompliantForm(s))return(await new Request(platform.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(s)||utils$1.isArrayBuffer(s))return s.byteLength;if(utils$1.isURLSearchParams(s)&&(s=s+""),utils$1.isString(s))return(await encodeText(s)).byteLength},resolveBodyLength=async(s,t)=>{const n=utils$1.toFiniteNumber(s.getContentLength());return n??getBodyLength(t)},fetchAdapter=isFetchSupported&&(async s=>{let{url:t,method:n,data:Ae,signal:Ne,cancelToken:tr,timeout:er,onDownloadProgress:ir,onUploadProgress:sr,responseType:rr,headers:nr,withCredentials:ar="same-origin",fetchOptions:or}=resolveConfig(s);rr=rr?(rr+"").toLowerCase():"text";let ur=composeSignals([Ne,tr&&tr.toAbortSignal()],er),hr;const cr=ur&&ur.unsubscribe&&(()=>{ur.unsubscribe()});let vr;try{if(sr&&supportsRequestStream&&n!=="get"&&n!=="head"&&(vr=await resolveBodyLength(nr,Ae))!==0){let fr=new Request(t,{method:"POST",body:Ae,duplex:"half"}),yr;if(utils$1.isFormData(Ae)&&(yr=fr.headers.get("content-type"))&&nr.setContentType(yr),fr.body){const[Er,wr]=progressEventDecorator(vr,progressEventReducer(asyncDecorator(sr)));Ae=trackStream(fr.body,DEFAULT_CHUNK_SIZE,Er,wr)}}utils$1.isString(ar)||(ar=ar?"include":"omit");const mr="credentials"in Request.prototype;hr=new Request(t,{...or,signal:ur,method:n.toUpperCase(),headers:nr.normalize().toJSON(),body:Ae,duplex:"half",credentials:mr?ar:void 0});let dr=await fetch(hr);const lr=supportsResponseStream&&(rr==="stream"||rr==="response");if(supportsResponseStream&&(ir||lr&&cr)){const fr={};["status","statusText","headers"].forEach(Dr=>{fr[Dr]=dr[Dr]});const yr=utils$1.toFiniteNumber(dr.headers.get("content-length")),[Er,wr]=ir&&progressEventDecorator(yr,progressEventReducer(asyncDecorator(ir),!0))||[];dr=new Response(trackStream(dr.body,DEFAULT_CHUNK_SIZE,Er,()=>{wr&&wr(),cr&&cr()}),fr)}rr=rr||"text";let gr=await resolvers[utils$1.findKey(resolvers,rr)||"text"](dr,s);return!lr&&cr&&cr(),await new Promise((fr,yr)=>{settle(fr,yr,{data:gr,headers:AxiosHeaders.from(dr.headers),status:dr.status,statusText:dr.statusText,config:s,request:hr})})}catch(mr){throw cr&&cr(),mr&&mr.name==="TypeError"&&/fetch/i.test(mr.message)?Object.assign(new AxiosError("Network Error",AxiosError.ERR_NETWORK,s,hr),{cause:mr.cause||mr}):AxiosError.from(mr,mr&&mr.code,s,hr)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$1.forEach(knownAdapters,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const renderReason=s=>`- ${s}`,isResolvedHandle=s=>utils$1.isFunction(s)||s===null||s===!1,adapters={getAdapter:s=>{s=utils$1.isArray(s)?s:[s];const{length:t}=s;let n,Ae;const Ne={};for(let tr=0;tr<t;tr++){n=s[tr];let er;if(Ae=n,!isResolvedHandle(n)&&(Ae=knownAdapters[(er=String(n)).toLowerCase()],Ae===void 0))throw new AxiosError(`Unknown adapter '${er}'`);if(Ae)break;Ne[er||"#"+tr]=Ae}if(!Ae){const tr=Object.entries(Ne).map(([ir,sr])=>`adapter ${ir} `+(sr===!1?"is not supported by the environment":"is not available in the build"));let er=t?tr.length>1?`since :
`+tr.map(renderReason).join(`
`):" "+renderReason(tr[0]):"as no adapter specified";throw new AxiosError("There is no suitable adapter to dispatch the request "+er,"ERR_NOT_SUPPORT")}return Ae},adapters:knownAdapters};function throwIfCancellationRequested(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new CanceledError(null,s)}function dispatchRequest(s){return throwIfCancellationRequested(s),s.headers=AxiosHeaders.from(s.headers),s.data=transformData.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(s.adapter||defaults.adapter)(s).then(function(Ae){return throwIfCancellationRequested(s),Ae.data=transformData.call(s,s.transformResponse,Ae),Ae.headers=AxiosHeaders.from(Ae.headers),Ae},function(Ae){return isCancel(Ae)||(throwIfCancellationRequested(s),Ae&&Ae.response&&(Ae.response.data=transformData.call(s,s.transformResponse,Ae.response),Ae.response.headers=AxiosHeaders.from(Ae.response.headers))),Promise.reject(Ae)})}const VERSION="1.7.7",validators$1={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{validators$1[s]=function(Ae){return typeof Ae===s||"a"+(t<1?"n ":" ")+s}});const deprecatedWarnings={};validators$1.transitional=function(t,n,Ae){function Ne(tr,er){return"[Axios v"+VERSION+"] Transitional option '"+tr+"'"+er+(Ae?". "+Ae:"")}return(tr,er,ir)=>{if(t===!1)throw new AxiosError(Ne(er," has been removed"+(n?" in "+n:"")),AxiosError.ERR_DEPRECATED);return n&&!deprecatedWarnings[er]&&(deprecatedWarnings[er]=!0,console.warn(Ne(er," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(tr,er,ir):!0}};function assertOptions(s,t,n){if(typeof s!="object")throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const Ae=Object.keys(s);let Ne=Ae.length;for(;Ne-- >0;){const tr=Ae[Ne],er=t[tr];if(er){const ir=s[tr],sr=ir===void 0||er(ir,tr,s);if(sr!==!0)throw new AxiosError("option "+tr+" must be "+sr,AxiosError.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new AxiosError("Unknown option "+tr,AxiosError.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;class Axios{constructor(t){this.defaults=t,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(t,n){try{return await this._request(t,n)}catch(Ae){if(Ae instanceof Error){let Ne;Error.captureStackTrace?Error.captureStackTrace(Ne={}):Ne=new Error;const tr=Ne.stack?Ne.stack.replace(/^.+\n/,""):"";try{Ae.stack?tr&&!String(Ae.stack).endsWith(tr.replace(/^.+\n.+\n/,""))&&(Ae.stack+=`
`+tr):Ae.stack=tr}catch{}}throw Ae}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=mergeConfig(this.defaults,n);const{transitional:Ae,paramsSerializer:Ne,headers:tr}=n;Ae!==void 0&&validator.assertOptions(Ae,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),Ne!=null&&(utils$1.isFunction(Ne)?n.paramsSerializer={serialize:Ne}:validator.assertOptions(Ne,{encode:validators.function,serialize:validators.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let er=tr&&utils$1.merge(tr.common,tr[n.method]);tr&&utils$1.forEach(["delete","get","head","post","put","patch","common"],hr=>{delete tr[hr]}),n.headers=AxiosHeaders.concat(er,tr);const ir=[];let sr=!0;this.interceptors.request.forEach(function(cr){typeof cr.runWhen=="function"&&cr.runWhen(n)===!1||(sr=sr&&cr.synchronous,ir.unshift(cr.fulfilled,cr.rejected))});const rr=[];this.interceptors.response.forEach(function(cr){rr.push(cr.fulfilled,cr.rejected)});let nr,ar=0,or;if(!sr){const hr=[dispatchRequest.bind(this),void 0];for(hr.unshift.apply(hr,ir),hr.push.apply(hr,rr),or=hr.length,nr=Promise.resolve(n);ar<or;)nr=nr.then(hr[ar++],hr[ar++]);return nr}or=ir.length;let ur=n;for(ar=0;ar<or;){const hr=ir[ar++],cr=ir[ar++];try{ur=hr(ur)}catch(vr){cr.call(this,vr);break}}try{nr=dispatchRequest.call(this,ur)}catch(hr){return Promise.reject(hr)}for(ar=0,or=rr.length;ar<or;)nr=nr.then(rr[ar++],rr[ar++]);return nr}getUri(t){t=mergeConfig(this.defaults,t);const n=buildFullPath(t.baseURL,t.url);return buildURL(n,t.params,t.paramsSerializer)}}utils$1.forEach(["delete","get","head","options"],function(t){Axios.prototype[t]=function(n,Ae){return this.request(mergeConfig(Ae||{},{method:t,url:n,data:(Ae||{}).data}))}});utils$1.forEach(["post","put","patch"],function(t){function n(Ae){return function(tr,er,ir){return this.request(mergeConfig(ir||{},{method:t,headers:Ae?{"Content-Type":"multipart/form-data"}:{},url:tr,data:er}))}}Axios.prototype[t]=n(),Axios.prototype[t+"Form"]=n(!0)});class CancelToken{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(tr){n=tr});const Ae=this;this.promise.then(Ne=>{if(!Ae._listeners)return;let tr=Ae._listeners.length;for(;tr-- >0;)Ae._listeners[tr](Ne);Ae._listeners=null}),this.promise.then=Ne=>{let tr;const er=new Promise(ir=>{Ae.subscribe(ir),tr=ir}).then(Ne);return er.cancel=function(){Ae.unsubscribe(tr)},er},t(function(tr,er,ir){Ae.reason||(Ae.reason=new CanceledError(tr,er,ir),n(Ae.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=Ae=>{t.abort(Ae)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new CancelToken(function(Ne){t=Ne}),cancel:t}}}function spread(s){return function(n){return s.apply(null,n)}}function isAxiosError(s){return utils$1.isObject(s)&&s.isAxiosError===!0}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach(([s,t])=>{HttpStatusCode[t]=s});function createInstance(s){const t=new Axios(s),n=bind(Axios.prototype.request,t);return utils$1.extend(n,Axios.prototype,t,{allOwnKeys:!0}),utils$1.extend(n,t,null,{allOwnKeys:!0}),n.create=function(Ne){return createInstance(mergeConfig(s,Ne))},n}const axios=createInstance(defaults);axios.Axios=Axios;axios.CanceledError=CanceledError;axios.CancelToken=CancelToken;axios.isCancel=isCancel;axios.VERSION=VERSION;axios.toFormData=toFormData;axios.AxiosError=AxiosError;axios.Cancel=axios.CanceledError;axios.all=function(t){return Promise.all(t)};axios.spread=spread;axios.isAxiosError=isAxiosError;axios.mergeConfig=mergeConfig;axios.AxiosHeaders=AxiosHeaders;axios.formToJSON=s=>formDataToJSON(utils$1.isHTMLForm(s)?new FormData(s):s);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode;axios.default=axios;const pve$2={position:i$2.POSITION.BOTTOM_RIGHT},useAuthStore=defineStore("auth",()=>{const s=ref(!1),t=ref(null),n=ref(null);function Ae(sr,rr){t.value=sr,n.value=rr,s.value=!0,localStorage.setItem("userToken",rr),localStorage.setItem("telegramUser",JSON.stringify(sr)),i$2.success("User logged in successfully",pve$2)}function Ne(sr,rr){t.value=sr,n.value=rr,s.value=!0,localStorage.setItem("userToken",rr),localStorage.setItem("telegramUser",JSON.stringify(sr))}function tr(){t.value=null,n.value=null,s.value=!1,localStorage.removeItem("userToken"),localStorage.removeItem("telegramUser")}function er(){t.value=null,n.value=null,s.value=!1,localStorage.removeItem("userToken"),localStorage.removeItem("telegramUser"),i$2.success("User logged out successfully",pve$2)}async function ir(){var nr;const sr=localStorage.getItem("userToken"),rr=localStorage.getItem("telegramUser");if(sr&&rr){t.value=JSON.parse(rr),n.value=sr;try{(await axios.post("/api/verify-token",{id:((nr=t.value)==null?void 0:nr.id)??"",token:sr})).data.status==="success"?(s.value=!0,i$2.success("User authorised successfully",pve$2)):(s.value=!1,er())}catch{s.value=!1,i$2.error("User is not authorised",pve$2),er()}}else s.value=!1,i$2.error("User is not authorised",pve$2)}return{isAuthenticated:s,userInfo:t,token:n,login:Ae,logout:er,initializeAuth:ir,silent_login:Ne,silent_logout:tr}}),_hoisted_1$9={class:"modal"},_hoisted_2$7={class:"telegram-container"},_hoisted_3$6={key:0,id:"telegram-login"},_sfc_main$b=defineComponent({__name:"Login",emits:["close"],setup(s,{emit:t}){const n=t,Ae=useAuthStore();function Ne(){n("close")}return window.onTelegramAuth=function(tr){localStorage.setItem("telegramUser",JSON.stringify(tr)),Ae.silent_login({id:tr.id,first_name:tr.first_name,last_name:tr.last_name||"",username:tr.username||"",photo_url:tr.photo_url||""},"");const er={id:tr.id,first_name:tr.first_name,last_name:tr.last_name||"",username:tr.username||"",photo_url:tr.photo_url||"",auth_date:tr.auth_date,hash:tr.hash};fetch("https://pve.finance/api/telegram-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(er)}).then(ir=>ir.json()).then(ir=>{ir.status==="success"&&(localStorage.setItem("userToken",ir.token),localStorage.setItem("userId",tr.id),Ae.login(Ae.userInfo,ir.token),n("close"))}).catch(ir=>{console.error("Error sending data to server:",ir)})},onMounted(()=>{var tr;if(!Ae.isAuthenticated){const er=document.createElement("script");er.async=!0,er.src="https://telegram.org/js/telegram-widget.js?22",er.setAttribute("data-telegram-login","pvetrader_bot"),er.setAttribute("data-size","large"),er.setAttribute("data-userpic","false"),er.setAttribute("data-request-access","write"),er.setAttribute("data-onauth","onTelegramAuth(user)"),(tr=document.getElementById("telegram-login"))==null||tr.appendChild(er)}}),(tr,er)=>(openBlock(),createElementBlock("div",{class:"modal-overlay",onClick:withModifiers(Ne,["self"])},[createBaseVNode("div",_hoisted_1$9,[createBaseVNode("div",_hoisted_2$7,[unref(Ae).isAuthenticated?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_3$6))])])]))}}),_export_sfc=(s,t)=>{const n=s.__vccOpts||s;for(const[Ae,Ne]of t)n[Ae]=Ne;return n},Login=_export_sfc(_sfc_main$b,[["__scopeId","data-v-2590d0cc"]]),defaultProfileImage="/assets/default-COgikoya.png",_hoisted_1$8={class:"header"},_hoisted_2$6={class:"navbar"},_hoisted_3$5={class:"logo"},_hoisted_4$2={class:"nav-links"},_hoisted_5$2={class:"auth-section"},_hoisted_6$2={key:1,class:"profile-wrapper"},_hoisted_7$2={class:"profile-button"},_hoisted_8$1=["src"],_sfc_main$a=defineComponent({__name:"Header",setup(s){const t=useAuthStore(),n=ref(!1);return onMounted(()=>{}),(Ae,Ne)=>{const tr=resolveComponent("router-link");return openBlock(),createElementBlock("header",_hoisted_1$8,[createBaseVNode("nav",_hoisted_2$6,[createBaseVNode("div",_hoisted_3$5,[createVNode(tr,{to:"/"},{default:withCtx(()=>Ne[2]||(Ne[2]=[createTextVNode("pve")])),_:1})]),createBaseVNode("ul",_hoisted_4$2,[createBaseVNode("li",null,[createVNode(tr,{to:"/factory"},{default:withCtx(()=>Ne[3]||(Ne[3]=[createTextVNode("Factory")])),_:1})]),createBaseVNode("li",null,[createVNode(tr,{to:"/port"},{default:withCtx(()=>Ne[4]||(Ne[4]=[createTextVNode("Port")])),_:1})]),createBaseVNode("li",null,[createVNode(tr,{to:"/docs"},{default:withCtx(()=>Ne[5]||(Ne[5]=[createTextVNode("Docs")])),_:1})])]),createBaseVNode("div",_hoisted_5$2,[unref(t).isAuthenticated?(openBlock(),createElementBlock("div",_hoisted_6$2,[createVNode(tr,{to:"/profile"},{default:withCtx(()=>{var er;return[createBaseVNode("div",_hoisted_7$2,[createBaseVNode("img",{src:((er=unref(t).userInfo)==null?void 0:er.photo_url)||unref(defaultProfileImage),alt:"User Profile"},null,8,_hoisted_8$1)])]}),_:1})])):(openBlock(),createElementBlock("button",{key:0,onClick:Ne[0]||(Ne[0]=er=>n.value=!0)},"Login"))])]),n.value?(openBlock(),createBlock(Login,{key:0,onClose:Ne[1]||(Ne[1]=er=>n.value=!1)})):createCommentVNode("",!0)])}}}),Header=_export_sfc(_sfc_main$a,[["__scopeId","data-v-9f46cff1"]]),_sfc_main$9={},_hoisted_1$7={class:"footer"};function _sfc_render$2(s,t){return openBlock(),createElementBlock("footer",_hoisted_1$7,t[0]||(t[0]=[createBaseVNode("p",null,"© 2024 pve. All rights not reserved.",-1)]))}const Footer=_export_sfc(_sfc_main$9,[["render",_sfc_render$2],["__scopeId","data-v-aabd87f9"]]),_hoisted_1$6={class:"app-container"},_sfc_main$8=defineComponent({__name:"App",setup(s){return(t,n)=>{const Ae=resolveComponent("router-view");return openBlock(),createElementBlock("div",_hoisted_1$6,[createVNode(Header),createVNode(Ae),createVNode(Footer)])}}}),App=_export_sfc(_sfc_main$8,[["__scopeId","data-v-19609a22"]]);/*!
  * vue-router v4.4.3
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const isBrowser=typeof document<"u";function isESModule(s){return s.__esModule||s[Symbol.toStringTag]==="Module"}const assign=Object.assign;function applyToParams(s,t){const n={};for(const Ae in t){const Ne=t[Ae];n[Ae]=isArray(Ne)?Ne.map(s):s(Ne)}return n}const noop=()=>{},isArray=Array.isArray,HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(s){return encodeURI(""+s).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(s){return commonEncode(s).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(s){return commonEncode(s).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(s){return encodeQueryValue(s).replace(EQUAL_RE,"%3D")}function encodePath(s){return commonEncode(s).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(s){return s==null?"":encodePath(s).replace(SLASH_RE,"%2F")}function decode$2(s){try{return decodeURIComponent(""+s)}catch{}return""+s}const TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=s=>s.replace(TRAILING_SLASH_RE,"");function parseURL(s,t,n="/"){let Ae,Ne={},tr="",er="";const ir=t.indexOf("#");let sr=t.indexOf("?");return ir<sr&&ir>=0&&(sr=-1),sr>-1&&(Ae=t.slice(0,sr),tr=t.slice(sr+1,ir>-1?ir:t.length),Ne=s(tr)),ir>-1&&(Ae=Ae||t.slice(0,ir),er=t.slice(ir,t.length)),Ae=resolveRelativePath(Ae??t,n),{fullPath:Ae+(tr&&"?")+tr+er,path:Ae,query:Ne,hash:decode$2(er)}}function stringifyURL(s,t){const n=t.query?s(t.query):"";return t.path+(n&&"?")+n+(t.hash||"")}function stripBase(s,t){return!t||!s.toLowerCase().startsWith(t.toLowerCase())?s:s.slice(t.length)||"/"}function isSameRouteLocation(s,t,n){const Ae=t.matched.length-1,Ne=n.matched.length-1;return Ae>-1&&Ae===Ne&&isSameRouteRecord(t.matched[Ae],n.matched[Ne])&&isSameRouteLocationParams(t.params,n.params)&&s(t.query)===s(n.query)&&t.hash===n.hash}function isSameRouteRecord(s,t){return(s.aliasOf||s)===(t.aliasOf||t)}function isSameRouteLocationParams(s,t){if(Object.keys(s).length!==Object.keys(t).length)return!1;for(const n in s)if(!isSameRouteLocationParamsValue(s[n],t[n]))return!1;return!0}function isSameRouteLocationParamsValue(s,t){return isArray(s)?isEquivalentArray(s,t):isArray(t)?isEquivalentArray(t,s):s===t}function isEquivalentArray(s,t){return isArray(t)?s.length===t.length&&s.every((n,Ae)=>n===t[Ae]):s.length===1&&s[0]===t}function resolveRelativePath(s,t){if(s.startsWith("/"))return s;if(!s)return t;const n=t.split("/"),Ae=s.split("/"),Ne=Ae[Ae.length-1];(Ne===".."||Ne===".")&&Ae.push("");let tr=n.length-1,er,ir;for(er=0;er<Ae.length;er++)if(ir=Ae[er],ir!==".")if(ir==="..")tr>1&&tr--;else break;return n.slice(0,tr).join("/")+"/"+Ae.slice(er).join("/")}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var NavigationType;(function(s){s.pop="pop",s.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(s){s.back="back",s.forward="forward",s.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(s){if(!s)if(isBrowser){const t=document.querySelector("base");s=t&&t.getAttribute("href")||"/",s=s.replace(/^\w+:\/\/[^\/]+/,"")}else s="/";return s[0]!=="/"&&s[0]!=="#"&&(s="/"+s),removeTrailingSlash(s)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(s,t){return s.replace(BEFORE_HASH_RE,"#")+t}function getElementPosition(s,t){const n=document.documentElement.getBoundingClientRect(),Ae=s.getBoundingClientRect();return{behavior:t.behavior,left:Ae.left-n.left-(t.left||0),top:Ae.top-n.top-(t.top||0)}}const computeScrollPosition=()=>({left:window.scrollX,top:window.scrollY});function scrollToPosition(s){let t;if("el"in s){const n=s.el,Ae=typeof n=="string"&&n.startsWith("#"),Ne=typeof n=="string"?Ae?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!Ne)return;t=getElementPosition(Ne,s)}else t=s;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function getScrollKey(s,t){return(history.state?history.state.position-t:-1)+s}const scrollPositions=new Map;function saveScrollPosition(s,t){scrollPositions.set(s,t)}function getSavedScrollPosition(s){const t=scrollPositions.get(s);return scrollPositions.delete(s),t}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(s,t){const{pathname:n,search:Ae,hash:Ne}=t,tr=s.indexOf("#");if(tr>-1){let ir=Ne.includes(s.slice(tr))?s.slice(tr).length:1,sr=Ne.slice(ir);return sr[0]!=="/"&&(sr="/"+sr),stripBase(sr,"")}return stripBase(n,s)+Ae+Ne}function useHistoryListeners(s,t,n,Ae){let Ne=[],tr=[],er=null;const ir=({state:or})=>{const ur=createCurrentLocation(s,location),hr=n.value,cr=t.value;let vr=0;if(or){if(n.value=ur,t.value=or,er&&er===hr){er=null;return}vr=cr?or.position-cr.position:0}else Ae(ur);Ne.forEach(mr=>{mr(n.value,hr,{delta:vr,type:NavigationType.pop,direction:vr?vr>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function sr(){er=n.value}function rr(or){Ne.push(or);const ur=()=>{const hr=Ne.indexOf(or);hr>-1&&Ne.splice(hr,1)};return tr.push(ur),ur}function nr(){const{history:or}=window;or.state&&or.replaceState(assign({},or.state,{scroll:computeScrollPosition()}),"")}function ar(){for(const or of tr)or();tr=[],window.removeEventListener("popstate",ir),window.removeEventListener("beforeunload",nr)}return window.addEventListener("popstate",ir),window.addEventListener("beforeunload",nr,{passive:!0}),{pauseListeners:sr,listen:rr,destroy:ar}}function buildState(s,t,n,Ae=!1,Ne=!1){return{back:s,current:t,forward:n,replaced:Ae,position:window.history.length,scroll:Ne?computeScrollPosition():null}}function useHistoryStateNavigation(s){const{history:t,location:n}=window,Ae={value:createCurrentLocation(s,n)},Ne={value:t.state};Ne.value||tr(Ae.value,{back:null,current:Ae.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function tr(sr,rr,nr){const ar=s.indexOf("#"),or=ar>-1?(n.host&&document.querySelector("base")?s:s.slice(ar))+sr:createBaseLocation()+s+sr;try{t[nr?"replaceState":"pushState"](rr,"",or),Ne.value=rr}catch(ur){console.error(ur),n[nr?"replace":"assign"](or)}}function er(sr,rr){const nr=assign({},t.state,buildState(Ne.value.back,sr,Ne.value.forward,!0),rr,{position:Ne.value.position});tr(sr,nr,!0),Ae.value=sr}function ir(sr,rr){const nr=assign({},Ne.value,t.state,{forward:sr,scroll:computeScrollPosition()});tr(nr.current,nr,!0);const ar=assign({},buildState(Ae.value,sr,null),{position:nr.position+1},rr);tr(sr,ar,!1),Ae.value=sr}return{location:Ae,state:Ne,push:ir,replace:er}}function createWebHistory(s){s=normalizeBase(s);const t=useHistoryStateNavigation(s),n=useHistoryListeners(s,t.state,t.location,t.replace);function Ae(tr,er=!0){er||n.pauseListeners(),history.go(tr)}const Ne=assign({location:"",base:s,go:Ae,createHref:createHref.bind(null,s)},t,n);return Object.defineProperty(Ne,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(Ne,"state",{enumerable:!0,get:()=>t.state.value}),Ne}function isRouteLocation(s){return typeof s=="string"||s&&typeof s=="object"}function isRouteName(s){return typeof s=="string"||typeof s=="symbol"}const NavigationFailureSymbol=Symbol("");var NavigationFailureType;(function(s){s[s.aborted=4]="aborted",s[s.cancelled=8]="cancelled",s[s.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(s,t){return assign(new Error,{type:s,[NavigationFailureSymbol]:!0},t)}function isNavigationFailure(s,t){return s instanceof Error&&NavigationFailureSymbol in s&&(t==null||!!(s.type&t))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(s,t){const n=assign({},BASE_PATH_PARSER_OPTIONS,t),Ae=[];let Ne=n.start?"^":"";const tr=[];for(const rr of s){const nr=rr.length?[]:[90];n.strict&&!rr.length&&(Ne+="/");for(let ar=0;ar<rr.length;ar++){const or=rr[ar];let ur=40+(n.sensitive?.25:0);if(or.type===0)ar||(Ne+="/"),Ne+=or.value.replace(REGEX_CHARS_RE,"\\$&"),ur+=40;else if(or.type===1){const{value:hr,repeatable:cr,optional:vr,regexp:mr}=or;tr.push({name:hr,repeatable:cr,optional:vr});const dr=mr||BASE_PARAM_PATTERN;if(dr!==BASE_PARAM_PATTERN){ur+=10;try{new RegExp(`(${dr})`)}catch(gr){throw new Error(`Invalid custom RegExp for param "${hr}" (${dr}): `+gr.message)}}let lr=cr?`((?:${dr})(?:/(?:${dr}))*)`:`(${dr})`;ar||(lr=vr&&rr.length<2?`(?:/${lr})`:"/"+lr),vr&&(lr+="?"),Ne+=lr,ur+=20,vr&&(ur+=-8),cr&&(ur+=-20),dr===".*"&&(ur+=-50)}nr.push(ur)}Ae.push(nr)}if(n.strict&&n.end){const rr=Ae.length-1;Ae[rr][Ae[rr].length-1]+=.7000000000000001}n.strict||(Ne+="/?"),n.end?Ne+="$":n.strict&&(Ne+="(?:/|$)");const er=new RegExp(Ne,n.sensitive?"":"i");function ir(rr){const nr=rr.match(er),ar={};if(!nr)return null;for(let or=1;or<nr.length;or++){const ur=nr[or]||"",hr=tr[or-1];ar[hr.name]=ur&&hr.repeatable?ur.split("/"):ur}return ar}function sr(rr){let nr="",ar=!1;for(const or of s){(!ar||!nr.endsWith("/"))&&(nr+="/"),ar=!1;for(const ur of or)if(ur.type===0)nr+=ur.value;else if(ur.type===1){const{value:hr,repeatable:cr,optional:vr}=ur,mr=hr in rr?rr[hr]:"";if(isArray(mr)&&!cr)throw new Error(`Provided param "${hr}" is an array but it is not repeatable (* or + modifiers)`);const dr=isArray(mr)?mr.join("/"):mr;if(!dr)if(vr)or.length<2&&(nr.endsWith("/")?nr=nr.slice(0,-1):ar=!0);else throw new Error(`Missing required param "${hr}"`);nr+=dr}}return nr||"/"}return{re:er,score:Ae,keys:tr,parse:ir,stringify:sr}}function compareScoreArray(s,t){let n=0;for(;n<s.length&&n<t.length;){const Ae=t[n]-s[n];if(Ae)return Ae;n++}return s.length<t.length?s.length===1&&s[0]===80?-1:1:s.length>t.length?t.length===1&&t[0]===80?1:-1:0}function comparePathParserScore(s,t){let n=0;const Ae=s.score,Ne=t.score;for(;n<Ae.length&&n<Ne.length;){const tr=compareScoreArray(Ae[n],Ne[n]);if(tr)return tr;n++}if(Math.abs(Ne.length-Ae.length)===1){if(isLastScoreNegative(Ae))return 1;if(isLastScoreNegative(Ne))return-1}return Ne.length-Ae.length}function isLastScoreNegative(s){const t=s[s.length-1];return s.length>0&&t[t.length-1]<0}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(s){if(!s)return[[]];if(s==="/")return[[ROOT_TOKEN]];if(!s.startsWith("/"))throw new Error(`Invalid path "${s}"`);function t(ur){throw new Error(`ERR (${n})/"${rr}": ${ur}`)}let n=0,Ae=n;const Ne=[];let tr;function er(){tr&&Ne.push(tr),tr=[]}let ir=0,sr,rr="",nr="";function ar(){rr&&(n===0?tr.push({type:0,value:rr}):n===1||n===2||n===3?(tr.length>1&&(sr==="*"||sr==="+")&&t(`A repeatable param (${rr}) must be alone in its segment. eg: '/:ids+.`),tr.push({type:1,value:rr,regexp:nr,repeatable:sr==="*"||sr==="+",optional:sr==="*"||sr==="?"})):t("Invalid state to consume buffer"),rr="")}function or(){rr+=sr}for(;ir<s.length;){if(sr=s[ir++],sr==="\\"&&n!==2){Ae=n,n=4;continue}switch(n){case 0:sr==="/"?(rr&&ar(),er()):sr===":"?(ar(),n=1):or();break;case 4:or(),n=Ae;break;case 1:sr==="("?n=2:VALID_PARAM_RE.test(sr)?or():(ar(),n=0,sr!=="*"&&sr!=="?"&&sr!=="+"&&ir--);break;case 2:sr===")"?nr[nr.length-1]=="\\"?nr=nr.slice(0,-1)+sr:n=3:nr+=sr;break;case 3:ar(),n=0,sr!=="*"&&sr!=="?"&&sr!=="+"&&ir--,nr="";break;default:t("Unknown state");break}}return n===2&&t(`Unfinished custom RegExp for param "${rr}"`),ar(),er(),Ne}function createRouteRecordMatcher(s,t,n){const Ae=tokensToParser(tokenizePath(s.path),n),Ne=assign(Ae,{record:s,parent:t,children:[],alias:[]});return t&&!Ne.record.aliasOf==!t.record.aliasOf&&t.children.push(Ne),Ne}function createRouterMatcher(s,t){const n=[],Ae=new Map;t=mergeOptions({strict:!1,end:!0,sensitive:!1},t);function Ne(ar){return Ae.get(ar)}function tr(ar,or,ur){const hr=!ur,cr=normalizeRouteRecord(ar);cr.aliasOf=ur&&ur.record;const vr=mergeOptions(t,ar),mr=[cr];if("alias"in ar){const gr=typeof ar.alias=="string"?[ar.alias]:ar.alias;for(const fr of gr)mr.push(assign({},cr,{components:ur?ur.record.components:cr.components,path:fr,aliasOf:ur?ur.record:cr}))}let dr,lr;for(const gr of mr){const{path:fr}=gr;if(or&&fr[0]!=="/"){const yr=or.record.path,Er=yr[yr.length-1]==="/"?"":"/";gr.path=or.record.path+(fr&&Er+fr)}if(dr=createRouteRecordMatcher(gr,or,vr),ur?ur.alias.push(dr):(lr=lr||dr,lr!==dr&&lr.alias.push(dr),hr&&ar.name&&!isAliasRecord(dr)&&er(ar.name)),isMatchable(dr)&&sr(dr),cr.children){const yr=cr.children;for(let Er=0;Er<yr.length;Er++)tr(yr[Er],dr,ur&&ur.children[Er])}ur=ur||dr}return lr?()=>{er(lr)}:noop}function er(ar){if(isRouteName(ar)){const or=Ae.get(ar);or&&(Ae.delete(ar),n.splice(n.indexOf(or),1),or.children.forEach(er),or.alias.forEach(er))}else{const or=n.indexOf(ar);or>-1&&(n.splice(or,1),ar.record.name&&Ae.delete(ar.record.name),ar.children.forEach(er),ar.alias.forEach(er))}}function ir(){return n}function sr(ar){const or=findInsertionIndex(ar,n);n.splice(or,0,ar),ar.record.name&&!isAliasRecord(ar)&&Ae.set(ar.record.name,ar)}function rr(ar,or){let ur,hr={},cr,vr;if("name"in ar&&ar.name){if(ur=Ae.get(ar.name),!ur)throw createRouterError(1,{location:ar});vr=ur.record.name,hr=assign(paramsFromLocation(or.params,ur.keys.filter(lr=>!lr.optional).concat(ur.parent?ur.parent.keys.filter(lr=>lr.optional):[]).map(lr=>lr.name)),ar.params&&paramsFromLocation(ar.params,ur.keys.map(lr=>lr.name))),cr=ur.stringify(hr)}else if(ar.path!=null)cr=ar.path,ur=n.find(lr=>lr.re.test(cr)),ur&&(hr=ur.parse(cr),vr=ur.record.name);else{if(ur=or.name?Ae.get(or.name):n.find(lr=>lr.re.test(or.path)),!ur)throw createRouterError(1,{location:ar,currentLocation:or});vr=ur.record.name,hr=assign({},or.params,ar.params),cr=ur.stringify(hr)}const mr=[];let dr=ur;for(;dr;)mr.unshift(dr.record),dr=dr.parent;return{name:vr,path:cr,params:hr,matched:mr,meta:mergeMetaFields(mr)}}s.forEach(ar=>tr(ar));function nr(){n.length=0,Ae.clear()}return{addRoute:tr,resolve:rr,removeRoute:er,clearRoutes:nr,getRoutes:ir,getRecordMatcher:Ne}}function paramsFromLocation(s,t){const n={};for(const Ae of t)Ae in s&&(n[Ae]=s[Ae]);return n}function normalizeRouteRecord(s){return{path:s.path,redirect:s.redirect,name:s.name,meta:s.meta||{},aliasOf:void 0,beforeEnter:s.beforeEnter,props:normalizeRecordProps(s),children:s.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in s?s.components||null:s.component&&{default:s.component}}}function normalizeRecordProps(s){const t={},n=s.props||!1;if("component"in s)t.default=n;else for(const Ae in s.components)t[Ae]=typeof n=="object"?n[Ae]:n;return t}function isAliasRecord(s){for(;s;){if(s.record.aliasOf)return!0;s=s.parent}return!1}function mergeMetaFields(s){return s.reduce((t,n)=>assign(t,n.meta),{})}function mergeOptions(s,t){const n={};for(const Ae in s)n[Ae]=Ae in t?t[Ae]:s[Ae];return n}function findInsertionIndex(s,t){let n=0,Ae=t.length;for(;n!==Ae;){const tr=n+Ae>>1;comparePathParserScore(s,t[tr])<0?Ae=tr:n=tr+1}const Ne=getInsertionAncestor(s);return Ne&&(Ae=t.lastIndexOf(Ne,Ae-1)),Ae}function getInsertionAncestor(s){let t=s;for(;t=t.parent;)if(isMatchable(t)&&comparePathParserScore(s,t)===0)return t}function isMatchable({record:s}){return!!(s.name||s.components&&Object.keys(s.components).length||s.redirect)}function parseQuery(s){const t={};if(s===""||s==="?")return t;const Ae=(s[0]==="?"?s.slice(1):s).split("&");for(let Ne=0;Ne<Ae.length;++Ne){const tr=Ae[Ne].replace(PLUS_RE," "),er=tr.indexOf("="),ir=decode$2(er<0?tr:tr.slice(0,er)),sr=er<0?null:decode$2(tr.slice(er+1));if(ir in t){let rr=t[ir];isArray(rr)||(rr=t[ir]=[rr]),rr.push(sr)}else t[ir]=sr}return t}function stringifyQuery(s){let t="";for(let n in s){const Ae=s[n];if(n=encodeQueryKey(n),Ae==null){Ae!==void 0&&(t+=(t.length?"&":"")+n);continue}(isArray(Ae)?Ae.map(tr=>tr&&encodeQueryValue(tr)):[Ae&&encodeQueryValue(Ae)]).forEach(tr=>{tr!==void 0&&(t+=(t.length?"&":"")+n,tr!=null&&(t+="="+tr))})}return t}function normalizeQuery(s){const t={};for(const n in s){const Ae=s[n];Ae!==void 0&&(t[n]=isArray(Ae)?Ae.map(Ne=>Ne==null?null:""+Ne):Ae==null?Ae:""+Ae)}return t}const matchedRouteKey=Symbol(""),viewDepthKey=Symbol(""),routerKey=Symbol(""),routeLocationKey=Symbol(""),routerViewLocationKey=Symbol("");function useCallbacks(){let s=[];function t(Ae){return s.push(Ae),()=>{const Ne=s.indexOf(Ae);Ne>-1&&s.splice(Ne,1)}}function n(){s=[]}return{add:t,list:()=>s.slice(),reset:n}}function guardToPromiseFn(s,t,n,Ae,Ne,tr=er=>er()){const er=Ae&&(Ae.enterCallbacks[Ne]=Ae.enterCallbacks[Ne]||[]);return()=>new Promise((ir,sr)=>{const rr=or=>{or===!1?sr(createRouterError(4,{from:n,to:t})):or instanceof Error?sr(or):isRouteLocation(or)?sr(createRouterError(2,{from:t,to:or})):(er&&Ae.enterCallbacks[Ne]===er&&typeof or=="function"&&er.push(or),ir())},nr=tr(()=>s.call(Ae&&Ae.instances[Ne],t,n,rr));let ar=Promise.resolve(nr);s.length<3&&(ar=ar.then(rr)),ar.catch(or=>sr(or))})}function extractComponentsGuards(s,t,n,Ae,Ne=tr=>tr()){const tr=[];for(const er of s)for(const ir in er.components){let sr=er.components[ir];if(!(t!=="beforeRouteEnter"&&!er.instances[ir]))if(isRouteComponent(sr)){const nr=(sr.__vccOpts||sr)[t];nr&&tr.push(guardToPromiseFn(nr,n,Ae,er,ir,Ne))}else{let rr=sr();tr.push(()=>rr.then(nr=>{if(!nr)return Promise.reject(new Error(`Couldn't resolve component "${ir}" at "${er.path}"`));const ar=isESModule(nr)?nr.default:nr;er.components[ir]=ar;const ur=(ar.__vccOpts||ar)[t];return ur&&guardToPromiseFn(ur,n,Ae,er,ir,Ne)()}))}}return tr}function isRouteComponent(s){return typeof s=="object"||"displayName"in s||"props"in s||"__vccOpts"in s}function useLink(s){const t=inject(routerKey),n=inject(routeLocationKey),Ae=computed(()=>{const sr=unref(s.to);return t.resolve(sr)}),Ne=computed(()=>{const{matched:sr}=Ae.value,{length:rr}=sr,nr=sr[rr-1],ar=n.matched;if(!nr||!ar.length)return-1;const or=ar.findIndex(isSameRouteRecord.bind(null,nr));if(or>-1)return or;const ur=getOriginalPath(sr[rr-2]);return rr>1&&getOriginalPath(nr)===ur&&ar[ar.length-1].path!==ur?ar.findIndex(isSameRouteRecord.bind(null,sr[rr-2])):or}),tr=computed(()=>Ne.value>-1&&includesParams(n.params,Ae.value.params)),er=computed(()=>Ne.value>-1&&Ne.value===n.matched.length-1&&isSameRouteLocationParams(n.params,Ae.value.params));function ir(sr={}){return guardEvent(sr)?t[unref(s.replace)?"replace":"push"](unref(s.to)).catch(noop):Promise.resolve()}return{route:Ae,href:computed(()=>Ae.value.href),isActive:tr,isExactActive:er,navigate:ir}}const RouterLinkImpl=defineComponent({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink,setup(s,{slots:t}){const n=reactive(useLink(s)),{options:Ae}=inject(routerKey),Ne=computed(()=>({[getLinkClass(s.activeClass,Ae.linkActiveClass,"router-link-active")]:n.isActive,[getLinkClass(s.exactActiveClass,Ae.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive}));return()=>{const tr=t.default&&t.default(n);return s.custom?tr:h$1("a",{"aria-current":n.isExactActive?s.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:Ne.value},tr)}}}),RouterLink=RouterLinkImpl;function guardEvent(s){if(!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)&&!s.defaultPrevented&&!(s.button!==void 0&&s.button!==0)){if(s.currentTarget&&s.currentTarget.getAttribute){const t=s.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return s.preventDefault&&s.preventDefault(),!0}}function includesParams(s,t){for(const n in t){const Ae=t[n],Ne=s[n];if(typeof Ae=="string"){if(Ae!==Ne)return!1}else if(!isArray(Ne)||Ne.length!==Ae.length||Ae.some((tr,er)=>tr!==Ne[er]))return!1}return!0}function getOriginalPath(s){return s?s.aliasOf?s.aliasOf.path:s.path:""}const getLinkClass=(s,t,n)=>s??t??n,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(s,{attrs:t,slots:n}){const Ae=inject(routerViewLocationKey),Ne=computed(()=>s.route||Ae.value),tr=inject(viewDepthKey,0),er=computed(()=>{let rr=unref(tr);const{matched:nr}=Ne.value;let ar;for(;(ar=nr[rr])&&!ar.components;)rr++;return rr}),ir=computed(()=>Ne.value.matched[er.value]);provide(viewDepthKey,computed(()=>er.value+1)),provide(matchedRouteKey,ir),provide(routerViewLocationKey,Ne);const sr=ref();return watch(()=>[sr.value,ir.value,s.name],([rr,nr,ar],[or,ur,hr])=>{nr&&(nr.instances[ar]=rr,ur&&ur!==nr&&rr&&rr===or&&(nr.leaveGuards.size||(nr.leaveGuards=ur.leaveGuards),nr.updateGuards.size||(nr.updateGuards=ur.updateGuards))),rr&&nr&&(!ur||!isSameRouteRecord(nr,ur)||!or)&&(nr.enterCallbacks[ar]||[]).forEach(cr=>cr(rr))},{flush:"post"}),()=>{const rr=Ne.value,nr=s.name,ar=ir.value,or=ar&&ar.components[nr];if(!or)return normalizeSlot(n.default,{Component:or,route:rr});const ur=ar.props[nr],hr=ur?ur===!0?rr.params:typeof ur=="function"?ur(rr):ur:null,vr=h$1(or,assign({},hr,t,{onVnodeUnmounted:mr=>{mr.component.isUnmounted&&(ar.instances[nr]=null)},ref:sr}));return normalizeSlot(n.default,{Component:vr,route:rr})||vr}}});function normalizeSlot(s,t){if(!s)return null;const n=s(t);return n.length===1?n[0]:n}const RouterView=RouterViewImpl;function createRouter(s){const t=createRouterMatcher(s.routes,s),n=s.parseQuery||parseQuery,Ae=s.stringifyQuery||stringifyQuery,Ne=s.history,tr=useCallbacks(),er=useCallbacks(),ir=useCallbacks(),sr=shallowRef(START_LOCATION_NORMALIZED);let rr=START_LOCATION_NORMALIZED;isBrowser&&s.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const nr=applyToParams.bind(null,pr=>""+pr),ar=applyToParams.bind(null,encodeParam),or=applyToParams.bind(null,decode$2);function ur(pr,br){let Cr,Rr;return isRouteName(pr)?(Cr=t.getRecordMatcher(pr),Rr=br):Rr=pr,t.addRoute(Rr,Cr)}function hr(pr){const br=t.getRecordMatcher(pr);br&&t.removeRoute(br)}function cr(){return t.getRoutes().map(pr=>pr.record)}function vr(pr){return!!t.getRecordMatcher(pr)}function mr(pr,br){if(br=assign({},br||sr.value),typeof pr=="string"){const Or=parseURL(n,pr,br.path),Pr=t.resolve({path:Or.path},br),Ur=Ne.createHref(Or.fullPath);return assign(Or,Pr,{params:or(Pr.params),hash:decode$2(Or.hash),redirectedFrom:void 0,href:Ur})}let Cr;if(pr.path!=null)Cr=assign({},pr,{path:parseURL(n,pr.path,br.path).path});else{const Or=assign({},pr.params);for(const Pr in Or)Or[Pr]==null&&delete Or[Pr];Cr=assign({},pr,{params:ar(Or)}),br.params=ar(br.params)}const Rr=t.resolve(Cr,br),Mr=pr.hash||"";Rr.params=nr(or(Rr.params));const Fr=stringifyURL(Ae,assign({},pr,{hash:encodeHash(Mr),path:Rr.path})),xr=Ne.createHref(Fr);return assign({fullPath:Fr,hash:Mr,query:Ae===stringifyQuery?normalizeQuery(pr.query):pr.query||{}},Rr,{redirectedFrom:void 0,href:xr})}function dr(pr){return typeof pr=="string"?parseURL(n,pr,sr.value.path):assign({},pr)}function lr(pr,br){if(rr!==pr)return createRouterError(8,{from:br,to:pr})}function gr(pr){return Er(pr)}function fr(pr){return gr(assign(dr(pr),{replace:!0}))}function yr(pr){const br=pr.matched[pr.matched.length-1];if(br&&br.redirect){const{redirect:Cr}=br;let Rr=typeof Cr=="function"?Cr(pr):Cr;return typeof Rr=="string"&&(Rr=Rr.includes("?")||Rr.includes("#")?Rr=dr(Rr):{path:Rr},Rr.params={}),assign({query:pr.query,hash:pr.hash,params:Rr.path!=null?{}:pr.params},Rr)}}function Er(pr,br){const Cr=rr=mr(pr),Rr=sr.value,Mr=pr.state,Fr=pr.force,xr=pr.replace===!0,Or=yr(Cr);if(Or)return Er(assign(dr(Or),{state:typeof Or=="object"?assign({},Mr,Or.state):Mr,force:Fr,replace:xr}),br||Cr);const Pr=Cr;Pr.redirectedFrom=br;let Ur;return!Fr&&isSameRouteLocation(Ae,Rr,Cr)&&(Ur=createRouterError(16,{to:Pr,from:Rr}),Gr(Rr,Rr,!0,!1)),(Ur?Promise.resolve(Ur):kr(Pr,Rr)).catch($r=>isNavigationFailure($r)?isNavigationFailure($r,2)?$r:Ir($r):Tr($r,Pr,Rr)).then($r=>{if($r){if(isNavigationFailure($r,2))return Er(assign({replace:xr},dr($r.to),{state:typeof $r.to=="object"?assign({},Mr,$r.to.state):Mr,force:Fr}),br||Pr)}else $r=Vr(Pr,Rr,!0,xr,Mr);return zr(Pr,Rr,$r),$r})}function wr(pr,br){const Cr=lr(pr,br);return Cr?Promise.reject(Cr):Promise.resolve()}function Dr(pr){const br=Yr.values().next().value;return br&&typeof br.runWithContext=="function"?br.runWithContext(pr):pr()}function kr(pr,br){let Cr;const[Rr,Mr,Fr]=extractChangingRecords(pr,br);Cr=extractComponentsGuards(Rr.reverse(),"beforeRouteLeave",pr,br);for(const Or of Rr)Or.leaveGuards.forEach(Pr=>{Cr.push(guardToPromiseFn(Pr,pr,br))});const xr=wr.bind(null,pr,br);return Cr.push(xr),Qr(Cr).then(()=>{Cr=[];for(const Or of tr.list())Cr.push(guardToPromiseFn(Or,pr,br));return Cr.push(xr),Qr(Cr)}).then(()=>{Cr=extractComponentsGuards(Mr,"beforeRouteUpdate",pr,br);for(const Or of Mr)Or.updateGuards.forEach(Pr=>{Cr.push(guardToPromiseFn(Pr,pr,br))});return Cr.push(xr),Qr(Cr)}).then(()=>{Cr=[];for(const Or of Fr)if(Or.beforeEnter)if(isArray(Or.beforeEnter))for(const Pr of Or.beforeEnter)Cr.push(guardToPromiseFn(Pr,pr,br));else Cr.push(guardToPromiseFn(Or.beforeEnter,pr,br));return Cr.push(xr),Qr(Cr)}).then(()=>(pr.matched.forEach(Or=>Or.enterCallbacks={}),Cr=extractComponentsGuards(Fr,"beforeRouteEnter",pr,br,Dr),Cr.push(xr),Qr(Cr))).then(()=>{Cr=[];for(const Or of er.list())Cr.push(guardToPromiseFn(Or,pr,br));return Cr.push(xr),Qr(Cr)}).catch(Or=>isNavigationFailure(Or,8)?Or:Promise.reject(Or))}function zr(pr,br,Cr){ir.list().forEach(Rr=>Dr(()=>Rr(pr,br,Cr)))}function Vr(pr,br,Cr,Rr,Mr){const Fr=lr(pr,br);if(Fr)return Fr;const xr=br===START_LOCATION_NORMALIZED,Or=isBrowser?history.state:{};Cr&&(Rr||xr?Ne.replace(pr.fullPath,assign({scroll:xr&&Or&&Or.scroll},Mr)):Ne.push(pr.fullPath,Mr)),sr.value=pr,Gr(pr,br,Cr,xr),Ir()}let Hr;function Sr(){Hr||(Hr=Ne.listen((pr,br,Cr)=>{if(!to.listening)return;const Rr=mr(pr),Mr=yr(Rr);if(Mr){Er(assign(Mr,{replace:!0}),Rr).catch(noop);return}rr=Rr;const Fr=sr.value;isBrowser&&saveScrollPosition(getScrollKey(Fr.fullPath,Cr.delta),computeScrollPosition()),kr(Rr,Fr).catch(xr=>isNavigationFailure(xr,12)?xr:isNavigationFailure(xr,2)?(Er(xr.to,Rr).then(Or=>{isNavigationFailure(Or,20)&&!Cr.delta&&Cr.type===NavigationType.pop&&Ne.go(-1,!1)}).catch(noop),Promise.reject()):(Cr.delta&&Ne.go(-Cr.delta,!1),Tr(xr,Rr,Fr))).then(xr=>{xr=xr||Vr(Rr,Fr,!1),xr&&(Cr.delta&&!isNavigationFailure(xr,8)?Ne.go(-Cr.delta,!1):Cr.type===NavigationType.pop&&isNavigationFailure(xr,20)&&Ne.go(-1,!1)),zr(Rr,Fr,xr)}).catch(noop)}))}let Ar=useCallbacks(),_r=useCallbacks(),Nr;function Tr(pr,br,Cr){Ir(pr);const Rr=_r.list();return Rr.length?Rr.forEach(Mr=>Mr(pr,br,Cr)):console.error(pr),Promise.reject(pr)}function Lr(){return Nr&&sr.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((pr,br)=>{Ar.add([pr,br])})}function Ir(pr){return Nr||(Nr=!pr,Sr(),Ar.list().forEach(([br,Cr])=>pr?Cr(pr):br()),Ar.reset()),pr}function Gr(pr,br,Cr,Rr){const{scrollBehavior:Mr}=s;if(!isBrowser||!Mr)return Promise.resolve();const Fr=!Cr&&getSavedScrollPosition(getScrollKey(pr.fullPath,0))||(Rr||!Cr)&&history.state&&history.state.scroll||null;return nextTick$1().then(()=>Mr(pr,br,Fr)).then(xr=>xr&&scrollToPosition(xr)).catch(xr=>Tr(xr,pr,br))}const Br=pr=>Ne.go(pr);let jr;const Yr=new Set,to={currentRoute:sr,listening:!0,addRoute:ur,removeRoute:hr,clearRoutes:t.clearRoutes,hasRoute:vr,getRoutes:cr,resolve:mr,options:s,push:gr,replace:fr,go:Br,back:()=>Br(-1),forward:()=>Br(1),beforeEach:tr.add,beforeResolve:er.add,afterEach:ir.add,onError:_r.add,isReady:Lr,install(pr){const br=this;pr.component("RouterLink",RouterLink),pr.component("RouterView",RouterView),pr.config.globalProperties.$router=br,Object.defineProperty(pr.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(sr)}),isBrowser&&!jr&&sr.value===START_LOCATION_NORMALIZED&&(jr=!0,gr(Ne.location).catch(Mr=>{}));const Cr={};for(const Mr in START_LOCATION_NORMALIZED)Object.defineProperty(Cr,Mr,{get:()=>sr.value[Mr],enumerable:!0});pr.provide(routerKey,br),pr.provide(routeLocationKey,shallowReactive(Cr)),pr.provide(routerViewLocationKey,sr);const Rr=pr.unmount;Yr.add(pr),pr.unmount=function(){Yr.delete(pr),Yr.size<1&&(rr=START_LOCATION_NORMALIZED,Hr&&Hr(),Hr=null,sr.value=START_LOCATION_NORMALIZED,jr=!1,Nr=!1),Rr()}}};function Qr(pr){return pr.reduce((br,Cr)=>br.then(()=>Dr(Cr)),Promise.resolve())}return to}function extractChangingRecords(s,t){const n=[],Ae=[],Ne=[],tr=Math.max(t.matched.length,s.matched.length);for(let er=0;er<tr;er++){const ir=t.matched[er];ir&&(s.matched.find(rr=>isSameRouteRecord(rr,ir))?Ae.push(ir):n.push(ir));const sr=s.matched[er];sr&&(t.matched.find(rr=>isSameRouteRecord(rr,sr))||Ne.push(sr))}return[n,Ae,Ne]}function useRouter(){return inject(routerKey)}const _sfc_main$7={};function _sfc_render$1(s,t){return openBlock(),createElementBlock("div")}const Home=_export_sfc(_sfc_main$7,[["render",_sfc_render$1]]),_hoisted_1$5={class:"profile-container"},_hoisted_2$5={class:"profile-content"},_hoisted_3$4={class:"profile-picture"},_hoisted_4$1=["src"],_hoisted_5$1={class:"form-group"},_hoisted_6$1={key:0,class:"error-text"},_hoisted_7$1={class:"form-group"},_hoisted_8={key:0,class:"error-text"},_hoisted_9={class:"form-group"},_hoisted_10={class:"buttons-container"},_hoisted_11=["disabled"],_sfc_main$6=defineComponent({__name:"UserProfile",setup(s){const t=useAuthStore(),n=useRouter(),Ae=reactive({first_name:"",last_name:"",username:""}),Ne=reactive({first_name:"",last_name:""}),tr=ref(!1),er={autoClose:1e3,position:i$2.POSITION.BOTTOM_RIGHT};onMounted(()=>{t.userInfo&&(Ae.first_name=t.userInfo.first_name,Ae.last_name=t.userInfo.last_name,Ae.username=t.userInfo.username)});const ir=()=>{t.logout(),n.push({name:"Home"})};function sr(){let nr=!0;return Ne.first_name="",Ne.last_name="",Ae.first_name.trim()||(Ne.first_name="First name is required.",nr=!1),Ae.last_name.trim()||(Ne.last_name="Last name is required.",nr=!1),nr}async function rr(){var or,ur;if(!sr()){i$2.error("Please fix the errors in the form.",er);return}tr.value=!0;const nr=localStorage.getItem("userToken");if(!nr){i$2.error("User token not found. Please log in again.",er),tr.value=!1,t.logout(),n.push({name:"Home"});return}const ar={id:(or=t.userInfo)==null?void 0:or.id,first_name:Ae.first_name,last_name:Ae.last_name,username:(ur=t.userInfo)==null?void 0:ur.username,token:nr};try{const cr=await(await fetch("https://pve.finance/api/update-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ar)})).json();cr.status==="success"?(t.userInfo&&(t.userInfo.first_name=Ae.first_name,t.userInfo.last_name=Ae.last_name),i$2.success("Profile updated successfully!",er),setTimeout(()=>{n.push({name:"Home"})},2e3)):i$2.error(cr.message||"Failed to update profile.",er)}catch(hr){console.error("Error updating user data:",hr),i$2.error("An unexpected error occurred. Please try again later.",er)}finally{tr.value=!1}}return(nr,ar)=>{var or;return openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("div",_hoisted_2$5,[createBaseVNode("form",{onSubmit:withModifiers(rr,["prevent"]),class:"profile-form"},[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("img",{src:((or=unref(t).userInfo)==null?void 0:or.photo_url)||unref(defaultProfileImage),alt:"User Profile"},null,8,_hoisted_4$1)]),createBaseVNode("div",_hoisted_5$1,[ar[3]||(ar[3]=createBaseVNode("label",{for:"firstName"},"First Name:",-1)),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":ar[0]||(ar[0]=ur=>Ae.first_name=ur),id:"firstName",type:"text",class:normalizeClass(["input",{"input-error":Ne.first_name}]),required:"","aria-required":"true"},null,2),[[vModelText,Ae.first_name]]),Ne.first_name?(openBlock(),createElementBlock("span",_hoisted_6$1,toDisplayString(Ne.first_name),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_7$1,[ar[4]||(ar[4]=createBaseVNode("label",{for:"lastName"},"Last Name:",-1)),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":ar[1]||(ar[1]=ur=>Ae.last_name=ur),id:"lastName",type:"text",class:normalizeClass(["input",{"input-error":Ne.last_name}]),required:"","aria-required":"true"},null,2),[[vModelText,Ae.last_name]]),Ne.last_name?(openBlock(),createElementBlock("span",_hoisted_8,toDisplayString(Ne.last_name),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_9,[ar[5]||(ar[5]=createBaseVNode("label",{for:"username"},"Username:",-1)),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":ar[2]||(ar[2]=ur=>Ae.username=ur),id:"username",type:"text",class:"input",disabled:"","aria-disabled":"true"},null,512),[[vModelText,Ae.username]])]),createBaseVNode("div",_hoisted_10,[createBaseVNode("button",{type:"submit",disabled:tr.value},toDisplayString(tr.value?"Saving...":"Save"),9,_hoisted_11),createBaseVNode("button",{type:"button",class:"secondary",onClick:ir}," Logout ")])],32)])])}}}),UserProfile=_export_sfc(_sfc_main$6,[["__scopeId","data-v-86d64046"]]),scriptRel="modulepreload",assetsURL=function(s){return"/"+s},seen={},__vitePreload=function(t,n,Ae){let Ne=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const er=document.querySelector("meta[property=csp-nonce]"),ir=(er==null?void 0:er.nonce)||(er==null?void 0:er.getAttribute("nonce"));Ne=Promise.allSettled(n.map(sr=>{if(sr=assetsURL(sr),sr in seen)return;seen[sr]=!0;const rr=sr.endsWith(".css"),nr=rr?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${sr}"]${nr}`))return;const ar=document.createElement("link");if(ar.rel=rr?"stylesheet":scriptRel,rr||(ar.as="script"),ar.crossOrigin="",ar.href=sr,ir&&ar.setAttribute("nonce",ir),document.head.appendChild(ar),rr)return new Promise((or,ur)=>{ar.addEventListener("load",or),ar.addEventListener("error",()=>ur(new Error(`Unable to preload CSS for ${sr}`)))})}))}function tr(er){const ir=new Event("vite:preloadError",{cancelable:!0});if(ir.payload=er,window.dispatchEvent(ir),!ir.defaultPrevented)throw er}return Ne.then(er=>{for(const ir of er||[])ir.status==="rejected"&&tr(ir.reason);return t().catch(tr)})};function size(s){var t=s.width,n=s.height;if(t<0)throw new Error("Negative width is not allowed for Size");if(n<0)throw new Error("Negative height is not allowed for Size");return{width:t,height:n}}function equalSizes(s,t){return s.width===t.width&&s.height===t.height}var Observable=function(){function s(t){var n=this;this._resolutionListener=function(){return n._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return s.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(s.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),s.prototype.subscribe=function(t){var n=this,Ae={next:t};return this._observers.push(Ae),{unsubscribe:function(){n._observers=n._observers.filter(function(Ne){return Ne!==Ae})}}},s.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},s.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},s.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},s.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach(function(n){return n.next(t._window.devicePixelRatio)}),this._reinstallResolutionListener()},s}();function createObservable(s){return new Observable(s)}var DevicePixelContentBoxBinding=function(){function s(t,n,Ae){var Ne;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=size({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=n??function(tr){return tr},this._allowResizeObserver=(Ne=Ae==null?void 0:Ae.allowResizeObserver)!==null&&Ne!==void 0?Ne:!0,this._chooseAndInitObserver()}return s.prototype.dispose=function(){var t,n;if(this._canvasElement===null)throw new Error("Object is disposed");(t=this._canvasElementResizeObserver)===null||t===void 0||t.disconnect(),this._canvasElementResizeObserver=null,(n=this._devicePixelRatioObservable)===null||n===void 0||n.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(s.prototype,"canvasElement",{get:function(){if(this._canvasElement===null)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"bitmapSize",{get:function(){return size({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),s.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=size(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},s.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},s.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(n){return n!==t})},Object.defineProperty(s.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),s.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},s.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(n){return n!==t})},s.prototype.applySuggestedBitmapSize=function(){if(this._suggestedBitmapSize!==null){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},s.prototype._resizeBitmap=function(t){var n=this.bitmapSize;equalSizes(n,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(n,t))},s.prototype._emitBitmapSizeChanged=function(t,n){var Ae=this;this._bitmapSizeChangedListeners.forEach(function(Ne){return Ne.call(Ae,t,n)})},s.prototype._suggestNewBitmapSize=function(t){var n=this._suggestedBitmapSize,Ae=size(this._transformBitmapSize(t,this._canvasElementClientSize)),Ne=equalSizes(this.bitmapSize,Ae)?null:Ae;n===null&&Ne===null||n!==null&&Ne!==null&&equalSizes(n,Ne)||(this._suggestedBitmapSize=Ne,this._emitSuggestedBitmapSizeChanged(n,Ne))},s.prototype._emitSuggestedBitmapSizeChanged=function(t,n){var Ae=this;this._suggestedBitmapSizeChangedListeners.forEach(function(Ne){return Ne.call(Ae,t,n)})},s.prototype._chooseAndInitObserver=function(){var t=this;if(!this._allowResizeObserver){this._initDevicePixelRatioObservable();return}isDevicePixelContentBoxSupported().then(function(n){return n?t._initResizeObserver():t._initDevicePixelRatioObservable()})},s.prototype._initDevicePixelRatioObservable=function(){var t=this;if(this._canvasElement!==null){var n=canvasElementWindow(this._canvasElement);if(n===null)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=createObservable(n),this._devicePixelRatioObservable.subscribe(function(){return t._invalidateBitmapSize()}),this._invalidateBitmapSize()}},s.prototype._invalidateBitmapSize=function(){var t,n;if(this._canvasElement!==null){var Ae=canvasElementWindow(this._canvasElement);if(Ae!==null){var Ne=(n=(t=this._devicePixelRatioObservable)===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:Ae.devicePixelRatio,tr=this._canvasElement.getClientRects(),er=tr[0]!==void 0?predictedBitmapSize(tr[0],Ne):size({width:this._canvasElementClientSize.width*Ne,height:this._canvasElementClientSize.height*Ne});this._suggestNewBitmapSize(er)}}},s.prototype._initResizeObserver=function(){var t=this;this._canvasElement!==null&&(this._canvasElementResizeObserver=new ResizeObserver(function(n){var Ae=n.find(function(er){return er.target===t._canvasElement});if(!(!Ae||!Ae.devicePixelContentBoxSize||!Ae.devicePixelContentBoxSize[0])){var Ne=Ae.devicePixelContentBoxSize[0],tr=size({width:Ne.inlineSize,height:Ne.blockSize});t._suggestNewBitmapSize(tr)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},s}();function bindTo(s,t){if(t.type==="device-pixel-content-box")return new DevicePixelContentBoxBinding(s,t.transform,t.options);throw new Error("Unsupported binding target")}function canvasElementWindow(s){return s.ownerDocument.defaultView}function isDevicePixelContentBoxSupported(){return new Promise(function(s){var t=new ResizeObserver(function(n){s(n.every(function(Ae){return"devicePixelContentBoxSize"in Ae})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})}function predictedBitmapSize(s,t){return size({width:Math.round(s.left*t+s.width*t)-Math.round(s.left*t),height:Math.round(s.top*t+s.height*t)-Math.round(s.top*t)})}var CanvasRenderingTarget2D=function(){function s(t,n,Ae){if(n.width===0||n.height===0)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=n,Ae.width===0||Ae.height===0)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=Ae,this._context=t}return s.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},s.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(s.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),s}();function tryCreateCanvasRenderingTarget2D(s,t){var n=s.canvasElementClientSize;if(n.width===0||n.height===0)return null;var Ae=s.bitmapSize;if(Ae.width===0||Ae.height===0)return null;var Ne=s.canvasElement.getContext("2d",t);return Ne===null?null:new CanvasRenderingTarget2D(Ne,n,Ae)}/*!
 * @license
 * TradingView Lightweight Charts™ v4.2.0
 * Copyright (c) 2024 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */const e={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},r={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},h={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},l={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},a={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},o={color:"#26a69a",base:0},_={color:"#2196f3"},u={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};var c,d;function f(s,t){const n={0:[],1:[s.lineWidth,s.lineWidth],2:[2*s.lineWidth,2*s.lineWidth],3:[6*s.lineWidth,6*s.lineWidth],4:[s.lineWidth,4*s.lineWidth]}[t];s.setLineDash(n)}function v(s,t,n,Ae){s.beginPath();const Ne=s.lineWidth%2?.5:0;s.moveTo(n,t+Ne),s.lineTo(Ae,t+Ne),s.stroke()}function p$1(s,t){if(!s)throw new Error("Assertion failed"+(t?": "+t:""))}function m(s){if(s===void 0)throw new Error("Value is undefined");return s}function b(s){if(s===null)throw new Error("Value is null");return s}function w(s){return b(m(s))}(function(s){s[s.Simple=0]="Simple",s[s.WithSteps=1]="WithSteps",s[s.Curved=2]="Curved"})(c||(c={})),function(s){s[s.Solid=0]="Solid",s[s.Dotted=1]="Dotted",s[s.Dashed=2]="Dashed",s[s.LargeDashed=3]="LargeDashed",s[s.SparseDotted=4]="SparseDotted"}(d||(d={}));const g={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function M(s){return s<0?0:s>255?255:Math.round(s)||0}function x(s){return s<=0||s>1?Math.min(Math.max(s,0),1):Math.round(1e4*s)/1e4}const S=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,k=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,y=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,C=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d*\.?\d+)\s*\)$/;function T(s){(s=s.toLowerCase())in g&&(s=g[s]);{const t=C.exec(s)||y.exec(s);if(t)return[M(parseInt(t[1],10)),M(parseInt(t[2],10)),M(parseInt(t[3],10)),x(t.length<5?1:parseFloat(t[4]))]}{const t=k.exec(s);if(t)return[M(parseInt(t[1],16)),M(parseInt(t[2],16)),M(parseInt(t[3],16)),1]}{const t=S.exec(s);if(t)return[M(17*parseInt(t[1],16)),M(17*parseInt(t[2],16)),M(17*parseInt(t[3],16)),1]}throw new Error(`Cannot parse color: ${s}`)}function P(s){return .199*s[0]+.687*s[1]+.114*s[2]}function R(s){const t=T(s);return{t:`rgb(${t[0]}, ${t[1]}, ${t[2]})`,i:P(t)>160?"black":"white"}}class D{constructor(){this.h=[]}l(t,n,Ae){const Ne={o:t,_:n,u:Ae===!0};this.h.push(Ne)}v(t){const n=this.h.findIndex(Ae=>t===Ae.o);n>-1&&this.h.splice(n,1)}p(t){this.h=this.h.filter(n=>n._!==t)}m(t,n,Ae){const Ne=[...this.h];this.h=this.h.filter(tr=>!tr.u),Ne.forEach(tr=>tr.o(t,n,Ae))}M(){return this.h.length>0}S(){this.h=[]}}function V(s,...t){for(const n of t)for(const Ae in n)n[Ae]!==void 0&&(typeof n[Ae]!="object"||s[Ae]===void 0||Array.isArray(n[Ae])?s[Ae]=n[Ae]:V(s[Ae],n[Ae]));return s}function O(s){return typeof s=="number"&&isFinite(s)}function B(s){return typeof s=="number"&&s%1==0}function A(s){return typeof s=="string"}function I(s){return typeof s=="boolean"}function z(s){const t=s;if(!t||typeof t!="object")return t;let n,Ae,Ne;for(Ae in n=Array.isArray(t)?[]:{},t)t.hasOwnProperty(Ae)&&(Ne=t[Ae],n[Ae]=Ne&&typeof Ne=="object"?z(Ne):Ne);return n}function L(s){return s!==null}function E(s){return s===null?void 0:s}const N="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function F(s,t,n){return t===void 0&&(t=N),`${n=n!==void 0?`${n} `:""}${s}px ${t}`}class W{constructor(t){this.k={C:1,T:5,P:NaN,R:"",D:"",V:"",O:"",B:0,A:0,I:0,L:0,N:0},this.F=t}W(){const t=this.k,n=this.j(),Ae=this.H();return t.P===n&&t.D===Ae||(t.P=n,t.D=Ae,t.R=F(n,Ae),t.L=2.5/12*n,t.B=t.L,t.A=n/12*t.T,t.I=n/12*t.T,t.N=0),t.V=this.$(),t.O=this.U(),this.k}$(){return this.F.W().layout.textColor}U(){return this.F.q()}j(){return this.F.W().layout.fontSize}H(){return this.F.W().layout.fontFamily}}class j{constructor(){this.Y=[]}Z(t){this.Y=t}X(t,n,Ae){this.Y.forEach(Ne=>{Ne.X(t,n,Ae)})}}class H{X(t,n,Ae){t.useBitmapCoordinateSpace(Ne=>this.K(Ne,n,Ae))}}class $ extends H{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K({context:t,horizontalPixelRatio:n,verticalPixelRatio:Ae}){if(this.G===null||this.G.tt===null)return;const Ne=this.G.tt,tr=this.G,er=Math.max(1,Math.floor(n))%2/2,ir=sr=>{t.beginPath();for(let rr=Ne.to-1;rr>=Ne.from;--rr){const nr=tr.it[rr],ar=Math.round(nr.nt*n)+er,or=nr.st*Ae,ur=sr*Ae+er;t.moveTo(ar,or),t.arc(ar,or,ur,0,2*Math.PI)}t.fill()};tr.et>0&&(t.fillStyle=tr.rt,ir(tr.ht+tr.et)),t.fillStyle=tr.lt,ir(tr.ht)}}function U(){return{it:[{nt:0,st:0,ot:0,_t:0}],lt:"",rt:"",ht:0,et:0,tt:null}}const q={from:0,to:1};class Y{constructor(t,n){this.ut=new j,this.ct=[],this.dt=[],this.ft=!0,this.F=t,this.vt=n,this.ut.Z(this.ct)}bt(t){const n=this.F.wt();n.length!==this.ct.length&&(this.dt=n.map(U),this.ct=this.dt.map(Ae=>{const Ne=new $;return Ne.J(Ae),Ne}),this.ut.Z(this.ct)),this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.ut}Mt(){const t=this.vt.W().mode===2,n=this.F.wt(),Ae=this.vt.xt(),Ne=this.F.St();n.forEach((tr,er)=>{var ir;const sr=this.dt[er],rr=tr.kt(Ae);if(t||rr===null||!tr.yt())return void(sr.tt=null);const nr=b(tr.Ct());sr.lt=rr.Tt,sr.ht=rr.ht,sr.et=rr.Pt,sr.it[0]._t=rr._t,sr.it[0].st=tr.Dt().Rt(rr._t,nr.Vt),sr.rt=(ir=rr.Ot)!==null&&ir!==void 0?ir:this.F.Bt(sr.it[0].st/tr.Dt().At()),sr.it[0].ot=Ae,sr.it[0].nt=Ne.It(Ae),sr.tt=q})}}class Z extends H{constructor(t){super(),this.zt=t}K({context:t,bitmapSize:n,horizontalPixelRatio:Ae,verticalPixelRatio:Ne}){if(this.zt===null)return;const tr=this.zt.Lt.yt,er=this.zt.Et.yt;if(!tr&&!er)return;const ir=Math.round(this.zt.nt*Ae),sr=Math.round(this.zt.st*Ne);t.lineCap="butt",tr&&ir>=0&&(t.lineWidth=Math.floor(this.zt.Lt.et*Ae),t.strokeStyle=this.zt.Lt.V,t.fillStyle=this.zt.Lt.V,f(t,this.zt.Lt.Nt),function(rr,nr,ar,or){rr.beginPath();const ur=rr.lineWidth%2?.5:0;rr.moveTo(nr+ur,ar),rr.lineTo(nr+ur,or),rr.stroke()}(t,ir,0,n.height)),er&&sr>=0&&(t.lineWidth=Math.floor(this.zt.Et.et*Ne),t.strokeStyle=this.zt.Et.V,t.fillStyle=this.zt.Et.V,f(t,this.zt.Et.Nt),v(t,sr,0,n.width))}}class X{constructor(t){this.ft=!0,this.Ft={Lt:{et:1,Nt:0,V:"",yt:!1},Et:{et:1,Nt:0,V:"",yt:!1},nt:0,st:0},this.Wt=new Z(this.Ft),this.jt=t}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){const t=this.jt.yt(),n=b(this.jt.Ht()),Ae=n.$t().W().crosshair,Ne=this.Ft;if(Ae.mode===2)return Ne.Et.yt=!1,void(Ne.Lt.yt=!1);Ne.Et.yt=t&&this.jt.Ut(n),Ne.Lt.yt=t&&this.jt.qt(),Ne.Et.et=Ae.horzLine.width,Ne.Et.Nt=Ae.horzLine.style,Ne.Et.V=Ae.horzLine.color,Ne.Lt.et=Ae.vertLine.width,Ne.Lt.Nt=Ae.vertLine.style,Ne.Lt.V=Ae.vertLine.color,Ne.nt=this.jt.Yt(),Ne.st=this.jt.Zt()}}function K(s,t,n,Ae,Ne,tr){s.fillRect(t+tr,n,Ae-2*tr,tr),s.fillRect(t+tr,n+Ne-tr,Ae-2*tr,tr),s.fillRect(t,n,tr,Ne),s.fillRect(t+Ae-tr,n,tr,Ne)}function G(s,t,n,Ae,Ne,tr){s.save(),s.globalCompositeOperation="copy",s.fillStyle=tr,s.fillRect(t,n,Ae,Ne),s.restore()}function J(s,t,n,Ae,Ne,tr){s.beginPath(),s.roundRect?s.roundRect(t,n,Ae,Ne,tr):(s.lineTo(t+Ae-tr[1],n),tr[1]!==0&&s.arcTo(t+Ae,n,t+Ae,n+tr[1],tr[1]),s.lineTo(t+Ae,n+Ne-tr[2]),tr[2]!==0&&s.arcTo(t+Ae,n+Ne,t+Ae-tr[2],n+Ne,tr[2]),s.lineTo(t+tr[3],n+Ne),tr[3]!==0&&s.arcTo(t,n+Ne,t,n+Ne-tr[3],tr[3]),s.lineTo(t,n+tr[0]),tr[0]!==0&&s.arcTo(t,n,t+tr[0],n,tr[0]))}function Q(s,t,n,Ae,Ne,tr,er=0,ir=[0,0,0,0],sr=""){if(s.save(),!er||!sr||sr===tr)return J(s,t,n,Ae,Ne,ir),s.fillStyle=tr,s.fill(),void s.restore();const rr=er/2;var nr;J(s,t+rr,n+rr,Ae-er,Ne-er,(nr=-rr,ir.map(ar=>ar===0?ar:ar+nr))),tr!=="transparent"&&(s.fillStyle=tr,s.fill()),sr!=="transparent"&&(s.lineWidth=er,s.strokeStyle=sr,s.closePath(),s.stroke()),s.restore()}function tt(s,t,n,Ae,Ne,tr,er){s.save(),s.globalCompositeOperation="copy";const ir=s.createLinearGradient(0,0,0,Ne);ir.addColorStop(0,tr),ir.addColorStop(1,er),s.fillStyle=ir,s.fillRect(t,n,Ae,Ne),s.restore()}class it{constructor(t,n){this.J(t,n)}J(t,n){this.zt=t,this.Xt=n}At(t,n){return this.zt.yt?t.P+t.L+t.B:0}X(t,n,Ae,Ne){if(!this.zt.yt||this.zt.Kt.length===0)return;const tr=this.zt.V,er=this.Xt.t,ir=t.useBitmapCoordinateSpace(sr=>{const rr=sr.context;rr.font=n.R;const nr=this.Gt(sr,n,Ae,Ne),ar=nr.Jt,or=(ur,hr)=>{nr.Qt?Q(rr,ar.ti,ar.ii,ar.ni,ar.si,ur,ar.ei,[ar.ht,0,0,ar.ht],hr):Q(rr,ar.ri,ar.ii,ar.ni,ar.si,ur,ar.ei,[0,ar.ht,ar.ht,0],hr)};return or(er,"transparent"),this.zt.hi&&(rr.fillStyle=tr,rr.fillRect(ar.ri,ar.li,ar.ai-ar.ri,ar.oi)),or("transparent",er),this.zt._i&&(rr.fillStyle=n.O,rr.fillRect(nr.Qt?ar.ui-ar.ei:0,ar.ii,ar.ei,ar.ci-ar.ii)),nr});t.useMediaCoordinateSpace(({context:sr})=>{const rr=ir.di;sr.font=n.R,sr.textAlign=ir.Qt?"right":"left",sr.textBaseline="middle",sr.fillStyle=tr,sr.fillText(this.zt.Kt,rr.fi,(rr.ii+rr.ci)/2+rr.pi)})}Gt(t,n,Ae,Ne){var tr;const{context:er,bitmapSize:ir,mediaSize:sr,horizontalPixelRatio:rr,verticalPixelRatio:nr}=t,ar=this.zt.hi||!this.zt.mi?n.T:0,or=this.zt.bi?n.C:0,ur=n.L+this.Xt.wi,hr=n.B+this.Xt.gi,cr=n.A,vr=n.I,mr=this.zt.Kt,dr=n.P,lr=Ae.Mi(er,mr),gr=Math.ceil(Ae.xi(er,mr)),fr=dr+ur+hr,yr=n.C+cr+vr+gr+ar,Er=Math.max(1,Math.floor(nr));let wr=Math.round(fr*nr);wr%2!=Er%2&&(wr+=1);const Dr=or>0?Math.max(1,Math.floor(or*rr)):0,kr=Math.round(yr*rr),zr=Math.round(ar*rr),Vr=(tr=this.Xt.Si)!==null&&tr!==void 0?tr:this.Xt.ki,Hr=Math.round(Vr*nr)-Math.floor(.5*nr),Sr=Math.floor(Hr+Er/2-wr/2),Ar=Sr+wr,_r=Ne==="right",Nr=_r?sr.width-or:or,Tr=_r?ir.width-Dr:Dr;let Lr,Ir,Gr;return _r?(Lr=Tr-kr,Ir=Tr-zr,Gr=Nr-ar-cr-or):(Lr=Tr+kr,Ir=Tr+zr,Gr=Nr+ar+cr),{Qt:_r,Jt:{ii:Sr,li:Hr,ci:Ar,ni:kr,si:wr,ht:2*rr,ei:Dr,ti:Lr,ri:Tr,ai:Ir,oi:Er,ui:ir.width},di:{ii:Sr/nr,ci:Ar/nr,fi:Gr,pi:lr}}}}class nt{constructor(t){this.yi={ki:0,t:"#000",gi:0,wi:0},this.Ci={Kt:"",yt:!1,hi:!0,mi:!1,Ot:"",V:"#FFF",_i:!1,bi:!1},this.Ti={Kt:"",yt:!1,hi:!1,mi:!0,Ot:"",V:"#FFF",_i:!0,bi:!0},this.ft=!0,this.Pi=new(t||it)(this.Ci,this.yi),this.Ri=new(t||it)(this.Ti,this.yi)}Kt(){return this.Di(),this.Ci.Kt}ki(){return this.Di(),this.yi.ki}bt(){this.ft=!0}At(t,n=!1){return Math.max(this.Pi.At(t,n),this.Ri.At(t,n))}Vi(){return this.yi.Si||0}Oi(t){this.yi.Si=t}Bi(){return this.Di(),this.Ci.yt||this.Ti.yt}Ai(){return this.Di(),this.Ci.yt}gt(t){return this.Di(),this.Ci.hi=this.Ci.hi&&t.W().ticksVisible,this.Ti.hi=this.Ti.hi&&t.W().ticksVisible,this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Pi}Ii(){return this.Di(),this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Ri}Di(){this.ft&&(this.Ci.hi=!0,this.Ti.hi=!1,this.zi(this.Ci,this.Ti,this.yi))}}class st extends nt{constructor(t,n,Ae){super(),this.jt=t,this.Li=n,this.Ei=Ae}zi(t,n,Ae){if(t.yt=!1,this.jt.W().mode===2)return;const Ne=this.jt.W().horzLine;if(!Ne.labelVisible)return;const tr=this.Li.Ct();if(!this.jt.yt()||this.Li.Ni()||tr===null)return;const er=R(Ne.labelBackgroundColor);Ae.t=er.t,t.V=er.i;const ir=2/12*this.Li.P();Ae.wi=ir,Ae.gi=ir;const sr=this.Ei(this.Li);Ae.ki=sr.ki,t.Kt=this.Li.Fi(sr._t,tr),t.yt=!0}}const et=/[1-9]/g;class rt{constructor(){this.zt=null}J(t){this.zt=t}X(t,n){if(this.zt===null||this.zt.yt===!1||this.zt.Kt.length===0)return;const Ae=t.useMediaCoordinateSpace(({context:or})=>(or.font=n.R,Math.round(n.Wi.xi(or,b(this.zt).Kt,et))));if(Ae<=0)return;const Ne=n.ji,tr=Ae+2*Ne,er=tr/2,ir=this.zt.Hi;let sr=this.zt.ki,rr=Math.floor(sr-er)+.5;rr<0?(sr+=Math.abs(0-rr),rr=Math.floor(sr-er)+.5):rr+tr>ir&&(sr-=Math.abs(ir-(rr+tr)),rr=Math.floor(sr-er)+.5);const nr=rr+tr,ar=Math.ceil(0+n.C+n.T+n.L+n.P+n.B);t.useBitmapCoordinateSpace(({context:or,horizontalPixelRatio:ur,verticalPixelRatio:hr})=>{const cr=b(this.zt);or.fillStyle=cr.t;const vr=Math.round(rr*ur),mr=Math.round(0*hr),dr=Math.round(nr*ur),lr=Math.round(ar*hr),gr=Math.round(2*ur);if(or.beginPath(),or.moveTo(vr,mr),or.lineTo(vr,lr-gr),or.arcTo(vr,lr,vr+gr,lr,gr),or.lineTo(dr-gr,lr),or.arcTo(dr,lr,dr,lr-gr,gr),or.lineTo(dr,mr),or.fill(),cr.hi){const fr=Math.round(cr.ki*ur),yr=mr,Er=Math.round((yr+n.T)*hr);or.fillStyle=cr.V;const wr=Math.max(1,Math.floor(ur)),Dr=Math.floor(.5*ur);or.fillRect(fr-Dr,yr,wr,Er-yr)}}),t.useMediaCoordinateSpace(({context:or})=>{const ur=b(this.zt),hr=0+n.C+n.T+n.L+n.P/2;or.font=n.R,or.textAlign="left",or.textBaseline="middle",or.fillStyle=ur.V;const cr=n.Wi.Mi(or,"Apr0");or.translate(rr+Ne,hr+cr),or.fillText(ur.Kt,0,0)})}}class ht{constructor(t,n,Ae){this.ft=!0,this.Wt=new rt,this.Ft={yt:!1,t:"#4c525e",V:"white",Kt:"",Hi:0,ki:NaN,hi:!0},this.vt=t,this.$i=n,this.Ei=Ae}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt.J(this.Ft),this.Wt}Mt(){const t=this.Ft;if(t.yt=!1,this.vt.W().mode===2)return;const n=this.vt.W().vertLine;if(!n.labelVisible)return;const Ae=this.$i.St();if(Ae.Ni())return;t.Hi=Ae.Hi();const Ne=this.Ei();if(Ne===null)return;t.ki=Ne.ki;const tr=Ae.Ui(this.vt.xt());t.Kt=Ae.qi(b(tr)),t.yt=!0;const er=R(n.labelBackgroundColor);t.t=er.t,t.V=er.i,t.hi=Ae.W().ticksVisible}}class lt{constructor(){this.Yi=null,this.Zi=0}Xi(){return this.Zi}Ki(t){this.Zi=t}Dt(){return this.Yi}Gi(t){this.Yi=t}Ji(t){return[]}Qi(){return[]}yt(){return!0}}var at;(function(s){s[s.Normal=0]="Normal",s[s.Magnet=1]="Magnet",s[s.Hidden=2]="Hidden"})(at||(at={}));class ot extends lt{constructor(t,n){super(),this.tn=null,this.nn=NaN,this.sn=0,this.en=!0,this.rn=new Map,this.hn=!1,this.ln=NaN,this.an=NaN,this._n=NaN,this.un=NaN,this.$i=t,this.cn=n,this.dn=new Y(t,this),this.fn=((Ne,tr)=>er=>{const ir=tr(),sr=Ne();if(er===b(this.tn).vn())return{_t:sr,ki:ir};{const rr=b(er.Ct());return{_t:er.pn(ir,rr),ki:ir}}})(()=>this.nn,()=>this.an);const Ae=((Ne,tr)=>()=>{const er=this.$i.St().mn(Ne()),ir=tr();return er&&Number.isFinite(ir)?{ot:er,ki:ir}:null})(()=>this.sn,()=>this.Yt());this.bn=new ht(this,t,Ae),this.wn=new X(this)}W(){return this.cn}gn(t,n){this._n=t,this.un=n}Mn(){this._n=NaN,this.un=NaN}xn(){return this._n}Sn(){return this.un}kn(t,n,Ae){this.hn||(this.hn=!0),this.en=!0,this.yn(t,n,Ae)}xt(){return this.sn}Yt(){return this.ln}Zt(){return this.an}yt(){return this.en}Cn(){this.en=!1,this.Tn(),this.nn=NaN,this.ln=NaN,this.an=NaN,this.tn=null,this.Mn()}Pn(t){return this.tn!==null?[this.wn,this.dn]:[]}Ut(t){return t===this.tn&&this.cn.horzLine.visible}qt(){return this.cn.vertLine.visible}Rn(t,n){this.en&&this.tn===t||this.rn.clear();const Ae=[];return this.tn===t&&Ae.push(this.Dn(this.rn,n,this.fn)),Ae}Qi(){return this.en?[this.bn]:[]}Ht(){return this.tn}Vn(){this.wn.bt(),this.rn.forEach(t=>t.bt()),this.bn.bt(),this.dn.bt()}On(t){return t&&!t.vn().Ni()?t.vn():null}yn(t,n,Ae){this.Bn(t,n,Ae)&&this.Vn()}Bn(t,n,Ae){const Ne=this.ln,tr=this.an,er=this.nn,ir=this.sn,sr=this.tn,rr=this.On(Ae);this.sn=t,this.ln=isNaN(t)?NaN:this.$i.St().It(t),this.tn=Ae;const nr=rr!==null?rr.Ct():null;return rr!==null&&nr!==null?(this.nn=n,this.an=rr.Rt(n,nr)):(this.nn=NaN,this.an=NaN),Ne!==this.ln||tr!==this.an||ir!==this.sn||er!==this.nn||sr!==this.tn}Tn(){const t=this.$i.wt().map(Ae=>Ae.In().An()).filter(L),n=t.length===0?null:Math.max(...t);this.sn=n!==null?n:NaN}Dn(t,n,Ae){let Ne=t.get(n);return Ne===void 0&&(Ne=new st(this,n,Ae),t.set(n,Ne)),Ne}}function _t(s){return s==="left"||s==="right"}class ut{constructor(t){this.zn=new Map,this.Ln=[],this.En=t}Nn(t,n){const Ae=function(Ne,tr){return Ne===void 0?tr:{Fn:Math.max(Ne.Fn,tr.Fn),Wn:Ne.Wn||tr.Wn}}(this.zn.get(t),n);this.zn.set(t,Ae)}jn(){return this.En}Hn(t){const n=this.zn.get(t);return n===void 0?{Fn:this.En}:{Fn:Math.max(this.En,n.Fn),Wn:n.Wn}}$n(){this.Un(),this.Ln=[{qn:0}]}Yn(t){this.Un(),this.Ln=[{qn:1,Vt:t}]}Zn(t){this.Xn(),this.Ln.push({qn:5,Vt:t})}Un(){this.Xn(),this.Ln.push({qn:6})}Kn(){this.Un(),this.Ln=[{qn:4}]}Gn(t){this.Un(),this.Ln.push({qn:2,Vt:t})}Jn(t){this.Un(),this.Ln.push({qn:3,Vt:t})}Qn(){return this.Ln}ts(t){for(const n of t.Ln)this.ns(n);this.En=Math.max(this.En,t.En),t.zn.forEach((n,Ae)=>{this.Nn(Ae,n)})}static ss(){return new ut(2)}static es(){return new ut(3)}ns(t){switch(t.qn){case 0:this.$n();break;case 1:this.Yn(t.Vt);break;case 2:this.Gn(t.Vt);break;case 3:this.Jn(t.Vt);break;case 4:this.Kn();break;case 5:this.Zn(t.Vt);break;case 6:this.Xn()}}Xn(){const t=this.Ln.findIndex(n=>n.qn===5);t!==-1&&this.Ln.splice(t,1)}}const ct=".";function dt(s,t){if(!O(s))return"n/a";if(!B(t))throw new TypeError("invalid length");if(t<0||t>16)throw new TypeError("invalid length");return t===0?s.toString():("0000000000000000"+s.toString()).slice(-t)}class ft{constructor(t,n){if(n||(n=1),O(t)&&B(t)||(t=100),t<0)throw new TypeError("invalid base");this.Li=t,this.rs=n,this.hs()}format(t){const n=t<0?"−":"";return t=Math.abs(t),n+this.ls(t)}hs(){if(this.os=0,this.Li>0&&this.rs>0){let t=this.Li;for(;t>1;)t/=10,this.os++}}ls(t){const n=this.Li/this.rs;let Ae=Math.floor(t),Ne="";const tr=this.os!==void 0?this.os:NaN;if(n>1){let er=+(Math.round(t*n)-Ae*n).toFixed(this.os);er>=n&&(er-=n,Ae+=1),Ne=ct+dt(+er.toFixed(this.os)*this.rs,tr)}else Ae=Math.round(Ae*n)/n,tr>0&&(Ne=ct+dt(0,tr));return Ae.toFixed(0)+Ne}}class vt extends ft{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class pt{constructor(t){this._s=t}format(t){let n="";return t<0&&(n="-",t=-t),t<995?n+this.us(t):t<999995?n+this.us(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),n+this.us(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),n+this.us(t/1e9)+"B")}us(t){let n;const Ae=Math.pow(10,this._s);return n=(t=Math.round(t*Ae)/Ae)>=1e-15&&t<1?t.toFixed(this._s).replace(/\.?0+$/,""):String(t),n.replace(/(\.[1-9]*)0+$/,(Ne,tr)=>tr)}}function mt(s,t,n,Ae,Ne,tr,er){if(t.length===0||Ae.from>=t.length||Ae.to<=0)return;const{context:ir,horizontalPixelRatio:sr,verticalPixelRatio:rr}=s,nr=t[Ae.from];let ar=tr(s,nr),or=nr;if(Ae.to-Ae.from<2){const ur=Ne/2;ir.beginPath();const hr={nt:nr.nt-ur,st:nr.st},cr={nt:nr.nt+ur,st:nr.st};ir.moveTo(hr.nt*sr,hr.st*rr),ir.lineTo(cr.nt*sr,cr.st*rr),er(s,ar,hr,cr)}else{const ur=(cr,vr)=>{er(s,ar,or,vr),ir.beginPath(),ar=cr,or=vr};let hr=or;ir.beginPath(),ir.moveTo(nr.nt*sr,nr.st*rr);for(let cr=Ae.from+1;cr<Ae.to;++cr){hr=t[cr];const vr=tr(s,hr);switch(n){case 0:ir.lineTo(hr.nt*sr,hr.st*rr);break;case 1:ir.lineTo(hr.nt*sr,t[cr-1].st*rr),vr!==ar&&(ur(vr,hr),ir.lineTo(hr.nt*sr,t[cr-1].st*rr)),ir.lineTo(hr.nt*sr,hr.st*rr);break;case 2:{const[mr,dr]=Mt(t,cr-1,cr);ir.bezierCurveTo(mr.nt*sr,mr.st*rr,dr.nt*sr,dr.st*rr,hr.nt*sr,hr.st*rr);break}}n!==1&&vr!==ar&&(ur(vr,hr),ir.moveTo(hr.nt*sr,hr.st*rr))}(or!==hr||or===hr&&n===1)&&er(s,ar,or,hr)}}const bt=6;function wt(s,t){return{nt:s.nt-t.nt,st:s.st-t.st}}function gt(s,t){return{nt:s.nt/t,st:s.st/t}}function Mt(s,t,n){const Ae=Math.max(0,t-1),Ne=Math.min(s.length-1,n+1);var tr,er;return[(tr=s[t],er=gt(wt(s[n],s[Ae]),bt),{nt:tr.nt+er.nt,st:tr.st+er.st}),wt(s[n],gt(wt(s[Ne],s[t]),bt))]}function xt(s,t,n,Ae,Ne){const{context:tr,horizontalPixelRatio:er,verticalPixelRatio:ir}=t;tr.lineTo(Ne.nt*er,s*ir),tr.lineTo(Ae.nt*er,s*ir),tr.closePath(),tr.fillStyle=n,tr.fill()}class St extends H{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K(t){var n;if(this.G===null)return;const{it:Ae,tt:Ne,cs:tr,et:er,Nt:ir,ds:sr}=this.G,rr=(n=this.G.fs)!==null&&n!==void 0?n:this.G.vs?0:t.mediaSize.height;if(Ne===null)return;const nr=t.context;nr.lineCap="butt",nr.lineJoin="round",nr.lineWidth=er,f(nr,ir),nr.lineWidth=1,mt(t,Ae,sr,Ne,tr,this.ps.bind(this),xt.bind(null,rr))}}function kt(s,t,n){return Math.min(Math.max(s,t),n)}function yt(s,t,n){return t-s<=n}function Ct(s){const t=Math.ceil(s);return t%2==0?t-1:t}class Tt{bs(t,n){const Ae=this.ws,{gs:Ne,Ms:tr,xs:er,Ss:ir,ks:sr,fs:rr}=n;if(this.ys===void 0||Ae===void 0||Ae.gs!==Ne||Ae.Ms!==tr||Ae.xs!==er||Ae.Ss!==ir||Ae.fs!==rr||Ae.ks!==sr){const nr=t.context.createLinearGradient(0,0,0,sr);if(nr.addColorStop(0,Ne),rr!=null){const ar=kt(rr*t.verticalPixelRatio/sr,0,1);nr.addColorStop(ar,tr),nr.addColorStop(ar,er)}nr.addColorStop(1,ir),this.ys=nr,this.ws=n}return this.ys}}class Pt extends St{constructor(){super(...arguments),this.Cs=new Tt}ps(t,n){return this.Cs.bs(t,{gs:n.Ts,Ms:"",xs:"",Ss:n.Ps,ks:t.bitmapSize.height})}}function Rt(s,t){const n=s.context;n.strokeStyle=t,n.stroke()}class Dt extends H{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K(t){if(this.G===null)return;const{it:n,tt:Ae,cs:Ne,ds:tr,et:er,Nt:ir,Rs:sr}=this.G;if(Ae===null)return;const rr=t.context;rr.lineCap="butt",rr.lineWidth=er*t.verticalPixelRatio,f(rr,ir),rr.lineJoin="round";const nr=this.Ds.bind(this);tr!==void 0&&mt(t,n,tr,Ae,Ne,nr,Rt),sr&&function(ar,or,ur,hr,cr){const{horizontalPixelRatio:vr,verticalPixelRatio:mr,context:dr}=ar;let lr=null;const gr=Math.max(1,Math.floor(vr))%2/2,fr=ur*mr+gr;for(let yr=hr.to-1;yr>=hr.from;--yr){const Er=or[yr];if(Er){const wr=cr(ar,Er);wr!==lr&&(dr.beginPath(),lr!==null&&dr.fill(),dr.fillStyle=wr,lr=wr);const Dr=Math.round(Er.nt*vr)+gr,kr=Er.st*mr;dr.moveTo(Dr,kr),dr.arc(Dr,kr,fr,0,2*Math.PI)}}dr.fill()}(t,n,sr,Ae,nr)}}class Vt extends Dt{Ds(t,n){return n.lt}}function Ot(s,t,n,Ae,Ne=0,tr=t.length){let er=tr-Ne;for(;0<er;){const ir=er>>1,sr=Ne+ir;Ae(t[sr],n)===s?(Ne=sr+1,er-=ir+1):er=ir}return Ne}const Bt=Ot.bind(null,!0),At=Ot.bind(null,!1);function It(s,t){return s.ot<t}function zt(s,t){return t<s.ot}function Lt(s,t,n){const Ae=t.Vs(),Ne=t.ui(),tr=Bt(s,Ae,It),er=At(s,Ne,zt);if(!n)return{from:tr,to:er};let ir=tr,sr=er;return tr>0&&tr<s.length&&s[tr].ot>=Ae&&(ir=tr-1),er>0&&er<s.length&&s[er-1].ot<=Ne&&(sr=er+1),{from:ir,to:sr}}class Et{constructor(t,n,Ae){this.Os=!0,this.Bs=!0,this.As=!0,this.Is=[],this.zs=null,this.Ls=t,this.Es=n,this.Ns=Ae}bt(t){this.Os=!0,t==="data"&&(this.Bs=!0),t==="options"&&(this.As=!0)}gt(){return this.Ls.yt()?(this.Fs(),this.zs===null?null:this.Ws):null}js(){this.Is=this.Is.map(t=>Object.assign(Object.assign({},t),this.Ls.$s().Hs(t.ot)))}Us(){this.zs=null}Fs(){this.Bs&&(this.qs(),this.Bs=!1),this.As&&(this.js(),this.As=!1),this.Os&&(this.Ys(),this.Os=!1)}Ys(){const t=this.Ls.Dt(),n=this.Es.St();if(this.Us(),n.Ni()||t.Ni())return;const Ae=n.Zs();if(Ae===null||this.Ls.In().Xs()===0)return;const Ne=this.Ls.Ct();Ne!==null&&(this.zs=Lt(this.Is,Ae,this.Ns),this.Ks(t,n,Ne.Vt),this.Gs())}}class Nt extends Et{constructor(t,n){super(t,n,!0)}Ks(t,n,Ae){n.Js(this.Is,E(this.zs)),t.Qs(this.Is,Ae,E(this.zs))}te(t,n){return{ot:t,_t:n,nt:NaN,st:NaN}}qs(){const t=this.Ls.$s();this.Is=this.Ls.In().ie().map(n=>{const Ae=n.Vt[3];return this.ne(n.se,Ae,t)})}}class Ft extends Nt{constructor(t,n){super(t,n),this.Ws=new j,this.ee=new Pt,this.re=new Vt,this.Ws.Z([this.ee,this.re])}ne(t,n,Ae){return Object.assign(Object.assign({},this.te(t,n)),Ae.Hs(t))}Gs(){const t=this.Ls.W();this.ee.J({ds:t.lineType,it:this.Is,Nt:t.lineStyle,et:t.lineWidth,fs:null,vs:t.invertFilledArea,tt:this.zs,cs:this.Es.St().he()}),this.re.J({ds:t.lineVisible?t.lineType:void 0,it:this.Is,Nt:t.lineStyle,et:t.lineWidth,tt:this.zs,cs:this.Es.St().he(),Rs:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0})}}class Wt extends H{constructor(){super(...arguments),this.zt=null,this.le=0,this.ae=0}J(t){this.zt=t}K({context:t,horizontalPixelRatio:n,verticalPixelRatio:Ae}){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;this.le=this.oe(n),this.le>=2&&Math.max(1,Math.floor(n))%2!=this.le%2&&this.le--,this.ae=this.zt._e?Math.min(this.le,Math.floor(n)):this.le;let Ne=null;const tr=this.ae<=this.le&&this.zt.he>=Math.floor(1.5*n);for(let er=this.zt.tt.from;er<this.zt.tt.to;++er){const ir=this.zt.In[er];Ne!==ir.ue&&(t.fillStyle=ir.ue,Ne=ir.ue);const sr=Math.floor(.5*this.ae),rr=Math.round(ir.nt*n),nr=rr-sr,ar=this.ae,or=nr+ar-1,ur=Math.min(ir.ce,ir.de),hr=Math.max(ir.ce,ir.de),cr=Math.round(ur*Ae)-sr,vr=Math.round(hr*Ae)+sr,mr=Math.max(vr-cr,this.ae);t.fillRect(nr,cr,ar,mr);const dr=Math.ceil(1.5*this.le);if(tr){if(this.zt.fe){const yr=rr-dr;let Er=Math.max(cr,Math.round(ir.ve*Ae)-sr),wr=Er+ar-1;wr>cr+mr-1&&(wr=cr+mr-1,Er=wr-ar+1),t.fillRect(yr,Er,nr-yr,wr-Er+1)}const lr=rr+dr;let gr=Math.max(cr,Math.round(ir.pe*Ae)-sr),fr=gr+ar-1;fr>cr+mr-1&&(fr=cr+mr-1,gr=fr-ar+1),t.fillRect(or+1,gr,lr-or,fr-gr+1)}}}oe(t){const n=Math.floor(t);return Math.max(n,Math.floor(function(Ae,Ne){return Math.floor(.3*Ae*Ne)}(b(this.zt).he,t)))}}class jt extends Et{constructor(t,n){super(t,n,!1)}Ks(t,n,Ae){n.Js(this.Is,E(this.zs)),t.me(this.Is,Ae,E(this.zs))}be(t,n,Ae){return{ot:t,we:n.Vt[0],ge:n.Vt[1],Me:n.Vt[2],xe:n.Vt[3],nt:NaN,ve:NaN,ce:NaN,de:NaN,pe:NaN}}qs(){const t=this.Ls.$s();this.Is=this.Ls.In().ie().map(n=>this.ne(n.se,n,t))}}class Ht extends jt{constructor(){super(...arguments),this.Ws=new Wt}ne(t,n,Ae){return Object.assign(Object.assign({},this.be(t,n,Ae)),Ae.Hs(t))}Gs(){const t=this.Ls.W();this.Ws.J({In:this.Is,he:this.Es.St().he(),fe:t.openVisible,_e:t.thinBars,tt:this.zs})}}class $t extends St{constructor(){super(...arguments),this.Cs=new Tt}ps(t,n){const Ae=this.G;return this.Cs.bs(t,{gs:n.Se,Ms:n.ke,xs:n.ye,Ss:n.Ce,ks:t.bitmapSize.height,fs:Ae.fs})}}class Ut extends Dt{constructor(){super(...arguments),this.Te=new Tt}Ds(t,n){const Ae=this.G;return this.Te.bs(t,{gs:n.Pe,Ms:n.Pe,xs:n.Re,Ss:n.Re,ks:t.bitmapSize.height,fs:Ae.fs})}}class qt extends Nt{constructor(t,n){super(t,n),this.Ws=new j,this.De=new $t,this.Ve=new Ut,this.Ws.Z([this.De,this.Ve])}ne(t,n,Ae){return Object.assign(Object.assign({},this.te(t,n)),Ae.Hs(t))}Gs(){const t=this.Ls.Ct();if(t===null)return;const n=this.Ls.W(),Ae=this.Ls.Dt().Rt(n.baseValue.price,t.Vt),Ne=this.Es.St().he();this.De.J({it:this.Is,et:n.lineWidth,Nt:n.lineStyle,ds:n.lineType,fs:Ae,vs:!1,tt:this.zs,cs:Ne}),this.Ve.J({it:this.Is,et:n.lineWidth,Nt:n.lineStyle,ds:n.lineVisible?n.lineType:void 0,Rs:n.pointMarkersVisible?n.pointMarkersRadius||n.lineWidth/2+2:void 0,fs:Ae,tt:this.zs,cs:Ne})}}class Yt extends H{constructor(){super(...arguments),this.zt=null,this.le=0}J(t){this.zt=t}K(t){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;const{horizontalPixelRatio:n}=t;this.le=function(tr,er){if(tr>=2.5&&tr<=4)return Math.floor(3*er);const ir=1-.2*Math.atan(Math.max(4,tr)-4)/(.5*Math.PI),sr=Math.floor(tr*ir*er),rr=Math.floor(tr*er),nr=Math.min(sr,rr);return Math.max(Math.floor(er),nr)}(this.zt.he,n),this.le>=2&&Math.floor(n)%2!=this.le%2&&this.le--;const Ae=this.zt.In;this.zt.Oe&&this.Be(t,Ae,this.zt.tt),this.zt._i&&this.Ae(t,Ae,this.zt.tt);const Ne=this.Ie(n);(!this.zt._i||this.le>2*Ne)&&this.ze(t,Ae,this.zt.tt)}Be(t,n,Ae){if(this.zt===null)return;const{context:Ne,horizontalPixelRatio:tr,verticalPixelRatio:er}=t;let ir="",sr=Math.min(Math.floor(tr),Math.floor(this.zt.he*tr));sr=Math.max(Math.floor(tr),Math.min(sr,this.le));const rr=Math.floor(.5*sr);let nr=null;for(let ar=Ae.from;ar<Ae.to;ar++){const or=n[ar];or.Le!==ir&&(Ne.fillStyle=or.Le,ir=or.Le);const ur=Math.round(Math.min(or.ve,or.pe)*er),hr=Math.round(Math.max(or.ve,or.pe)*er),cr=Math.round(or.ce*er),vr=Math.round(or.de*er);let mr=Math.round(tr*or.nt)-rr;const dr=mr+sr-1;nr!==null&&(mr=Math.max(nr+1,mr),mr=Math.min(mr,dr));const lr=dr-mr+1;Ne.fillRect(mr,cr,lr,ur-cr),Ne.fillRect(mr,hr+1,lr,vr-hr),nr=dr}}Ie(t){let n=Math.floor(1*t);this.le<=2*n&&(n=Math.floor(.5*(this.le-1)));const Ae=Math.max(Math.floor(t),n);return this.le<=2*Ae?Math.max(Math.floor(t),Math.floor(1*t)):Ae}Ae(t,n,Ae){if(this.zt===null)return;const{context:Ne,horizontalPixelRatio:tr,verticalPixelRatio:er}=t;let ir="";const sr=this.Ie(tr);let rr=null;for(let nr=Ae.from;nr<Ae.to;nr++){const ar=n[nr];ar.Ee!==ir&&(Ne.fillStyle=ar.Ee,ir=ar.Ee);let or=Math.round(ar.nt*tr)-Math.floor(.5*this.le);const ur=or+this.le-1,hr=Math.round(Math.min(ar.ve,ar.pe)*er),cr=Math.round(Math.max(ar.ve,ar.pe)*er);if(rr!==null&&(or=Math.max(rr+1,or),or=Math.min(or,ur)),this.zt.he*tr>2*sr)K(Ne,or,hr,ur-or+1,cr-hr+1,sr);else{const vr=ur-or+1;Ne.fillRect(or,hr,vr,cr-hr+1)}rr=ur}}ze(t,n,Ae){if(this.zt===null)return;const{context:Ne,horizontalPixelRatio:tr,verticalPixelRatio:er}=t;let ir="";const sr=this.Ie(tr);for(let rr=Ae.from;rr<Ae.to;rr++){const nr=n[rr];let ar=Math.round(Math.min(nr.ve,nr.pe)*er),or=Math.round(Math.max(nr.ve,nr.pe)*er),ur=Math.round(nr.nt*tr)-Math.floor(.5*this.le),hr=ur+this.le-1;if(nr.ue!==ir){const cr=nr.ue;Ne.fillStyle=cr,ir=cr}this.zt._i&&(ur+=sr,ar+=sr,hr-=sr,or-=sr),ar>or||Ne.fillRect(ur,ar,hr-ur+1,or-ar+1)}}}class Zt extends jt{constructor(){super(...arguments),this.Ws=new Yt}ne(t,n,Ae){return Object.assign(Object.assign({},this.be(t,n,Ae)),Ae.Hs(t))}Gs(){const t=this.Ls.W();this.Ws.J({In:this.Is,he:this.Es.St().he(),Oe:t.wickVisible,_i:t.borderVisible,tt:this.zs})}}class Xt{constructor(t,n){this.Ne=t,this.Li=n}X(t,n,Ae){this.Ne.draw(t,this.Li,n,Ae)}}class Kt extends Et{constructor(t,n,Ae){super(t,n,!1),this.wn=Ae,this.Ws=new Xt(this.wn.renderer(),Ne=>{const tr=t.Ct();return tr===null?null:t.Dt().Rt(Ne,tr.Vt)})}Fe(t){return this.wn.priceValueBuilder(t)}We(t){return this.wn.isWhitespace(t)}qs(){const t=this.Ls.$s();this.Is=this.Ls.In().ie().map(n=>Object.assign(Object.assign({ot:n.se,nt:NaN},t.Hs(n.se)),{je:n.He}))}Ks(t,n){n.Js(this.Is,E(this.zs))}Gs(){this.wn.update({bars:this.Is.map(Gt),barSpacing:this.Es.St().he(),visibleRange:this.zs},this.Ls.W())}}function Gt(s){return{x:s.nt,time:s.ot,originalData:s.je,barColor:s.ue}}class Jt extends H{constructor(){super(...arguments),this.zt=null,this.$e=[]}J(t){this.zt=t,this.$e=[]}K({context:t,horizontalPixelRatio:n,verticalPixelRatio:Ae}){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return;this.$e.length||this.Ue(n);const Ne=Math.max(1,Math.floor(Ae)),tr=Math.round(this.zt.qe*Ae)-Math.floor(Ne/2),er=tr+Ne;for(let ir=this.zt.tt.from;ir<this.zt.tt.to;ir++){const sr=this.zt.it[ir],rr=this.$e[ir-this.zt.tt.from],nr=Math.round(sr.st*Ae);let ar,or;t.fillStyle=sr.ue,nr<=tr?(ar=nr,or=er):(ar=tr,or=nr-Math.floor(Ne/2)+Ne),t.fillRect(rr.Vs,ar,rr.ui-rr.Vs+1,or-ar)}}Ue(t){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return void(this.$e=[]);const n=Math.ceil(this.zt.he*t)<=1?0:Math.max(1,Math.floor(t)),Ae=Math.round(this.zt.he*t)-n;this.$e=new Array(this.zt.tt.to-this.zt.tt.from);for(let tr=this.zt.tt.from;tr<this.zt.tt.to;tr++){const er=this.zt.it[tr],ir=Math.round(er.nt*t);let sr,rr;if(Ae%2){const nr=(Ae-1)/2;sr=ir-nr,rr=ir+nr}else{const nr=Ae/2;sr=ir-nr,rr=ir+nr-1}this.$e[tr-this.zt.tt.from]={Vs:sr,ui:rr,Ye:ir,Ze:er.nt*t,ot:er.ot}}for(let tr=this.zt.tt.from+1;tr<this.zt.tt.to;tr++){const er=this.$e[tr-this.zt.tt.from],ir=this.$e[tr-this.zt.tt.from-1];er.ot===ir.ot+1&&er.Vs-ir.ui!==n+1&&(ir.Ye>ir.Ze?ir.ui=er.Vs-n-1:er.Vs=ir.ui+n+1)}let Ne=Math.ceil(this.zt.he*t);for(let tr=this.zt.tt.from;tr<this.zt.tt.to;tr++){const er=this.$e[tr-this.zt.tt.from];er.ui<er.Vs&&(er.ui=er.Vs);const ir=er.ui-er.Vs+1;Ne=Math.min(ir,Ne)}if(n>0&&Ne<4)for(let tr=this.zt.tt.from;tr<this.zt.tt.to;tr++){const er=this.$e[tr-this.zt.tt.from];er.ui-er.Vs+1>Ne&&(er.Ye>er.Ze?er.ui-=1:er.Vs+=1)}}}class Qt extends Nt{constructor(){super(...arguments),this.Ws=new Jt}ne(t,n,Ae){return Object.assign(Object.assign({},this.te(t,n)),Ae.Hs(t))}Gs(){const t={it:this.Is,he:this.Es.St().he(),tt:this.zs,qe:this.Ls.Dt().Rt(this.Ls.W().base,b(this.Ls.Ct()).Vt)};this.Ws.J(t)}}class ti extends Nt{constructor(){super(...arguments),this.Ws=new Vt}ne(t,n,Ae){return Object.assign(Object.assign({},this.te(t,n)),Ae.Hs(t))}Gs(){const t=this.Ls.W(),n={it:this.Is,Nt:t.lineStyle,ds:t.lineVisible?t.lineType:void 0,et:t.lineWidth,Rs:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0,tt:this.zs,cs:this.Es.St().he()};this.Ws.J(n)}}const ii=/[2-9]/g;class ni{constructor(t=50){this.Xe=0,this.Ke=1,this.Ge=1,this.Je={},this.Qe=new Map,this.tr=t}ir(){this.Xe=0,this.Qe.clear(),this.Ke=1,this.Ge=1,this.Je={}}xi(t,n,Ae){return this.nr(t,n,Ae).width}Mi(t,n,Ae){const Ne=this.nr(t,n,Ae);return((Ne.actualBoundingBoxAscent||0)-(Ne.actualBoundingBoxDescent||0))/2}nr(t,n,Ae){const Ne=Ae||ii,tr=String(n).replace(Ne,"0");if(this.Qe.has(tr))return m(this.Qe.get(tr)).sr;if(this.Xe===this.tr){const ir=this.Je[this.Ge];delete this.Je[this.Ge],this.Qe.delete(ir),this.Ge++,this.Xe--}t.save(),t.textBaseline="middle";const er=t.measureText(tr);return t.restore(),er.width===0&&n.length||(this.Qe.set(tr,{sr:er,er:this.Ke}),this.Je[this.Ke]=tr,this.Xe++,this.Ke++),er}}class si{constructor(t){this.rr=null,this.k=null,this.hr="right",this.lr=t}ar(t,n,Ae){this.rr=t,this.k=n,this.hr=Ae}X(t){this.k!==null&&this.rr!==null&&this.rr.X(t,this.k,this.lr,this.hr)}}class ei{constructor(t,n,Ae){this._r=t,this.lr=new ni(50),this.ur=n,this.F=Ae,this.j=-1,this.Wt=new si(this.lr)}gt(){const t=this.F.cr(this.ur);if(t===null)return null;const n=t.dr(this.ur)?t.vr():this.ur.Dt();if(n===null)return null;const Ae=t.pr(n);if(Ae==="overlay")return null;const Ne=this.F.mr();return Ne.P!==this.j&&(this.j=Ne.P,this.lr.ir()),this.Wt.ar(this._r.Ii(),Ne,Ae),this.Wt}}class ri extends H{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}br(t,n){var Ae;if(!(!((Ae=this.zt)===null||Ae===void 0)&&Ae.yt))return null;const{st:Ne,et:tr,wr:er}=this.zt;return n>=Ne-tr-7&&n<=Ne+tr+7?{gr:this.zt,wr:er}:null}K({context:t,bitmapSize:n,horizontalPixelRatio:Ae,verticalPixelRatio:Ne}){if(this.zt===null||this.zt.yt===!1)return;const tr=Math.round(this.zt.st*Ne);tr<0||tr>n.height||(t.lineCap="butt",t.strokeStyle=this.zt.V,t.lineWidth=Math.floor(this.zt.et*Ae),f(t,this.zt.Nt),v(t,tr,0,n.width))}}class hi{constructor(t){this.Mr={st:0,V:"rgba(0, 0, 0, 0)",et:1,Nt:0,yt:!1},this.Sr=new ri,this.ft=!0,this.Ls=t,this.Es=t.$t(),this.Sr.J(this.Mr)}bt(){this.ft=!0}gt(){return this.Ls.yt()?(this.ft&&(this.kr(),this.ft=!1),this.Sr):null}}class li extends hi{constructor(t){super(t)}kr(){this.Mr.yt=!1;const t=this.Ls.Dt(),n=t.yr().yr;if(n!==2&&n!==3)return;const Ae=this.Ls.W();if(!Ae.baseLineVisible||!this.Ls.yt())return;const Ne=this.Ls.Ct();Ne!==null&&(this.Mr.yt=!0,this.Mr.st=t.Rt(Ne.Vt,Ne.Vt),this.Mr.V=Ae.baseLineColor,this.Mr.et=Ae.baseLineWidth,this.Mr.Nt=Ae.baseLineStyle)}}class ai extends H{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}He(){return this.zt}K({context:t,horizontalPixelRatio:n,verticalPixelRatio:Ae}){const Ne=this.zt;if(Ne===null)return;const tr=Math.max(1,Math.floor(n)),er=tr%2/2,ir=Math.round(Ne.Ze.x*n)+er,sr=Ne.Ze.y*Ae;t.fillStyle=Ne.Cr,t.beginPath();const rr=Math.max(2,1.5*Ne.Tr)*n;t.arc(ir,sr,rr,0,2*Math.PI,!1),t.fill(),t.fillStyle=Ne.Pr,t.beginPath(),t.arc(ir,sr,Ne.ht*n,0,2*Math.PI,!1),t.fill(),t.lineWidth=tr,t.strokeStyle=Ne.Rr,t.beginPath(),t.arc(ir,sr,Ne.ht*n+tr/2,0,2*Math.PI,!1),t.stroke()}}const oi=[{Dr:0,Vr:.25,Or:4,Br:10,Ar:.25,Ir:0,zr:.4,Lr:.8},{Dr:.25,Vr:.525,Or:10,Br:14,Ar:0,Ir:0,zr:.8,Lr:0},{Dr:.525,Vr:1,Or:14,Br:14,Ar:0,Ir:0,zr:0,Lr:0}];function _i(s,t,n,Ae){return function(Ne,tr){if(Ne==="transparent")return Ne;const er=T(Ne),ir=er[3];return`rgba(${er[0]}, ${er[1]}, ${er[2]}, ${tr*ir})`}(s,n+(Ae-n)*t)}function ui(s,t){const n=s%2600/2600;let Ae;for(const sr of oi)if(n>=sr.Dr&&n<=sr.Vr){Ae=sr;break}p$1(Ae!==void 0,"Last price animation internal logic error");const Ne=(n-Ae.Dr)/(Ae.Vr-Ae.Dr);return{Pr:_i(t,Ne,Ae.Ar,Ae.Ir),Rr:_i(t,Ne,Ae.zr,Ae.Lr),ht:(tr=Ne,er=Ae.Or,ir=Ae.Br,er+(ir-er)*tr)};var tr,er,ir}class ci{constructor(t){this.Wt=new ai,this.ft=!0,this.Er=!0,this.Nr=performance.now(),this.Fr=this.Nr-1,this.Wr=t}jr(){this.Fr=this.Nr-1,this.bt()}Hr(){if(this.bt(),this.Wr.W().lastPriceAnimation===2){const t=performance.now(),n=this.Fr-t;if(n>0)return void(n<650&&(this.Fr+=2600));this.Nr=t,this.Fr=t+2600}}bt(){this.ft=!0}$r(){this.Er=!0}yt(){return this.Wr.W().lastPriceAnimation!==0}Ur(){switch(this.Wr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Fr}}gt(){return this.ft?(this.Mt(),this.ft=!1,this.Er=!1):this.Er&&(this.qr(),this.Er=!1),this.Wt}Mt(){this.Wt.J(null);const t=this.Wr.$t().St(),n=t.Zs(),Ae=this.Wr.Ct();if(n===null||Ae===null)return;const Ne=this.Wr.Yr(!0);if(Ne.Zr||!n.Xr(Ne.se))return;const tr={x:t.It(Ne.se),y:this.Wr.Dt().Rt(Ne._t,Ae.Vt)},er=Ne.V,ir=this.Wr.W().lineWidth,sr=ui(this.Kr(),er);this.Wt.J({Cr:er,Tr:ir,Pr:sr.Pr,Rr:sr.Rr,ht:sr.ht,Ze:tr})}qr(){const t=this.Wt.He();if(t!==null){const n=ui(this.Kr(),t.Cr);t.Pr=n.Pr,t.Rr=n.Rr,t.ht=n.ht}}Kr(){return this.Ur()?performance.now()-this.Nr:2599}}function di(s,t){return Ct(Math.min(Math.max(s,12),30)*t)}function fi(s,t){switch(s){case"arrowDown":case"arrowUp":return di(t,1);case"circle":return di(t,.8);case"square":return di(t,.7)}}function vi(s){return function(t){const n=Math.ceil(t);return n%2!=0?n-1:n}(di(s,1))}function pi(s){return Math.max(di(s,.1),3)}function mi(s,t,n){return t?s:n?Math.ceil(s/2):0}function bi(s,t,n,Ae,Ne){const tr=fi("square",n),er=(tr-1)/2,ir=s-er,sr=t-er;return Ae>=ir&&Ae<=ir+tr&&Ne>=sr&&Ne<=sr+tr}function wi(s,t,n,Ae){const Ne=(fi("arrowUp",Ae)-1)/2*n.Gr,tr=(Ct(Ae/2)-1)/2*n.Gr;t.beginPath(),s?(t.moveTo(n.nt-Ne,n.st),t.lineTo(n.nt,n.st-Ne),t.lineTo(n.nt+Ne,n.st),t.lineTo(n.nt+tr,n.st),t.lineTo(n.nt+tr,n.st+Ne),t.lineTo(n.nt-tr,n.st+Ne),t.lineTo(n.nt-tr,n.st)):(t.moveTo(n.nt-Ne,n.st),t.lineTo(n.nt,n.st+Ne),t.lineTo(n.nt+Ne,n.st),t.lineTo(n.nt+tr,n.st),t.lineTo(n.nt+tr,n.st-Ne),t.lineTo(n.nt-tr,n.st-Ne),t.lineTo(n.nt-tr,n.st)),t.fill()}function gi(s,t,n,Ae,Ne,tr){return bi(t,n,Ae,Ne,tr)}class Mi extends H{constructor(){super(...arguments),this.zt=null,this.lr=new ni,this.j=-1,this.H="",this.Jr=""}J(t){this.zt=t}ar(t,n){this.j===t&&this.H===n||(this.j=t,this.H=n,this.Jr=F(t,n),this.lr.ir())}br(t,n){if(this.zt===null||this.zt.tt===null)return null;for(let Ae=this.zt.tt.from;Ae<this.zt.tt.to;Ae++){const Ne=this.zt.it[Ae];if(Si(Ne,t,n))return{gr:Ne.Qr,wr:Ne.wr}}return null}K({context:t,horizontalPixelRatio:n,verticalPixelRatio:Ae},Ne,tr){if(this.zt!==null&&this.zt.tt!==null){t.textBaseline="middle",t.font=this.Jr;for(let er=this.zt.tt.from;er<this.zt.tt.to;er++){const ir=this.zt.it[er];ir.Kt!==void 0&&(ir.Kt.Hi=this.lr.xi(t,ir.Kt.th),ir.Kt.At=this.j,ir.Kt.nt=ir.nt-ir.Kt.Hi/2),xi(ir,t,n,Ae)}}}}function xi(s,t,n,Ae){t.fillStyle=s.V,s.Kt!==void 0&&function(Ne,tr,er,ir,sr,rr){Ne.save(),Ne.scale(sr,rr),Ne.fillText(tr,er,ir),Ne.restore()}(t,s.Kt.th,s.Kt.nt,s.Kt.st,n,Ae),function(Ne,tr,er){if(Ne.Xs!==0){switch(Ne.ih){case"arrowDown":return void wi(!1,tr,er,Ne.Xs);case"arrowUp":return void wi(!0,tr,er,Ne.Xs);case"circle":return void function(ir,sr,rr){const nr=(fi("circle",rr)-1)/2;ir.beginPath(),ir.arc(sr.nt,sr.st,nr*sr.Gr,0,2*Math.PI,!1),ir.fill()}(tr,er,Ne.Xs);case"square":return void function(ir,sr,rr){const nr=fi("square",rr),ar=(nr-1)*sr.Gr/2,or=sr.nt-ar,ur=sr.st-ar;ir.fillRect(or,ur,nr*sr.Gr,nr*sr.Gr)}(tr,er,Ne.Xs)}Ne.ih}}(s,t,function(Ne,tr,er){const ir=Math.max(1,Math.floor(tr))%2/2;return{nt:Math.round(Ne.nt*tr)+ir,st:Ne.st*er,Gr:tr}}(s,n,Ae))}function Si(s,t,n){return!(s.Kt===void 0||!function(Ae,Ne,tr,er,ir,sr){const rr=er/2;return ir>=Ae&&ir<=Ae+tr&&sr>=Ne-rr&&sr<=Ne+rr}(s.Kt.nt,s.Kt.st,s.Kt.Hi,s.Kt.At,t,n))||function(Ae,Ne,tr){if(Ae.Xs===0)return!1;switch(Ae.ih){case"arrowDown":case"arrowUp":return gi(0,Ae.nt,Ae.st,Ae.Xs,Ne,tr);case"circle":return function(er,ir,sr,rr,nr){const ar=2+fi("circle",sr)/2,or=er-rr,ur=ir-nr;return Math.sqrt(or*or+ur*ur)<=ar}(Ae.nt,Ae.st,Ae.Xs,Ne,tr);case"square":return bi(Ae.nt,Ae.st,Ae.Xs,Ne,tr)}}(s,t,n)}function ki(s,t,n,Ae,Ne,tr,er,ir,sr){const rr=O(n)?n:n.xe,nr=O(n)?n:n.ge,ar=O(n)?n:n.Me,or=O(t.size)?Math.max(t.size,0):1,ur=vi(ir.he())*or,hr=ur/2;switch(s.Xs=ur,t.position){case"inBar":return s.st=er.Rt(rr,sr),void(s.Kt!==void 0&&(s.Kt.st=s.st+hr+tr+.6*Ne));case"aboveBar":return s.st=er.Rt(nr,sr)-hr-Ae.nh,s.Kt!==void 0&&(s.Kt.st=s.st-hr-.6*Ne,Ae.nh+=1.2*Ne),void(Ae.nh+=ur+tr);case"belowBar":return s.st=er.Rt(ar,sr)+hr+Ae.sh,s.Kt!==void 0&&(s.Kt.st=s.st+hr+tr+.6*Ne,Ae.sh+=1.2*Ne),void(Ae.sh+=ur+tr)}t.position}class yi{constructor(t,n){this.ft=!0,this.eh=!0,this.rh=!0,this.hh=null,this.ah=null,this.Wt=new Mi,this.Wr=t,this.$i=n,this.zt={it:[],tt:null}}bt(t){this.ft=!0,this.rh=!0,t==="data"&&(this.eh=!0,this.ah=null)}gt(t){if(!this.Wr.yt())return null;this.ft&&this.oh();const n=this.$i.W().layout;return this.Wt.ar(n.fontSize,n.fontFamily),this.Wt.J(this.zt),this.Wt}_h(){if(this.rh){if(this.Wr.uh().length>0){const t=this.$i.St().he(),n=pi(t),Ae=1.5*vi(t)+2*n,Ne=this.dh();this.hh={above:mi(Ae,Ne.aboveBar,Ne.inBar),below:mi(Ae,Ne.belowBar,Ne.inBar)}}else this.hh=null;this.rh=!1}return this.hh}dh(){return this.ah===null&&(this.ah=this.Wr.uh().reduce((t,n)=>(t[n.position]||(t[n.position]=!0),t),{inBar:!1,aboveBar:!1,belowBar:!1})),this.ah}oh(){const t=this.Wr.Dt(),n=this.$i.St(),Ae=this.Wr.uh();this.eh&&(this.zt.it=Ae.map(nr=>({ot:nr.time,nt:0,st:0,Xs:0,ih:nr.shape,V:nr.color,Qr:nr.Qr,wr:nr.id,Kt:void 0})),this.eh=!1);const Ne=this.$i.W().layout;this.zt.tt=null;const tr=n.Zs();if(tr===null)return;const er=this.Wr.Ct();if(er===null||this.zt.it.length===0)return;let ir=NaN;const sr=pi(n.he()),rr={nh:sr,sh:sr};this.zt.tt=Lt(this.zt.it,tr,!0);for(let nr=this.zt.tt.from;nr<this.zt.tt.to;nr++){const ar=Ae[nr];ar.time!==ir&&(rr.nh=sr,rr.sh=sr,ir=ar.time);const or=this.zt.it[nr];or.nt=n.It(ar.time),ar.text!==void 0&&ar.text.length>0&&(or.Kt={th:ar.text,nt:0,st:0,Hi:0,At:0});const ur=this.Wr.fh(ar.time);ur!==null&&ki(or,ar,ur,rr,Ne.fontSize,sr,t,n,er.Vt)}this.ft=!1}}class Ci extends hi{constructor(t){super(t)}kr(){const t=this.Mr;t.yt=!1;const n=this.Ls.W();if(!n.priceLineVisible||!this.Ls.yt())return;const Ae=this.Ls.Yr(n.priceLineSource===0);Ae.Zr||(t.yt=!0,t.st=Ae.ki,t.V=this.Ls.ph(Ae.V),t.et=n.priceLineWidth,t.Nt=n.priceLineStyle)}}class Ti extends nt{constructor(t){super(),this.jt=t}zi(t,n,Ae){t.yt=!1,n.yt=!1;const Ne=this.jt;if(!Ne.yt())return;const tr=Ne.W(),er=tr.lastValueVisible,ir=Ne.mh()!=="",sr=tr.seriesLastValueMode===0,rr=Ne.Yr(!1);if(rr.Zr)return;er&&(t.Kt=this.bh(rr,er,sr),t.yt=t.Kt.length!==0),(ir||sr)&&(n.Kt=this.wh(rr,er,ir,sr),n.yt=n.Kt.length>0);const nr=Ne.ph(rr.V),ar=R(nr);Ae.t=ar.t,Ae.ki=rr.ki,n.Ot=Ne.$t().Bt(rr.ki/Ne.Dt().At()),t.Ot=nr,t.V=ar.i,n.V=ar.i}wh(t,n,Ae,Ne){let tr="";const er=this.jt.mh();return Ae&&er.length!==0&&(tr+=`${er} `),n&&Ne&&(tr+=this.jt.Dt().gh()?t.Mh:t.xh),tr.trim()}bh(t,n,Ae){return n?Ae?this.jt.Dt().gh()?t.xh:t.Mh:t.Kt:""}}function Pi(s,t,n,Ae){const Ne=Number.isFinite(t),tr=Number.isFinite(n);return Ne&&tr?s(t,n):Ne||tr?Ne?t:n:Ae}class Ri{constructor(t,n){this.Sh=t,this.kh=n}yh(t){return t!==null&&this.Sh===t.Sh&&this.kh===t.kh}Ch(){return new Ri(this.Sh,this.kh)}Th(){return this.Sh}Ph(){return this.kh}Rh(){return this.kh-this.Sh}Ni(){return this.kh===this.Sh||Number.isNaN(this.kh)||Number.isNaN(this.Sh)}ts(t){return t===null?this:new Ri(Pi(Math.min,this.Th(),t.Th(),-1/0),Pi(Math.max,this.Ph(),t.Ph(),1/0))}Dh(t){if(!O(t)||this.kh-this.Sh===0)return;const n=.5*(this.kh+this.Sh);let Ae=this.kh-n,Ne=this.Sh-n;Ae*=t,Ne*=t,this.kh=n+Ae,this.Sh=n+Ne}Vh(t){O(t)&&(this.kh+=t,this.Sh+=t)}Oh(){return{minValue:this.Sh,maxValue:this.kh}}static Bh(t){return t===null?null:new Ri(t.minValue,t.maxValue)}}class Di{constructor(t,n){this.Ah=t,this.Ih=n||null}zh(){return this.Ah}Lh(){return this.Ih}Oh(){return this.Ah===null?null:{priceRange:this.Ah.Oh(),margins:this.Ih||void 0}}static Bh(t){return t===null?null:new Di(Ri.Bh(t.priceRange),t.margins)}}class Vi extends hi{constructor(t,n){super(t),this.Eh=n}kr(){const t=this.Mr;t.yt=!1;const n=this.Eh.W();if(!this.Ls.yt()||!n.lineVisible)return;const Ae=this.Eh.Nh();Ae!==null&&(t.yt=!0,t.st=Ae,t.V=n.color,t.et=n.lineWidth,t.Nt=n.lineStyle,t.wr=this.Eh.W().id)}}class Oi extends nt{constructor(t,n){super(),this.Wr=t,this.Eh=n}zi(t,n,Ae){t.yt=!1,n.yt=!1;const Ne=this.Eh.W(),tr=Ne.axisLabelVisible,er=Ne.title!=="",ir=this.Wr;if(!tr||!ir.yt())return;const sr=this.Eh.Nh();if(sr===null)return;er&&(n.Kt=Ne.title,n.yt=!0),n.Ot=ir.$t().Bt(sr/ir.Dt().At()),t.Kt=this.Fh(Ne.price),t.yt=!0;const rr=R(Ne.axisLabelColor||Ne.color);Ae.t=rr.t;const nr=Ne.axisLabelTextColor||rr.i;t.V=nr,n.V=nr,Ae.ki=sr}Fh(t){const n=this.Wr.Ct();return n===null?"":this.Wr.Dt().Fi(t,n.Vt)}}class Bi{constructor(t,n){this.Wr=t,this.cn=n,this.Wh=new Vi(t,this),this._r=new Oi(t,this),this.jh=new ei(this._r,t,t.$t())}Hh(t){V(this.cn,t),this.bt(),this.Wr.$t().$h()}W(){return this.cn}Uh(){return this.Wh}qh(){return this.jh}Yh(){return this._r}bt(){this.Wh.bt(),this._r.bt()}Nh(){const t=this.Wr,n=t.Dt();if(t.$t().St().Ni()||n.Ni())return null;const Ae=t.Ct();return Ae===null?null:n.Rt(this.cn.price,Ae.Vt)}}class Ai extends lt{constructor(t){super(),this.$i=t}$t(){return this.$i}}const Ii={Bar:(s,t,n,Ae)=>{var Ne;const tr=t.upColor,er=t.downColor,ir=b(s(n,Ae)),sr=w(ir.Vt[0])<=w(ir.Vt[3]);return{ue:(Ne=ir.V)!==null&&Ne!==void 0?Ne:sr?tr:er}},Candlestick:(s,t,n,Ae)=>{var Ne,tr,er;const ir=t.upColor,sr=t.downColor,rr=t.borderUpColor,nr=t.borderDownColor,ar=t.wickUpColor,or=t.wickDownColor,ur=b(s(n,Ae)),hr=w(ur.Vt[0])<=w(ur.Vt[3]);return{ue:(Ne=ur.V)!==null&&Ne!==void 0?Ne:hr?ir:sr,Ee:(tr=ur.Ot)!==null&&tr!==void 0?tr:hr?rr:nr,Le:(er=ur.Zh)!==null&&er!==void 0?er:hr?ar:or}},Custom:(s,t,n,Ae)=>{var Ne;return{ue:(Ne=b(s(n,Ae)).V)!==null&&Ne!==void 0?Ne:t.color}},Area:(s,t,n,Ae)=>{var Ne,tr,er,ir;const sr=b(s(n,Ae));return{ue:(Ne=sr.lt)!==null&&Ne!==void 0?Ne:t.lineColor,lt:(tr=sr.lt)!==null&&tr!==void 0?tr:t.lineColor,Ts:(er=sr.Ts)!==null&&er!==void 0?er:t.topColor,Ps:(ir=sr.Ps)!==null&&ir!==void 0?ir:t.bottomColor}},Baseline:(s,t,n,Ae)=>{var Ne,tr,er,ir,sr,rr;const nr=b(s(n,Ae));return{ue:nr.Vt[3]>=t.baseValue.price?t.topLineColor:t.bottomLineColor,Pe:(Ne=nr.Pe)!==null&&Ne!==void 0?Ne:t.topLineColor,Re:(tr=nr.Re)!==null&&tr!==void 0?tr:t.bottomLineColor,Se:(er=nr.Se)!==null&&er!==void 0?er:t.topFillColor1,ke:(ir=nr.ke)!==null&&ir!==void 0?ir:t.topFillColor2,ye:(sr=nr.ye)!==null&&sr!==void 0?sr:t.bottomFillColor1,Ce:(rr=nr.Ce)!==null&&rr!==void 0?rr:t.bottomFillColor2}},Line:(s,t,n,Ae)=>{var Ne,tr;const er=b(s(n,Ae));return{ue:(Ne=er.V)!==null&&Ne!==void 0?Ne:t.color,lt:(tr=er.V)!==null&&tr!==void 0?tr:t.color}},Histogram:(s,t,n,Ae)=>{var Ne;return{ue:(Ne=b(s(n,Ae)).V)!==null&&Ne!==void 0?Ne:t.color}}};class zi{constructor(t){this.Xh=(n,Ae)=>Ae!==void 0?Ae.Vt:this.Wr.In().Kh(n),this.Wr=t,this.Gh=Ii[t.Jh()]}Hs(t,n){return this.Gh(this.Xh,this.Wr.W(),t,n)}}var Li;(function(s){s[s.NearestLeft=-1]="NearestLeft",s[s.None=0]="None",s[s.NearestRight=1]="NearestRight"})(Li||(Li={}));const Ei=30;class Ni{constructor(){this.Qh=[],this.tl=new Map,this.il=new Map}nl(){return this.Xs()>0?this.Qh[this.Qh.length-1]:null}sl(){return this.Xs()>0?this.el(0):null}An(){return this.Xs()>0?this.el(this.Qh.length-1):null}Xs(){return this.Qh.length}Ni(){return this.Xs()===0}Xr(t){return this.rl(t,0)!==null}Kh(t){return this.hl(t)}hl(t,n=0){const Ae=this.rl(t,n);return Ae===null?null:Object.assign(Object.assign({},this.ll(Ae)),{se:this.el(Ae)})}ie(){return this.Qh}al(t,n,Ae){if(this.Ni())return null;let Ne=null;for(const tr of Ae)Ne=Fi(Ne,this.ol(t,n,tr));return Ne}J(t){this.il.clear(),this.tl.clear(),this.Qh=t}el(t){return this.Qh[t].se}ll(t){return this.Qh[t]}rl(t,n){const Ae=this._l(t);if(Ae===null&&n!==0)switch(n){case-1:return this.ul(t);case 1:return this.cl(t);default:throw new TypeError("Unknown search mode")}return Ae}ul(t){let n=this.dl(t);return n>0&&(n-=1),n!==this.Qh.length&&this.el(n)<t?n:null}cl(t){const n=this.fl(t);return n!==this.Qh.length&&t<this.el(n)?n:null}_l(t){const n=this.dl(t);return n===this.Qh.length||t<this.Qh[n].se?null:n}dl(t){return Bt(this.Qh,t,(n,Ae)=>n.se<Ae)}fl(t){return At(this.Qh,t,(n,Ae)=>n.se>Ae)}vl(t,n,Ae){let Ne=null;for(let tr=t;tr<n;tr++){const er=this.Qh[tr].Vt[Ae];Number.isNaN(er)||(Ne===null?Ne={pl:er,ml:er}:(er<Ne.pl&&(Ne.pl=er),er>Ne.ml&&(Ne.ml=er)))}return Ne}ol(t,n,Ae){if(this.Ni())return null;let Ne=null;const tr=b(this.sl()),er=b(this.An()),ir=Math.max(t,tr),sr=Math.min(n,er),rr=Math.ceil(ir/Ei)*Ei,nr=Math.max(rr,Math.floor(sr/Ei)*Ei);{const or=this.dl(ir),ur=this.fl(Math.min(sr,rr,n));Ne=Fi(Ne,this.vl(or,ur,Ae))}let ar=this.tl.get(Ae);ar===void 0&&(ar=new Map,this.tl.set(Ae,ar));for(let or=Math.max(rr+1,ir);or<nr;or+=Ei){const ur=Math.floor(or/Ei);let hr=ar.get(ur);if(hr===void 0){const cr=this.dl(ur*Ei),vr=this.fl((ur+1)*Ei-1);hr=this.vl(cr,vr,Ae),ar.set(ur,hr)}Ne=Fi(Ne,hr)}{const or=this.dl(nr),ur=this.fl(sr);Ne=Fi(Ne,this.vl(or,ur,Ae))}return Ne}}function Fi(s,t){return s===null?t:t===null?s:{pl:Math.min(s.pl,t.pl),ml:Math.max(s.ml,t.ml)}}class Wi{constructor(t){this.bl=t}X(t,n,Ae){this.bl.draw(t)}wl(t,n,Ae){var Ne,tr;(tr=(Ne=this.bl).drawBackground)===null||tr===void 0||tr.call(Ne,t)}}class ji{constructor(t){this.Qe=null,this.wn=t}gt(){var t;const n=this.wn.renderer();if(n===null)return null;if(((t=this.Qe)===null||t===void 0?void 0:t.gl)===n)return this.Qe.Ml;const Ae=new Wi(n);return this.Qe={gl:n,Ml:Ae},Ae}xl(){var t,n,Ae;return(Ae=(n=(t=this.wn).zOrder)===null||n===void 0?void 0:n.call(t))!==null&&Ae!==void 0?Ae:"normal"}}function Hi(s){var t,n,Ae,Ne,tr;return{Kt:s.text(),ki:s.coordinate(),Si:(t=s.fixedCoordinate)===null||t===void 0?void 0:t.call(s),V:s.textColor(),t:s.backColor(),yt:(Ae=(n=s.visible)===null||n===void 0?void 0:n.call(s))===null||Ae===void 0||Ae,hi:(tr=(Ne=s.tickVisible)===null||Ne===void 0?void 0:Ne.call(s))===null||tr===void 0||tr}}class $i{constructor(t,n){this.Wt=new rt,this.Sl=t,this.kl=n}gt(){return this.Wt.J(Object.assign({Hi:this.kl.Hi()},Hi(this.Sl))),this.Wt}}class Ui extends nt{constructor(t,n){super(),this.Sl=t,this.Li=n}zi(t,n,Ae){const Ne=Hi(this.Sl);Ae.t=Ne.t,t.V=Ne.V;const tr=2/12*this.Li.P();Ae.wi=tr,Ae.gi=tr,Ae.ki=Ne.ki,Ae.Si=Ne.Si,t.Kt=Ne.Kt,t.yt=Ne.yt,t.hi=Ne.hi}}class qi{constructor(t,n){this.yl=null,this.Cl=null,this.Tl=null,this.Pl=null,this.Rl=null,this.Dl=t,this.Wr=n}Vl(){return this.Dl}Vn(){var t,n;(n=(t=this.Dl).updateAllViews)===null||n===void 0||n.call(t)}Pn(){var t,n,Ae,Ne;const tr=(Ae=(n=(t=this.Dl).paneViews)===null||n===void 0?void 0:n.call(t))!==null&&Ae!==void 0?Ae:[];if(((Ne=this.yl)===null||Ne===void 0?void 0:Ne.gl)===tr)return this.yl.Ml;const er=tr.map(ir=>new ji(ir));return this.yl={gl:tr,Ml:er},er}Qi(){var t,n,Ae,Ne;const tr=(Ae=(n=(t=this.Dl).timeAxisViews)===null||n===void 0?void 0:n.call(t))!==null&&Ae!==void 0?Ae:[];if(((Ne=this.Cl)===null||Ne===void 0?void 0:Ne.gl)===tr)return this.Cl.Ml;const er=this.Wr.$t().St(),ir=tr.map(sr=>new $i(sr,er));return this.Cl={gl:tr,Ml:ir},ir}Rn(){var t,n,Ae,Ne;const tr=(Ae=(n=(t=this.Dl).priceAxisViews)===null||n===void 0?void 0:n.call(t))!==null&&Ae!==void 0?Ae:[];if(((Ne=this.Tl)===null||Ne===void 0?void 0:Ne.gl)===tr)return this.Tl.Ml;const er=this.Wr.Dt(),ir=tr.map(sr=>new Ui(sr,er));return this.Tl={gl:tr,Ml:ir},ir}Ol(){var t,n,Ae,Ne;const tr=(Ae=(n=(t=this.Dl).priceAxisPaneViews)===null||n===void 0?void 0:n.call(t))!==null&&Ae!==void 0?Ae:[];if(((Ne=this.Pl)===null||Ne===void 0?void 0:Ne.gl)===tr)return this.Pl.Ml;const er=tr.map(ir=>new ji(ir));return this.Pl={gl:tr,Ml:er},er}Bl(){var t,n,Ae,Ne;const tr=(Ae=(n=(t=this.Dl).timeAxisPaneViews)===null||n===void 0?void 0:n.call(t))!==null&&Ae!==void 0?Ae:[];if(((Ne=this.Rl)===null||Ne===void 0?void 0:Ne.gl)===tr)return this.Rl.Ml;const er=tr.map(ir=>new ji(ir));return this.Rl={gl:tr,Ml:er},er}Al(t,n){var Ae,Ne,tr;return(tr=(Ne=(Ae=this.Dl).autoscaleInfo)===null||Ne===void 0?void 0:Ne.call(Ae,t,n))!==null&&tr!==void 0?tr:null}br(t,n){var Ae,Ne,tr;return(tr=(Ne=(Ae=this.Dl).hitTest)===null||Ne===void 0?void 0:Ne.call(Ae,t,n))!==null&&tr!==void 0?tr:null}}function Yi(s,t,n,Ae){s.forEach(Ne=>{t(Ne).forEach(tr=>{tr.xl()===n&&Ae.push(tr)})})}function Zi(s){return s.Pn()}function Xi(s){return s.Ol()}function Ki(s){return s.Bl()}class Gi extends Ai{constructor(t,n,Ae,Ne,tr){super(t),this.zt=new Ni,this.Wh=new Ci(this),this.Il=[],this.zl=new li(this),this.Ll=null,this.El=null,this.Nl=[],this.Fl=[],this.Wl=null,this.jl=[],this.cn=n,this.Hl=Ae;const er=new Ti(this);this.rn=[er],this.jh=new ei(er,this,t),Ae!=="Area"&&Ae!=="Line"&&Ae!=="Baseline"||(this.Ll=new ci(this)),this.$l(),this.Ul(tr)}S(){this.Wl!==null&&clearTimeout(this.Wl)}ph(t){return this.cn.priceLineColor||t}Yr(t){const n={Zr:!0},Ae=this.Dt();if(this.$t().St().Ni()||Ae.Ni()||this.zt.Ni())return n;const Ne=this.$t().St().Zs(),tr=this.Ct();if(Ne===null||tr===null)return n;let er,ir;if(t){const ar=this.zt.nl();if(ar===null)return n;er=ar,ir=ar.se}else{const ar=this.zt.hl(Ne.ui(),-1);if(ar===null||(er=this.zt.Kh(ar.se),er===null))return n;ir=ar.se}const sr=er.Vt[3],rr=this.$s().Hs(ir,{Vt:er}),nr=Ae.Rt(sr,tr.Vt);return{Zr:!1,_t:sr,Kt:Ae.Fi(sr,tr.Vt),Mh:Ae.ql(sr),xh:Ae.Yl(sr,tr.Vt),V:rr.ue,ki:nr,se:ir}}$s(){return this.El!==null||(this.El=new zi(this)),this.El}W(){return this.cn}Hh(t){const n=t.priceScaleId;n!==void 0&&n!==this.cn.priceScaleId&&this.$t().Zl(this,n),V(this.cn,t),t.priceFormat!==void 0&&(this.$l(),this.$t().Xl()),this.$t().Kl(this),this.$t().Gl(),this.wn.bt("options")}J(t,n){this.zt.J(t),this.Jl(),this.wn.bt("data"),this.dn.bt("data"),this.Ll!==null&&(n&&n.Ql?this.Ll.Hr():t.length===0&&this.Ll.jr());const Ae=this.$t().cr(this);this.$t().ta(Ae),this.$t().Kl(this),this.$t().Gl(),this.$t().$h()}ia(t){this.Nl=t,this.Jl();const n=this.$t().cr(this);this.dn.bt("data"),this.$t().ta(n),this.$t().Kl(this),this.$t().Gl(),this.$t().$h()}na(){return this.Nl}uh(){return this.Fl}sa(t){const n=new Bi(this,t);return this.Il.push(n),this.$t().Kl(this),n}ea(t){const n=this.Il.indexOf(t);n!==-1&&this.Il.splice(n,1),this.$t().Kl(this)}Jh(){return this.Hl}Ct(){const t=this.ra();return t===null?null:{Vt:t.Vt[3],ha:t.ot}}ra(){const t=this.$t().St().Zs();if(t===null)return null;const n=t.Vs();return this.zt.hl(n,1)}In(){return this.zt}fh(t){const n=this.zt.Kh(t);return n===null?null:this.Hl==="Bar"||this.Hl==="Candlestick"||this.Hl==="Custom"?{we:n.Vt[0],ge:n.Vt[1],Me:n.Vt[2],xe:n.Vt[3]}:n.Vt[3]}la(t){const n=[];Yi(this.jl,Zi,"top",n);const Ae=this.Ll;return Ae!==null&&Ae.yt()&&(this.Wl===null&&Ae.Ur()&&(this.Wl=setTimeout(()=>{this.Wl=null,this.$t().aa()},0)),Ae.$r(),n.unshift(Ae)),n}Pn(){const t=[];this.oa()||t.push(this.zl),t.push(this.wn,this.Wh,this.dn);const n=this.Il.map(Ae=>Ae.Uh());return t.push(...n),Yi(this.jl,Zi,"normal",t),t}_a(){return this.ua(Zi,"bottom")}ca(t){return this.ua(Xi,t)}da(t){return this.ua(Ki,t)}fa(t,n){return this.jl.map(Ae=>Ae.br(t,n)).filter(Ae=>Ae!==null)}Ji(t){return[this.jh,...this.Il.map(n=>n.qh())]}Rn(t,n){if(n!==this.Yi&&!this.oa())return[];const Ae=[...this.rn];for(const Ne of this.Il)Ae.push(Ne.Yh());return this.jl.forEach(Ne=>{Ae.push(...Ne.Rn())}),Ae}Qi(){const t=[];return this.jl.forEach(n=>{t.push(...n.Qi())}),t}Al(t,n){if(this.cn.autoscaleInfoProvider!==void 0){const Ae=this.cn.autoscaleInfoProvider(()=>{const Ne=this.va(t,n);return Ne===null?null:Ne.Oh()});return Di.Bh(Ae)}return this.va(t,n)}pa(){return this.cn.priceFormat.minMove}ma(){return this.ba}Vn(){var t;this.wn.bt(),this.dn.bt();for(const n of this.rn)n.bt();for(const n of this.Il)n.bt();this.Wh.bt(),this.zl.bt(),(t=this.Ll)===null||t===void 0||t.bt(),this.jl.forEach(n=>n.Vn())}Dt(){return b(super.Dt())}kt(t){if(!((this.Hl==="Line"||this.Hl==="Area"||this.Hl==="Baseline")&&this.cn.crosshairMarkerVisible))return null;const n=this.zt.Kh(t);return n===null?null:{_t:n.Vt[3],ht:this.wa(),Ot:this.ga(),Pt:this.Ma(),Tt:this.xa(t)}}mh(){return this.cn.title}yt(){return this.cn.visible}Sa(t){this.jl.push(new qi(t,this))}ka(t){this.jl=this.jl.filter(n=>n.Vl()!==t)}ya(){if(this.wn instanceof Kt)return t=>this.wn.Fe(t)}Ca(){if(this.wn instanceof Kt)return t=>this.wn.We(t)}oa(){return!_t(this.Dt().Ta())}va(t,n){if(!B(t)||!B(n)||this.zt.Ni())return null;const Ae=this.Hl==="Line"||this.Hl==="Area"||this.Hl==="Baseline"||this.Hl==="Histogram"?[3]:[2,1],Ne=this.zt.al(t,n,Ae);let tr=Ne!==null?new Ri(Ne.pl,Ne.ml):null;if(this.Jh()==="Histogram"){const ir=this.cn.base,sr=new Ri(ir,ir);tr=tr!==null?tr.ts(sr):sr}let er=this.dn._h();return this.jl.forEach(ir=>{const sr=ir.Al(t,n);if(sr!=null&&sr.priceRange){const ur=new Ri(sr.priceRange.minValue,sr.priceRange.maxValue);tr=tr!==null?tr.ts(ur):ur}var rr,nr,ar,or;sr!=null&&sr.margins&&(rr=er,nr=sr.margins,er={above:Math.max((ar=rr==null?void 0:rr.above)!==null&&ar!==void 0?ar:0,nr.above),below:Math.max((or=rr==null?void 0:rr.below)!==null&&or!==void 0?or:0,nr.below)})}),new Di(tr,er)}wa(){switch(this.Hl){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerRadius}return 0}ga(){switch(this.Hl){case"Line":case"Area":case"Baseline":{const t=this.cn.crosshairMarkerBorderColor;if(t.length!==0)return t}}return null}Ma(){switch(this.Hl){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerBorderWidth}return 0}xa(t){switch(this.Hl){case"Line":case"Area":case"Baseline":{const n=this.cn.crosshairMarkerBackgroundColor;if(n.length!==0)return n}}return this.$s().Hs(t).ue}$l(){switch(this.cn.priceFormat.type){case"custom":this.ba={format:this.cn.priceFormat.formatter};break;case"volume":this.ba=new pt(this.cn.priceFormat.precision);break;case"percent":this.ba=new vt(this.cn.priceFormat.precision);break;default:{const t=Math.pow(10,this.cn.priceFormat.precision);this.ba=new ft(t,this.cn.priceFormat.minMove*t)}}this.Yi!==null&&this.Yi.Pa()}Jl(){const t=this.$t().St();if(!t.Ra()||this.zt.Ni())return void(this.Fl=[]);const n=b(this.zt.sl());this.Fl=this.Nl.map((Ae,Ne)=>{const tr=b(t.Da(Ae.time,!0)),er=tr<n?1:-1;return{time:b(this.zt.hl(tr,er)).se,position:Ae.position,shape:Ae.shape,color:Ae.color,id:Ae.id,Qr:Ne,text:Ae.text,size:Ae.size,originalTime:Ae.originalTime}})}Ul(t){switch(this.dn=new yi(this,this.$t()),this.Hl){case"Bar":this.wn=new Ht(this,this.$t());break;case"Candlestick":this.wn=new Zt(this,this.$t());break;case"Line":this.wn=new ti(this,this.$t());break;case"Custom":this.wn=new Kt(this,this.$t(),m(t));break;case"Area":this.wn=new Ft(this,this.$t());break;case"Baseline":this.wn=new qt(this,this.$t());break;case"Histogram":this.wn=new Qt(this,this.$t());break;default:throw Error("Unknown chart style assigned: "+this.Hl)}}ua(t,n){const Ae=[];return Yi(this.jl,t,n,Ae),Ae}}class Ji{constructor(t){this.cn=t}Va(t,n,Ae){let Ne=t;if(this.cn.mode===0)return Ne;const tr=Ae.vn(),er=tr.Ct();if(er===null)return Ne;const ir=tr.Rt(t,er),sr=Ae.Oa().filter(nr=>nr instanceof Gi).reduce((nr,ar)=>{if(Ae.dr(ar)||!ar.yt())return nr;const or=ar.Dt(),ur=ar.In();if(or.Ni()||!ur.Xr(n))return nr;const hr=ur.Kh(n);if(hr===null)return nr;const cr=w(ar.Ct());return nr.concat([or.Rt(hr.Vt[3],cr.Vt)])},[]);if(sr.length===0)return Ne;sr.sort((nr,ar)=>Math.abs(nr-ir)-Math.abs(ar-ir));const rr=sr[0];return Ne=tr.pn(rr,er),Ne}}class Qi extends H{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}K({context:t,bitmapSize:n,horizontalPixelRatio:Ae,verticalPixelRatio:Ne}){if(this.zt===null)return;const tr=Math.max(1,Math.floor(Ae));t.lineWidth=tr,function(er,ir){er.save(),er.lineWidth%2&&er.translate(.5,.5),ir(),er.restore()}(t,()=>{const er=b(this.zt);if(er.Ba){t.strokeStyle=er.Aa,f(t,er.Ia),t.beginPath();for(const ir of er.za){const sr=Math.round(ir.La*Ae);t.moveTo(sr,-tr),t.lineTo(sr,n.height+tr)}t.stroke()}if(er.Ea){t.strokeStyle=er.Na,f(t,er.Fa),t.beginPath();for(const ir of er.Wa){const sr=Math.round(ir.La*Ne);t.moveTo(-tr,sr),t.lineTo(n.width+tr,sr)}t.stroke()}})}}class tn{constructor(t){this.Wt=new Qi,this.ft=!0,this.tn=t}bt(){this.ft=!0}gt(){if(this.ft){const t=this.tn.$t().W().grid,n={Ea:t.horzLines.visible,Ba:t.vertLines.visible,Na:t.horzLines.color,Aa:t.vertLines.color,Fa:t.horzLines.style,Ia:t.vertLines.style,Wa:this.tn.vn().ja(),za:(this.tn.$t().St().ja()||[]).map(Ae=>({La:Ae.coord}))};this.Wt.J(n),this.ft=!1}return this.Wt}}class nn{constructor(t){this.wn=new tn(t)}Uh(){return this.wn}}const sn={Ha:4,$a:1e-4};function en(s,t){const n=100*(s-t)/t;return t<0?-n:n}function rn(s,t){const n=en(s.Th(),t),Ae=en(s.Ph(),t);return new Ri(n,Ae)}function hn(s,t){const n=100*(s-t)/t+100;return t<0?-n:n}function ln(s,t){const n=hn(s.Th(),t),Ae=hn(s.Ph(),t);return new Ri(n,Ae)}function an(s,t){const n=Math.abs(s);if(n<1e-15)return 0;const Ae=Math.log10(n+t.$a)+t.Ha;return s<0?-Ae:Ae}function on$1(s,t){const n=Math.abs(s);if(n<1e-15)return 0;const Ae=Math.pow(10,n-t.Ha)-t.$a;return s<0?-Ae:Ae}function _n(s,t){if(s===null)return null;const n=an(s.Th(),t),Ae=an(s.Ph(),t);return new Ri(n,Ae)}function un(s,t){if(s===null)return null;const n=on$1(s.Th(),t),Ae=on$1(s.Ph(),t);return new Ri(n,Ae)}function cn(s){if(s===null)return sn;const t=Math.abs(s.Ph()-s.Th());if(t>=1||t<1e-15)return sn;const n=Math.ceil(Math.abs(Math.log10(t))),Ae=sn.Ha+n;return{Ha:Ae,$a:1/Math.pow(10,Ae)}}class dn{constructor(t,n){if(this.Ua=t,this.qa=n,function(Ae){if(Ae<0)return!1;for(let Ne=Ae;Ne>1;Ne/=10)if(Ne%10!=0)return!1;return!0}(this.Ua))this.Ya=[2,2.5,2];else{this.Ya=[];for(let Ae=this.Ua;Ae!==1;){if(Ae%2==0)this.Ya.push(2),Ae/=2;else{if(Ae%5!=0)throw new Error("unexpected base");this.Ya.push(2,2.5),Ae/=5}if(this.Ya.length>100)throw new Error("something wrong with base")}}}Za(t,n,Ae){const Ne=this.Ua===0?0:1/this.Ua;let tr=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-n)))),er=0,ir=this.qa[0];for(;;){const ar=yt(tr,Ne,1e-14)&&tr>Ne+1e-14,or=yt(tr,Ae*ir,1e-14),ur=yt(tr,1,1e-14);if(!(ar&&or&&ur))break;tr/=ir,ir=this.qa[++er%this.qa.length]}if(tr<=Ne+1e-14&&(tr=Ne),tr=Math.max(1,tr),this.Ya.length>0&&(sr=tr,rr=1,nr=1e-14,Math.abs(sr-rr)<nr))for(er=0,ir=this.Ya[0];yt(tr,Ae*ir,1e-14)&&tr>Ne+1e-14;)tr/=ir,ir=this.Ya[++er%this.Ya.length];var sr,rr,nr;return tr}}class fn{constructor(t,n,Ae,Ne){this.Xa=[],this.Li=t,this.Ua=n,this.Ka=Ae,this.Ga=Ne}Za(t,n){if(t<n)throw new Error("high < low");const Ae=this.Li.At(),Ne=(t-n)*this.Ja()/Ae,tr=new dn(this.Ua,[2,2.5,2]),er=new dn(this.Ua,[2,2,2.5]),ir=new dn(this.Ua,[2.5,2,2]),sr=[];return sr.push(tr.Za(t,n,Ne),er.Za(t,n,Ne),ir.Za(t,n,Ne)),function(rr){if(rr.length<1)throw Error("array is empty");let nr=rr[0];for(let ar=1;ar<rr.length;++ar)rr[ar]<nr&&(nr=rr[ar]);return nr}(sr)}Qa(){const t=this.Li,n=t.Ct();if(n===null)return void(this.Xa=[]);const Ae=t.At(),Ne=this.Ka(Ae-1,n),tr=this.Ka(0,n),er=this.Li.W().entireTextOnly?this.io()/2:0,ir=er,sr=Ae-1-er,rr=Math.max(Ne,tr),nr=Math.min(Ne,tr);if(rr===nr)return void(this.Xa=[]);let ar=this.Za(rr,nr),or=rr%ar;or+=or<0?ar:0;const ur=rr>=nr?1:-1;let hr=null,cr=0;for(let vr=rr-or;vr>nr;vr-=ar){const mr=this.Ga(vr,n,!0);hr!==null&&Math.abs(mr-hr)<this.Ja()||mr<ir||mr>sr||(cr<this.Xa.length?(this.Xa[cr].La=mr,this.Xa[cr].no=t.so(vr)):this.Xa.push({La:mr,no:t.so(vr)}),cr++,hr=mr,t.eo()&&(ar=this.Za(vr*ur,nr)))}this.Xa.length=cr}ja(){return this.Xa}io(){return this.Li.P()}Ja(){return Math.ceil(2.5*this.io())}}function vn(s){return s.slice().sort((t,n)=>b(t.Xi())-b(n.Xi()))}var pn;(function(s){s[s.Normal=0]="Normal",s[s.Logarithmic=1]="Logarithmic",s[s.Percentage=2]="Percentage",s[s.IndexedTo100=3]="IndexedTo100"})(pn||(pn={}));const mn=new vt,bn=new ft(100,1);class wn{constructor(t,n,Ae,Ne){this.ro=0,this.ho=null,this.Ah=null,this.lo=null,this.ao={oo:!1,_o:null},this.uo=0,this.co=0,this.do=new D,this.fo=new D,this.vo=[],this.po=null,this.mo=null,this.bo=null,this.wo=null,this.ba=bn,this.Mo=cn(null),this.xo=t,this.cn=n,this.So=Ae,this.ko=Ne,this.yo=new fn(this,100,this.Co.bind(this),this.To.bind(this))}Ta(){return this.xo}W(){return this.cn}Hh(t){if(V(this.cn,t),this.Pa(),t.mode!==void 0&&this.Po({yr:t.mode}),t.scaleMargins!==void 0){const n=m(t.scaleMargins.top),Ae=m(t.scaleMargins.bottom);if(n<0||n>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${n}`);if(Ae<0||Ae>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${Ae}`);if(n+Ae>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${n+Ae}`);this.Ro(),this.mo=null}}Do(){return this.cn.autoScale}eo(){return this.cn.mode===1}gh(){return this.cn.mode===2}Vo(){return this.cn.mode===3}yr(){return{Wn:this.cn.autoScale,Oo:this.cn.invertScale,yr:this.cn.mode}}Po(t){const n=this.yr();let Ae=null;t.Wn!==void 0&&(this.cn.autoScale=t.Wn),t.yr!==void 0&&(this.cn.mode=t.yr,t.yr!==2&&t.yr!==3||(this.cn.autoScale=!0),this.ao.oo=!1),n.yr===1&&t.yr!==n.yr&&(function(tr,er){if(tr===null)return!1;const ir=on$1(tr.Th(),er),sr=on$1(tr.Ph(),er);return isFinite(ir)&&isFinite(sr)}(this.Ah,this.Mo)?(Ae=un(this.Ah,this.Mo),Ae!==null&&this.Bo(Ae)):this.cn.autoScale=!0),t.yr===1&&t.yr!==n.yr&&(Ae=_n(this.Ah,this.Mo),Ae!==null&&this.Bo(Ae));const Ne=n.yr!==this.cn.mode;Ne&&(n.yr===2||this.gh())&&this.Pa(),Ne&&(n.yr===3||this.Vo())&&this.Pa(),t.Oo!==void 0&&n.Oo!==t.Oo&&(this.cn.invertScale=t.Oo,this.Ao()),this.fo.m(n,this.yr())}Io(){return this.fo}P(){return this.So.fontSize}At(){return this.ro}zo(t){this.ro!==t&&(this.ro=t,this.Ro(),this.mo=null)}Lo(){if(this.ho)return this.ho;const t=this.At()-this.Eo()-this.No();return this.ho=t,t}zh(){return this.Fo(),this.Ah}Bo(t,n){const Ae=this.Ah;(n||Ae===null&&t!==null||Ae!==null&&!Ae.yh(t))&&(this.mo=null,this.Ah=t)}Ni(){return this.Fo(),this.ro===0||!this.Ah||this.Ah.Ni()}Wo(t){return this.Oo()?t:this.At()-1-t}Rt(t,n){return this.gh()?t=en(t,n):this.Vo()&&(t=hn(t,n)),this.To(t,n)}Qs(t,n,Ae){this.Fo();const Ne=this.No(),tr=b(this.zh()),er=tr.Th(),ir=tr.Ph(),sr=this.Lo()-1,rr=this.Oo(),nr=sr/(ir-er),ar=Ae===void 0?0:Ae.from,or=Ae===void 0?t.length:Ae.to,ur=this.jo();for(let hr=ar;hr<or;hr++){const cr=t[hr],vr=cr._t;if(isNaN(vr))continue;let mr=vr;ur!==null&&(mr=ur(cr._t,n));const dr=Ne+nr*(mr-er),lr=rr?dr:this.ro-1-dr;cr.st=lr}}me(t,n,Ae){this.Fo();const Ne=this.No(),tr=b(this.zh()),er=tr.Th(),ir=tr.Ph(),sr=this.Lo()-1,rr=this.Oo(),nr=sr/(ir-er),ar=Ae===void 0?0:Ae.from,or=Ae===void 0?t.length:Ae.to,ur=this.jo();for(let hr=ar;hr<or;hr++){const cr=t[hr];let vr=cr.we,mr=cr.ge,dr=cr.Me,lr=cr.xe;ur!==null&&(vr=ur(cr.we,n),mr=ur(cr.ge,n),dr=ur(cr.Me,n),lr=ur(cr.xe,n));let gr=Ne+nr*(vr-er),fr=rr?gr:this.ro-1-gr;cr.ve=fr,gr=Ne+nr*(mr-er),fr=rr?gr:this.ro-1-gr,cr.ce=fr,gr=Ne+nr*(dr-er),fr=rr?gr:this.ro-1-gr,cr.de=fr,gr=Ne+nr*(lr-er),fr=rr?gr:this.ro-1-gr,cr.pe=fr}}pn(t,n){const Ae=this.Co(t,n);return this.Ho(Ae,n)}Ho(t,n){let Ae=t;return this.gh()?Ae=function(Ne,tr){return tr<0&&(Ne=-Ne),Ne/100*tr+tr}(Ae,n):this.Vo()&&(Ae=function(Ne,tr){return Ne-=100,tr<0&&(Ne=-Ne),Ne/100*tr+tr}(Ae,n)),Ae}Oa(){return this.vo}$o(){if(this.po)return this.po;let t=[];for(let n=0;n<this.vo.length;n++){const Ae=this.vo[n];Ae.Xi()===null&&Ae.Ki(n+1),t.push(Ae)}return t=vn(t),this.po=t,this.po}Uo(t){this.vo.indexOf(t)===-1&&(this.vo.push(t),this.Pa(),this.qo())}Yo(t){const n=this.vo.indexOf(t);if(n===-1)throw new Error("source is not attached to scale");this.vo.splice(n,1),this.vo.length===0&&(this.Po({Wn:!0}),this.Bo(null)),this.Pa(),this.qo()}Ct(){let t=null;for(const n of this.vo){const Ae=n.Ct();Ae!==null&&(t===null||Ae.ha<t.ha)&&(t=Ae)}return t===null?null:t.Vt}Oo(){return this.cn.invertScale}ja(){const t=this.Ct()===null;if(this.mo!==null&&(t||this.mo.Zo===t))return this.mo.ja;this.yo.Qa();const n=this.yo.ja();return this.mo={ja:n,Zo:t},this.do.m(),n}Xo(){return this.do}Ko(t){this.gh()||this.Vo()||this.bo===null&&this.lo===null&&(this.Ni()||(this.bo=this.ro-t,this.lo=b(this.zh()).Ch()))}Go(t){if(this.gh()||this.Vo()||this.bo===null)return;this.Po({Wn:!1}),(t=this.ro-t)<0&&(t=0);let n=(this.bo+.2*(this.ro-1))/(t+.2*(this.ro-1));const Ae=b(this.lo).Ch();n=Math.max(n,.1),Ae.Dh(n),this.Bo(Ae)}Jo(){this.gh()||this.Vo()||(this.bo=null,this.lo=null)}Qo(t){this.Do()||this.wo===null&&this.lo===null&&(this.Ni()||(this.wo=t,this.lo=b(this.zh()).Ch()))}t_(t){if(this.Do()||this.wo===null)return;const n=b(this.zh()).Rh()/(this.Lo()-1);let Ae=t-this.wo;this.Oo()&&(Ae*=-1);const Ne=Ae*n,tr=b(this.lo).Ch();tr.Vh(Ne),this.Bo(tr,!0),this.mo=null}i_(){this.Do()||this.wo!==null&&(this.wo=null,this.lo=null)}ma(){return this.ba||this.Pa(),this.ba}Fi(t,n){switch(this.cn.mode){case 2:return this.n_(en(t,n));case 3:return this.ma().format(hn(t,n));default:return this.Fh(t)}}so(t){switch(this.cn.mode){case 2:return this.n_(t);case 3:return this.ma().format(t);default:return this.Fh(t)}}ql(t){return this.Fh(t,b(this.s_()).ma())}Yl(t,n){return t=en(t,n),this.n_(t,mn)}e_(){return this.vo}r_(t){this.ao={_o:t,oo:!1}}Vn(){this.vo.forEach(t=>t.Vn())}Pa(){this.mo=null;const t=this.s_();let n=100;t!==null&&(n=Math.round(1/t.pa())),this.ba=bn,this.gh()?(this.ba=mn,n=100):this.Vo()?(this.ba=new ft(100,1),n=100):t!==null&&(this.ba=t.ma()),this.yo=new fn(this,n,this.Co.bind(this),this.To.bind(this)),this.yo.Qa()}qo(){this.po=null}s_(){return this.vo[0]||null}Eo(){return this.Oo()?this.cn.scaleMargins.bottom*this.At()+this.co:this.cn.scaleMargins.top*this.At()+this.uo}No(){return this.Oo()?this.cn.scaleMargins.top*this.At()+this.uo:this.cn.scaleMargins.bottom*this.At()+this.co}Fo(){this.ao.oo||(this.ao.oo=!0,this.h_())}Ro(){this.ho=null}To(t,n){if(this.Fo(),this.Ni())return 0;t=this.eo()&&t?an(t,this.Mo):t;const Ae=b(this.zh()),Ne=this.No()+(this.Lo()-1)*(t-Ae.Th())/Ae.Rh();return this.Wo(Ne)}Co(t,n){if(this.Fo(),this.Ni())return 0;const Ae=this.Wo(t),Ne=b(this.zh()),tr=Ne.Th()+Ne.Rh()*((Ae-this.No())/(this.Lo()-1));return this.eo()?on$1(tr,this.Mo):tr}Ao(){this.mo=null,this.yo.Qa()}h_(){const t=this.ao._o;if(t===null)return;let n=null;const Ae=this.e_();let Ne=0,tr=0;for(const sr of Ae){if(!sr.yt())continue;const rr=sr.Ct();if(rr===null)continue;const nr=sr.Al(t.Vs(),t.ui());let ar=nr&&nr.zh();if(ar!==null){switch(this.cn.mode){case 1:ar=_n(ar,this.Mo);break;case 2:ar=rn(ar,rr.Vt);break;case 3:ar=ln(ar,rr.Vt)}if(n=n===null?ar:n.ts(b(ar)),nr!==null){const or=nr.Lh();or!==null&&(Ne=Math.max(Ne,or.above),tr=Math.max(tr,or.below))}}}if(Ne===this.uo&&tr===this.co||(this.uo=Ne,this.co=tr,this.mo=null,this.Ro()),n!==null){if(n.Th()===n.Ph()){const sr=this.s_(),rr=5*(sr===null||this.gh()||this.Vo()?1:sr.pa());this.eo()&&(n=un(n,this.Mo)),n=new Ri(n.Th()-rr,n.Ph()+rr),this.eo()&&(n=_n(n,this.Mo))}if(this.eo()){const sr=un(n,this.Mo),rr=cn(sr);if(er=rr,ir=this.Mo,er.Ha!==ir.Ha||er.$a!==ir.$a){const nr=this.lo!==null?un(this.lo,this.Mo):null;this.Mo=rr,n=_n(sr,rr),nr!==null&&(this.lo=_n(nr,rr))}}this.Bo(n)}else this.Ah===null&&(this.Bo(new Ri(-.5,.5)),this.Mo=cn(null));var er,ir;this.ao.oo=!0}jo(){return this.gh()?en:this.Vo()?hn:this.eo()?t=>an(t,this.Mo):null}l_(t,n,Ae){return n===void 0?(Ae===void 0&&(Ae=this.ma()),Ae.format(t)):n(t)}Fh(t,n){return this.l_(t,this.ko.priceFormatter,n)}n_(t,n){return this.l_(t,this.ko.percentageFormatter,n)}}class gn{constructor(t,n){this.vo=[],this.a_=new Map,this.ro=0,this.o_=0,this.__=1e3,this.po=null,this.u_=new D,this.kl=t,this.$i=n,this.c_=new nn(this);const Ae=n.W();this.d_=this.f_("left",Ae.leftPriceScale),this.v_=this.f_("right",Ae.rightPriceScale),this.d_.Io().l(this.p_.bind(this,this.d_),this),this.v_.Io().l(this.p_.bind(this,this.v_),this),this.m_(Ae)}m_(t){if(t.leftPriceScale&&this.d_.Hh(t.leftPriceScale),t.rightPriceScale&&this.v_.Hh(t.rightPriceScale),t.localization&&(this.d_.Pa(),this.v_.Pa()),t.overlayPriceScales){const n=Array.from(this.a_.values());for(const Ae of n){const Ne=b(Ae[0].Dt());Ne.Hh(t.overlayPriceScales),t.localization&&Ne.Pa()}}}b_(t){switch(t){case"left":return this.d_;case"right":return this.v_}return this.a_.has(t)?m(this.a_.get(t))[0].Dt():null}S(){this.$t().w_().p(this),this.d_.Io().p(this),this.v_.Io().p(this),this.vo.forEach(t=>{t.S&&t.S()}),this.u_.m()}g_(){return this.__}M_(t){this.__=t}$t(){return this.$i}Hi(){return this.o_}At(){return this.ro}x_(t){this.o_=t,this.S_()}zo(t){this.ro=t,this.d_.zo(t),this.v_.zo(t),this.vo.forEach(n=>{if(this.dr(n)){const Ae=n.Dt();Ae!==null&&Ae.zo(t)}}),this.S_()}Oa(){return this.vo}dr(t){const n=t.Dt();return n===null||this.d_!==n&&this.v_!==n}Uo(t,n,Ae){const Ne=Ae!==void 0?Ae:this.y_().k_+1;this.C_(t,n,Ne)}Yo(t){const n=this.vo.indexOf(t);p$1(n!==-1,"removeDataSource: invalid data source"),this.vo.splice(n,1);const Ae=b(t.Dt()).Ta();if(this.a_.has(Ae)){const tr=m(this.a_.get(Ae)),er=tr.indexOf(t);er!==-1&&(tr.splice(er,1),tr.length===0&&this.a_.delete(Ae))}const Ne=t.Dt();Ne&&Ne.Oa().indexOf(t)>=0&&Ne.Yo(t),Ne!==null&&(Ne.qo(),this.T_(Ne)),this.po=null}pr(t){return t===this.d_?"left":t===this.v_?"right":"overlay"}P_(){return this.d_}R_(){return this.v_}D_(t,n){t.Ko(n)}V_(t,n){t.Go(n),this.S_()}O_(t){t.Jo()}B_(t,n){t.Qo(n)}A_(t,n){t.t_(n),this.S_()}I_(t){t.i_()}S_(){this.vo.forEach(t=>{t.Vn()})}vn(){let t=null;return this.$i.W().rightPriceScale.visible&&this.v_.Oa().length!==0?t=this.v_:this.$i.W().leftPriceScale.visible&&this.d_.Oa().length!==0?t=this.d_:this.vo.length!==0&&(t=this.vo[0].Dt()),t===null&&(t=this.v_),t}vr(){let t=null;return this.$i.W().rightPriceScale.visible?t=this.v_:this.$i.W().leftPriceScale.visible&&(t=this.d_),t}T_(t){t!==null&&t.Do()&&this.z_(t)}L_(t){const n=this.kl.Zs();t.Po({Wn:!0}),n!==null&&t.r_(n),this.S_()}E_(){this.z_(this.d_),this.z_(this.v_)}N_(){this.T_(this.d_),this.T_(this.v_),this.vo.forEach(t=>{this.dr(t)&&this.T_(t.Dt())}),this.S_(),this.$i.$h()}$o(){return this.po===null&&(this.po=vn(this.vo)),this.po}F_(){return this.u_}W_(){return this.c_}z_(t){const n=t.e_();if(n&&n.length>0&&!this.kl.Ni()){const Ae=this.kl.Zs();Ae!==null&&t.r_(Ae)}t.Vn()}y_(){const t=this.$o();if(t.length===0)return{j_:0,k_:0};let n=0,Ae=0;for(let Ne=0;Ne<t.length;Ne++){const tr=t[Ne].Xi();tr!==null&&(tr<n&&(n=tr),tr>Ae&&(Ae=tr))}return{j_:n,k_:Ae}}C_(t,n,Ae){let Ne=this.b_(n);if(Ne===null&&(Ne=this.f_(n,this.$i.W().overlayPriceScales)),this.vo.push(t),!_t(n)){const tr=this.a_.get(n)||[];tr.push(t),this.a_.set(n,tr)}Ne.Uo(t),t.Gi(Ne),t.Ki(Ae),this.T_(Ne),this.po=null}p_(t,n,Ae){n.yr!==Ae.yr&&this.z_(t)}f_(t,n){const Ae=Object.assign({visible:!0,autoScale:!0},z(n)),Ne=new wn(t,Ae,this.$i.W().layout,this.$i.W().localization);return Ne.zo(this.At()),Ne}}class Mn{constructor(t,n,Ae=50){this.Xe=0,this.Ke=1,this.Ge=1,this.Qe=new Map,this.Je=new Map,this.H_=t,this.U_=n,this.tr=Ae}q_(t){const n=t.time,Ae=this.U_.cacheKey(n),Ne=this.Qe.get(Ae);if(Ne!==void 0)return Ne.Y_;if(this.Xe===this.tr){const er=this.Je.get(this.Ge);this.Je.delete(this.Ge),this.Qe.delete(m(er)),this.Ge++,this.Xe--}const tr=this.H_(t);return this.Qe.set(Ae,{Y_:tr,er:this.Ke}),this.Je.set(this.Ke,Ae),this.Xe++,this.Ke++,tr}}class xn{constructor(t,n){p$1(t<=n,"right should be >= left"),this.Z_=t,this.X_=n}Vs(){return this.Z_}ui(){return this.X_}K_(){return this.X_-this.Z_+1}Xr(t){return this.Z_<=t&&t<=this.X_}yh(t){return this.Z_===t.Vs()&&this.X_===t.ui()}}function Sn(s,t){return s===null||t===null?s===t:s.yh(t)}class kn{constructor(){this.G_=new Map,this.Qe=null,this.J_=!1}Q_(t){this.J_=t,this.Qe=null}tu(t,n){this.iu(n),this.Qe=null;for(let Ae=n;Ae<t.length;++Ae){const Ne=t[Ae];let tr=this.G_.get(Ne.timeWeight);tr===void 0&&(tr=[],this.G_.set(Ne.timeWeight,tr)),tr.push({index:Ae,time:Ne.time,weight:Ne.timeWeight,originalTime:Ne.originalTime})}}nu(t,n){const Ae=Math.ceil(n/t);return this.Qe!==null&&this.Qe.su===Ae||(this.Qe={ja:this.eu(Ae),su:Ae}),this.Qe.ja}iu(t){if(t===0)return void this.G_.clear();const n=[];this.G_.forEach((Ae,Ne)=>{t<=Ae[0].index?n.push(Ne):Ae.splice(Bt(Ae,t,tr=>tr.index<t),1/0)});for(const Ae of n)this.G_.delete(Ae)}eu(t){let n=[];for(const Ae of Array.from(this.G_.keys()).sort((Ne,tr)=>tr-Ne)){if(!this.G_.get(Ae))continue;const Ne=n;n=[];const tr=Ne.length;let er=0;const ir=m(this.G_.get(Ae)),sr=ir.length;let rr=1/0,nr=-1/0;for(let ar=0;ar<sr;ar++){const or=ir[ar],ur=or.index;for(;er<tr;){const hr=Ne[er],cr=hr.index;if(!(cr<ur)){rr=cr;break}er++,n.push(hr),nr=cr,rr=1/0}if(rr-ur>=t&&ur-nr>=t)n.push(or),nr=ur;else if(this.J_)return Ne}for(;er<tr;er++)n.push(Ne[er])}return n}}class yn{constructor(t){this.ru=t}hu(){return this.ru===null?null:new xn(Math.floor(this.ru.Vs()),Math.ceil(this.ru.ui()))}lu(){return this.ru}static au(){return new yn(null)}}function Cn(s,t){return s.weight>t.weight?s:t}class Tn{constructor(t,n,Ae,Ne){this.o_=0,this.ou=null,this._u=[],this.wo=null,this.bo=null,this.uu=new kn,this.cu=new Map,this.du=yn.au(),this.fu=!0,this.vu=new D,this.pu=new D,this.mu=new D,this.bu=null,this.wu=null,this.gu=[],this.cn=n,this.ko=Ae,this.Mu=n.rightOffset,this.xu=n.barSpacing,this.$i=t,this.U_=Ne,this.Su(),this.uu.Q_(n.uniformDistribution)}W(){return this.cn}ku(t){V(this.ko,t),this.yu(),this.Su()}Hh(t,n){var Ae;V(this.cn,t),this.cn.fixLeftEdge&&this.Cu(),this.cn.fixRightEdge&&this.Tu(),t.barSpacing!==void 0&&this.$i.Gn(t.barSpacing),t.rightOffset!==void 0&&this.$i.Jn(t.rightOffset),t.minBarSpacing!==void 0&&this.$i.Gn((Ae=t.barSpacing)!==null&&Ae!==void 0?Ae:this.xu),this.yu(),this.Su(),this.mu.m()}mn(t){var n,Ae;return(Ae=(n=this._u[t])===null||n===void 0?void 0:n.time)!==null&&Ae!==void 0?Ae:null}Ui(t){var n;return(n=this._u[t])!==null&&n!==void 0?n:null}Da(t,n){if(this._u.length<1)return null;if(this.U_.key(t)>this.U_.key(this._u[this._u.length-1].time))return n?this._u.length-1:null;const Ae=Bt(this._u,this.U_.key(t),(Ne,tr)=>this.U_.key(Ne.time)<tr);return this.U_.key(t)<this.U_.key(this._u[Ae].time)?n?Ae:null:Ae}Ni(){return this.o_===0||this._u.length===0||this.ou===null}Ra(){return this._u.length>0}Zs(){return this.Pu(),this.du.hu()}Ru(){return this.Pu(),this.du.lu()}Du(){const t=this.Zs();if(t===null)return null;const n={from:t.Vs(),to:t.ui()};return this.Vu(n)}Vu(t){const n=Math.round(t.from),Ae=Math.round(t.to),Ne=b(this.Ou()),tr=b(this.Bu());return{from:b(this.Ui(Math.max(Ne,n))),to:b(this.Ui(Math.min(tr,Ae)))}}Au(t){return{from:b(this.Da(t.from,!0)),to:b(this.Da(t.to,!0))}}Hi(){return this.o_}x_(t){if(!isFinite(t)||t<=0||this.o_===t)return;const n=this.Ru(),Ae=this.o_;if(this.o_=t,this.fu=!0,this.cn.lockVisibleTimeRangeOnResize&&Ae!==0){const Ne=this.xu*t/Ae;this.xu=Ne}if(this.cn.fixLeftEdge&&n!==null&&n.Vs()<=0){const Ne=Ae-t;this.Mu-=Math.round(Ne/this.xu)+1,this.fu=!0}this.Iu(),this.zu()}It(t){if(this.Ni()||!B(t))return 0;const n=this.Lu()+this.Mu-t;return this.o_-(n+.5)*this.xu-1}Js(t,n){const Ae=this.Lu(),Ne=n===void 0?0:n.from,tr=n===void 0?t.length:n.to;for(let er=Ne;er<tr;er++){const ir=t[er].ot,sr=Ae+this.Mu-ir,rr=this.o_-(sr+.5)*this.xu-1;t[er].nt=rr}}Eu(t){return Math.ceil(this.Nu(t))}Jn(t){this.fu=!0,this.Mu=t,this.zu(),this.$i.Fu(),this.$i.$h()}he(){return this.xu}Gn(t){this.Wu(t),this.zu(),this.$i.Fu(),this.$i.$h()}ju(){return this.Mu}ja(){if(this.Ni())return null;if(this.wu!==null)return this.wu;const t=this.xu,n=5*(this.$i.W().layout.fontSize+4)/8*(this.cn.tickMarkMaxCharacterLength||8),Ae=Math.round(n/t),Ne=b(this.Zs()),tr=Math.max(Ne.Vs(),Ne.Vs()-Ae),er=Math.max(Ne.ui(),Ne.ui()-Ae),ir=this.uu.nu(t,n),sr=this.Ou()+Ae,rr=this.Bu()-Ae,nr=this.Hu(),ar=this.cn.fixLeftEdge||nr,or=this.cn.fixRightEdge||nr;let ur=0;for(const hr of ir){if(!(tr<=hr.index&&hr.index<=er))continue;let cr;ur<this.gu.length?(cr=this.gu[ur],cr.coord=this.It(hr.index),cr.label=this.$u(hr),cr.weight=hr.weight):(cr={needAlignCoordinate:!1,coord:this.It(hr.index),label:this.$u(hr),weight:hr.weight},this.gu.push(cr)),this.xu>n/2&&!nr?cr.needAlignCoordinate=!1:cr.needAlignCoordinate=ar&&hr.index<=sr||or&&hr.index>=rr,ur++}return this.gu.length=ur,this.wu=this.gu,this.gu}Uu(){this.fu=!0,this.Gn(this.cn.barSpacing),this.Jn(this.cn.rightOffset)}qu(t){this.fu=!0,this.ou=t,this.zu(),this.Cu()}Yu(t,n){const Ae=this.Nu(t),Ne=this.he(),tr=Ne+n*(Ne/10);this.Gn(tr),this.cn.rightBarStaysOnScroll||this.Jn(this.ju()+(Ae-this.Nu(t)))}Ko(t){this.wo&&this.i_(),this.bo===null&&this.bu===null&&(this.Ni()||(this.bo=t,this.Zu()))}Go(t){if(this.bu===null)return;const n=kt(this.o_-t,0,this.o_),Ae=kt(this.o_-b(this.bo),0,this.o_);n!==0&&Ae!==0&&this.Gn(this.bu.he*n/Ae)}Jo(){this.bo!==null&&(this.bo=null,this.Xu())}Qo(t){this.wo===null&&this.bu===null&&(this.Ni()||(this.wo=t,this.Zu()))}t_(t){if(this.wo===null)return;const n=(this.wo-t)/this.he();this.Mu=b(this.bu).ju+n,this.fu=!0,this.zu()}i_(){this.wo!==null&&(this.wo=null,this.Xu())}Ku(){this.Gu(this.cn.rightOffset)}Gu(t,n=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(n)||n<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const Ae=this.Mu,Ne=performance.now();this.$i.Zn({Ju:tr=>(tr-Ne)/n>=1,Qu:tr=>{const er=(tr-Ne)/n;return er>=1?t:Ae+(t-Ae)*er}})}bt(t,n){this.fu=!0,this._u=t,this.uu.tu(t,n),this.zu()}tc(){return this.vu}nc(){return this.pu}sc(){return this.mu}Lu(){return this.ou||0}ec(t){const n=t.K_();this.Wu(this.o_/n),this.Mu=t.ui()-this.Lu(),this.zu(),this.fu=!0,this.$i.Fu(),this.$i.$h()}rc(){const t=this.Ou(),n=this.Bu();t!==null&&n!==null&&this.ec(new xn(t,n+this.cn.rightOffset))}hc(t){const n=new xn(t.from,t.to);this.ec(n)}qi(t){return this.ko.timeFormatter!==void 0?this.ko.timeFormatter(t.originalTime):this.U_.formatHorzItem(t.time)}Hu(){const{handleScroll:t,handleScale:n}=this.$i.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||n.axisDoubleClickReset.time||n.axisPressedMouseMove.time||n.mouseWheel||n.pinch)}Ou(){return this._u.length===0?null:0}Bu(){return this._u.length===0?null:this._u.length-1}lc(t){return(this.o_-1-t)/this.xu}Nu(t){const n=this.lc(t),Ae=this.Lu()+this.Mu-n;return Math.round(1e6*Ae)/1e6}Wu(t){const n=this.xu;this.xu=t,this.Iu(),n!==this.xu&&(this.fu=!0,this.ac())}Pu(){if(!this.fu)return;if(this.fu=!1,this.Ni())return void this.oc(yn.au());const t=this.Lu(),n=this.o_/this.xu,Ae=this.Mu+t,Ne=new xn(Ae-n+1,Ae);this.oc(new yn(Ne))}Iu(){const t=this._c();if(this.xu<t&&(this.xu=t,this.fu=!0),this.o_!==0){const n=.5*this.o_;this.xu>n&&(this.xu=n,this.fu=!0)}}_c(){return this.cn.fixLeftEdge&&this.cn.fixRightEdge&&this._u.length!==0?this.o_/this._u.length:this.cn.minBarSpacing}zu(){const t=this.uc();this.Mu>t&&(this.Mu=t,this.fu=!0);const n=this.cc();n!==null&&this.Mu<n&&(this.Mu=n,this.fu=!0)}cc(){const t=this.Ou(),n=this.ou;return t===null||n===null?null:t-n-1+(this.cn.fixLeftEdge?this.o_/this.xu:Math.min(2,this._u.length))}uc(){return this.cn.fixRightEdge?0:this.o_/this.xu-Math.min(2,this._u.length)}Zu(){this.bu={he:this.he(),ju:this.ju()}}Xu(){this.bu=null}$u(t){let n=this.cu.get(t.weight);return n===void 0&&(n=new Mn(Ae=>this.dc(Ae),this.U_),this.cu.set(t.weight,n)),n.q_(t)}dc(t){return this.U_.formatTickmark(t,this.ko)}oc(t){const n=this.du;this.du=t,Sn(n.hu(),this.du.hu())||this.vu.m(),Sn(n.lu(),this.du.lu())||this.pu.m(),this.ac()}ac(){this.wu=null}yu(){this.ac(),this.cu.clear()}Su(){this.U_.updateFormatter(this.ko)}Cu(){if(!this.cn.fixLeftEdge)return;const t=this.Ou();if(t===null)return;const n=this.Zs();if(n===null)return;const Ae=n.Vs()-t;if(Ae<0){const Ne=this.Mu-Ae-1;this.Jn(Ne)}this.Iu()}Tu(){this.zu(),this.Iu()}}class Pn{X(t,n,Ae){t.useMediaCoordinateSpace(Ne=>this.K(Ne,n,Ae))}wl(t,n,Ae){t.useMediaCoordinateSpace(Ne=>this.fc(Ne,n,Ae))}fc(t,n,Ae){}}class Rn extends Pn{constructor(t){super(),this.vc=new Map,this.zt=t}K(t){}fc(t){if(!this.zt.yt)return;const{context:n,mediaSize:Ae}=t;let Ne=0;for(const er of this.zt.mc){if(er.Kt.length===0)continue;n.font=er.R;const ir=this.bc(n,er.Kt);ir>Ae.width?er.Yu=Ae.width/ir:er.Yu=1,Ne+=er.wc*er.Yu}let tr=0;switch(this.zt.gc){case"top":tr=0;break;case"center":tr=Math.max((Ae.height-Ne)/2,0);break;case"bottom":tr=Math.max(Ae.height-Ne,0)}n.fillStyle=this.zt.V;for(const er of this.zt.mc){n.save();let ir=0;switch(this.zt.Mc){case"left":n.textAlign="left",ir=er.wc/2;break;case"center":n.textAlign="center",ir=Ae.width/2;break;case"right":n.textAlign="right",ir=Ae.width-1-er.wc/2}n.translate(ir,tr),n.textBaseline="top",n.font=er.R,n.scale(er.Yu,er.Yu),n.fillText(er.Kt,0,er.xc),n.restore(),tr+=er.wc*er.Yu}}bc(t,n){const Ae=this.Sc(t.font);let Ne=Ae.get(n);return Ne===void 0&&(Ne=t.measureText(n).width,Ae.set(n,Ne)),Ne}Sc(t){let n=this.vc.get(t);return n===void 0&&(n=new Map,this.vc.set(t,n)),n}}class Dn{constructor(t){this.ft=!0,this.Ft={yt:!1,V:"",mc:[],gc:"center",Mc:"center"},this.Wt=new Rn(this.Ft),this.jt=t}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){const t=this.jt.W(),n=this.Ft;n.yt=t.visible,n.yt&&(n.V=t.color,n.Mc=t.horzAlign,n.gc=t.vertAlign,n.mc=[{Kt:t.text,R:F(t.fontSize,t.fontFamily,t.fontStyle),wc:1.2*t.fontSize,xc:0,Yu:0}])}}class Vn extends lt{constructor(t,n){super(),this.cn=n,this.wn=new Dn(this)}Rn(){return[]}Pn(){return[this.wn]}W(){return this.cn}Vn(){this.wn.bt()}}var On,Bn,An,In,zn;(function(s){s[s.OnTouchEnd=0]="OnTouchEnd",s[s.OnNextTap=1]="OnNextTap"})(On||(On={}));class Ln{constructor(t,n,Ae){this.kc=[],this.yc=[],this.o_=0,this.Cc=null,this.Tc=new D,this.Pc=new D,this.Rc=null,this.Dc=t,this.cn=n,this.U_=Ae,this.Vc=new W(this),this.kl=new Tn(this,n.timeScale,this.cn.localization,Ae),this.vt=new ot(this,n.crosshair),this.Oc=new Ji(n.crosshair),this.Bc=new Vn(this,n.watermark),this.Ac(),this.kc[0].M_(2e3),this.Ic=this.zc(0),this.Lc=this.zc(1)}Xl(){this.Ec(ut.es())}$h(){this.Ec(ut.ss())}aa(){this.Ec(new ut(1))}Kl(t){const n=this.Nc(t);this.Ec(n)}Fc(){return this.Cc}Wc(t){const n=this.Cc;this.Cc=t,n!==null&&this.Kl(n.jc),t!==null&&this.Kl(t.jc)}W(){return this.cn}Hh(t){V(this.cn,t),this.kc.forEach(n=>n.m_(t)),t.timeScale!==void 0&&this.kl.Hh(t.timeScale),t.localization!==void 0&&this.kl.ku(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Tc.m(),this.Ic=this.zc(0),this.Lc=this.zc(1),this.Xl()}Hc(t,n){if(t==="left")return void this.Hh({leftPriceScale:n});if(t==="right")return void this.Hh({rightPriceScale:n});const Ae=this.$c(t);Ae!==null&&(Ae.Dt.Hh(n),this.Tc.m())}$c(t){for(const n of this.kc){const Ae=n.b_(t);if(Ae!==null)return{Ht:n,Dt:Ae}}return null}St(){return this.kl}Uc(){return this.kc}qc(){return this.Bc}Yc(){return this.vt}Zc(){return this.Pc}Xc(t,n){t.zo(n),this.Fu()}x_(t){this.o_=t,this.kl.x_(this.o_),this.kc.forEach(n=>n.x_(t)),this.Fu()}Ac(t){const n=new gn(this.kl,this);t!==void 0?this.kc.splice(t,0,n):this.kc.push(n);const Ae=t===void 0?this.kc.length-1:t,Ne=ut.es();return Ne.Nn(Ae,{Fn:0,Wn:!0}),this.Ec(Ne),n}D_(t,n,Ae){t.D_(n,Ae)}V_(t,n,Ae){t.V_(n,Ae),this.Gl(),this.Ec(this.Kc(t,2))}O_(t,n){t.O_(n),this.Ec(this.Kc(t,2))}B_(t,n,Ae){n.Do()||t.B_(n,Ae)}A_(t,n,Ae){n.Do()||(t.A_(n,Ae),this.Gl(),this.Ec(this.Kc(t,2)))}I_(t,n){n.Do()||(t.I_(n),this.Ec(this.Kc(t,2)))}L_(t,n){t.L_(n),this.Ec(this.Kc(t,2))}Gc(t){this.kl.Ko(t)}Jc(t,n){const Ae=this.St();if(Ae.Ni()||n===0)return;const Ne=Ae.Hi();t=Math.max(1,Math.min(t,Ne)),Ae.Yu(t,n),this.Fu()}Qc(t){this.td(0),this.nd(t),this.sd()}ed(t){this.kl.Go(t),this.Fu()}rd(){this.kl.Jo(),this.$h()}td(t){this.kl.Qo(t)}nd(t){this.kl.t_(t),this.Fu()}sd(){this.kl.i_(),this.$h()}wt(){return this.yc}hd(t,n,Ae,Ne,tr){this.vt.gn(t,n);let er=NaN,ir=this.kl.Eu(t);const sr=this.kl.Zs();sr!==null&&(ir=Math.min(Math.max(sr.Vs(),ir),sr.ui()));const rr=Ne.vn(),nr=rr.Ct();nr!==null&&(er=rr.pn(n,nr)),er=this.Oc.Va(er,ir,Ne),this.vt.kn(ir,er,Ne),this.aa(),tr||this.Pc.m(this.vt.xt(),{x:t,y:n},Ae)}ld(t,n,Ae){const Ne=Ae.vn(),tr=Ne.Ct(),er=Ne.Rt(t,b(tr)),ir=this.kl.Da(n,!0),sr=this.kl.It(b(ir));this.hd(sr,er,null,Ae,!0)}ad(t){this.Yc().Cn(),this.aa(),t||this.Pc.m(null,null,null)}Gl(){const t=this.vt.Ht();if(t!==null){const n=this.vt.xn(),Ae=this.vt.Sn();this.hd(n,Ae,null,t)}this.vt.Vn()}od(t,n,Ae){const Ne=this.kl.mn(0);n!==void 0&&Ae!==void 0&&this.kl.bt(n,Ae);const tr=this.kl.mn(0),er=this.kl.Lu(),ir=this.kl.Zs();if(ir!==null&&Ne!==null&&tr!==null){const sr=ir.Xr(er),rr=this.U_.key(Ne)>this.U_.key(tr),nr=t!==null&&t>er&&!rr,ar=this.kl.W().allowShiftVisibleRangeOnWhitespaceReplacement,or=sr&&(Ae!==void 0||ar)&&this.kl.W().shiftVisibleRangeOnNewBar;if(nr&&!or){const ur=t-er;this.kl.Jn(this.kl.ju()-ur)}}this.kl.qu(t)}ta(t){t!==null&&t.N_()}cr(t){const n=this.kc.find(Ae=>Ae.$o().includes(t));return n===void 0?null:n}Fu(){this.Bc.Vn(),this.kc.forEach(t=>t.N_()),this.Gl()}S(){this.kc.forEach(t=>t.S()),this.kc.length=0,this.cn.localization.priceFormatter=void 0,this.cn.localization.percentageFormatter=void 0,this.cn.localization.timeFormatter=void 0}_d(){return this.Vc}mr(){return this.Vc.W()}w_(){return this.Tc}ud(t,n,Ae){const Ne=this.kc[0],tr=this.dd(n,t,Ne,Ae);return this.yc.push(tr),this.yc.length===1?this.Xl():this.$h(),tr}fd(t){const n=this.cr(t),Ae=this.yc.indexOf(t);p$1(Ae!==-1,"Series not found"),this.yc.splice(Ae,1),b(n).Yo(t),t.S&&t.S()}Zl(t,n){const Ae=b(this.cr(t));Ae.Yo(t);const Ne=this.$c(n);if(Ne===null){const tr=t.Xi();Ae.Uo(t,n,tr)}else{const tr=Ne.Ht===Ae?t.Xi():void 0;Ne.Ht.Uo(t,n,tr)}}rc(){const t=ut.ss();t.$n(),this.Ec(t)}vd(t){const n=ut.ss();n.Yn(t),this.Ec(n)}Kn(){const t=ut.ss();t.Kn(),this.Ec(t)}Gn(t){const n=ut.ss();n.Gn(t),this.Ec(n)}Jn(t){const n=ut.ss();n.Jn(t),this.Ec(n)}Zn(t){const n=ut.ss();n.Zn(t),this.Ec(n)}Un(){const t=ut.ss();t.Un(),this.Ec(t)}pd(){return this.cn.rightPriceScale.visible?"right":"left"}md(){return this.Lc}q(){return this.Ic}Bt(t){const n=this.Lc,Ae=this.Ic;if(n===Ae)return n;if(t=Math.max(0,Math.min(100,Math.round(100*t))),this.Rc===null||this.Rc.Ts!==Ae||this.Rc.Ps!==n)this.Rc={Ts:Ae,Ps:n,bd:new Map};else{const tr=this.Rc.bd.get(t);if(tr!==void 0)return tr}const Ne=function(tr,er,ir){const[sr,rr,nr,ar]=T(tr),[or,ur,hr,cr]=T(er),vr=[M(sr+ir*(or-sr)),M(rr+ir*(ur-rr)),M(nr+ir*(hr-nr)),x(ar+ir*(cr-ar))];return`rgba(${vr[0]}, ${vr[1]}, ${vr[2]}, ${vr[3]})`}(Ae,n,t/100);return this.Rc.bd.set(t,Ne),Ne}Kc(t,n){const Ae=new ut(n);if(t!==null){const Ne=this.kc.indexOf(t);Ae.Nn(Ne,{Fn:n})}return Ae}Nc(t,n){return n===void 0&&(n=2),this.Kc(this.cr(t),n)}Ec(t){this.Dc&&this.Dc(t),this.kc.forEach(n=>n.W_().Uh().bt())}dd(t,n,Ae,Ne){const tr=new Gi(this,t,n,Ae,Ne),er=t.priceScaleId!==void 0?t.priceScaleId:this.pd();return Ae.Uo(tr,er),_t(er)||tr.Hh(t),tr}zc(t){const n=this.cn.layout;return n.background.type==="gradient"?t===0?n.background.topColor:n.background.bottomColor:n.background.color}}function En(s){return!O(s)&&!A(s)}function Nn(s){return O(s)}(function(s){s[s.Disabled=0]="Disabled",s[s.Continuous=1]="Continuous",s[s.OnDataUpdate=2]="OnDataUpdate"})(Bn||(Bn={})),function(s){s[s.LastBar=0]="LastBar",s[s.LastVisible=1]="LastVisible"}(An||(An={})),function(s){s.Solid="solid",s.VerticalGradient="gradient"}(In||(In={})),function(s){s[s.Year=0]="Year",s[s.Month=1]="Month",s[s.DayOfMonth=2]="DayOfMonth",s[s.Time=3]="Time",s[s.TimeWithSeconds=4]="TimeWithSeconds"}(zn||(zn={}));const Fn=s=>s.getUTCFullYear();function Wn(s,t,n){return t.replace(/yyyy/g,(Ae=>dt(Fn(Ae),4))(s)).replace(/yy/g,(Ae=>dt(Fn(Ae)%100,2))(s)).replace(/MMMM/g,((Ae,Ne)=>new Date(Ae.getUTCFullYear(),Ae.getUTCMonth(),1).toLocaleString(Ne,{month:"long"}))(s,n)).replace(/MMM/g,((Ae,Ne)=>new Date(Ae.getUTCFullYear(),Ae.getUTCMonth(),1).toLocaleString(Ne,{month:"short"}))(s,n)).replace(/MM/g,(Ae=>dt((Ne=>Ne.getUTCMonth()+1)(Ae),2))(s)).replace(/dd/g,(Ae=>dt((Ne=>Ne.getUTCDate())(Ae),2))(s))}class jn{constructor(t="yyyy-MM-dd",n="default"){this.wd=t,this.gd=n}q_(t){return Wn(t,this.wd,this.gd)}}class Hn{constructor(t){this.Md=t||"%h:%m:%s"}q_(t){return this.Md.replace("%h",dt(t.getUTCHours(),2)).replace("%m",dt(t.getUTCMinutes(),2)).replace("%s",dt(t.getUTCSeconds(),2))}}const $n={xd:"yyyy-MM-dd",Sd:"%h:%m:%s",kd:" ",yd:"default"};class Un{constructor(t={}){const n=Object.assign(Object.assign({},$n),t);this.Cd=new jn(n.xd,n.yd),this.Td=new Hn(n.Sd),this.Pd=n.kd}q_(t){return`${this.Cd.q_(t)}${this.Pd}${this.Td.q_(t)}`}}function qn(s){return 60*s*60*1e3}function Yn(s){return 60*s*1e3}const Zn=[{Rd:(Xn=1,1e3*Xn),Dd:10},{Rd:Yn(1),Dd:20},{Rd:Yn(5),Dd:21},{Rd:Yn(30),Dd:22},{Rd:qn(1),Dd:30},{Rd:qn(3),Dd:31},{Rd:qn(6),Dd:32},{Rd:qn(12),Dd:33}];var Xn;function Kn(s,t){if(s.getUTCFullYear()!==t.getUTCFullYear())return 70;if(s.getUTCMonth()!==t.getUTCMonth())return 60;if(s.getUTCDate()!==t.getUTCDate())return 50;for(let n=Zn.length-1;n>=0;--n)if(Math.floor(t.getTime()/Zn[n].Rd)!==Math.floor(s.getTime()/Zn[n].Rd))return Zn[n].Dd;return 0}function Gn(s){let t=s;if(A(s)&&(t=Qn(s)),!En(t))throw new Error("time must be of type BusinessDay");const n=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{Vd:Math.round(n.getTime()/1e3),Od:t}}function Jn(s){if(!Nn(s))throw new Error("time must be of type isUTCTimestamp");return{Vd:s}}function Qn(s){const t=new Date(s);if(isNaN(t.getTime()))throw new Error(`Invalid date string=${s}, expected format=yyyy-mm-dd`);return{day:t.getUTCDate(),month:t.getUTCMonth()+1,year:t.getUTCFullYear()}}function ts(s){A(s.time)&&(s.time=Qn(s.time))}class is{options(){return this.cn}setOptions(t){this.cn=t,this.updateFormatter(t.localization)}preprocessData(t){Array.isArray(t)?function(n){n.forEach(ts)}(t):ts(t)}createConverterToInternalObj(t){return b(function(n){return n.length===0?null:En(n[0].time)||A(n[0].time)?Gn:Jn}(t))}key(t){return typeof t=="object"&&"Vd"in t?t.Vd:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){const n=t;return n.Od===void 0?new Date(1e3*n.Vd).getTime():new Date(Date.UTC(n.Od.year,n.Od.month-1,n.Od.day)).getTime()}convertHorzItemToInternal(t){return Nn(n=t)?Jn(n):En(n)?Gn(n):Gn(Qn(n));var n}updateFormatter(t){if(!this.cn)return;const n=t.dateFormat;this.cn.timeScale.timeVisible?this.Bd=new Un({xd:n,Sd:this.cn.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",kd:"   ",yd:t.locale}):this.Bd=new jn(n,t.locale)}formatHorzItem(t){const n=t;return this.Bd.q_(new Date(1e3*n.Vd))}formatTickmark(t,n){const Ae=function(tr,er,ir){switch(tr){case 0:case 10:return er?ir?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return er?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.weight,this.cn.timeScale.timeVisible,this.cn.timeScale.secondsVisible),Ne=this.cn.timeScale;if(Ne.tickMarkFormatter!==void 0){const tr=Ne.tickMarkFormatter(t.originalTime,Ae,n.locale);if(tr!==null)return tr}return function(tr,er,ir){const sr={};switch(er){case 0:sr.year="numeric";break;case 1:sr.month="short";break;case 2:sr.day="numeric";break;case 3:sr.hour12=!1,sr.hour="2-digit",sr.minute="2-digit";break;case 4:sr.hour12=!1,sr.hour="2-digit",sr.minute="2-digit",sr.second="2-digit"}const rr=tr.Od===void 0?new Date(1e3*tr.Vd):new Date(Date.UTC(tr.Od.year,tr.Od.month-1,tr.Od.day));return new Date(rr.getUTCFullYear(),rr.getUTCMonth(),rr.getUTCDate(),rr.getUTCHours(),rr.getUTCMinutes(),rr.getUTCSeconds(),rr.getUTCMilliseconds()).toLocaleString(ir,sr)}(t.time,Ae,n.locale)}maxTickMarkWeight(t){let n=t.reduce(Cn,t[0]).weight;return n>30&&n<50&&(n=30),n}fillWeightsForPoints(t,n){(function(Ae,Ne=0){if(Ae.length===0)return;let tr=Ne===0?null:Ae[Ne-1].time.Vd,er=tr!==null?new Date(1e3*tr):null,ir=0;for(let sr=Ne;sr<Ae.length;++sr){const rr=Ae[sr],nr=new Date(1e3*rr.time.Vd);er!==null&&(rr.timeWeight=Kn(nr,er)),ir+=rr.time.Vd-(tr||rr.time.Vd),tr=rr.time.Vd,er=nr}if(Ne===0&&Ae.length>1){const sr=Math.ceil(ir/(Ae.length-1)),rr=new Date(1e3*(Ae[0].time.Vd-sr));Ae[0].timeWeight=Kn(new Date(1e3*Ae[0].time.Vd),rr)}})(t,n)}static Ad(t){return V({localization:{dateFormat:"dd MMM 'yy"}},t??{})}}const ns=typeof window<"u";function ss(){return!!ns&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function es(){return!!ns&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function rs(s){return s+s%2}function hs(s,t){return s.Id-t.Id}function ls(s,t,n){const Ae=(s.Id-t.Id)/(s.ot-t.ot);return Math.sign(Ae)*Math.min(Math.abs(Ae),n)}class as{constructor(t,n,Ae,Ne){this.zd=null,this.Ld=null,this.Ed=null,this.Nd=null,this.Fd=null,this.Wd=0,this.jd=0,this.Hd=t,this.$d=n,this.Ud=Ae,this.rs=Ne}qd(t,n){if(this.zd!==null){if(this.zd.ot===n)return void(this.zd.Id=t);if(Math.abs(this.zd.Id-t)<this.rs)return}this.Nd=this.Ed,this.Ed=this.Ld,this.Ld=this.zd,this.zd={ot:n,Id:t}}Dr(t,n){if(this.zd===null||this.Ld===null||n-this.zd.ot>50)return;let Ae=0;const Ne=ls(this.zd,this.Ld,this.$d),tr=hs(this.zd,this.Ld),er=[Ne],ir=[tr];if(Ae+=tr,this.Ed!==null){const rr=ls(this.Ld,this.Ed,this.$d);if(Math.sign(rr)===Math.sign(Ne)){const nr=hs(this.Ld,this.Ed);if(er.push(rr),ir.push(nr),Ae+=nr,this.Nd!==null){const ar=ls(this.Ed,this.Nd,this.$d);if(Math.sign(ar)===Math.sign(Ne)){const or=hs(this.Ed,this.Nd);er.push(ar),ir.push(or),Ae+=or}}}}let sr=0;for(let rr=0;rr<er.length;++rr)sr+=ir[rr]/Ae*er[rr];Math.abs(sr)<this.Hd||(this.Fd={Id:t,ot:n},this.jd=sr,this.Wd=function(rr,nr){const ar=Math.log(nr);return Math.log(1*ar/-rr)/ar}(Math.abs(sr),this.Ud))}Qu(t){const n=b(this.Fd),Ae=t-n.ot;return n.Id+this.jd*(Math.pow(this.Ud,Ae)-1)/Math.log(this.Ud)}Ju(t){return this.Fd===null||this.Yd(t)===this.Wd}Yd(t){const n=t-b(this.Fd).ot;return Math.min(n,this.Wd)}}class os{constructor(t,n){this.Zd=void 0,this.Xd=void 0,this.Kd=void 0,this.en=!1,this.Gd=t,this.Jd=n,this.Qd()}bt(){this.Qd()}tf(){this.Zd&&this.Gd.removeChild(this.Zd),this.Xd&&this.Gd.removeChild(this.Xd),this.Zd=void 0,this.Xd=void 0}if(){return this.en!==this.nf()||this.Kd!==this.sf()}sf(){return P(T(this.Jd.W().layout.textColor))>160?"dark":"light"}nf(){return this.Jd.W().layout.attributionLogo}ef(){const t=new URL(location.href);return t.hostname?"&utm_source="+t.hostname+t.pathname:""}Qd(){this.if()&&(this.tf(),this.en=this.nf(),this.en&&(this.Kd=this.sf(),this.Xd=document.createElement("style"),this.Xd.innerText="a#tv-attr-logo{--fill:#131722;--stroke:#fff;position:absolute;left:10px;bottom:10px;height:19px;width:35px;margin:0;padding:0;border:0;z-index:3;}a#tv-attr-logo[data-dark]{--fill:#D1D4DC;--stroke:#131722;}",this.Zd=document.createElement("a"),this.Zd.href=`https://www.tradingview.com/?utm_medium=lwc-link&utm_campaign=lwc-chart${this.ef()}`,this.Zd.title="Charting by TradingView",this.Zd.id="tv-attr-logo",this.Zd.target="_blank",this.Zd.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 19" width="35" height="19" fill="none"><g fill-rule="evenodd" clip-path="url(#a)" clip-rule="evenodd"><path fill="var(--stroke)" d="M2 0H0v10h6v9h21.4l.5-1.3 6-15 1-2.7H23.7l-.5 1.3-.2.6a5 5 0 0 0-7-.9V0H2Zm20 17h4l5.2-13 .8-2h-7l-1 2.5-.2.5-1.5 3.8-.3.7V17Zm-.8-10a3 3 0 0 0 .7-2.7A3 3 0 1 0 16.8 7h4.4ZM14 7V2H2v6h6v9h4V7h2Z"/><path fill="var(--fill)" d="M14 2H2v6h6v9h6V2Zm12 15h-7l6-15h7l-6 15Zm-7-9a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></g><defs><clipPath id="a"><path fill="var(--stroke)" d="M0 0h35v19H0z"/></clipPath></defs></svg>',this.Zd.toggleAttribute("data-dark",this.Kd==="dark"),this.Gd.appendChild(this.Xd),this.Gd.appendChild(this.Zd)))}}function _s(s,t){const n=b(s.ownerDocument).createElement("canvas");s.appendChild(n);const Ae=bindTo(n,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(Ne,tr)=>({width:Math.max(Ne.width,tr.width),height:Math.max(Ne.height,tr.height)})});return Ae.resizeCanvasElement(t),Ae}function us(s){var t;s.width=1,s.height=1,(t=s.getContext("2d"))===null||t===void 0||t.clearRect(0,0,1,1)}function cs(s,t,n,Ae){s.wl&&s.wl(t,n,Ae)}function ds(s,t,n,Ae){s.X(t,n,Ae)}function fs(s,t,n,Ae){const Ne=s(n,Ae);for(const tr of Ne){const er=tr.gt();er!==null&&t(er)}}function vs(s){ns&&window.chrome!==void 0&&s.addEventListener("mousedown",t=>{if(t.button===1)return t.preventDefault(),!1})}class ps{constructor(t,n,Ae){this.rf=0,this.hf=null,this.lf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.af=0,this._f=null,this.uf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.cf=null,this.df=!1,this.ff=null,this.vf=null,this.pf=!1,this.mf=!1,this.bf=!1,this.wf=null,this.gf=null,this.Mf=null,this.xf=null,this.Sf=null,this.kf=null,this.yf=null,this.Cf=0,this.Tf=!1,this.Pf=!1,this.Rf=!1,this.Df=0,this.Vf=null,this.Of=!es(),this.Bf=Ne=>{this.Af(Ne)},this.If=Ne=>{if(this.zf(Ne)){const tr=this.Lf(Ne);if(++this.af,this._f&&this.af>1){const{Ef:er}=this.Nf(ws(Ne),this.uf);er<30&&!this.bf&&this.Ff(tr,this.jf.Wf),this.Hf()}}else{const tr=this.Lf(Ne);if(++this.rf,this.hf&&this.rf>1){const{Ef:er}=this.Nf(ws(Ne),this.lf);er<5&&!this.mf&&this.$f(tr,this.jf.Uf),this.qf()}}},this.Yf=t,this.jf=n,this.cn=Ae,this.Zf()}S(){this.wf!==null&&(this.wf(),this.wf=null),this.gf!==null&&(this.gf(),this.gf=null),this.xf!==null&&(this.xf(),this.xf=null),this.Sf!==null&&(this.Sf(),this.Sf=null),this.kf!==null&&(this.kf(),this.kf=null),this.Mf!==null&&(this.Mf(),this.Mf=null),this.Xf(),this.qf()}Kf(t){this.xf&&this.xf();const n=this.Gf.bind(this);if(this.xf=()=>{this.Yf.removeEventListener("mousemove",n)},this.Yf.addEventListener("mousemove",n),this.zf(t))return;const Ae=this.Lf(t);this.$f(Ae,this.jf.Jf),this.Of=!0}qf(){this.hf!==null&&clearTimeout(this.hf),this.rf=0,this.hf=null,this.lf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}Hf(){this._f!==null&&clearTimeout(this._f),this.af=0,this._f=null,this.uf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}Gf(t){if(this.Rf||this.vf!==null||this.zf(t))return;const n=this.Lf(t);this.$f(n,this.jf.Qf),this.Of=!0}tv(t){const n=Ms(t.changedTouches,b(this.Vf));if(n===null||(this.Df=gs(t),this.yf!==null)||this.Pf)return;this.Tf=!0;const Ae=this.Nf(ws(n),b(this.vf)),{iv:Ne,nv:tr,Ef:er}=Ae;if(this.pf||!(er<5)){if(!this.pf){const ir=.5*Ne,sr=tr>=ir&&!this.cn.sv(),rr=ir>tr&&!this.cn.ev();sr||rr||(this.Pf=!0),this.pf=!0,this.bf=!0,this.Xf(),this.Hf()}if(!this.Pf){const ir=this.Lf(t,n);this.Ff(ir,this.jf.rv),bs(t)}}}hv(t){if(t.button!==0)return;const n=this.Nf(ws(t),b(this.ff)),{Ef:Ae}=n;if(Ae>=5&&(this.mf=!0,this.qf()),this.mf){const Ne=this.Lf(t);this.$f(Ne,this.jf.lv)}}Nf(t,n){const Ae=Math.abs(n.nt-t.nt),Ne=Math.abs(n.st-t.st);return{iv:Ae,nv:Ne,Ef:Ae+Ne}}av(t){let n=Ms(t.changedTouches,b(this.Vf));if(n===null&&t.touches.length===0&&(n=t.changedTouches[0]),n===null)return;this.Vf=null,this.Df=gs(t),this.Xf(),this.vf=null,this.kf&&(this.kf(),this.kf=null);const Ae=this.Lf(t,n);if(this.Ff(Ae,this.jf.ov),++this.af,this._f&&this.af>1){const{Ef:Ne}=this.Nf(ws(n),this.uf);Ne<30&&!this.bf&&this.Ff(Ae,this.jf.Wf),this.Hf()}else this.bf||(this.Ff(Ae,this.jf._v),this.jf._v&&bs(t));this.af===0&&bs(t),t.touches.length===0&&this.df&&(this.df=!1,bs(t))}Af(t){if(t.button!==0)return;const n=this.Lf(t);if(this.ff=null,this.Rf=!1,this.Sf&&(this.Sf(),this.Sf=null),ss()&&this.Yf.ownerDocument.documentElement.removeEventListener("mouseleave",this.Bf),!this.zf(t))if(this.$f(n,this.jf.uv),++this.rf,this.hf&&this.rf>1){const{Ef:Ae}=this.Nf(ws(t),this.lf);Ae<5&&!this.mf&&this.$f(n,this.jf.Uf),this.qf()}else this.mf||this.$f(n,this.jf.cv)}Xf(){this.cf!==null&&(clearTimeout(this.cf),this.cf=null)}dv(t){if(this.Vf!==null)return;const n=t.changedTouches[0];this.Vf=n.identifier,this.Df=gs(t);const Ae=this.Yf.ownerDocument.documentElement;this.bf=!1,this.pf=!1,this.Pf=!1,this.vf=ws(n),this.kf&&(this.kf(),this.kf=null);{const tr=this.tv.bind(this),er=this.av.bind(this);this.kf=()=>{Ae.removeEventListener("touchmove",tr),Ae.removeEventListener("touchend",er)},Ae.addEventListener("touchmove",tr,{passive:!1}),Ae.addEventListener("touchend",er,{passive:!1}),this.Xf(),this.cf=setTimeout(this.fv.bind(this,t),240)}const Ne=this.Lf(t,n);this.Ff(Ne,this.jf.vv),this._f||(this.af=0,this._f=setTimeout(this.Hf.bind(this),500),this.uf=ws(n))}pv(t){if(t.button!==0)return;const n=this.Yf.ownerDocument.documentElement;ss()&&n.addEventListener("mouseleave",this.Bf),this.mf=!1,this.ff=ws(t),this.Sf&&(this.Sf(),this.Sf=null);{const Ne=this.hv.bind(this),tr=this.Af.bind(this);this.Sf=()=>{n.removeEventListener("mousemove",Ne),n.removeEventListener("mouseup",tr)},n.addEventListener("mousemove",Ne),n.addEventListener("mouseup",tr)}if(this.Rf=!0,this.zf(t))return;const Ae=this.Lf(t);this.$f(Ae,this.jf.mv),this.hf||(this.rf=0,this.hf=setTimeout(this.qf.bind(this),500),this.lf=ws(t))}Zf(){this.Yf.addEventListener("mouseenter",this.Kf.bind(this)),this.Yf.addEventListener("touchcancel",this.Xf.bind(this));{const t=this.Yf.ownerDocument,n=Ae=>{this.jf.bv&&(Ae.composed&&this.Yf.contains(Ae.composedPath()[0])||Ae.target&&this.Yf.contains(Ae.target)||this.jf.bv())};this.gf=()=>{t.removeEventListener("touchstart",n)},this.wf=()=>{t.removeEventListener("mousedown",n)},t.addEventListener("mousedown",n),t.addEventListener("touchstart",n,{passive:!0})}es()&&(this.Mf=()=>{this.Yf.removeEventListener("dblclick",this.If)},this.Yf.addEventListener("dblclick",this.If)),this.Yf.addEventListener("mouseleave",this.wv.bind(this)),this.Yf.addEventListener("touchstart",this.dv.bind(this),{passive:!0}),vs(this.Yf),this.Yf.addEventListener("mousedown",this.pv.bind(this)),this.gv(),this.Yf.addEventListener("touchmove",()=>{},{passive:!1})}gv(){this.jf.Mv===void 0&&this.jf.xv===void 0&&this.jf.Sv===void 0||(this.Yf.addEventListener("touchstart",t=>this.kv(t.touches),{passive:!0}),this.Yf.addEventListener("touchmove",t=>{if(t.touches.length===2&&this.yf!==null&&this.jf.xv!==void 0){const n=ms(t.touches[0],t.touches[1])/this.Cf;this.jf.xv(this.yf,n),bs(t)}},{passive:!1}),this.Yf.addEventListener("touchend",t=>{this.kv(t.touches)}))}kv(t){t.length===1&&(this.Tf=!1),t.length!==2||this.Tf||this.df?this.yv():this.Cv(t)}Cv(t){const n=this.Yf.getBoundingClientRect()||{left:0,top:0};this.yf={nt:(t[0].clientX-n.left+(t[1].clientX-n.left))/2,st:(t[0].clientY-n.top+(t[1].clientY-n.top))/2},this.Cf=ms(t[0],t[1]),this.jf.Mv!==void 0&&this.jf.Mv(),this.Xf()}yv(){this.yf!==null&&(this.yf=null,this.jf.Sv!==void 0&&this.jf.Sv())}wv(t){if(this.xf&&this.xf(),this.zf(t)||!this.Of)return;const n=this.Lf(t);this.$f(n,this.jf.Tv),this.Of=!es()}fv(t){const n=Ms(t.touches,b(this.Vf));if(n===null)return;const Ae=this.Lf(t,n);this.Ff(Ae,this.jf.Pv),this.bf=!0,this.df=!0}zf(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents!==void 0?t.sourceCapabilities.firesTouchEvents:gs(t)<this.Df+500}Ff(t,n){n&&n.call(this.jf,t)}$f(t,n){n&&n.call(this.jf,t)}Lf(t,n){const Ae=n||t,Ne=this.Yf.getBoundingClientRect()||{left:0,top:0};return{clientX:Ae.clientX,clientY:Ae.clientY,pageX:Ae.pageX,pageY:Ae.pageY,screenX:Ae.screenX,screenY:Ae.screenY,localX:Ae.clientX-Ne.left,localY:Ae.clientY-Ne.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,Rv:!t.type.startsWith("mouse")&&t.type!=="contextmenu"&&t.type!=="click",Dv:t.type,Vv:Ae.target,Ov:t.view,Bv:()=>{t.type!=="touchstart"&&bs(t)}}}}function ms(s,t){const n=s.clientX-t.clientX,Ae=s.clientY-t.clientY;return Math.sqrt(n*n+Ae*Ae)}function bs(s){s.cancelable&&s.preventDefault()}function ws(s){return{nt:s.pageX,st:s.pageY}}function gs(s){return s.timeStamp||performance.now()}function Ms(s,t){for(let n=0;n<s.length;++n)if(s[n].identifier===t)return s[n];return null}function xs(s){return{jc:s.jc,Av:{wr:s.Iv.externalId},zv:s.Iv.cursorStyle}}function Ss(s,t,n){for(const Ae of s){const Ne=Ae.gt();if(Ne!==null&&Ne.br){const tr=Ne.br(t,n);if(tr!==null)return{Ov:Ae,Av:tr}}}return null}function ks(s,t){return n=>{var Ae,Ne,tr,er;return((Ne=(Ae=n.Dt())===null||Ae===void 0?void 0:Ae.Ta())!==null&&Ne!==void 0?Ne:"")!==t?[]:(er=(tr=n.ca)===null||tr===void 0?void 0:tr.call(n,s))!==null&&er!==void 0?er:[]}}function ys(s,t,n,Ae){if(!s.length)return;let Ne=0;const tr=n/2,er=s[0].At(Ae,!0);let ir=t===1?tr-(s[0].Vi()-er/2):s[0].Vi()-er/2-tr;ir=Math.max(0,ir);for(let sr=1;sr<s.length;sr++){const rr=s[sr],nr=s[sr-1],ar=nr.At(Ae,!1),or=rr.Vi(),ur=nr.Vi();if(t===1?or>ur-ar:or<ur+ar){const hr=ur-ar*t;rr.Oi(hr);const cr=hr-t*ar/2;if((t===1?cr<0:cr>n)&&ir>0){const vr=t===1?-1-cr:cr-n,mr=Math.min(vr,ir);for(let dr=Ne;dr<s.length;dr++)s[dr].Oi(s[dr].Vi()+t*mr);ir-=mr}}else Ne=sr,ir=t===1?ur-ar-or:or-(ur+ar)}}class Cs{constructor(t,n,Ae,Ne){this.Li=null,this.Lv=null,this.Ev=!1,this.Nv=new ni(200),this.Jr=null,this.Fv=0,this.Wv=!1,this.jv=()=>{this.Wv||this.tn.Hv().$t().$h()},this.$v=()=>{this.Wv||this.tn.Hv().$t().$h()},this.tn=t,this.cn=n,this.So=n.layout,this.Vc=Ae,this.Uv=Ne==="left",this.qv=ks("normal",Ne),this.Yv=ks("top",Ne),this.Zv=ks("bottom",Ne),this.Xv=document.createElement("div"),this.Xv.style.height="100%",this.Xv.style.overflow="hidden",this.Xv.style.width="25px",this.Xv.style.left="0",this.Xv.style.position="relative",this.Kv=_s(this.Xv,size({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv);const tr=this.Kv.canvasElement;tr.style.position="absolute",tr.style.zIndex="1",tr.style.left="0",tr.style.top="0",this.Gv=_s(this.Xv,size({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.$v);const er=this.Gv.canvasElement;er.style.position="absolute",er.style.zIndex="2",er.style.left="0",er.style.top="0";const ir={mv:this.Jv.bind(this),vv:this.Jv.bind(this),lv:this.Qv.bind(this),rv:this.Qv.bind(this),bv:this.tp.bind(this),uv:this.ip.bind(this),ov:this.ip.bind(this),Uf:this.np.bind(this),Wf:this.np.bind(this),Jf:this.sp.bind(this),Tv:this.ep.bind(this)};this.rp=new ps(this.Gv.canvasElement,ir,{sv:()=>!this.cn.handleScroll.vertTouchDrag,ev:()=>!0})}S(){this.rp.S(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.$v),us(this.Gv.canvasElement),this.Gv.dispose(),this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),us(this.Kv.canvasElement),this.Kv.dispose(),this.Li!==null&&this.Li.Xo().p(this),this.Li=null}hp(){return this.Xv}P(){return this.So.fontSize}lp(){const t=this.Vc.W();return this.Jr!==t.R&&(this.Nv.ir(),this.Jr=t.R),t}ap(){if(this.Li===null)return 0;let t=0;const n=this.lp(),Ae=b(this.Kv.canvasElement.getContext("2d"));Ae.save();const Ne=this.Li.ja();Ae.font=this.op(),Ne.length>0&&(t=Math.max(this.Nv.xi(Ae,Ne[0].no),this.Nv.xi(Ae,Ne[Ne.length-1].no)));const tr=this._p();for(let sr=tr.length;sr--;){const rr=this.Nv.xi(Ae,tr[sr].Kt());rr>t&&(t=rr)}const er=this.Li.Ct();if(er!==null&&this.Lv!==null){const sr=this.Li.pn(1,er),rr=this.Li.pn(this.Lv.height-2,er);t=Math.max(t,this.Nv.xi(Ae,this.Li.Fi(Math.floor(Math.min(sr,rr))+.11111111111111,er)),this.Nv.xi(Ae,this.Li.Fi(Math.ceil(Math.max(sr,rr))-.11111111111111,er)))}Ae.restore();const ir=t||34;return rs(Math.ceil(n.C+n.T+n.A+n.I+5+ir))}up(t){this.Lv!==null&&equalSizes(this.Lv,t)||(this.Lv=t,this.Wv=!0,this.Kv.resizeCanvasElement(t),this.Gv.resizeCanvasElement(t),this.Wv=!1,this.Xv.style.width=`${t.width}px`,this.Xv.style.height=`${t.height}px`)}cp(){return b(this.Lv).width}Gi(t){this.Li!==t&&(this.Li!==null&&this.Li.Xo().p(this),this.Li=t,t.Xo().l(this.do.bind(this),this))}Dt(){return this.Li}ir(){const t=this.tn.dp();this.tn.Hv().$t().L_(t,b(this.Dt()))}fp(t){if(this.Lv===null)return;if(t!==1){this.vp(),this.Kv.applySuggestedBitmapSize();const Ae=tryCreateCanvasRenderingTarget2D(this.Kv);Ae!==null&&(Ae.useBitmapCoordinateSpace(Ne=>{this.pp(Ne),this.Ae(Ne)}),this.tn.mp(Ae,this.Zv),this.bp(Ae),this.tn.mp(Ae,this.qv),this.wp(Ae))}this.Gv.applySuggestedBitmapSize();const n=tryCreateCanvasRenderingTarget2D(this.Gv);n!==null&&(n.useBitmapCoordinateSpace(({context:Ae,bitmapSize:Ne})=>{Ae.clearRect(0,0,Ne.width,Ne.height)}),this.gp(n),this.tn.mp(n,this.Yv))}Mp(){return this.Kv.bitmapSize}xp(t,n,Ae){const Ne=this.Mp();Ne.width>0&&Ne.height>0&&t.drawImage(this.Kv.canvasElement,n,Ae)}bt(){var t;(t=this.Li)===null||t===void 0||t.ja()}Jv(t){if(this.Li===null||this.Li.Ni()||!this.cn.handleScale.axisPressedMouseMove.price)return;const n=this.tn.Hv().$t(),Ae=this.tn.dp();this.Ev=!0,n.D_(Ae,this.Li,t.localY)}Qv(t){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const n=this.tn.Hv().$t(),Ae=this.tn.dp(),Ne=this.Li;n.V_(Ae,Ne,t.localY)}tp(){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const t=this.tn.Hv().$t(),n=this.tn.dp(),Ae=this.Li;this.Ev&&(this.Ev=!1,t.O_(n,Ae))}ip(t){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const n=this.tn.Hv().$t(),Ae=this.tn.dp();this.Ev=!1,n.O_(Ae,this.Li)}np(t){this.cn.handleScale.axisDoubleClickReset.price&&this.ir()}sp(t){this.Li!==null&&(!this.tn.Hv().$t().W().handleScale.axisPressedMouseMove.price||this.Li.gh()||this.Li.Vo()||this.Sp(1))}ep(t){this.Sp(0)}_p(){const t=[],n=this.Li===null?void 0:this.Li;return(Ae=>{for(let Ne=0;Ne<Ae.length;++Ne){const tr=Ae[Ne].Rn(this.tn.dp(),n);for(let er=0;er<tr.length;er++)t.push(tr[er])}})(this.tn.dp().$o()),t}pp({context:t,bitmapSize:n}){const{width:Ae,height:Ne}=n,tr=this.tn.dp().$t(),er=tr.q(),ir=tr.md();er===ir?G(t,0,0,Ae,Ne,er):tt(t,0,0,Ae,Ne,er,ir)}Ae({context:t,bitmapSize:n,horizontalPixelRatio:Ae}){if(this.Lv===null||this.Li===null||!this.Li.W().borderVisible)return;t.fillStyle=this.Li.W().borderColor;const Ne=Math.max(1,Math.floor(this.lp().C*Ae));let tr;tr=this.Uv?n.width-Ne:0,t.fillRect(tr,0,Ne,n.height)}bp(t){if(this.Lv===null||this.Li===null)return;const n=this.Li.ja(),Ae=this.Li.W(),Ne=this.lp(),tr=this.Uv?this.Lv.width-Ne.T:0;Ae.borderVisible&&Ae.ticksVisible&&t.useBitmapCoordinateSpace(({context:er,horizontalPixelRatio:ir,verticalPixelRatio:sr})=>{er.fillStyle=Ae.borderColor;const rr=Math.max(1,Math.floor(sr)),nr=Math.floor(.5*sr),ar=Math.round(Ne.T*ir);er.beginPath();for(const or of n)er.rect(Math.floor(tr*ir),Math.round(or.La*sr)-nr,ar,rr);er.fill()}),t.useMediaCoordinateSpace(({context:er})=>{var ir;er.font=this.op(),er.fillStyle=(ir=Ae.textColor)!==null&&ir!==void 0?ir:this.So.textColor,er.textAlign=this.Uv?"right":"left",er.textBaseline="middle";const sr=this.Uv?Math.round(tr-Ne.A):Math.round(tr+Ne.T+Ne.A),rr=n.map(nr=>this.Nv.Mi(er,nr.no));for(let nr=n.length;nr--;){const ar=n[nr];er.fillText(ar.no,sr,ar.La+rr[nr])}})}vp(){if(this.Lv===null||this.Li===null)return;const t=[],n=this.Li.$o().slice(),Ae=this.tn.dp(),Ne=this.lp();this.Li===Ae.vr()&&this.tn.dp().$o().forEach(er=>{Ae.dr(er)&&n.push(er)});const tr=this.Li;n.forEach(er=>{er.Rn(Ae,tr).forEach(ir=>{ir.Oi(null),ir.Bi()&&t.push(ir)})}),t.forEach(er=>er.Oi(er.ki())),this.Li.W().alignLabels&&this.kp(t,Ne)}kp(t,n){if(this.Lv===null)return;const Ae=this.Lv.height/2,Ne=t.filter(er=>er.ki()<=Ae),tr=t.filter(er=>er.ki()>Ae);Ne.sort((er,ir)=>ir.ki()-er.ki()),tr.sort((er,ir)=>er.ki()-ir.ki());for(const er of t){const ir=Math.floor(er.At(n)/2),sr=er.ki();sr>-ir&&sr<ir&&er.Oi(ir),sr>this.Lv.height-ir&&sr<this.Lv.height+ir&&er.Oi(this.Lv.height-ir)}ys(Ne,1,this.Lv.height,n),ys(tr,-1,this.Lv.height,n)}wp(t){if(this.Lv===null)return;const n=this._p(),Ae=this.lp(),Ne=this.Uv?"right":"left";n.forEach(tr=>{tr.Ai()&&tr.gt(b(this.Li)).X(t,Ae,this.Nv,Ne)})}gp(t){if(this.Lv===null||this.Li===null)return;const n=this.tn.Hv().$t(),Ae=[],Ne=this.tn.dp(),tr=n.Yc().Rn(Ne,this.Li);tr.length&&Ae.push(tr);const er=this.lp(),ir=this.Uv?"right":"left";Ae.forEach(sr=>{sr.forEach(rr=>{rr.gt(b(this.Li)).X(t,er,this.Nv,ir)})})}Sp(t){this.Xv.style.cursor=t===1?"ns-resize":"default"}do(){const t=this.ap();this.Fv<t&&this.tn.Hv().$t().Xl(),this.Fv=t}op(){return F(this.So.fontSize,this.So.fontFamily)}}function Ts(s,t){var n,Ae;return(Ae=(n=s._a)===null||n===void 0?void 0:n.call(s,t))!==null&&Ae!==void 0?Ae:[]}function Ps(s,t){var n,Ae;return(Ae=(n=s.Pn)===null||n===void 0?void 0:n.call(s,t))!==null&&Ae!==void 0?Ae:[]}function Rs(s,t){var n,Ae;return(Ae=(n=s.Ji)===null||n===void 0?void 0:n.call(s,t))!==null&&Ae!==void 0?Ae:[]}function Ds(s,t){var n,Ae;return(Ae=(n=s.la)===null||n===void 0?void 0:n.call(s,t))!==null&&Ae!==void 0?Ae:[]}class Vs{constructor(t,n){this.Lv=size({width:0,height:0}),this.yp=null,this.Cp=null,this.Tp=null,this.Pp=null,this.Rp=!1,this.Dp=new D,this.Vp=new D,this.Op=0,this.Bp=!1,this.Ap=null,this.Ip=!1,this.zp=null,this.Lp=null,this.Wv=!1,this.jv=()=>{this.Wv||this.Ep===null||this.$i().$h()},this.$v=()=>{this.Wv||this.Ep===null||this.$i().$h()},this.Jd=t,this.Ep=n,this.Ep.F_().l(this.Np.bind(this),this,!0),this.Fp=document.createElement("td"),this.Fp.style.padding="0",this.Fp.style.position="relative";const Ae=document.createElement("div");Ae.style.width="100%",Ae.style.height="100%",Ae.style.position="relative",Ae.style.overflow="hidden",this.Wp=document.createElement("td"),this.Wp.style.padding="0",this.jp=document.createElement("td"),this.jp.style.padding="0",this.Fp.appendChild(Ae),this.Kv=_s(Ae,size({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv);const Ne=this.Kv.canvasElement;Ne.style.position="absolute",Ne.style.zIndex="1",Ne.style.left="0",Ne.style.top="0",this.Gv=_s(Ae,size({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.$v);const tr=this.Gv.canvasElement;tr.style.position="absolute",tr.style.zIndex="2",tr.style.left="0",tr.style.top="0",this.Hp=document.createElement("tr"),this.Hp.appendChild(this.Wp),this.Hp.appendChild(this.Fp),this.Hp.appendChild(this.jp),this.$p(),this.rp=new ps(this.Gv.canvasElement,this,{sv:()=>this.Ap===null&&!this.Jd.W().handleScroll.vertTouchDrag,ev:()=>this.Ap===null&&!this.Jd.W().handleScroll.horzTouchDrag})}S(){this.yp!==null&&this.yp.S(),this.Cp!==null&&this.Cp.S(),this.Tp=null,this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.$v),us(this.Gv.canvasElement),this.Gv.dispose(),this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),us(this.Kv.canvasElement),this.Kv.dispose(),this.Ep!==null&&this.Ep.F_().p(this),this.rp.S()}dp(){return b(this.Ep)}Up(t){var n,Ae;this.Ep!==null&&this.Ep.F_().p(this),this.Ep=t,this.Ep!==null&&this.Ep.F_().l(Vs.prototype.Np.bind(this),this,!0),this.$p(),this.Jd.qp().indexOf(this)===this.Jd.qp().length-1?(this.Tp=(n=this.Tp)!==null&&n!==void 0?n:new os(this.Fp,this.Jd),this.Tp.bt()):((Ae=this.Tp)===null||Ae===void 0||Ae.tf(),this.Tp=null)}Hv(){return this.Jd}hp(){return this.Hp}$p(){if(this.Ep!==null&&(this.Yp(),this.$i().wt().length!==0)){if(this.yp!==null){const t=this.Ep.P_();this.yp.Gi(b(t))}if(this.Cp!==null){const t=this.Ep.R_();this.Cp.Gi(b(t))}}}Zp(){this.yp!==null&&this.yp.bt(),this.Cp!==null&&this.Cp.bt()}g_(){return this.Ep!==null?this.Ep.g_():0}M_(t){this.Ep&&this.Ep.M_(t)}Jf(t){if(!this.Ep)return;this.Xp();const n=t.localX,Ae=t.localY;this.Kp(n,Ae,t)}mv(t){this.Xp(),this.Gp(),this.Kp(t.localX,t.localY,t)}Qf(t){var n;if(!this.Ep)return;this.Xp();const Ae=t.localX,Ne=t.localY;this.Kp(Ae,Ne,t);const tr=this.br(Ae,Ne);this.Jd.Jp((n=tr==null?void 0:tr.zv)!==null&&n!==void 0?n:null),this.$i().Wc(tr&&{jc:tr.jc,Av:tr.Av})}cv(t){this.Ep!==null&&(this.Xp(),this.Qp(t))}Uf(t){this.Ep!==null&&this.tm(this.Vp,t)}Wf(t){this.Uf(t)}lv(t){this.Xp(),this.im(t),this.Kp(t.localX,t.localY,t)}uv(t){this.Ep!==null&&(this.Xp(),this.Bp=!1,this.nm(t))}_v(t){this.Ep!==null&&this.Qp(t)}Pv(t){if(this.Bp=!0,this.Ap===null){const n={x:t.localX,y:t.localY};this.sm(n,n,t)}}Tv(t){this.Ep!==null&&(this.Xp(),this.Ep.$t().Wc(null),this.rm())}hm(){return this.Dp}lm(){return this.Vp}Mv(){this.Op=1,this.$i().Un()}xv(t,n){if(!this.Jd.W().handleScale.pinch)return;const Ae=5*(n-this.Op);this.Op=n,this.$i().Jc(t.nt,Ae)}vv(t){this.Bp=!1,this.Ip=this.Ap!==null,this.Gp();const n=this.$i().Yc();this.Ap!==null&&n.yt()&&(this.zp={x:n.Yt(),y:n.Zt()},this.Ap={x:t.localX,y:t.localY})}rv(t){if(this.Ep===null)return;const n=t.localX,Ae=t.localY;if(this.Ap===null)this.im(t);else{this.Ip=!1;const Ne=b(this.zp),tr=Ne.x+(n-this.Ap.x),er=Ne.y+(Ae-this.Ap.y);this.Kp(tr,er,t)}}ov(t){this.Hv().W().trackingMode.exitMode===0&&(this.Ip=!0),this.am(),this.nm(t)}br(t,n){const Ae=this.Ep;return Ae===null?null:function(Ne,tr,er){const ir=Ne.$o(),sr=function(rr,nr,ar){var or,ur;let hr,cr;for(const dr of rr){const lr=(ur=(or=dr.fa)===null||or===void 0?void 0:or.call(dr,nr,ar))!==null&&ur!==void 0?ur:[];for(const gr of lr)vr=gr.zOrder,(!(mr=hr==null?void 0:hr.zOrder)||vr==="top"&&mr!=="top"||vr==="normal"&&mr==="bottom")&&(hr=gr,cr=dr)}var vr,mr;return hr&&cr?{Iv:hr,jc:cr}:null}(ir,tr,er);if((sr==null?void 0:sr.Iv.zOrder)==="top")return xs(sr);for(const rr of ir){if(sr&&sr.jc===rr&&sr.Iv.zOrder!=="bottom"&&!sr.Iv.isBackground)return xs(sr);const nr=Ss(rr.Pn(Ne),tr,er);if(nr!==null)return{jc:rr,Ov:nr.Ov,Av:nr.Av};if(sr&&sr.jc===rr&&sr.Iv.zOrder!=="bottom"&&sr.Iv.isBackground)return xs(sr)}return sr!=null&&sr.Iv?xs(sr):null}(Ae,t,n)}om(t,n){b(n==="left"?this.yp:this.Cp).up(size({width:t,height:this.Lv.height}))}_m(){return this.Lv}up(t){equalSizes(this.Lv,t)||(this.Lv=t,this.Wv=!0,this.Kv.resizeCanvasElement(t),this.Gv.resizeCanvasElement(t),this.Wv=!1,this.Fp.style.width=t.width+"px",this.Fp.style.height=t.height+"px")}um(){const t=b(this.Ep);t.T_(t.P_()),t.T_(t.R_());for(const n of t.Oa())if(t.dr(n)){const Ae=n.Dt();Ae!==null&&t.T_(Ae),n.Vn()}}Mp(){return this.Kv.bitmapSize}xp(t,n,Ae){const Ne=this.Mp();Ne.width>0&&Ne.height>0&&t.drawImage(this.Kv.canvasElement,n,Ae)}fp(t){if(t===0||this.Ep===null)return;if(t>1&&this.um(),this.yp!==null&&this.yp.fp(t),this.Cp!==null&&this.Cp.fp(t),t!==1){this.Kv.applySuggestedBitmapSize();const Ae=tryCreateCanvasRenderingTarget2D(this.Kv);Ae!==null&&(Ae.useBitmapCoordinateSpace(Ne=>{this.pp(Ne)}),this.Ep&&(this.dm(Ae,Ts),this.fm(Ae),this.vm(Ae),this.dm(Ae,Ps),this.dm(Ae,Rs)))}this.Gv.applySuggestedBitmapSize();const n=tryCreateCanvasRenderingTarget2D(this.Gv);n!==null&&(n.useBitmapCoordinateSpace(({context:Ae,bitmapSize:Ne})=>{Ae.clearRect(0,0,Ne.width,Ne.height)}),this.pm(n),this.dm(n,Ds))}bm(){return this.yp}wm(){return this.Cp}mp(t,n){this.dm(t,n)}Np(){this.Ep!==null&&this.Ep.F_().p(this),this.Ep=null}Qp(t){this.tm(this.Dp,t)}tm(t,n){const Ae=n.localX,Ne=n.localY;t.M()&&t.m(this.$i().St().Eu(Ae),{x:Ae,y:Ne},n)}pp({context:t,bitmapSize:n}){const{width:Ae,height:Ne}=n,tr=this.$i(),er=tr.q(),ir=tr.md();er===ir?G(t,0,0,Ae,Ne,ir):tt(t,0,0,Ae,Ne,er,ir)}fm(t){const n=b(this.Ep).W_().Uh().gt();n!==null&&n.X(t,!1)}vm(t){const n=this.$i().qc();this.gm(t,Ps,cs,n),this.gm(t,Ps,ds,n)}pm(t){this.gm(t,Ps,ds,this.$i().Yc())}dm(t,n){const Ae=b(this.Ep).$o();for(const Ne of Ae)this.gm(t,n,cs,Ne);for(const Ne of Ae)this.gm(t,n,ds,Ne)}gm(t,n,Ae,Ne){const tr=b(this.Ep),er=tr.$t().Fc(),ir=er!==null&&er.jc===Ne,sr=er!==null&&ir&&er.Av!==void 0?er.Av.gr:void 0;fs(n,rr=>Ae(rr,t,ir,sr),Ne,tr)}Yp(){if(this.Ep===null)return;const t=this.Jd,n=this.Ep.P_().W().visible,Ae=this.Ep.R_().W().visible;n||this.yp===null||(this.Wp.removeChild(this.yp.hp()),this.yp.S(),this.yp=null),Ae||this.Cp===null||(this.jp.removeChild(this.Cp.hp()),this.Cp.S(),this.Cp=null);const Ne=t.$t()._d();n&&this.yp===null&&(this.yp=new Cs(this,t.W(),Ne,"left"),this.Wp.appendChild(this.yp.hp())),Ae&&this.Cp===null&&(this.Cp=new Cs(this,t.W(),Ne,"right"),this.jp.appendChild(this.Cp.hp()))}Mm(t){return t.Rv&&this.Bp||this.Ap!==null}xm(t){return Math.max(0,Math.min(t,this.Lv.width-1))}Sm(t){return Math.max(0,Math.min(t,this.Lv.height-1))}Kp(t,n,Ae){this.$i().hd(this.xm(t),this.Sm(n),Ae,b(this.Ep))}rm(){this.$i().ad()}am(){this.Ip&&(this.Ap=null,this.rm())}sm(t,n,Ae){this.Ap=t,this.Ip=!1,this.Kp(n.x,n.y,Ae);const Ne=this.$i().Yc();this.zp={x:Ne.Yt(),y:Ne.Zt()}}$i(){return this.Jd.$t()}nm(t){if(!this.Rp)return;const n=this.$i(),Ae=this.dp();if(n.I_(Ae,Ae.vn()),this.Pp=null,this.Rp=!1,n.sd(),this.Lp!==null){const Ne=performance.now(),tr=n.St();this.Lp.Dr(tr.ju(),Ne),this.Lp.Ju(Ne)||n.Zn(this.Lp)}}Xp(){this.Ap=null}Gp(){if(this.Ep){if(this.$i().Un(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)b(document.activeElement).blur();else{const t=document.getSelection();t!==null&&t.removeAllRanges()}!this.Ep.vn().Ni()&&this.$i().St().Ni()}}im(t){if(this.Ep===null)return;const n=this.$i(),Ae=n.St();if(Ae.Ni())return;const Ne=this.Jd.W(),tr=Ne.handleScroll,er=Ne.kineticScroll;if((!tr.pressedMouseMove||t.Rv)&&(!tr.horzTouchDrag&&!tr.vertTouchDrag||!t.Rv))return;const ir=this.Ep.vn(),sr=performance.now();if(this.Pp!==null||this.Mm(t)||(this.Pp={x:t.clientX,y:t.clientY,Vd:sr,km:t.localX,ym:t.localY}),this.Pp!==null&&!this.Rp&&(this.Pp.x!==t.clientX||this.Pp.y!==t.clientY)){if(t.Rv&&er.touch||!t.Rv&&er.mouse){const rr=Ae.he();this.Lp=new as(.2/rr,7/rr,.997,15/rr),this.Lp.qd(Ae.ju(),this.Pp.Vd)}else this.Lp=null;ir.Ni()||n.B_(this.Ep,ir,t.localY),n.td(t.localX),this.Rp=!0}this.Rp&&(ir.Ni()||n.A_(this.Ep,ir,t.localY),n.nd(t.localX),this.Lp!==null&&this.Lp.qd(Ae.ju(),sr))}}class Os{constructor(t,n,Ae,Ne,tr){this.ft=!0,this.Lv=size({width:0,height:0}),this.jv=()=>this.fp(3),this.Uv=t==="left",this.Vc=Ae._d,this.cn=n,this.Cm=Ne,this.Tm=tr,this.Xv=document.createElement("div"),this.Xv.style.width="25px",this.Xv.style.height="100%",this.Xv.style.overflow="hidden",this.Kv=_s(this.Xv,size({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv)}S(){this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),us(this.Kv.canvasElement),this.Kv.dispose()}hp(){return this.Xv}_m(){return this.Lv}up(t){equalSizes(this.Lv,t)||(this.Lv=t,this.Kv.resizeCanvasElement(t),this.Xv.style.width=`${t.width}px`,this.Xv.style.height=`${t.height}px`,this.ft=!0)}fp(t){if(t<3&&!this.ft||this.Lv.width===0||this.Lv.height===0)return;this.ft=!1,this.Kv.applySuggestedBitmapSize();const n=tryCreateCanvasRenderingTarget2D(this.Kv);n!==null&&n.useBitmapCoordinateSpace(Ae=>{this.pp(Ae),this.Ae(Ae)})}Mp(){return this.Kv.bitmapSize}xp(t,n,Ae){const Ne=this.Mp();Ne.width>0&&Ne.height>0&&t.drawImage(this.Kv.canvasElement,n,Ae)}Ae({context:t,bitmapSize:n,horizontalPixelRatio:Ae,verticalPixelRatio:Ne}){if(!this.Cm())return;t.fillStyle=this.cn.timeScale.borderColor;const tr=Math.floor(this.Vc.W().C*Ae),er=Math.floor(this.Vc.W().C*Ne),ir=this.Uv?n.width-tr:0;t.fillRect(ir,0,tr,er)}pp({context:t,bitmapSize:n}){G(t,0,0,n.width,n.height,this.Tm())}}function Bs(s){return t=>{var n,Ae;return(Ae=(n=t.da)===null||n===void 0?void 0:n.call(t,s))!==null&&Ae!==void 0?Ae:[]}}const As=Bs("normal"),Is=Bs("top"),zs=Bs("bottom");class Ls{constructor(t,n){this.Pm=null,this.Rm=null,this.k=null,this.Dm=!1,this.Lv=size({width:0,height:0}),this.Vm=new D,this.Nv=new ni(5),this.Wv=!1,this.jv=()=>{this.Wv||this.Jd.$t().$h()},this.$v=()=>{this.Wv||this.Jd.$t().$h()},this.Jd=t,this.U_=n,this.cn=t.W().layout,this.Zd=document.createElement("tr"),this.Om=document.createElement("td"),this.Om.style.padding="0",this.Bm=document.createElement("td"),this.Bm.style.padding="0",this.Xv=document.createElement("td"),this.Xv.style.height="25px",this.Xv.style.padding="0",this.Am=document.createElement("div"),this.Am.style.width="100%",this.Am.style.height="100%",this.Am.style.position="relative",this.Am.style.overflow="hidden",this.Xv.appendChild(this.Am),this.Kv=_s(this.Am,size({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv);const Ae=this.Kv.canvasElement;Ae.style.position="absolute",Ae.style.zIndex="1",Ae.style.left="0",Ae.style.top="0",this.Gv=_s(this.Am,size({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.$v);const Ne=this.Gv.canvasElement;Ne.style.position="absolute",Ne.style.zIndex="2",Ne.style.left="0",Ne.style.top="0",this.Zd.appendChild(this.Om),this.Zd.appendChild(this.Xv),this.Zd.appendChild(this.Bm),this.Im(),this.Jd.$t().w_().l(this.Im.bind(this),this),this.rp=new ps(this.Gv.canvasElement,this,{sv:()=>!0,ev:()=>!this.Jd.W().handleScroll.horzTouchDrag})}S(){this.rp.S(),this.Pm!==null&&this.Pm.S(),this.Rm!==null&&this.Rm.S(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.$v),us(this.Gv.canvasElement),this.Gv.dispose(),this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),us(this.Kv.canvasElement),this.Kv.dispose()}hp(){return this.Zd}zm(){return this.Pm}Lm(){return this.Rm}mv(t){if(this.Dm)return;this.Dm=!0;const n=this.Jd.$t();!n.St().Ni()&&this.Jd.W().handleScale.axisPressedMouseMove.time&&n.Gc(t.localX)}vv(t){this.mv(t)}bv(){const t=this.Jd.$t();!t.St().Ni()&&this.Dm&&(this.Dm=!1,this.Jd.W().handleScale.axisPressedMouseMove.time&&t.rd())}lv(t){const n=this.Jd.$t();!n.St().Ni()&&this.Jd.W().handleScale.axisPressedMouseMove.time&&n.ed(t.localX)}rv(t){this.lv(t)}uv(){this.Dm=!1;const t=this.Jd.$t();t.St().Ni()&&!this.Jd.W().handleScale.axisPressedMouseMove.time||t.rd()}ov(){this.uv()}Uf(){this.Jd.W().handleScale.axisDoubleClickReset.time&&this.Jd.$t().Kn()}Wf(){this.Uf()}Jf(){this.Jd.$t().W().handleScale.axisPressedMouseMove.time&&this.Sp(1)}Tv(){this.Sp(0)}_m(){return this.Lv}Em(){return this.Vm}Nm(t,n,Ae){equalSizes(this.Lv,t)||(this.Lv=t,this.Wv=!0,this.Kv.resizeCanvasElement(t),this.Gv.resizeCanvasElement(t),this.Wv=!1,this.Xv.style.width=`${t.width}px`,this.Xv.style.height=`${t.height}px`,this.Vm.m(t)),this.Pm!==null&&this.Pm.up(size({width:n,height:t.height})),this.Rm!==null&&this.Rm.up(size({width:Ae,height:t.height}))}Fm(){const t=this.Wm();return Math.ceil(t.C+t.T+t.P+t.L+t.B+t.jm)}bt(){this.Jd.$t().St().ja()}Mp(){return this.Kv.bitmapSize}xp(t,n,Ae){const Ne=this.Mp();Ne.width>0&&Ne.height>0&&t.drawImage(this.Kv.canvasElement,n,Ae)}fp(t){if(t===0)return;if(t!==1){this.Kv.applySuggestedBitmapSize();const Ae=tryCreateCanvasRenderingTarget2D(this.Kv);Ae!==null&&(Ae.useBitmapCoordinateSpace(Ne=>{this.pp(Ne),this.Ae(Ne),this.Hm(Ae,zs)}),this.bp(Ae),this.Hm(Ae,As)),this.Pm!==null&&this.Pm.fp(t),this.Rm!==null&&this.Rm.fp(t)}this.Gv.applySuggestedBitmapSize();const n=tryCreateCanvasRenderingTarget2D(this.Gv);n!==null&&(n.useBitmapCoordinateSpace(({context:Ae,bitmapSize:Ne})=>{Ae.clearRect(0,0,Ne.width,Ne.height)}),this.$m([...this.Jd.$t().wt(),this.Jd.$t().Yc()],n),this.Hm(n,Is))}Hm(t,n){const Ae=this.Jd.$t().wt();for(const Ne of Ae)fs(n,tr=>cs(tr,t,!1,void 0),Ne,void 0);for(const Ne of Ae)fs(n,tr=>ds(tr,t,!1,void 0),Ne,void 0)}pp({context:t,bitmapSize:n}){G(t,0,0,n.width,n.height,this.Jd.$t().md())}Ae({context:t,bitmapSize:n,verticalPixelRatio:Ae}){if(this.Jd.W().timeScale.borderVisible){t.fillStyle=this.Um();const Ne=Math.max(1,Math.floor(this.Wm().C*Ae));t.fillRect(0,0,n.width,Ne)}}bp(t){const n=this.Jd.$t().St(),Ae=n.ja();if(!Ae||Ae.length===0)return;const Ne=this.U_.maxTickMarkWeight(Ae),tr=this.Wm(),er=n.W();er.borderVisible&&er.ticksVisible&&t.useBitmapCoordinateSpace(({context:ir,horizontalPixelRatio:sr,verticalPixelRatio:rr})=>{ir.strokeStyle=this.Um(),ir.fillStyle=this.Um();const nr=Math.max(1,Math.floor(sr)),ar=Math.floor(.5*sr);ir.beginPath();const or=Math.round(tr.T*rr);for(let ur=Ae.length;ur--;){const hr=Math.round(Ae[ur].coord*sr);ir.rect(hr-ar,0,nr,or)}ir.fill()}),t.useMediaCoordinateSpace(({context:ir})=>{const sr=tr.C+tr.T+tr.L+tr.P/2;ir.textAlign="center",ir.textBaseline="middle",ir.fillStyle=this.$(),ir.font=this.op();for(const rr of Ae)if(rr.weight<Ne){const nr=rr.needAlignCoordinate?this.qm(ir,rr.coord,rr.label):rr.coord;ir.fillText(rr.label,nr,sr)}this.Jd.W().timeScale.allowBoldLabels&&(ir.font=this.Ym());for(const rr of Ae)if(rr.weight>=Ne){const nr=rr.needAlignCoordinate?this.qm(ir,rr.coord,rr.label):rr.coord;ir.fillText(rr.label,nr,sr)}})}qm(t,n,Ae){const Ne=this.Nv.xi(t,Ae),tr=Ne/2,er=Math.floor(n-tr)+.5;return er<0?n+=Math.abs(0-er):er+Ne>this.Lv.width&&(n-=Math.abs(this.Lv.width-(er+Ne))),n}$m(t,n){const Ae=this.Wm();for(const Ne of t)for(const tr of Ne.Qi())tr.gt().X(n,Ae)}Um(){return this.Jd.W().timeScale.borderColor}$(){return this.cn.textColor}j(){return this.cn.fontSize}op(){return F(this.j(),this.cn.fontFamily)}Ym(){return F(this.j(),this.cn.fontFamily,"bold")}Wm(){this.k===null&&(this.k={C:1,N:NaN,L:NaN,B:NaN,ji:NaN,T:5,P:NaN,R:"",Wi:new ni,jm:0});const t=this.k,n=this.op();if(t.R!==n){const Ae=this.j();t.P=Ae,t.R=n,t.L=3*Ae/12,t.B=3*Ae/12,t.ji=9*Ae/12,t.N=0,t.jm=4*Ae/12,t.Wi.ir()}return this.k}Sp(t){this.Xv.style.cursor=t===1?"ew-resize":"default"}Im(){const t=this.Jd.$t(),n=t.W();n.leftPriceScale.visible||this.Pm===null||(this.Om.removeChild(this.Pm.hp()),this.Pm.S(),this.Pm=null),n.rightPriceScale.visible||this.Rm===null||(this.Bm.removeChild(this.Rm.hp()),this.Rm.S(),this.Rm=null);const Ae={_d:this.Jd.$t()._d()},Ne=()=>n.leftPriceScale.borderVisible&&t.St().W().borderVisible,tr=()=>t.md();n.leftPriceScale.visible&&this.Pm===null&&(this.Pm=new Os("left",n,Ae,Ne,tr),this.Om.appendChild(this.Pm.hp())),n.rightPriceScale.visible&&this.Rm===null&&(this.Rm=new Os("right",n,Ae,Ne,tr),this.Bm.appendChild(this.Rm.hp()))}}const Es=!!ns&&!!navigator.userAgentData&&navigator.userAgentData.brands.some(s=>s.brand.includes("Chromium"))&&!!ns&&(!((Ns=navigator==null?void 0:navigator.userAgentData)===null||Ns===void 0)&&Ns.platform?navigator.userAgentData.platform==="Windows":navigator.userAgent.toLowerCase().indexOf("win")>=0);var Ns;class Fs{constructor(t,n,Ae){var Ne;this.Zm=[],this.Xm=0,this.ro=0,this.o_=0,this.Km=0,this.Gm=0,this.Jm=null,this.Qm=!1,this.Dp=new D,this.Vp=new D,this.Pc=new D,this.tb=null,this.ib=null,this.Gd=t,this.cn=n,this.U_=Ae,this.Zd=document.createElement("div"),this.Zd.classList.add("tv-lightweight-charts"),this.Zd.style.overflow="hidden",this.Zd.style.direction="ltr",this.Zd.style.width="100%",this.Zd.style.height="100%",(Ne=this.Zd).style.userSelect="none",Ne.style.webkitUserSelect="none",Ne.style.msUserSelect="none",Ne.style.MozUserSelect="none",Ne.style.webkitTapHighlightColor="transparent",this.nb=document.createElement("table"),this.nb.setAttribute("cellspacing","0"),this.Zd.appendChild(this.nb),this.sb=this.eb.bind(this),Ws(this.cn)&&this.rb(!0),this.$i=new Ln(this.Dc.bind(this),this.cn,Ae),this.$t().Zc().l(this.hb.bind(this),this),this.lb=new Ls(this,this.U_),this.nb.appendChild(this.lb.hp());const tr=n.autoSize&&this.ab();let er=this.cn.width,ir=this.cn.height;if(tr||er===0||ir===0){const sr=t.getBoundingClientRect();er=er||sr.width,ir=ir||sr.height}this.ob(er,ir),this._b(),t.appendChild(this.Zd),this.ub(),this.$i.St().sc().l(this.$i.Xl.bind(this.$i),this),this.$i.w_().l(this.$i.Xl.bind(this.$i),this)}$t(){return this.$i}W(){return this.cn}qp(){return this.Zm}cb(){return this.lb}S(){this.rb(!1),this.Xm!==0&&window.cancelAnimationFrame(this.Xm),this.$i.Zc().p(this),this.$i.St().sc().p(this),this.$i.w_().p(this),this.$i.S();for(const t of this.Zm)this.nb.removeChild(t.hp()),t.hm().p(this),t.lm().p(this),t.S();this.Zm=[],b(this.lb).S(),this.Zd.parentElement!==null&&this.Zd.parentElement.removeChild(this.Zd),this.Pc.S(),this.Dp.S(),this.Vp.S(),this.fb()}ob(t,n,Ae=!1){if(this.ro===n&&this.o_===t)return;const Ne=function(ir){const sr=Math.floor(ir.width),rr=Math.floor(ir.height);return size({width:sr-sr%2,height:rr-rr%2})}(size({width:t,height:n}));this.ro=Ne.height,this.o_=Ne.width;const tr=this.ro+"px",er=this.o_+"px";b(this.Zd).style.height=tr,b(this.Zd).style.width=er,this.nb.style.height=tr,this.nb.style.width=er,Ae?this.pb(ut.es(),performance.now()):this.$i.Xl()}fp(t){t===void 0&&(t=ut.es());for(let n=0;n<this.Zm.length;n++)this.Zm[n].fp(t.Hn(n).Fn);this.cn.timeScale.visible&&this.lb.fp(t.jn())}Hh(t){const n=Ws(this.cn);this.$i.Hh(t);const Ae=Ws(this.cn);Ae!==n&&this.rb(Ae),this.ub(),this.mb(t)}hm(){return this.Dp}lm(){return this.Vp}Zc(){return this.Pc}bb(){this.Jm!==null&&(this.pb(this.Jm,performance.now()),this.Jm=null);const t=this.wb(null),n=document.createElement("canvas");n.width=t.width,n.height=t.height;const Ae=b(n.getContext("2d"));return this.wb(Ae),n}gb(t){return t==="left"&&!this.Mb()||t==="right"&&!this.xb()||this.Zm.length===0?0:b(t==="left"?this.Zm[0].bm():this.Zm[0].wm()).cp()}Sb(){return this.cn.autoSize&&this.tb!==null}kb(){return this.Zd}Jp(t){this.ib=t,this.ib?this.kb().style.setProperty("cursor",t):this.kb().style.removeProperty("cursor")}yb(){return this.ib}Cb(){return m(this.Zm[0])._m()}mb(t){(t.autoSize!==void 0||!this.tb||t.width===void 0&&t.height===void 0)&&(t.autoSize&&!this.tb&&this.ab(),t.autoSize===!1&&this.tb!==null&&this.fb(),t.autoSize||t.width===void 0&&t.height===void 0||this.ob(t.width||this.o_,t.height||this.ro))}wb(t){let n=0,Ae=0;const Ne=this.Zm[0],tr=(ir,sr)=>{let rr=0;for(let nr=0;nr<this.Zm.length;nr++){const ar=this.Zm[nr],or=b(ir==="left"?ar.bm():ar.wm()),ur=or.Mp();t!==null&&or.xp(t,sr,rr),rr+=ur.height}};this.Mb()&&(tr("left",0),n+=b(Ne.bm()).Mp().width);for(let ir=0;ir<this.Zm.length;ir++){const sr=this.Zm[ir],rr=sr.Mp();t!==null&&sr.xp(t,n,Ae),Ae+=rr.height}n+=Ne.Mp().width,this.xb()&&(tr("right",n),n+=b(Ne.wm()).Mp().width);const er=(ir,sr,rr)=>{b(ir==="left"?this.lb.zm():this.lb.Lm()).xp(b(t),sr,rr)};if(this.cn.timeScale.visible){const ir=this.lb.Mp();if(t!==null){let sr=0;this.Mb()&&(er("left",sr,Ae),sr=b(Ne.bm()).Mp().width),this.lb.xp(t,sr,Ae),sr+=ir.width,this.xb()&&er("right",sr,Ae)}Ae+=ir.height}return size({width:n,height:Ae})}Tb(){let t=0,n=0,Ae=0;for(const hr of this.Zm)this.Mb()&&(n=Math.max(n,b(hr.bm()).ap(),this.cn.leftPriceScale.minimumWidth)),this.xb()&&(Ae=Math.max(Ae,b(hr.wm()).ap(),this.cn.rightPriceScale.minimumWidth)),t+=hr.g_();n=rs(n),Ae=rs(Ae);const Ne=this.o_,tr=this.ro,er=Math.max(Ne-n-Ae,0),ir=this.cn.timeScale.visible;let sr=ir?Math.max(this.lb.Fm(),this.cn.timeScale.minimumHeight):0;var rr;sr=(rr=sr)+rr%2;const nr=0+sr,ar=tr<nr?0:tr-nr,or=ar/t;let ur=0;for(let hr=0;hr<this.Zm.length;++hr){const cr=this.Zm[hr];cr.Up(this.$i.Uc()[hr]);let vr=0,mr=0;mr=hr===this.Zm.length-1?ar-ur:Math.round(cr.g_()*or),vr=Math.max(mr,2),ur+=vr,cr.up(size({width:er,height:vr})),this.Mb()&&cr.om(n,"left"),this.xb()&&cr.om(Ae,"right"),cr.dp()&&this.$i.Xc(cr.dp(),vr)}this.lb.Nm(size({width:ir?er:0,height:sr}),ir?n:0,ir?Ae:0),this.$i.x_(er),this.Km!==n&&(this.Km=n),this.Gm!==Ae&&(this.Gm=Ae)}rb(t){t?this.Zd.addEventListener("wheel",this.sb,{passive:!1}):this.Zd.removeEventListener("wheel",this.sb)}Pb(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return Es?1/window.devicePixelRatio:1}eb(t){if(!(t.deltaX!==0&&this.cn.handleScroll.mouseWheel||t.deltaY!==0&&this.cn.handleScale.mouseWheel))return;const n=this.Pb(t),Ae=n*t.deltaX/100,Ne=-n*t.deltaY/100;if(t.cancelable&&t.preventDefault(),Ne!==0&&this.cn.handleScale.mouseWheel){const tr=Math.sign(Ne)*Math.min(1,Math.abs(Ne)),er=t.clientX-this.Zd.getBoundingClientRect().left;this.$t().Jc(er,tr)}Ae!==0&&this.cn.handleScroll.mouseWheel&&this.$t().Qc(-80*Ae)}pb(t,n){var Ae;const Ne=t.jn();Ne===3&&this.Rb(),Ne!==3&&Ne!==2||(this.Db(t),this.Vb(t,n),this.lb.bt(),this.Zm.forEach(tr=>{tr.Zp()}),((Ae=this.Jm)===null||Ae===void 0?void 0:Ae.jn())===3&&(this.Jm.ts(t),this.Rb(),this.Db(this.Jm),this.Vb(this.Jm,n),t=this.Jm,this.Jm=null)),this.fp(t)}Vb(t,n){for(const Ae of t.Qn())this.ns(Ae,n)}Db(t){const n=this.$i.Uc();for(let Ae=0;Ae<n.length;Ae++)t.Hn(Ae).Wn&&n[Ae].E_()}ns(t,n){const Ae=this.$i.St();switch(t.qn){case 0:Ae.rc();break;case 1:Ae.hc(t.Vt);break;case 2:Ae.Gn(t.Vt);break;case 3:Ae.Jn(t.Vt);break;case 4:Ae.Uu();break;case 5:t.Vt.Ju(n)||Ae.Jn(t.Vt.Qu(n))}}Dc(t){this.Jm!==null?this.Jm.ts(t):this.Jm=t,this.Qm||(this.Qm=!0,this.Xm=window.requestAnimationFrame(n=>{if(this.Qm=!1,this.Xm=0,this.Jm!==null){const Ae=this.Jm;this.Jm=null,this.pb(Ae,n);for(const Ne of Ae.Qn())if(Ne.qn===5&&!Ne.Vt.Ju(n)){this.$t().Zn(Ne.Vt);break}}}))}Rb(){this._b()}_b(){const t=this.$i.Uc(),n=t.length,Ae=this.Zm.length;for(let Ne=n;Ne<Ae;Ne++){const tr=m(this.Zm.pop());this.nb.removeChild(tr.hp()),tr.hm().p(this),tr.lm().p(this),tr.S()}for(let Ne=Ae;Ne<n;Ne++){const tr=new Vs(this,t[Ne]);tr.hm().l(this.Ob.bind(this),this),tr.lm().l(this.Bb.bind(this),this),this.Zm.push(tr),this.nb.insertBefore(tr.hp(),this.lb.hp())}for(let Ne=0;Ne<n;Ne++){const tr=t[Ne],er=this.Zm[Ne];er.dp()!==tr?er.Up(tr):er.$p()}this.ub(),this.Tb()}Ab(t,n,Ae){var Ne;const tr=new Map;t!==null&&this.$i.wt().forEach(nr=>{const ar=nr.In().hl(t);ar!==null&&tr.set(nr,ar)});let er;if(t!==null){const nr=(Ne=this.$i.St().Ui(t))===null||Ne===void 0?void 0:Ne.originalTime;nr!==void 0&&(er=nr)}const ir=this.$t().Fc(),sr=ir!==null&&ir.jc instanceof Gi?ir.jc:void 0,rr=ir!==null&&ir.Av!==void 0?ir.Av.wr:void 0;return{Ib:er,se:t??void 0,zb:n??void 0,Lb:sr,Eb:tr,Nb:rr,Fb:Ae??void 0}}Ob(t,n,Ae){this.Dp.m(()=>this.Ab(t,n,Ae))}Bb(t,n,Ae){this.Vp.m(()=>this.Ab(t,n,Ae))}hb(t,n,Ae){this.Pc.m(()=>this.Ab(t,n,Ae))}ub(){const t=this.cn.timeScale.visible?"":"none";this.lb.hp().style.display=t}Mb(){return this.Zm[0].dp().P_().W().visible}xb(){return this.Zm[0].dp().R_().W().visible}ab(){return"ResizeObserver"in window&&(this.tb=new ResizeObserver(t=>{const n=t.find(Ae=>Ae.target===this.Gd);n&&this.ob(n.contentRect.width,n.contentRect.height)}),this.tb.observe(this.Gd,{box:"border-box"}),!0)}fb(){this.tb!==null&&this.tb.disconnect(),this.tb=null}}function Ws(s){return!!(s.handleScroll.mouseWheel||s.handleScale.mouseWheel)}function js(s){return function(t){return t.open!==void 0}(s)||function(t){return t.value!==void 0}(s)}function Hs(s,t){var n={};for(var Ae in s)Object.prototype.hasOwnProperty.call(s,Ae)&&t.indexOf(Ae)<0&&(n[Ae]=s[Ae]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var Ne=0;for(Ae=Object.getOwnPropertySymbols(s);Ne<Ae.length;Ne++)t.indexOf(Ae[Ne])<0&&Object.prototype.propertyIsEnumerable.call(s,Ae[Ne])&&(n[Ae[Ne]]=s[Ae[Ne]])}return n}function $s(s,t,n,Ae){const Ne=n.value,tr={se:t,ot:s,Vt:[Ne,Ne,Ne,Ne],Ib:Ae};return n.color!==void 0&&(tr.V=n.color),tr}function Us(s,t,n,Ae){const Ne=n.value,tr={se:t,ot:s,Vt:[Ne,Ne,Ne,Ne],Ib:Ae};return n.lineColor!==void 0&&(tr.lt=n.lineColor),n.topColor!==void 0&&(tr.Ts=n.topColor),n.bottomColor!==void 0&&(tr.Ps=n.bottomColor),tr}function qs(s,t,n,Ae){const Ne=n.value,tr={se:t,ot:s,Vt:[Ne,Ne,Ne,Ne],Ib:Ae};return n.topLineColor!==void 0&&(tr.Pe=n.topLineColor),n.bottomLineColor!==void 0&&(tr.Re=n.bottomLineColor),n.topFillColor1!==void 0&&(tr.Se=n.topFillColor1),n.topFillColor2!==void 0&&(tr.ke=n.topFillColor2),n.bottomFillColor1!==void 0&&(tr.ye=n.bottomFillColor1),n.bottomFillColor2!==void 0&&(tr.Ce=n.bottomFillColor2),tr}function Ys(s,t,n,Ae){const Ne={se:t,ot:s,Vt:[n.open,n.high,n.low,n.close],Ib:Ae};return n.color!==void 0&&(Ne.V=n.color),Ne}function Zs(s,t,n,Ae){const Ne={se:t,ot:s,Vt:[n.open,n.high,n.low,n.close],Ib:Ae};return n.color!==void 0&&(Ne.V=n.color),n.borderColor!==void 0&&(Ne.Ot=n.borderColor),n.wickColor!==void 0&&(Ne.Zh=n.wickColor),Ne}function Xs(s,t,n,Ae,Ne){const tr=m(Ne)(n),er=Math.max(...tr),ir=Math.min(...tr),sr=tr[tr.length-1],rr=[sr,er,ir,sr],nr=n,{time:ar,color:or}=nr;return{se:t,ot:s,Vt:rr,Ib:Ae,He:Hs(nr,["time","color"]),V:or}}function Ks(s){return s.Vt!==void 0}function Gs(s,t){return t.customValues!==void 0&&(s.Wb=t.customValues),s}function Js(s){return(t,n,Ae,Ne,tr,er)=>function(ir,sr){return sr?sr(ir):(rr=ir).open===void 0&&rr.value===void 0;var rr}(Ae,er)?Gs({ot:t,se:n,Ib:Ne},Ae):Gs(s(t,n,Ae,Ne,tr),Ae)}function Qs(s){return{Candlestick:Js(Zs),Bar:Js(Ys),Area:Js(Us),Baseline:Js(qs),Histogram:Js($s),Line:Js($s),Custom:Js(Xs)}[s]}function te(s){return{se:0,jb:new Map,ha:s}}function ie(s,t){if(s!==void 0&&s.length!==0)return{Hb:t.key(s[0].ot),$b:t.key(s[s.length-1].ot)}}function ne(s){let t;return s.forEach(n=>{t===void 0&&(t=n.Ib)}),m(t)}class se{constructor(t){this.Ub=new Map,this.qb=new Map,this.Yb=new Map,this.Zb=[],this.U_=t}S(){this.Ub.clear(),this.qb.clear(),this.Yb.clear(),this.Zb=[]}Xb(t,n){let Ae=this.Ub.size!==0,Ne=!1;const tr=this.qb.get(t);if(tr!==void 0)if(this.qb.size===1)Ae=!1,Ne=!0,this.Ub.clear();else for(const sr of this.Zb)sr.pointData.jb.delete(t)&&(Ne=!0);let er=[];if(n.length!==0){const sr=n.map(ur=>ur.time),rr=this.U_.createConverterToInternalObj(n),nr=Qs(t.Jh()),ar=t.ya(),or=t.Ca();er=n.map((ur,hr)=>{const cr=rr(ur.time),vr=this.U_.key(cr);let mr=this.Ub.get(vr);mr===void 0&&(mr=te(cr),this.Ub.set(vr,mr),Ne=!0);const dr=nr(cr,mr.se,ur,sr[hr],ar,or);return mr.jb.set(t,dr),dr})}Ae&&this.Kb(),this.Gb(t,er);let ir=-1;if(Ne){const sr=[];this.Ub.forEach(rr=>{sr.push({timeWeight:0,time:rr.ha,pointData:rr,originalTime:ne(rr.jb)})}),sr.sort((rr,nr)=>this.U_.key(rr.time)-this.U_.key(nr.time)),ir=this.Jb(sr)}return this.Qb(t,ir,function(sr,rr,nr){const ar=ie(sr,nr),or=ie(rr,nr);if(ar!==void 0&&or!==void 0)return{Ql:ar.$b>=or.$b&&ar.Hb>=or.Hb}}(this.qb.get(t),tr,this.U_))}fd(t){return this.Xb(t,[])}tw(t,n){const Ae=n;(function(cr){cr.Ib===void 0&&(cr.Ib=cr.time)})(Ae),this.U_.preprocessData(n);const Ne=this.U_.createConverterToInternalObj([n])(n.time),tr=this.Yb.get(t);if(tr!==void 0&&this.U_.key(Ne)<this.U_.key(tr))throw new Error(`Cannot update oldest data, last time=${tr}, new time=${Ne}`);let er=this.Ub.get(this.U_.key(Ne));const ir=er===void 0;er===void 0&&(er=te(Ne),this.Ub.set(this.U_.key(Ne),er));const sr=Qs(t.Jh()),rr=t.ya(),nr=t.Ca(),ar=sr(Ne,er.se,n,Ae.Ib,rr,nr);er.jb.set(t,ar),this.iw(t,ar);const or={Ql:Ks(ar)};if(!ir)return this.Qb(t,-1,or);const ur={timeWeight:0,time:er.ha,pointData:er,originalTime:ne(er.jb)},hr=Bt(this.Zb,this.U_.key(ur.time),(cr,vr)=>this.U_.key(cr.time)<vr);this.Zb.splice(hr,0,ur);for(let cr=hr;cr<this.Zb.length;++cr)ee(this.Zb[cr].pointData,cr);return this.U_.fillWeightsForPoints(this.Zb,hr),this.Qb(t,hr,or)}iw(t,n){let Ae=this.qb.get(t);Ae===void 0&&(Ae=[],this.qb.set(t,Ae));const Ne=Ae.length!==0?Ae[Ae.length-1]:null;Ne===null||this.U_.key(n.ot)>this.U_.key(Ne.ot)?Ks(n)&&Ae.push(n):Ks(n)?Ae[Ae.length-1]=n:Ae.splice(-1,1),this.Yb.set(t,n.ot)}Gb(t,n){n.length!==0?(this.qb.set(t,n.filter(Ks)),this.Yb.set(t,n[n.length-1].ot)):(this.qb.delete(t),this.Yb.delete(t))}Kb(){for(const t of this.Zb)t.pointData.jb.size===0&&this.Ub.delete(this.U_.key(t.time))}Jb(t){let n=-1;for(let Ae=0;Ae<this.Zb.length&&Ae<t.length;++Ae){const Ne=this.Zb[Ae],tr=t[Ae];if(this.U_.key(Ne.time)!==this.U_.key(tr.time)){n=Ae;break}tr.timeWeight=Ne.timeWeight,ee(tr.pointData,Ae)}if(n===-1&&this.Zb.length!==t.length&&(n=Math.min(this.Zb.length,t.length)),n===-1)return-1;for(let Ae=n;Ae<t.length;++Ae)ee(t[Ae].pointData,Ae);return this.U_.fillWeightsForPoints(t,n),this.Zb=t,n}nw(){if(this.qb.size===0)return null;let t=0;return this.qb.forEach(n=>{n.length!==0&&(t=Math.max(t,n[n.length-1].se))}),t}Qb(t,n,Ae){const Ne={sw:new Map,St:{Lu:this.nw()}};if(n!==-1)this.qb.forEach((tr,er)=>{Ne.sw.set(er,{He:tr,ew:er===t?Ae:void 0})}),this.qb.has(t)||Ne.sw.set(t,{He:[],ew:Ae}),Ne.St.rw=this.Zb,Ne.St.hw=n;else{const tr=this.qb.get(t);Ne.sw.set(t,{He:tr||[],ew:Ae})}return Ne}}function ee(s,t){s.se=t,s.jb.forEach(n=>{n.se=t})}function re$1(s){const t={value:s.Vt[3],time:s.Ib};return s.Wb!==void 0&&(t.customValues=s.Wb),t}function he(s){const t=re$1(s);return s.V!==void 0&&(t.color=s.V),t}function le(s){const t=re$1(s);return s.lt!==void 0&&(t.lineColor=s.lt),s.Ts!==void 0&&(t.topColor=s.Ts),s.Ps!==void 0&&(t.bottomColor=s.Ps),t}function ae(s){const t=re$1(s);return s.Pe!==void 0&&(t.topLineColor=s.Pe),s.Re!==void 0&&(t.bottomLineColor=s.Re),s.Se!==void 0&&(t.topFillColor1=s.Se),s.ke!==void 0&&(t.topFillColor2=s.ke),s.ye!==void 0&&(t.bottomFillColor1=s.ye),s.Ce!==void 0&&(t.bottomFillColor2=s.Ce),t}function oe(s){const t={open:s.Vt[0],high:s.Vt[1],low:s.Vt[2],close:s.Vt[3],time:s.Ib};return s.Wb!==void 0&&(t.customValues=s.Wb),t}function _e(s){const t=oe(s);return s.V!==void 0&&(t.color=s.V),t}function ue(s){const t=oe(s),{V:n,Ot:Ae,Zh:Ne}=s;return n!==void 0&&(t.color=n),Ae!==void 0&&(t.borderColor=Ae),Ne!==void 0&&(t.wickColor=Ne),t}function ce(s){return{Area:le,Line:he,Baseline:ae,Histogram:he,Bar:_e,Candlestick:ue,Custom:de}[s]}function de(s){const t=s.Ib;return Object.assign(Object.assign({},s.He),{time:t})}const fe={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},ve={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},pe={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:N,attributionLogo:!0},me={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},be={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},we={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:N,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function ge(){return{width:0,height:0,autoSize:!1,layout:pe,crosshair:fe,grid:ve,overlayPriceScales:Object.assign({},me),leftPriceScale:Object.assign(Object.assign({},me),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},me),{visible:!0}),timeScale:be,watermark:we,localization:{locale:ns?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class Me{constructor(t,n){this.lw=t,this.aw=n}applyOptions(t){this.lw.$t().Hc(this.aw,t)}options(){return this.Li().W()}width(){return _t(this.aw)?this.lw.gb(this.aw):0}Li(){return b(this.lw.$t().$c(this.aw)).Dt}}function xe(s,t,n){const Ae=Hs(s,["time","originalTime"]),Ne=Object.assign({time:t},Ae);return n!==void 0&&(Ne.originalTime=n),Ne}const Se={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class ke{constructor(t){this.Eh=t}applyOptions(t){this.Eh.Hh(t)}options(){return this.Eh.W()}ow(){return this.Eh}}class ye{constructor(t,n,Ae,Ne,tr){this._w=new D,this.Ls=t,this.uw=n,this.cw=Ae,this.U_=tr,this.dw=Ne}S(){this._w.S()}priceFormatter(){return this.Ls.ma()}priceToCoordinate(t){const n=this.Ls.Ct();return n===null?null:this.Ls.Dt().Rt(t,n.Vt)}coordinateToPrice(t){const n=this.Ls.Ct();return n===null?null:this.Ls.Dt().pn(t,n.Vt)}barsInLogicalRange(t){if(t===null)return null;const n=new yn(new xn(t.from,t.to)).hu(),Ae=this.Ls.In();if(Ae.Ni())return null;const Ne=Ae.hl(n.Vs(),1),tr=Ae.hl(n.ui(),-1),er=b(Ae.sl()),ir=b(Ae.An());if(Ne!==null&&tr!==null&&Ne.se>tr.se)return{barsBefore:t.from-er,barsAfter:ir-t.to};const sr={barsBefore:Ne===null||Ne.se===er?t.from-er:Ne.se-er,barsAfter:tr===null||tr.se===ir?ir-t.to:ir-tr.se};return Ne!==null&&tr!==null&&(sr.from=Ne.Ib,sr.to=tr.Ib),sr}setData(t){this.U_,this.Ls.Jh(),this.uw.fw(this.Ls,t),this.pw("full")}update(t){this.Ls.Jh(),this.uw.mw(this.Ls,t),this.pw("update")}dataByIndex(t,n){const Ae=this.Ls.In().hl(t,n);return Ae===null?null:ce(this.seriesType())(Ae)}data(){const t=ce(this.seriesType());return this.Ls.In().ie().map(n=>t(n))}subscribeDataChanged(t){this._w.l(t)}unsubscribeDataChanged(t){this._w.v(t)}setMarkers(t){this.U_;const n=t.map(Ae=>xe(Ae,this.U_.convertHorzItemToInternal(Ae.time),Ae.time));this.Ls.ia(n)}markers(){return this.Ls.na().map(t=>xe(t,t.originalTime,void 0))}applyOptions(t){this.Ls.Hh(t)}options(){return z(this.Ls.W())}priceScale(){return this.cw.priceScale(this.Ls.Dt().Ta())}createPriceLine(t){const n=V(z(Se),t),Ae=this.Ls.sa(n);return new ke(Ae)}removePriceLine(t){this.Ls.ea(t.ow())}seriesType(){return this.Ls.Jh()}attachPrimitive(t){this.Ls.Sa(t),t.attached&&t.attached({chart:this.dw,series:this,requestUpdate:()=>this.Ls.$t().Xl()})}detachPrimitive(t){this.Ls.ka(t),t.detached&&t.detached()}pw(t){this._w.M()&&this._w.m(t)}}class Ce{constructor(t,n,Ae){this.bw=new D,this.pu=new D,this.Vm=new D,this.$i=t,this.kl=t.St(),this.lb=n,this.kl.tc().l(this.ww.bind(this)),this.kl.nc().l(this.gw.bind(this)),this.lb.Em().l(this.Mw.bind(this)),this.U_=Ae}S(){this.kl.tc().p(this),this.kl.nc().p(this),this.lb.Em().p(this),this.bw.S(),this.pu.S(),this.Vm.S()}scrollPosition(){return this.kl.ju()}scrollToPosition(t,n){n?this.kl.Gu(t,1e3):this.$i.Jn(t)}scrollToRealTime(){this.kl.Ku()}getVisibleRange(){const t=this.kl.Du();return t===null?null:{from:t.from.originalTime,to:t.to.originalTime}}setVisibleRange(t){const n={from:this.U_.convertHorzItemToInternal(t.from),to:this.U_.convertHorzItemToInternal(t.to)},Ae=this.kl.Au(n);this.$i.vd(Ae)}getVisibleLogicalRange(){const t=this.kl.Ru();return t===null?null:{from:t.Vs(),to:t.ui()}}setVisibleLogicalRange(t){p$1(t.from<=t.to,"The from index cannot be after the to index."),this.$i.vd(t)}resetTimeScale(){this.$i.Kn()}fitContent(){this.$i.rc()}logicalToCoordinate(t){const n=this.$i.St();return n.Ni()?null:n.It(t)}coordinateToLogical(t){return this.kl.Ni()?null:this.kl.Eu(t)}timeToCoordinate(t){const n=this.U_.convertHorzItemToInternal(t),Ae=this.kl.Da(n,!1);return Ae===null?null:this.kl.It(Ae)}coordinateToTime(t){const n=this.$i.St(),Ae=n.Eu(t),Ne=n.Ui(Ae);return Ne===null?null:Ne.originalTime}width(){return this.lb._m().width}height(){return this.lb._m().height}subscribeVisibleTimeRangeChange(t){this.bw.l(t)}unsubscribeVisibleTimeRangeChange(t){this.bw.v(t)}subscribeVisibleLogicalRangeChange(t){this.pu.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.pu.v(t)}subscribeSizeChange(t){this.Vm.l(t)}unsubscribeSizeChange(t){this.Vm.v(t)}applyOptions(t){this.kl.Hh(t)}options(){return Object.assign(Object.assign({},z(this.kl.W())),{barSpacing:this.kl.he()})}ww(){this.bw.M()&&this.bw.m(this.getVisibleRange())}gw(){this.pu.M()&&this.pu.m(this.getVisibleLogicalRange())}Mw(t){this.Vm.m(t.width,t.height)}}function Te(s){if(s===void 0||s.type==="custom")return;const t=s;t.minMove!==void 0&&t.precision===void 0&&(t.precision=function(n){if(n>=1)return 0;let Ae=0;for(;Ae<8;Ae++){const Ne=Math.round(n);if(Math.abs(Ne-n)<1e-8)return Ae;n*=10}return Ae}(t.minMove))}function Pe(s){return function(t){if(I(t.handleScale)){const Ae=t.handleScale;t.handleScale={axisDoubleClickReset:{time:Ae,price:Ae},axisPressedMouseMove:{time:Ae,price:Ae},mouseWheel:Ae,pinch:Ae}}else if(t.handleScale!==void 0){const{axisPressedMouseMove:Ae,axisDoubleClickReset:Ne}=t.handleScale;I(Ae)&&(t.handleScale.axisPressedMouseMove={time:Ae,price:Ae}),I(Ne)&&(t.handleScale.axisDoubleClickReset={time:Ne,price:Ne})}const n=t.handleScroll;I(n)&&(t.handleScroll={horzTouchDrag:n,vertTouchDrag:n,mouseWheel:n,pressedMouseMove:n})}(s),s}class Re{constructor(t,n,Ae){this.xw=new Map,this.Sw=new Map,this.kw=new D,this.yw=new D,this.Cw=new D,this.Tw=new se(n);const Ne=Ae===void 0?z(ge()):V(z(ge()),Pe(Ae));this.U_=n,this.lw=new Fs(t,Ne,n),this.lw.hm().l(er=>{this.kw.M()&&this.kw.m(this.Pw(er()))},this),this.lw.lm().l(er=>{this.yw.M()&&this.yw.m(this.Pw(er()))},this),this.lw.Zc().l(er=>{this.Cw.M()&&this.Cw.m(this.Pw(er()))},this);const tr=this.lw.$t();this.Rw=new Ce(tr,this.lw.cb(),this.U_)}remove(){this.lw.hm().p(this),this.lw.lm().p(this),this.lw.Zc().p(this),this.Rw.S(),this.lw.S(),this.xw.clear(),this.Sw.clear(),this.kw.S(),this.yw.S(),this.Cw.S(),this.Tw.S()}resize(t,n,Ae){this.autoSizeActive()||this.lw.ob(t,n,Ae)}addCustomSeries(t,n){const Ae=w(t),Ne=Object.assign(Object.assign({},_),Ae.defaultOptions());return this.Dw("Custom",Ne,n,Ae)}addAreaSeries(t){return this.Dw("Area",l,t)}addBaselineSeries(t){return this.Dw("Baseline",a,t)}addBarSeries(t){return this.Dw("Bar",r,t)}addCandlestickSeries(t={}){return function(n){n.borderColor!==void 0&&(n.borderUpColor=n.borderColor,n.borderDownColor=n.borderColor),n.wickColor!==void 0&&(n.wickUpColor=n.wickColor,n.wickDownColor=n.wickColor)}(t),this.Dw("Candlestick",e,t)}addHistogramSeries(t){return this.Dw("Histogram",o,t)}addLineSeries(t){return this.Dw("Line",h,t)}removeSeries(t){const n=m(this.xw.get(t)),Ae=this.Tw.fd(n);this.lw.$t().fd(n),this.Vw(Ae),this.xw.delete(t),this.Sw.delete(n)}fw(t,n){this.Vw(this.Tw.Xb(t,n))}mw(t,n){this.Vw(this.Tw.tw(t,n))}subscribeClick(t){this.kw.l(t)}unsubscribeClick(t){this.kw.v(t)}subscribeCrosshairMove(t){this.Cw.l(t)}unsubscribeCrosshairMove(t){this.Cw.v(t)}subscribeDblClick(t){this.yw.l(t)}unsubscribeDblClick(t){this.yw.v(t)}priceScale(t){return new Me(this.lw,t)}timeScale(){return this.Rw}applyOptions(t){this.lw.Hh(Pe(t))}options(){return this.lw.W()}takeScreenshot(){return this.lw.bb()}autoSizeActive(){return this.lw.Sb()}chartElement(){return this.lw.kb()}paneSize(){const t=this.lw.Cb();return{height:t.height,width:t.width}}setCrosshairPosition(t,n,Ae){const Ne=this.xw.get(Ae);if(Ne===void 0)return;const tr=this.lw.$t().cr(Ne);tr!==null&&this.lw.$t().ld(t,n,tr)}clearCrosshairPosition(){this.lw.$t().ad(!0)}Dw(t,n,Ae={},Ne){Te(Ae.priceFormat);const tr=V(z(u),z(n),Ae),er=this.lw.$t().ud(t,tr,Ne),ir=new ye(er,this,this,this,this.U_);return this.xw.set(ir,er),this.Sw.set(er,ir),ir}Vw(t){const n=this.lw.$t();n.od(t.St.Lu,t.St.rw,t.St.hw),t.sw.forEach((Ae,Ne)=>Ne.J(Ae.He,Ae.ew)),n.Fu()}Ow(t){return m(this.Sw.get(t))}Pw(t){const n=new Map;t.Eb.forEach((Ne,tr)=>{const er=tr.Jh(),ir=ce(er)(Ne);if(er!=="Custom")p$1(js(ir));else{const sr=tr.Ca();p$1(!sr||sr(ir)===!1)}n.set(this.Ow(tr),ir)});const Ae=t.Lb!==void 0&&this.Sw.has(t.Lb)?this.Ow(t.Lb):void 0;return{time:t.Ib,logical:t.se,point:t.zb,hoveredSeries:Ae,hoveredObjectId:t.Nb,seriesData:n,sourceEvent:t.Fb}}}function De(s,t,n){let Ae;if(A(s)){const tr=document.getElementById(s);p$1(tr!==null,`Cannot find element in DOM with id=${s}`),Ae=tr}else Ae=s;const Ne=new Re(Ae,t,n);return t.setOptions(Ne.options()),Ne}function Ve(s,t){return De(s,new is,is.Ad(t))}Object.assign(Object.assign({},u),_);const PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(s=>{PACKET_TYPES_REVERSE[PACKET_TYPES[s]]=s});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer,encodePacket=({type:s,data:t},n,Ae)=>withNativeBlob$1&&t instanceof Blob?n?Ae(t):encodeBlobAsBase64(t,Ae):withNativeArrayBuffer$2&&(t instanceof ArrayBuffer||isView$1(t))?n?Ae(t):encodeBlobAsBase64(new Blob([t]),Ae):Ae(PACKET_TYPES[s]+(t||"")),encodeBlobAsBase64=(s,t)=>{const n=new FileReader;return n.onload=function(){const Ae=n.result.split(",")[1];t("b"+(Ae||""))},n.readAsDataURL(s)};function toArray(s){return s instanceof Uint8Array?s:s instanceof ArrayBuffer?new Uint8Array(s):new Uint8Array(s.buffer,s.byteOffset,s.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(s,t){if(withNativeBlob$1&&s.data instanceof Blob)return s.data.arrayBuffer().then(toArray).then(t);if(withNativeArrayBuffer$2&&(s.data instanceof ArrayBuffer||isView$1(s.data)))return t(toArray(s.data));encodePacket(s,!1,n=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),t(TEXT_ENCODER.encode(n))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let s=0;s<chars.length;s++)lookup$1[chars.charCodeAt(s)]=s;const decode$1=s=>{let t=s.length*.75,n=s.length,Ae,Ne=0,tr,er,ir,sr;s[s.length-1]==="="&&(t--,s[s.length-2]==="="&&t--);const rr=new ArrayBuffer(t),nr=new Uint8Array(rr);for(Ae=0;Ae<n;Ae+=4)tr=lookup$1[s.charCodeAt(Ae)],er=lookup$1[s.charCodeAt(Ae+1)],ir=lookup$1[s.charCodeAt(Ae+2)],sr=lookup$1[s.charCodeAt(Ae+3)],nr[Ne++]=tr<<2|er>>4,nr[Ne++]=(er&15)<<4|ir>>2,nr[Ne++]=(ir&3)<<6|sr&63;return rr},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(s,t)=>{if(typeof s!="string")return{type:"message",data:mapBinary(s,t)};const n=s.charAt(0);return n==="b"?{type:"message",data:decodeBase64Packet(s.substring(1),t)}:PACKET_TYPES_REVERSE[n]?s.length>1?{type:PACKET_TYPES_REVERSE[n],data:s.substring(1)}:{type:PACKET_TYPES_REVERSE[n]}:ERROR_PACKET},decodeBase64Packet=(s,t)=>{if(withNativeArrayBuffer$1){const n=decode$1(s);return mapBinary(n,t)}else return{base64:!0,data:s}},mapBinary=(s,t)=>{switch(t){case"blob":return s instanceof Blob?s:new Blob([s]);case"arraybuffer":default:return s instanceof ArrayBuffer?s:s.buffer}},SEPARATOR="",encodePayload=(s,t)=>{const n=s.length,Ae=new Array(n);let Ne=0;s.forEach((tr,er)=>{encodePacket(tr,!1,ir=>{Ae[er]=ir,++Ne===n&&t(Ae.join(SEPARATOR))})})},decodePayload=(s,t)=>{const n=s.split(SEPARATOR),Ae=[];for(let Ne=0;Ne<n.length;Ne++){const tr=decodePacket(n[Ne],t);if(Ae.push(tr),tr.type==="error")break}return Ae};function createPacketEncoderStream(){return new TransformStream({transform(s,t){encodePacketToBinary(s,n=>{const Ae=n.length;let Ne;if(Ae<126)Ne=new Uint8Array(1),new DataView(Ne.buffer).setUint8(0,Ae);else if(Ae<65536){Ne=new Uint8Array(3);const tr=new DataView(Ne.buffer);tr.setUint8(0,126),tr.setUint16(1,Ae)}else{Ne=new Uint8Array(9);const tr=new DataView(Ne.buffer);tr.setUint8(0,127),tr.setBigUint64(1,BigInt(Ae))}s.data&&typeof s.data!="string"&&(Ne[0]|=128),t.enqueue(Ne),t.enqueue(n)})}})}let TEXT_DECODER;function totalLength(s){return s.reduce((t,n)=>t+n.length,0)}function concatChunks(s,t){if(s[0].length===t)return s.shift();const n=new Uint8Array(t);let Ae=0;for(let Ne=0;Ne<t;Ne++)n[Ne]=s[0][Ae++],Ae===s[0].length&&(s.shift(),Ae=0);return s.length&&Ae<s[0].length&&(s[0]=s[0].slice(Ae)),n}function createPacketDecoderStream(s,t){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const n=[];let Ae=0,Ne=-1,tr=!1;return new TransformStream({transform(er,ir){for(n.push(er);;){if(Ae===0){if(totalLength(n)<1)break;const sr=concatChunks(n,1);tr=(sr[0]&128)===128,Ne=sr[0]&127,Ne<126?Ae=3:Ne===126?Ae=1:Ae=2}else if(Ae===1){if(totalLength(n)<2)break;const sr=concatChunks(n,2);Ne=new DataView(sr.buffer,sr.byteOffset,sr.length).getUint16(0),Ae=3}else if(Ae===2){if(totalLength(n)<8)break;const sr=concatChunks(n,8),rr=new DataView(sr.buffer,sr.byteOffset,sr.length),nr=rr.getUint32(0);if(nr>Math.pow(2,21)-1){ir.enqueue(ERROR_PACKET);break}Ne=nr*Math.pow(2,32)+rr.getUint32(4),Ae=3}else{if(totalLength(n)<Ne)break;const sr=concatChunks(n,Ne);ir.enqueue(decodePacket(tr?sr:TEXT_DECODER.decode(sr),t)),Ae=0}if(Ne===0||Ne>s){ir.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(s){if(s)return mixin(s)}function mixin(s){for(var t in Emitter.prototype)s[t]=Emitter.prototype[t];return s}Emitter.prototype.on=Emitter.prototype.addEventListener=function(s,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(t),this};Emitter.prototype.once=function(s,t){function n(){this.off(s,n),t.apply(this,arguments)}return n.fn=t,this.on(s,n),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(s,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+s];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var Ae,Ne=0;Ne<n.length;Ne++)if(Ae=n[Ne],Ae===t||Ae.fn===t){n.splice(Ne,1);break}return n.length===0&&delete this._callbacks["$"+s],this};Emitter.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+s],Ae=1;Ae<arguments.length;Ae++)t[Ae-1]=arguments[Ae];if(n){n=n.slice(0);for(var Ae=0,Ne=n.length;Ae<Ne;++Ae)n[Ae].apply(this,t)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};Emitter.prototype.hasListeners=function(s){return!!this.listeners(s).length};const globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function pick(s,...t){return t.reduce((n,Ae)=>(s.hasOwnProperty(Ae)&&(n[Ae]=s[Ae]),n),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(s,t){t.useNativeTimers?(s.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),s.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(s.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),s.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(s){return typeof s=="string"?utf8Length(s):Math.ceil((s.byteLength||s.size)*BASE64_OVERHEAD)}function utf8Length(s){let t=0,n=0;for(let Ae=0,Ne=s.length;Ae<Ne;Ae++)t=s.charCodeAt(Ae),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(Ae++,n+=4);return n}function encode$1(s){let t="";for(let n in s)s.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(s[n]));return t}function decode(s){let t={},n=s.split("&");for(let Ae=0,Ne=n.length;Ae<Ne;Ae++){let tr=n[Ae].split("=");t[decodeURIComponent(tr[0])]=decodeURIComponent(tr[1])}return t}class TransportError extends Error{constructor(t,n,Ae){super(t),this.description=n,this.context=Ae,this.type="TransportError"}}class Transport extends Emitter{constructor(t){super(),this.writable=!1,installTimerFunctions(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,n,Ae){return super.emitReserved("error",new TransportError(t,n,Ae)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=decodePacket(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=encode$1(t);return n.length?"?"+n:""}}const alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={};let seed=0,i$1=0,prev;function encode(s){let t="";do t=alphabet[s%length]+t,s=Math.floor(s/length);while(s>0);return t}function yeast(){const s=encode(+new Date);return s!==prev?(seed=0,prev=s):s+"."+encode(seed++)}for(;i$1<length;i$1++)map[alphabet[i$1]]=i$1;let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const hasCORS=value;function XHR(s){const t=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||hasCORS))return new XMLHttpRequest}catch{}if(!t)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function createCookieJar(){}function empty(){}const hasXHR2=function(){return new XHR({xdomain:!1}).responseType!=null}();class Polling extends Transport{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const Ae=location.protocol==="https:";let Ne=location.port;Ne||(Ne=Ae?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||Ne!==t.port}const n=t&&t.forceBase64;this.supportsBinary=hasXHR2&&!n,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let Ae=0;this.polling&&(Ae++,this.once("pollComplete",function(){--Ae||n()})),this.writable||(Ae++,this.once("drain",function(){--Ae||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=Ae=>{if(this.readyState==="opening"&&Ae.type==="open"&&this.onOpen(),Ae.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(Ae)};decodePayload(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,encodePayload(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=yeast()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}request(t={}){return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request$1(this.uri(),t)}doWrite(t,n){const Ae=this.request({method:"POST",data:t});Ae.on("success",n),Ae.on("error",(Ne,tr)=>{this.onError("xhr post error",Ne,tr)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,Ae)=>{this.onError("xhr poll error",n,Ae)}),this.pollXhr=t}}let Request$1=class vo extends Emitter{constructor(t,n){super(),installTimerFunctions(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.data=n.data!==void 0?n.data:null,this.create()}create(){var t;const n=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const Ae=this.xhr=new XHR(n);try{Ae.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){Ae.setDisableHeaderCheck&&Ae.setDisableHeaderCheck(!0);for(let Ne in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(Ne)&&Ae.setRequestHeader(Ne,this.opts.extraHeaders[Ne])}}catch{}if(this.method==="POST")try{Ae.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{Ae.setRequestHeader("Accept","*/*")}catch{}(t=this.opts.cookieJar)===null||t===void 0||t.addCookies(Ae),"withCredentials"in Ae&&(Ae.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(Ae.timeout=this.opts.requestTimeout),Ae.onreadystatechange=()=>{var Ne;Ae.readyState===3&&((Ne=this.opts.cookieJar)===null||Ne===void 0||Ne.parseCookies(Ae)),Ae.readyState===4&&(Ae.status===200||Ae.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof Ae.status=="number"?Ae.status:0)},0))},Ae.send(this.data)}catch(Ne){this.setTimeoutFn(()=>{this.onError(Ne)},0);return}typeof document<"u"&&(this.index=vo.requestsCount++,vo.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=empty,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete vo.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Request$1.requestsCount=0;Request$1.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const s="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(s,unloadHandler,!1)}}function unloadHandler(){for(let s in Request$1.requests)Request$1.requests.hasOwnProperty(s)&&Request$1.requests[s].abort()}const nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),WebSocket$1=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class WS extends Transport{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),n=this.opts.protocols,Ae=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(Ae.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?n?new WebSocket$1(t,n):new WebSocket$1(t):new WebSocket$1(t,n,Ae)}catch(Ne){return this.emitReserved("error",Ne)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const Ae=t[n],Ne=n===t.length-1;encodePacket(Ae,this.supportsBinary,tr=>{const er={};try{usingBrowserWebSocket&&this.ws.send(tr)}catch{}Ne&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=yeast()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}check(){return!!WebSocket$1}}class WT extends Transport{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(t=>{const n=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),Ae=t.readable.pipeThrough(n).getReader(),Ne=createPacketEncoderStream();Ne.readable.pipeTo(t.writable),this.writer=Ne.writable.getWriter();const tr=()=>{Ae.read().then(({done:ir,value:sr})=>{ir||(this.onPacket(sr),tr())}).catch(ir=>{})};tr();const er={type:"open"};this.query.sid&&(er.data=`{"sid":"${this.query.sid}"}`),this.writer.write(er).then(()=>this.onOpen())})}))}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const Ae=t[n],Ne=n===t.length-1;this.writer.write(Ae).then(()=>{Ne&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this.transport)===null||t===void 0||t.close()}}const transports={websocket:WS,webtransport:WT,polling:Polling},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(s){if(s.length>2e3)throw"URI too long";const t=s,n=s.indexOf("["),Ae=s.indexOf("]");n!=-1&&Ae!=-1&&(s=s.substring(0,n)+s.substring(n,Ae).replace(/:/g,";")+s.substring(Ae,s.length));let Ne=re.exec(s||""),tr={},er=14;for(;er--;)tr[parts[er]]=Ne[er]||"";return n!=-1&&Ae!=-1&&(tr.source=t,tr.host=tr.host.substring(1,tr.host.length-1).replace(/;/g,":"),tr.authority=tr.authority.replace("[","").replace("]","").replace(/;/g,":"),tr.ipv6uri=!0),tr.pathNames=pathNames(tr,tr.path),tr.queryKey=queryKey(tr,tr.query),tr}function pathNames(s,t){const n=/\/{2,9}/g,Ae=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&Ae.splice(0,1),t.slice(-1)=="/"&&Ae.splice(Ae.length-1,1),Ae}function queryKey(s,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Ae,Ne,tr){Ne&&(n[Ne]=tr)}),n}let Socket$1=class fo extends Emitter{constructor(t,n={}){super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],t&&typeof t=="object"&&(n=t,t=null),t?(t=parse(t),n.hostname=t.host,n.secure=t.protocol==="https"||t.protocol==="wss",n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=parse(n.host).host),installTimerFunctions(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=protocol$1,n.transport=t,this.id&&(n.sid=this.id);const Ae=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new transports[t](Ae)}open(){let t;if(this.opts.rememberUpgrade&&fo.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch{this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),Ae=!1;fo.priorWebsocketSuccess=!1;const Ne=()=>{Ae||(n.send([{type:"ping",data:"probe"}]),n.once("packet",ar=>{if(!Ae)if(ar.type==="pong"&&ar.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;fo.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{Ae||this.readyState!=="closed"&&(nr(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const or=new Error("probe error");or.transport=n.name,this.emitReserved("upgradeError",or)}}))};function tr(){Ae||(Ae=!0,nr(),n.close(),n=null)}const er=ar=>{const or=new Error("probe error: "+ar);or.transport=n.name,tr(),this.emitReserved("upgradeError",or)};function ir(){er("transport closed")}function sr(){er("socket closed")}function rr(ar){n&&ar.name!==n.name&&tr()}const nr=()=>{n.removeListener("open",Ne),n.removeListener("error",er),n.removeListener("close",ir),this.off("close",sr),this.off("upgrading",rr)};n.once("open",Ne),n.once("error",er),n.once("close",ir),this.once("close",sr),this.once("upgrading",rr),this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{Ae||n.open()},200):n.open()}onOpen(){if(this.readyState="open",fo.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let Ae=0;Ae<this.writeBuffer.length;Ae++){const Ne=this.writeBuffer[Ae].data;if(Ne&&(n+=byteLength(Ne)),Ae>0&&n>this.maxPayload)return this.writeBuffer.slice(0,Ae);n+=2}return this.writeBuffer}write(t,n,Ae){return this.sendPacket("message",t,n,Ae),this}send(t,n,Ae){return this.sendPacket("message",t,n,Ae),this}sendPacket(t,n,Ae,Ne){if(typeof n=="function"&&(Ne=n,n=void 0),typeof Ae=="function"&&(Ne=Ae,Ae=null),this.readyState==="closing"||this.readyState==="closed")return;Ae=Ae||{},Ae.compress=Ae.compress!==!1;const tr={type:t,data:n,options:Ae};this.emitReserved("packetCreate",tr),this.writeBuffer.push(tr),Ne&&this.once("flush",Ne),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},Ae=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?Ae():t()}):this.upgrading?Ae():t()),this}onError(t){fo.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let Ae=0;const Ne=t.length;for(;Ae<Ne;Ae++)~this.transports.indexOf(t[Ae])&&n.push(t[Ae]);return n}};Socket$1.protocol=protocol$1;function url(s,t="",n){let Ae=s;n=n||typeof location<"u"&&location,s==null&&(s=n.protocol+"//"+n.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=n.protocol+s:s=n.host+s),/^(https?|wss?):\/\//.test(s)||(typeof n<"u"?s=n.protocol+"//"+s:s="https://"+s),Ae=parse(s)),Ae.port||(/^(http|ws)$/.test(Ae.protocol)?Ae.port="80":/^(http|ws)s$/.test(Ae.protocol)&&(Ae.port="443")),Ae.path=Ae.path||"/";const tr=Ae.host.indexOf(":")!==-1?"["+Ae.host+"]":Ae.host;return Ae.id=Ae.protocol+"://"+tr+":"+Ae.port+t,Ae.href=Ae.protocol+"://"+tr+(n&&n.port===Ae.port?"":":"+Ae.port),Ae}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString.call(File)==="[object FileConstructor]";function isBinary(s){return withNativeArrayBuffer&&(s instanceof ArrayBuffer||isView(s))||withNativeBlob&&s instanceof Blob||withNativeFile&&s instanceof File}function hasBinary(s,t){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let n=0,Ae=s.length;n<Ae;n++)if(hasBinary(s[n]))return!0;return!1}if(isBinary(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return hasBinary(s.toJSON(),!0);for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n)&&hasBinary(s[n]))return!0;return!1}function deconstructPacket(s){const t=[],n=s.data,Ae=s;return Ae.data=_deconstructPacket(n,t),Ae.attachments=t.length,{packet:Ae,buffers:t}}function _deconstructPacket(s,t){if(!s)return s;if(isBinary(s)){const n={_placeholder:!0,num:t.length};return t.push(s),n}else if(Array.isArray(s)){const n=new Array(s.length);for(let Ae=0;Ae<s.length;Ae++)n[Ae]=_deconstructPacket(s[Ae],t);return n}else if(typeof s=="object"&&!(s instanceof Date)){const n={};for(const Ae in s)Object.prototype.hasOwnProperty.call(s,Ae)&&(n[Ae]=_deconstructPacket(s[Ae],t));return n}return s}function reconstructPacket(s,t){return s.data=_reconstructPacket(s.data,t),delete s.attachments,s}function _reconstructPacket(s,t){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<t.length)return t[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let n=0;n<s.length;n++)s[n]=_reconstructPacket(s[n],t);else if(typeof s=="object")for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&(s[n]=_reconstructPacket(s[n],t));return s}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));class Encoder{constructor(t){this.replacer=t}encode(t){return(t.type===PacketType.EVENT||t.type===PacketType.ACK)&&hasBinary(t)?this.encodeAsBinary({type:t.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===PacketType.BINARY_EVENT||t.type===PacketType.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=deconstructPacket(t),Ae=this.encodeAsString(n.packet),Ne=n.buffers;return Ne.unshift(Ae),Ne}}function isObject(s){return Object.prototype.toString.call(s)==="[object Object]"}class Decoder extends Emitter{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const Ae=n.type===PacketType.BINARY_EVENT;Ae||n.type===PacketType.BINARY_ACK?(n.type=Ae?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(isBinary(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const Ae={type:Number(t.charAt(0))};if(PacketType[Ae.type]===void 0)throw new Error("unknown packet type "+Ae.type);if(Ae.type===PacketType.BINARY_EVENT||Ae.type===PacketType.BINARY_ACK){const tr=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const er=t.substring(tr,n);if(er!=Number(er)||t.charAt(n)!=="-")throw new Error("Illegal attachments");Ae.attachments=Number(er)}if(t.charAt(n+1)==="/"){const tr=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););Ae.nsp=t.substring(tr,n)}else Ae.nsp="/";const Ne=t.charAt(n+1);if(Ne!==""&&Number(Ne)==Ne){const tr=n+1;for(;++n;){const er=t.charAt(n);if(er==null||Number(er)!=er){--n;break}if(n===t.length)break}Ae.id=Number(t.substring(tr,n+1))}if(t.charAt(++n)){const tr=this.tryParse(t.substr(n));if(Decoder.isPayloadValid(Ae.type,tr))Ae.data=tr;else throw new Error("invalid payload")}return Ae}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case PacketType.CONNECT:return isObject(n);case PacketType.DISCONNECT:return n===void 0;case PacketType.CONNECT_ERROR:return typeof n=="string"||isObject(n);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&RESERVED_EVENTS$1.indexOf(n[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BinaryReconstructor{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder,Encoder,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(s,t,n){return s.on(t,n),function(){s.off(t,n)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(t,n,Ae){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,Ae&&Ae.auth&&(this.auth=Ae.auth),this._opts=Object.assign({},Ae),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[on(t,"open",this.onopen.bind(this)),on(t,"packet",this.onpacket.bind(this)),on(t,"error",this.onerror.bind(this)),on(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){if(RESERVED_EVENTS.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const Ae={type:PacketType.EVENT,data:n};if(Ae.options={},Ae.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const er=this.ids++,ir=n.pop();this._registerAckCallback(er,ir),Ae.id=er}const Ne=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!Ne||!this.connected)||(this.connected?(this.notifyOutgoingListeners(Ae),this.packet(Ae)):this.sendBuffer.push(Ae)),this.flags={},this}_registerAckCallback(t,n){var Ae;const Ne=(Ae=this.flags.timeout)!==null&&Ae!==void 0?Ae:this._opts.ackTimeout;if(Ne===void 0){this.acks[t]=n;return}const tr=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let ir=0;ir<this.sendBuffer.length;ir++)this.sendBuffer[ir].id===t&&this.sendBuffer.splice(ir,1);n.call(this,new Error("operation has timed out"))},Ne),er=(...ir)=>{this.io.clearTimeoutFn(tr),n.apply(this,ir)};er.withError=!0,this.acks[t]=er}emitWithAck(t,...n){return new Promise((Ae,Ne)=>{const tr=(er,ir)=>er?Ne(er):Ae(ir);tr.withError=!0,n.push(tr),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const Ae={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((Ne,...tr)=>Ae!==this._queue[0]?void 0:(Ne!==null?Ae.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(Ne)):(this._queue.shift(),n&&n(null,...tr)),Ae.pending=!1,this._drainQueue())),this._queue.push(Ae),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(Ae=>String(Ae.id)===t)){const Ae=this.acks[t];delete this.acks[t],Ae.withError&&Ae.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case PacketType.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(t);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(t);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const Ae=new Error(t.data.message);Ae.data=t.data.data,this.emitReserved("connect_error",Ae);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const Ae of n)Ae.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let Ae=!1;return function(...Ne){Ae||(Ae=!0,n.packet({type:PacketType.ACK,id:t,data:Ne}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let Ae=0;Ae<n.length;Ae++)if(t===n[Ae])return n.splice(Ae,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let Ae=0;Ae<n.length;Ae++)if(t===n[Ae])return n.splice(Ae,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const Ae of n)Ae.apply(this,t.data)}}}function Backoff(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*s);s=Math.floor(t*10)&1?s+n:s-n}return Math.min(s,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(s){this.ms=s};Backoff.prototype.setMax=function(s){this.max=s};Backoff.prototype.setJitter=function(s){this.jitter=s};class Manager extends Emitter{constructor(t,n){var Ae;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,installTimerFunctions(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((Ae=n.randomizationFactor)!==null&&Ae!==void 0?Ae:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const Ne=n.parser||parser;this.encoder=new Ne.Encoder,this.decoder=new Ne.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const n=this.engine,Ae=this;this._readyState="opening",this.skipReconnect=!1;const Ne=on(n,"open",function(){Ae.onopen(),t&&t()}),tr=ir=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",ir),t?t(ir):this.maybeReconnectOnOpen()},er=on(n,"error",tr);if(this._timeout!==!1){const ir=this._timeout,sr=this.setTimeoutFn(()=>{Ne(),tr(new Error("timeout")),n.close()},ir);this.opts.autoUnref&&sr.unref(),this.subs.push(()=>{this.clearTimeoutFn(sr)})}return this.subs.push(Ne),this.subs.push(er),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(on(t,"ping",this.onping.bind(this)),on(t,"data",this.ondata.bind(this)),on(t,"error",this.onerror.bind(this)),on(t,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){nextTick(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let Ae=this.nsps[t];return Ae?this._autoConnect&&!Ae.active&&Ae.connect():(Ae=new Socket(this,t,n),this.nsps[t]=Ae),Ae}_destroy(t){const n=Object.keys(this.nsps);for(const Ae of n)if(this.nsps[Ae].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let Ae=0;Ae<n.length;Ae++)this.engine.write(n[Ae],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,n){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const Ae=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(Ne=>{Ne?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",Ne)):t.onreconnect()}))},n);this.opts.autoUnref&&Ae.unref(),this.subs.push(()=>{this.clearTimeoutFn(Ae)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const cache={};function lookup(s,t){typeof s=="object"&&(t=s,s=void 0),t=t||{};const n=url(s,t.path||"/socket.io"),Ae=n.source,Ne=n.id,tr=n.path,er=cache[Ne]&&tr in cache[Ne].nsps,ir=t.forceNew||t["force new connection"]||t.multiplex===!1||er;let sr;return ir?sr=new Manager(Ae,t):(cache[Ne]||(cache[Ne]=new Manager(Ae,t)),sr=cache[Ne]),n.query&&!t.query&&(t.query=n.queryKey),sr.socket(n.path,t)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});const pve$1={position:i$2.POSITION.BOTTOM_RIGHT},useWebSocketStore=defineStore("websocket",()=>{const s=ref(null),t=ref(!1),n=ref([]),Ae=ref(null),Ne=ref(null),tr=ref(null);function er(){const rr=localStorage.getItem("userId"),nr=localStorage.getItem("userToken");if(!rr||!nr){i$2.error("User is not authorised",pve$1);return}s.value=lookup("wss://pve.finance",{path:"/api/ws/socket.io",query:{user_id:rr,token:nr},transports:["websocket"]}),s.value.on("connect",()=>{i$2.info("Connected to server via WebSocket",pve$1),t.value=!0}),s.value.on("disconnect",()=>{i$2.info("Disconnected from server",pve$1),t.value=!1}),s.value.on("reconnect_attempt",()=>{i$2.info("Attempting to reconnect...",pve$1)}),s.value.on("connect_error",ar=>{i$2.error("Connection error:",pve$1)}),s.value.on("log_message",ar=>{const or=ir(ar.message);n.value.push(or)}),s.value.on("update_chart",ar=>{ar.status==="success"?(Ae.value=ar.data,Ne.value=ar.precision,tr.value=ar.minMove):i$2.error("Error updating chart:",pve$1)})}function ir(rr){const nr=/^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2},\d+) - (.*?) - (.*?) - (.*)$/,ar=rr.match(nr);if(ar){const or=ar[1],ur=ar[3],hr=ar[4],cr=or.replace(",","."),vr=new Date(cr);return isNaN(vr.getTime())?{timestamp:new Date,level:ur,message:hr}:{timestamp:vr,level:ur,message:hr}}else return{timestamp:new Date,level:"INFO",message:rr}}function sr(){s.value&&(s.value.disconnect(),i$2.error("Disconnected from WebSocket",pve$1))}return{socket:s,isConnected:t,logs:n,chartData:Ae,precision:Ne,minMove:tr,initializeWebSocket:er,disconnectWebSocket:sr}}),_hoisted_1$4={class:"ma-settings"},_hoisted_2$4=["onUpdate:modelValue"],_hoisted_3$3=["onUpdate:modelValue"],_sfc_main$5={__name:"Chart",setup(s){const t=ref(null),n=ref(!1),Ae=useAuthStore();let Ne,tr,er;const ir=useWebSocketStore(),sr=reactive({}),rr={};let nr=[];function ar(){const mr="0123456789ABCDEF";let dr="#";for(let lr=0;lr<6;lr++)dr+=mr[Math.floor(Math.random()*16)];return dr}const or=JSON.parse(localStorage.getItem("maColors")||'{"order_1":"#28914d","order_2":"#28914d","order_3":"#28914d","order_4":"#28914d","order_5":"#28914d"}'),ur=computed(()=>ir.precision??2),hr=computed(()=>ir.minMove??.01);watch(sr,mr=>{const dr={};for(const lr in mr)dr[lr]=mr[lr].color;localStorage.setItem("maColors",JSON.stringify(dr))},{deep:!0}),onMounted(()=>{document.addEventListener("fullscreenchange",()=>{n.value=!!document.fullscreenElement}),Ae.isAuthenticated&&(Ne=Ve(t.value,{width:t.value.clientWidth,height:t.value.clientHeight,layout:{background:{type:"solid",color:"#222"},textColor:"#FFFFFF"},grid:{vertLines:{color:"#111"},horzLines:{color:"#111"}},timeScale:{timeVisible:!0,secondsVisible:!0}}),tr=Ne.addCandlestickSeries({upColor:"#4caf50",downColor:"#f44336",borderDownColor:"#f44336",borderUpColor:"#4caf50",wickDownColor:"#f44336",wickUpColor:"#4caf50"}),er=Ne.addHistogramSeries({priceFormat:{type:"volume"},priceScaleId:""}),er.priceScale().applyOptions({scaleMargins:{top:.7,bottom:0}}),tr.priceScale().applyOptions({scaleMargins:{top:.1,bottom:.2}}),ir.isConnected||ir.initializeWebSocket(),watch(()=>ir.chartData,mr=>{mr&&cr(mr)}),watch([ur,hr],([mr,dr])=>{tr&&tr.applyOptions({priceFormat:{type:"price",precision:mr,minMove:dr}})}),window.addEventListener("resize",()=>{Ne.resize(t.value.clientWidth,t.value.clientHeight)}))}),onBeforeUnmount(()=>{document.removeEventListener("fullscreenchange",()=>{n.value=!!document.fullscreenElement}),Ne&&Ne.remove()}),watch(sr,mr=>{Object.keys(mr).forEach(dr=>{const lr=mr[dr];if(lr.visible){if(!rr[dr]){const Er=Ne.addLineSeries({color:lr.color,lineWidth:2,title:dr});rr[dr]=Er}const gr=[];let fr=0,yr=null;nr.forEach(Er=>{const wr=Er[dr];wr===null||wr===0||wr==="None"?(fr++,fr<=15&&gr.push({time:Er.date,value:yr,color:"transparent"})):(fr=0,yr=wr,gr.push({time:Er.date,value:wr}))}),gr.sort((Er,wr)=>Er.time-wr.time),rr[dr].setData(gr),rr[dr].applyOptions({color:lr.color})}else rr[dr]&&(Ne.removeSeries(rr[dr]),delete rr[dr])})},{deep:!0});function cr(mr){if(nr=mr.slice(),nr&&Array.isArray(nr)){const dr=[],lr=[],gr=new Set,fr=[],yr={$:{position:"belowBar",shape:"circle",color:"rgba(0, 150, 136, 1)",lineWidth:3},"£":{position:"belowBar",shape:"arrowUp",color:"rgb(34,255,0)",lineWidth:5},"@":{position:"aboveBar",shape:"arrowDown",color:"rgb(255,0,0)",lineWidth:5}};nr.forEach(Er=>{const wr=Er.volume,Dr=Er.close>Er.open,kr=Dr?"rgba(76, 175, 80, 0.2)":"rgba(244, 67, 54, 0.2)",zr=Dr?"rgba(76, 175, 80, 0.1)":"rgba(244, 67, 54, 0.1)";dr.push({time:Er.date,open:Er.open,high:Er.high,low:Er.low,close:Er.close,color:kr}),lr.push({time:Er.date,value:wr,color:zr}),Object.keys(Er).forEach(Vr=>{if(!["date","open","high","low","close","volume"].includes(Vr)){const Hr=Object.keys(yr).find(Sr=>Vr.startsWith(Sr));if(Hr){if(Er[Vr]){const Sr=yr[Hr];Vr.substring(Hr.length);const Ar=Er[Vr]===!0?"signal":`${Er[Vr]}`;fr.push({time:Er.date,text:Ar,...Sr})}}else gr.add(Vr)}})}),tr.setMarkers(fr),gr.forEach(Er=>{sr[Er]||(sr[Er]={color:or[Er]||ar(),visible:!0})}),Object.keys(sr).forEach(Er=>{gr.has(Er)||(delete sr[Er],rr[Er]&&(Ne.removeSeries(rr[Er]),delete rr[Er]))}),dr.sort((Er,wr)=>Er.time-wr.time),tr.setData(dr),er.setData(lr),Object.keys(sr).forEach(Er=>{const wr=sr[Er];if(wr.visible){if(!rr[Er]){const Vr=Ne.addLineSeries({color:wr.color,lineWidth:2,title:Er});rr[Er]=Vr}const Dr=[];let kr=0,zr=null;nr.forEach(Vr=>{const Hr=Vr[Er];Hr===null||Hr===0||Hr==="None"?(kr++,kr<=15&&Dr.push({time:Vr.date,value:zr,color:"transparent"})):(kr=0,zr=Hr,Dr.push({time:Vr.date,value:Hr}))}),Dr.sort((Vr,Hr)=>Vr.time-Hr.time),rr[Er].setData(Dr)}else rr[Er]&&(Ne.removeSeries(rr[Er]),delete rr[Er])})}else console.error("Invalid data format:",nr)}function vr(){n.value?(document.exitFullscreen(),n.value=!1):(t.value.requestFullscreen(),n.value=!0)}return(mr,dr)=>(openBlock(),createElementBlock("div",{ref_key:"chartContainer",ref:t,class:"chart-container"},[createBaseVNode("button",{onClick:vr,class:"fullscreen-button"},toDisplayString(n.value?"Minimize":"Fullscreen"),1),createBaseVNode("div",_hoisted_1$4,[(openBlock(!0),createElementBlock(Fragment,null,renderList(sr,(lr,gr)=>(openBlock(),createElementBlock("div",{key:gr,class:"ma-setting"},[createBaseVNode("label",null,[withDirectives(createBaseVNode("input",{type:"checkbox","onUpdate:modelValue":fr=>lr.visible=fr},null,8,_hoisted_2$4),[[vModelCheckbox,lr.visible]]),createBaseVNode("span",null,toDisplayString(gr),1)]),withDirectives(createBaseVNode("input",{type:"color","onUpdate:modelValue":fr=>lr.color=fr},null,8,_hoisted_3$3),[[vModelText,lr.color]])]))),128))])],512))}},Chart=_export_sfc(_sfc_main$5,[["__scopeId","data-v-dfe9a2f3"]]);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},litegraph={};(function(exports){(function(global){var LiteGraph=global.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",NODE_BOX_OUTLINE_COLOR:"#FFF",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,GRID_SHAPE:6,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,NODE_MODES:["Always","On Event","Never","On Trigger"],NODE_MODES_COLORS:["#666","#422","#333","#224","#626"],ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,LINK_RENDER_MODES:["Straight","Linear","Spline"],STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,VERTICAL_LAYOUT:"vertical",proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,use_deferred_actions:!0,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},auto_sort_node_types:!1,node_box_coloured_when_on:!1,node_box_coloured_by_mode:!1,dialog_close_on_mouse_leave:!0,dialog_close_on_mouse_leave_delay:500,shift_click_do_break_link_from:!1,click_do_break_link_to:!1,search_hide_on_mouse_leave:!0,search_filter_enabled:!1,search_show_all_on_open:!0,auto_load_slot_types:!1,registered_slot_in_types:{},registered_slot_out_types:{},slot_types_in:[],slot_types_out:[],slot_types_default_in:[],slot_types_default_out:[],alt_drag_do_clone_nodes:!1,do_add_triggers_slots:!1,allow_multi_output_for_events:!0,middle_click_slot_add_default_node:!1,release_link_on_empty_shows_menu:!1,pointerevents_method:"mouse",ctrl_shift_v_paste_connect_unselected_outputs:!1,use_uuids:!1,registerNodeType:function(s,t){if(!t.prototype)throw"Cannot register a simple object, it must be a class with a prototype";t.type=s,LiteGraph.debug&&console.log("Node registered: "+s);const n=t.name,Ae=s.lastIndexOf("/");t.category=s.substring(0,Ae),t.title||(t.title=n);for(var Ne in LGraphNode.prototype)t.prototype[Ne]||(t.prototype[Ne]=LGraphNode.prototype[Ne]);const tr=this.registered_node_types[s];if(tr&&console.log("replacing node type: "+s),!Object.prototype.hasOwnProperty.call(t.prototype,"shape")&&(Object.defineProperty(t.prototype,"shape",{set:function(er){switch(er){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=er}},get:function(){return this._shape},enumerable:!0,configurable:!0}),t.supported_extensions))for(let er in t.supported_extensions){const ir=t.supported_extensions[er];ir&&ir.constructor===String&&(this.node_types_by_file_extension[ir.toLowerCase()]=t)}this.registered_node_types[s]=t,t.constructor.name&&(this.Nodes[n]=t),LiteGraph.onNodeTypeRegistered&&LiteGraph.onNodeTypeRegistered(s,t),tr&&LiteGraph.onNodeTypeReplaced&&LiteGraph.onNodeTypeReplaced(s,t,tr),t.prototype.onPropertyChange&&console.warn("LiteGraph node class "+s+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new t(t.title||"tmpnode")},unregisterNodeType:function(s){const t=s.constructor===String?this.registered_node_types[s]:s;if(!t)throw"node type not found: "+s;delete this.registered_node_types[t.type],t.constructor.name&&delete this.Nodes[t.constructor.name]},registerNodeAndSlotType:function(s,t,n){n=n||!1;const Ne=(s.constructor===String&&this.registered_node_types[s]!=="anonymous"?this.registered_node_types[s]:s).constructor.type;let tr=[];typeof t=="string"?tr=t.split(","):t==this.EVENT||t==this.ACTION?tr=["_event_"]:tr=["*"];for(let er=0;er<tr.length;++er){let ir=tr[er];ir===""&&(ir="*");const sr=n?"registered_slot_out_types":"registered_slot_in_types";this[sr][ir]===void 0&&(this[sr][ir]={nodes:[]}),this[sr][ir].nodes.includes(Ne)||this[sr][ir].nodes.push(Ne),n?this.slot_types_out.includes(ir.toLowerCase())||(this.slot_types_out.push(ir.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(ir.toLowerCase())||(this.slot_types_in.push(ir.toLowerCase()),this.slot_types_in.sort())}},buildNodeClassFromObject:function(s,t){var n="";if(t.inputs)for(var Ae=0;Ae<t.inputs.length;++Ae){var Ne=t.inputs[Ae][0],tr=t.inputs[Ae][1];tr&&tr.constructor===String&&(tr='"'+tr+'"'),n+="this.addInput('"+Ne+"',"+tr+`);
`}if(t.outputs)for(var Ae=0;Ae<t.outputs.length;++Ae){var Ne=t.outputs[Ae][0],tr=t.outputs[Ae][1];tr&&tr.constructor===String&&(tr='"'+tr+'"'),n+="this.addOutput('"+Ne+"',"+tr+`);
`}if(t.properties)for(var Ae in t.properties){var er=t.properties[Ae];er&&er.constructor===String&&(er='"'+er+'"'),n+="this.addProperty('"+Ae+"',"+er+`);
`}n+="if(this.onCreate)this.onCreate()";var ir=Function(n);for(var Ae in t)Ae!="inputs"&&Ae!="outputs"&&Ae!="properties"&&(ir.prototype[Ae]=t[Ae]);return ir.title=t.title||s.split("/").pop(),ir.desc=t.desc||"Generated from object",this.registerNodeType(s,ir),ir},wrapFunctionAsNode:function(s,t,n,Ae,Ne){var tr=Array(t.length),er="";if(n!==null)for(var ir=LiteGraph.getParameterNames(t),sr=0;sr<ir.length;++sr){var rr=0;n&&(n[sr]!=null&&n[sr].constructor===String?rr="'"+n[sr]+"'":n[sr]!=null&&(rr=n[sr])),er+="this.addInput('"+ir[sr]+"',"+rr+`);
`}Ae!==null&&(er+="this.addOutput('out',"+(Ae!=null?Ae.constructor===String?"'"+Ae+"'":Ae:0)+`);
`),Ne&&(er+="this.properties = "+JSON.stringify(Ne)+`;
`);var nr=Function(er);return nr.title=s.split("/").pop(),nr.desc="Generated from "+t.name,nr.prototype.onExecute=function(){for(var or=0;or<tr.length;++or)tr[or]=this.getInputData(or);var ur=t.apply(this,tr);this.setOutputData(0,ur)},this.registerNodeType(s,nr),nr},clearRegisteredTypes:function(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod:function(s,t){LGraphNode.prototype[s]=t;for(var n in this.registered_node_types){var Ae=this.registered_node_types[n];Ae.prototype[s]&&(Ae.prototype["_"+s]=Ae.prototype[s]),Ae.prototype[s]=t}},createNode:function(s,t,n){var Ae=this.registered_node_types[s];if(!Ae)return LiteGraph.debug&&console.log('GraphNode type "'+s+'" not registered.'),null;Ae.prototype,t=t||Ae.title||s;var Ne=null;if(LiteGraph.catch_exceptions)try{Ne=new Ae(t)}catch(er){return console.error(er),null}else Ne=new Ae(t);if(Ne.type=s,!Ne.title&&t&&(Ne.title=t),Ne.properties||(Ne.properties={}),Ne.properties_info||(Ne.properties_info=[]),Ne.flags||(Ne.flags={}),Ne.size||(Ne.size=Ne.computeSize()),Ne.pos||(Ne.pos=LiteGraph.DEFAULT_POSITION.concat()),Ne.mode||(Ne.mode=LiteGraph.ALWAYS),n)for(var tr in n)Ne[tr]=n[tr];return Ne.onNodeCreated&&Ne.onNodeCreated(),Ne},getNodeType:function(s){return this.registered_node_types[s]},getNodeTypesInCategory:function(s,t){var n=[];for(var Ae in this.registered_node_types){var Ne=this.registered_node_types[Ae];Ne.filter==t&&(s==""?Ne.category==null&&n.push(Ne):Ne.category==s&&n.push(Ne))}return this.auto_sort_node_types&&n.sort(function(tr,er){return tr.title.localeCompare(er.title)}),n},getNodeTypesCategories:function(s){var t={"":1};for(var n in this.registered_node_types){var Ae=this.registered_node_types[n];if(Ae.category&&!Ae.skip_list){if(Ae.filter!=s)continue;t[Ae.category]=1}}var Ne=[];for(var n in t)Ne.push(n);return this.auto_sort_node_types?Ne.sort():Ne},reloadNodes:function(s){for(var t=document.getElementsByTagName("script"),n=[],Ae=0;Ae<t.length;Ae++)n.push(t[Ae]);var Ne=document.getElementsByTagName("head")[0];s=document.location.href+s;for(var Ae=0;Ae<n.length;Ae++){var tr=n[Ae].src;if(!(!tr||tr.substr(0,s.length)!=s))try{LiteGraph.debug&&console.log("Reloading: "+tr);var er=document.createElement("script");er.type="text/javascript",er.src=tr,Ne.appendChild(er),Ne.removeChild(n[Ae])}catch(sr){if(LiteGraph.throw_errors)throw sr;LiteGraph.debug&&console.log("Error while reloading "+tr)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(s,t){if(s==null)return null;var n=JSON.parse(JSON.stringify(s));if(!t)return n;for(var Ae in n)t[Ae]=n[Ae];return t},uuidv4:function(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,s=>(s^Math.random()*16>>s/4).toString(16))},isValidConnection:function(s,t){if((s==""||s==="*")&&(s=0),(t==""||t==="*")&&(t=0),!s||!t||s==t||s==LiteGraph.EVENT&&t==LiteGraph.ACTION)return!0;if(s=String(s),t=String(t),s=s.toLowerCase(),t=t.toLowerCase(),s.indexOf(",")==-1&&t.indexOf(",")==-1)return s==t;for(var n=s.split(","),Ae=t.split(","),Ne=0;Ne<n.length;++Ne)for(var tr=0;tr<Ae.length;++tr)if(this.isValidConnection(n[Ne],Ae[tr]))return!0;return!1},registerSearchboxExtra:function(s,t,n){this.searchbox_extras[t.toLowerCase()]={type:s,desc:t,data:n}},fetchFile:function(s,t,n,Ae){if(!s)return null;if(t=t||"text",s.constructor===String)return s.substr(0,4)=="http"&&LiteGraph.proxy&&(s=LiteGraph.proxy+s.substr(s.indexOf(":")+3)),fetch(s).then(function(tr){if(!tr.ok)throw new Error("File not found");if(t=="arraybuffer")return tr.arrayBuffer();if(t=="text"||t=="string")return tr.text();if(t=="json")return tr.json();if(t=="blob")return tr.blob()}).then(function(tr){n&&n(tr)}).catch(function(tr){console.error("error fetching file:",s),Ae&&Ae(tr)});if(s.constructor===File||s.constructor===Blob){var Ne=new FileReader;if(Ne.onload=function(tr){var er=tr.target.result;t=="json"&&(er=JSON.parse(er)),n&&n(er)},t=="arraybuffer")return Ne.readAsArrayBuffer(s);if(t=="text"||t=="json")return Ne.readAsText(s);if(t=="blob")return Ne.readAsBinaryString(s)}return null}};typeof performance<"u"?LiteGraph.getTime=performance.now.bind(performance):typeof Date<"u"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process<"u"?LiteGraph.getTime=function(){var s=process.hrtime();return s[0]*.001+s[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()};function LGraph(s){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),s&&this.configure(s)}global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var s=0;s<this._nodes.length;++s){var t=this._nodes[s];t.onRemoved&&t.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(s){if(s.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";s.graph&&s.graph!=this&&s.graph.detachCanvas(s),s.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(s)},LGraph.prototype.detachCanvas=function(s){if(this.list_of_graphcanvas){var t=this.list_of_graphcanvas.indexOf(s);t!=-1&&(s.graph=null,this.list_of_graphcanvas.splice(t,1))}},LGraph.prototype.start=function(s){if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,s=s||0;var t=this;if(s==0&&typeof window<"u"&&window.requestAnimationFrame){let n=function(){t.execution_timer_id==-1&&(window.requestAnimationFrame(n),t.onBeforeStep&&t.onBeforeStep(),t.runStep(1,!t.catch_errors),t.onAfterStep&&t.onAfterStep())};this.execution_timer_id=-1,n()}else this.execution_timer_id=setInterval(function(){t.onBeforeStep&&t.onBeforeStep(),t.runStep(1,!t.catch_errors),t.onAfterStep&&t.onAfterStep()},s)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(s,t,n){s=s||1;var Ae=LiteGraph.getTime();this.globaltime=.001*(Ae-this.starttime);var Ne=this._nodes_executable?this._nodes_executable:this._nodes;if(Ne){if(n=n||Ne.length,t){for(var tr=0;tr<s;tr++){for(var er=0;er<n;++er){var ir=Ne[er];LiteGraph.use_deferred_actions&&ir._waiting_actions&&ir._waiting_actions.length&&ir.executePendingActions(),ir.mode==LiteGraph.ALWAYS&&ir.onExecute&&ir.doExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var tr=0;tr<s;tr++){for(var er=0;er<n;++er){var ir=Ne[er];LiteGraph.use_deferred_actions&&ir._waiting_actions&&ir._waiting_actions.length&&ir.executePendingActions(),ir.mode==LiteGraph.ALWAYS&&ir.onExecute&&ir.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(nr){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw nr;LiteGraph.debug&&console.log("Error during execution: "+nr),this.stop()}var sr=LiteGraph.getTime(),rr=sr-Ae;rr==0&&(rr=1),this.execution_time=.001*rr,this.globaltime+=.001*rr,this.iteration+=1,this.elapsed_time=(sr-this.last_update_time)*.001,this.last_update_time=sr,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var s=0;s<this._nodes_in_order.length;++s)this._nodes_in_order[s].onExecute&&this._nodes_executable.push(this._nodes_in_order[s])},LGraph.prototype.computeExecutionOrder=function(s,t){for(var n=[],Ae=[],Ne={},tr={},er={},ir=0,vr=this._nodes.length;ir<vr;++ir){var sr=this._nodes[ir];if(!(s&&!sr.onExecute)){Ne[sr.id]=sr;var rr=0;if(sr.inputs)for(var nr=0,ar=sr.inputs.length;nr<ar;nr++)sr.inputs[nr]&&sr.inputs[nr].link!=null&&(rr+=1);rr==0?(Ae.push(sr),t&&(sr._level=1)):(t&&(sr._level=0),er[sr.id]=rr)}}for(;Ae.length!=0;){var sr=Ae.shift();if(n.push(sr),delete Ne[sr.id],!!sr.outputs)for(var ir=0;ir<sr.outputs.length;ir++){var or=sr.outputs[ir];if(!(or==null||or.links==null||or.links.length==0))for(var nr=0;nr<or.links.length;nr++){var ur=or.links[nr],hr=this.links[ur];if(hr&&!tr[hr.id]){var cr=this.getNodeById(hr.target_id);if(cr==null){tr[hr.id]=!0;continue}t&&(!cr._level||cr._level<=sr._level)&&(cr._level=sr._level+1),tr[hr.id]=!0,er[cr.id]-=1,er[cr.id]==0&&Ae.push(cr)}}}}for(var ir in Ne)n.push(Ne[ir]);n.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");for(var vr=n.length,ir=0;ir<vr;++ir)n[ir].order=ir;n=n.sort(function(mr,dr){var lr=mr.constructor.priority||mr.priority||0,gr=dr.constructor.priority||dr.priority||0;return lr==gr?mr.order-dr.order:lr-gr});for(var ir=0;ir<vr;++ir)n[ir].order=ir;return n},LGraph.prototype.getAncestors=function(s){for(var t=[],n=[s],Ae={};n.length;){var Ne=n.shift();if(Ne.inputs){!Ae[Ne.id]&&Ne!=s&&(Ae[Ne.id]=!0,t.push(Ne));for(var tr=0;tr<Ne.inputs.length;++tr){var er=Ne.getInputNode(tr);er&&t.indexOf(er)==-1&&n.push(er)}}}return t.sort(function(ir,sr){return ir.order-sr.order}),t},LGraph.prototype.arrange=function(s,t){s=s||100;const n=this.computeExecutionOrder(!1,!0),Ae=[];for(let tr=0;tr<n.length;++tr){const er=n[tr],ir=er._level||1;Ae[ir]||(Ae[ir]=[]),Ae[ir].push(er)}let Ne=s;for(let tr=0;tr<Ae.length;++tr){const er=Ae[tr];if(!er)continue;let ir=100,sr=s+LiteGraph.NODE_TITLE_HEIGHT;for(let rr=0;rr<er.length;++rr){const nr=er[rr];nr.pos[0]=t==LiteGraph.VERTICAL_LAYOUT?sr:Ne,nr.pos[1]=t==LiteGraph.VERTICAL_LAYOUT?Ne:sr;const ar=t==LiteGraph.VERTICAL_LAYOUT?1:0;nr.size[ar]>ir&&(ir=nr.size[ar]);const or=t==LiteGraph.VERTICAL_LAYOUT?0:1;sr+=nr.size[or]+s+LiteGraph.NODE_TITLE_HEIGHT}Ne+=ir+s}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(s,t,n){n=n||LiteGraph.ALWAYS;var Ae=this._nodes_in_order?this._nodes_in_order:this._nodes;if(Ae)for(var Ne=0,tr=Ae.length;Ne<tr;++Ne){var er=Ae[Ne];if(er.constructor===LiteGraph.Subgraph&&s!="onExecute"){er.mode==n&&er.sendEventToAllNodes(s,t,n);continue}!er[s]||er.mode!=n||(t===void 0?er[s]():t&&t.constructor===Array?er[s].apply(er,t):er[s](t))}},LGraph.prototype.sendActionToCanvas=function(s,t){if(this.list_of_graphcanvas)for(var n=0;n<this.list_of_graphcanvas.length;++n){var Ae=this.list_of_graphcanvas[n];Ae[s]&&Ae[s].apply(Ae,t)}},LGraph.prototype.add=function(s,t){if(s){if(s.constructor===LGraphGroup){this._groups.push(s),this.setDirtyCanvas(!0),this.change(),s.graph=this,this._version++;return}if(s.id!=-1&&this._nodes_by_id[s.id]!=null&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?s.id=LiteGraph.uuidv4():s.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?(s.id==null||s.id==-1)&&(s.id=LiteGraph.uuidv4()):s.id==null||s.id==-1?s.id=++this.last_node_id:this.last_node_id<s.id&&(this.last_node_id=s.id),s.graph=this,this._version++,this._nodes.push(s),this._nodes_by_id[s.id]=s,s.onAdded&&s.onAdded(this),this.config.align_to_grid&&s.alignToGrid(),t||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(s),this.setDirtyCanvas(!0),this.change(),s}},LGraph.prototype.remove=function(s){if(s.constructor===LiteGraph.LGraphGroup){var t=this._groups.indexOf(s);t!=-1&&this._groups.splice(t,1),s.graph=null,this._version++,this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[s.id]!=null&&!s.ignore_remove){if(this.beforeChange(),s.inputs)for(var n=0;n<s.inputs.length;n++){var Ae=s.inputs[n];Ae.link!=null&&s.disconnectInput(n)}if(s.outputs)for(var n=0;n<s.outputs.length;n++){var Ae=s.outputs[n];Ae.links!=null&&Ae.links.length&&s.disconnectOutput(n)}if(s.onRemoved&&s.onRemoved(),s.graph=null,this._version++,this.list_of_graphcanvas)for(var n=0;n<this.list_of_graphcanvas.length;++n){var Ne=this.list_of_graphcanvas[n];Ne.selected_nodes[s.id]&&delete Ne.selected_nodes[s.id],Ne.node_dragged==s&&(Ne.node_dragged=null)}var tr=this._nodes.indexOf(s);tr!=-1&&this._nodes.splice(tr,1),delete this._nodes_by_id[s.id],this.onNodeRemoved&&this.onNodeRemoved(s),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(s){return s==null?null:this._nodes_by_id[s]},LGraph.prototype.findNodesByClass=function(s,t){t=t||[],t.length=0;for(var n=0,Ae=this._nodes.length;n<Ae;++n)this._nodes[n].constructor===s&&t.push(this._nodes[n]);return t},LGraph.prototype.findNodesByType=function(n,t){var n=n.toLowerCase();t=t||[],t.length=0;for(var Ae=0,Ne=this._nodes.length;Ae<Ne;++Ae)this._nodes[Ae].type.toLowerCase()==n&&t.push(this._nodes[Ae]);return t},LGraph.prototype.findNodeByTitle=function(s){for(var t=0,n=this._nodes.length;t<n;++t)if(this._nodes[t].title==s)return this._nodes[t];return null},LGraph.prototype.findNodesByTitle=function(s){for(var t=[],n=0,Ae=this._nodes.length;n<Ae;++n)this._nodes[n].title==s&&t.push(this._nodes[n]);return t},LGraph.prototype.getNodeOnPos=function(s,t,n,Ae){n=n||this._nodes;for(var Ne=null,tr=n.length-1;tr>=0;tr--){var er=n[tr];if(er.isPointInside(s,t,Ae))return er}return Ne},LGraph.prototype.getGroupOnPos=function(s,t){for(var n=this._groups.length-1;n>=0;n--){var Ae=this._groups[n];if(Ae.isPointInside(s,t,2,!0))return Ae}return null},LGraph.prototype.checkNodeTypes=function(){for(var s=0;s<this._nodes.length;s++){var t=this._nodes[s],n=LiteGraph.registered_node_types[t.type];if(t.constructor!=n){console.log("node being replaced by newer version: "+t.type);var Ae=LiteGraph.createNode(t.type);this._nodes[s]=Ae,Ae.configure(t.serialize()),Ae.graph=this,this._nodes_by_id[Ae.id]=Ae,t.inputs&&(Ae.inputs=t.inputs.concat()),t.outputs&&(Ae.outputs=t.outputs.concat())}}this.updateExecutionOrder()},LGraph.prototype.onAction=function(s,t,n){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var Ae=0;Ae<this._input_nodes.length;++Ae){var Ne=this._input_nodes[Ae];if(Ne.properties.name==s){Ne.actionDo(s,t,n);break}}},LGraph.prototype.trigger=function(s,t){this.onTrigger&&this.onTrigger(s,t)},LGraph.prototype.addInput=function(s,t,n){var Ae=this.inputs[s];Ae||(this.beforeChange(),this.inputs[s]={name:s,type:t,value:n},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(s,t),this.onInputsOutputsChange&&this.onInputsOutputsChange())},LGraph.prototype.setInputData=function(s,t){var n=this.inputs[s];n&&(n.value=t)},LGraph.prototype.getInputData=function(s){var t=this.inputs[s];return t?t.value:null},LGraph.prototype.renameInput=function(s,t){if(t!=s){if(!this.inputs[s])return!1;if(this.inputs[t])return console.error("there is already one input with that name"),!1;this.inputs[t]=this.inputs[s],delete this.inputs[s],this._version++,this.onInputRenamed&&this.onInputRenamed(s,t),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},LGraph.prototype.changeInputType=function(s,t){if(!this.inputs[s])return!1;this.inputs[s].type&&String(this.inputs[s].type).toLowerCase()==String(t).toLowerCase()||(this.inputs[s].type=t,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(s,t))},LGraph.prototype.removeInput=function(s){return this.inputs[s]?(delete this.inputs[s],this._version++,this.onInputRemoved&&this.onInputRemoved(s),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.addOutput=function(s,t,n){this.outputs[s]={name:s,type:t,value:n},this._version++,this.onOutputAdded&&this.onOutputAdded(s,t),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.setOutputData=function(s,t){var n=this.outputs[s];n&&(n.value=t)},LGraph.prototype.getOutputData=function(s){var t=this.outputs[s];return t?t.value:null},LGraph.prototype.renameOutput=function(s,t){if(!this.outputs[s])return!1;if(this.outputs[t])return console.error("there is already one output with that name"),!1;this.outputs[t]=this.outputs[s],delete this.outputs[s],this._version++,this.onOutputRenamed&&this.onOutputRenamed(s,t),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.changeOutputType=function(s,t){if(!this.outputs[s])return!1;this.outputs[s].type&&String(this.outputs[s].type).toLowerCase()==String(t).toLowerCase()||(this.outputs[s].type=t,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(s,t))},LGraph.prototype.removeOutput=function(s){return this.outputs[s]?(delete this.outputs[s],this._version++,this.onOutputRemoved&&this.onOutputRemoved(s),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.triggerInput=function(s,t){for(var n=this.findNodesByTitle(s),Ae=0;Ae<n.length;++Ae)n[Ae].onTrigger(t)},LGraph.prototype.setCallback=function(s,t){for(var n=this.findNodesByTitle(s),Ae=0;Ae<n.length;++Ae)n[Ae].setTrigger(t)},LGraph.prototype.beforeChange=function(s){this.onBeforeChange&&this.onBeforeChange(this,s),this.sendActionToCanvas("onBeforeChange",this)},LGraph.prototype.afterChange=function(s){this.onAfterChange&&this.onAfterChange(this,s),this.sendActionToCanvas("onAfterChange",this)},LGraph.prototype.connectionChange=function(s,t){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(s),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var s=0;s<this.list_of_graphcanvas.length;++s){var t=this.list_of_graphcanvas[s];if(t.live_mode)return!0}return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var s in this.links){var t=this.links[s];t&&t._last_time&&(t._last_time=0)}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(s,t){this.sendActionToCanvas("setDirty",[s,t])},LGraph.prototype.removeLink=function(s){var t=this.links[s];if(t){var n=this.getNodeById(t.target_id);n&&n.disconnectInput(t.target_slot)}},LGraph.prototype.serialize=function(){for(var s=[],t=0,n=this._nodes.length;t<n;++t)s.push(this._nodes[t].serialize());var Ae=[];for(var t in this.links){var Ne=this.links[t];if(!Ne.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var tr=new LLink;for(var er in Ne)tr[er]=Ne[er];this.links[t]=tr,Ne=tr}Ae.push(Ne.serialize())}for(var ir=[],t=0;t<this._groups.length;++t)ir.push(this._groups[t].serialize());var sr={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:s,links:Ae,groups:ir,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return this.onSerialize&&this.onSerialize(sr),sr},LGraph.prototype.configure=function(s,t){if(s){t||this.clear();var n=s.nodes;if(s.links&&s.links.constructor===Array){for(var Ae=[],Ne=0;Ne<s.links.length;++Ne){var tr=s.links[Ne];if(!tr){console.warn("serialized graph link data contains errors, skipping.");continue}var er=new LLink;er.configure(tr),Ae[er.id]=er}s.links=Ae}for(var Ne in s)Ne=="nodes"||Ne=="groups"||(this[Ne]=s[Ne]);var ir=!1;if(this._nodes=[],n){for(var Ne=0,sr=n.length;Ne<sr;++Ne){var rr=n[Ne],nr=LiteGraph.createNode(rr.type,rr.title);nr||(LiteGraph.debug&&console.log("Node not found or has errors: "+rr.type),nr=new LGraphNode,nr.last_serialization=rr,nr.has_errors=!0,ir=!0),nr.id=rr.id,this.add(nr,!0)}for(var Ne=0,sr=n.length;Ne<sr;++Ne){var rr=n[Ne],nr=this.getNodeById(rr.id);nr&&nr.configure(rr)}}if(this._groups.length=0,s.groups)for(var Ne=0;Ne<s.groups.length;++Ne){var ar=new LiteGraph.LGraphGroup;ar.configure(s.groups[Ne]),this.add(ar)}return this.updateExecutionOrder(),this.extra=s.extra||{},this.onConfigure&&this.onConfigure(s),this._version++,this.setDirtyCanvas(!0,!0),ir}},LGraph.prototype.load=function(s,t){var n=this;if(s.constructor===File||s.constructor===Blob){var Ae=new FileReader;Ae.addEventListener("load",function(tr){var er=JSON.parse(tr.target.result);n.configure(er),t&&t()}),Ae.readAsText(s);return}var Ne=new XMLHttpRequest;Ne.open("GET",s,!0),Ne.send(null),Ne.onload=function(tr){if(Ne.status!==200){console.error("Error loading graph:",Ne.status,Ne.response);return}var er=JSON.parse(Ne.response);n.configure(er),t&&t()},Ne.onerror=function(tr){console.error("Error loading graph:",tr)}},LGraph.prototype.onNodeTrace=function(s,t,n){};function LLink(s,t,n,Ae,Ne,tr){this.id=s,this.type=t,this.origin_id=n,this.origin_slot=Ae,this.target_id=Ne,this.target_slot=tr,this._data=null,this._pos=new Float32Array(2)}LLink.prototype.configure=function(s){s.constructor===Array?(this.id=s[0],this.origin_id=s[1],this.origin_slot=s[2],this.target_id=s[3],this.target_slot=s[4],this.type=s[5]):(this.id=s.id,this.type=s.type,this.origin_id=s.origin_id,this.origin_slot=s.origin_slot,this.target_id=s.target_id,this.target_slot=s.target_slot)},LLink.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},LiteGraph.LLink=LLink;function LGraphNode(s){this._ctor(s)}global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(s){this.title=s||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(s){this.graph&&this.graph._version++;for(var t in s){if(t=="properties"){for(var n in s.properties)this.properties[n]=s.properties[n],this.onPropertyChanged&&this.onPropertyChanged(n,s.properties[n]);continue}s[t]!=null&&(typeof s[t]=="object"?this[t]&&this[t].configure?this[t].configure(s[t]):this[t]=LiteGraph.cloneObject(s[t],this[t]):this[t]=s[t])}if(s.title||(this.title=this.constructor.title),this.inputs)for(var Ae=0;Ae<this.inputs.length;++Ae){var Ne=this.inputs[Ae],tr=this.graph?this.graph.links[Ne.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,Ae,!0,tr,Ne),this.onInputAdded&&this.onInputAdded(Ne)}if(this.outputs)for(var Ae=0;Ae<this.outputs.length;++Ae){var er=this.outputs[Ae];if(er.links){for(var t=0;t<er.links.length;++t){var tr=this.graph?this.graph.links[er.links[t]]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,Ae,!0,tr,er)}this.onOutputAdded&&this.onOutputAdded(er)}}if(this.widgets){for(var Ae=0;Ae<this.widgets.length;++Ae){var ir=this.widgets[Ae];ir&&ir.options&&ir.options.property&&this.properties[ir.options.property]!=null&&(ir.value=JSON.parse(JSON.stringify(this.properties[ir.options.property])))}if(s.widgets_values)for(var Ae=0;Ae<s.widgets_values.length;++Ae)this.widgets[Ae]&&(this.widgets[Ae].value=s.widgets_values[Ae])}this.onConfigure&&this.onConfigure(s)},LGraphNode.prototype.serialize=function(){var s={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(s.inputs=this.inputs),this.outputs){for(var t=0;t<this.outputs.length;t++)delete this.outputs[t]._data;s.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(s.title=this.title),this.properties&&(s.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){s.widgets_values=[];for(var t=0;t<this.widgets.length;++t)this.widgets[t]?s.widgets_values[t]=this.widgets[t].value:s.widgets_values[t]=null}return s.type||(s.type=this.constructor.type),this.color&&(s.color=this.color),this.bgcolor&&(s.bgcolor=this.bgcolor),this.boxcolor&&(s.boxcolor=this.boxcolor),this.shape&&(s.shape=this.shape),this.onSerialize&&this.onSerialize(s)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),s},LGraphNode.prototype.clone=function(){var s=LiteGraph.createNode(this.type);if(!s)return null;var t=LiteGraph.cloneObject(this.serialize());if(t.inputs)for(var n=0;n<t.inputs.length;++n)t.inputs[n].link=null;if(t.outputs)for(var n=0;n<t.outputs.length;++n)t.outputs[n].links&&(t.outputs[n].links.length=0);return delete t.id,LiteGraph.use_uuids&&(t.id=LiteGraph.uuidv4()),s.configure(t),s},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setProperty=function(s,t){if(this.properties||(this.properties={}),t!==this.properties[s]){var n=this.properties[s];if(this.properties[s]=t,this.onPropertyChanged&&this.onPropertyChanged(s,t,n)===!1&&(this.properties[s]=n),this.widgets)for(var Ae=0;Ae<this.widgets.length;++Ae){var Ne=this.widgets[Ae];if(Ne&&Ne.options.property==s){Ne.value=t;break}}}},LGraphNode.prototype.setOutputData=function(s,t){if(this.outputs&&!(s==-1||s>=this.outputs.length)){var n=this.outputs[s];if(n&&(n._data=t,this.outputs[s].links))for(var Ae=0;Ae<this.outputs[s].links.length;Ae++){var Ne=this.outputs[s].links[Ae],tr=this.graph.links[Ne];tr&&(tr.data=t)}}},LGraphNode.prototype.setOutputDataType=function(s,t){if(this.outputs&&!(s==-1||s>=this.outputs.length)){var n=this.outputs[s];if(n&&(n.type=t,this.outputs[s].links))for(var Ae=0;Ae<this.outputs[s].links.length;Ae++){var Ne=this.outputs[s].links[Ae];this.graph.links[Ne].type=t}}},LGraphNode.prototype.getInputData=function(s,t){if(this.inputs&&!(s>=this.inputs.length||this.inputs[s].link==null)){var n=this.inputs[s].link,Ae=this.graph.links[n];if(!Ae)return null;if(!t)return Ae.data;var Ne=this.graph.getNodeById(Ae.origin_id);return Ne&&(Ne.updateOutputData?Ne.updateOutputData(Ae.origin_slot):Ne.onExecute&&Ne.onExecute()),Ae.data}},LGraphNode.prototype.getInputDataType=function(s){if(!this.inputs||s>=this.inputs.length||this.inputs[s].link==null)return null;var t=this.inputs[s].link,n=this.graph.links[t];if(!n)return null;var Ae=this.graph.getNodeById(n.origin_id);if(!Ae)return n.type;var Ne=Ae.outputs[n.origin_slot];return Ne?Ne.type:null},LGraphNode.prototype.getInputDataByName=function(s,t){var n=this.findInputSlot(s);return n==-1?null:this.getInputData(n,t)},LGraphNode.prototype.isInputConnected=function(s){return this.inputs?s<this.inputs.length&&this.inputs[s].link!=null:!1},LGraphNode.prototype.getInputInfo=function(s){return this.inputs&&s<this.inputs.length?this.inputs[s]:null},LGraphNode.prototype.getInputLink=function(s){if(!this.inputs)return null;if(s<this.inputs.length){var t=this.inputs[s];return this.graph.links[t.link]}return null},LGraphNode.prototype.getInputNode=function(s){if(!this.inputs||s>=this.inputs.length)return null;var t=this.inputs[s];if(!t||t.link===null)return null;var n=this.graph.links[t.link];return n?this.graph.getNodeById(n.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(s){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[s]:null;for(var t=0,n=this.inputs.length;t<n;++t){var Ae=this.inputs[t];if(s==Ae.name&&Ae.link!=null){var Ne=this.graph.links[Ae.link];if(Ne)return Ne.data}}return this.properties[s]},LGraphNode.prototype.getOutputData=function(s){if(!this.outputs||s>=this.outputs.length)return null;var t=this.outputs[s];return t._data},LGraphNode.prototype.getOutputInfo=function(s){return this.outputs&&s<this.outputs.length?this.outputs[s]:null},LGraphNode.prototype.isOutputConnected=function(s){return this.outputs?s<this.outputs.length&&this.outputs[s].links&&this.outputs[s].links.length:!1},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var s=0;s<this.outputs.length;++s)if(this.outputs[s].links&&this.outputs[s].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(s){if(!this.outputs||this.outputs.length==0||s>=this.outputs.length)return null;var t=this.outputs[s];if(!t.links||t.links.length==0)return null;for(var n=[],Ae=0;Ae<t.links.length;Ae++){var Ne=t.links[Ae],tr=this.graph.links[Ne];if(tr){var er=this.graph.getNodeById(tr.target_id);er&&n.push(er)}}return n},LGraphNode.prototype.addOnTriggerInput=function(){var s=this.findInputSlot("onTrigger");if(s==-1){//!trigS || 
return this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")}return s},LGraphNode.prototype.addOnExecutedOutput=function(){var s=this.findOutputSlot("onExecuted");if(s==-1){//!trigS || 
return this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")}return s},LGraphNode.prototype.onAfterExecuteNode=function(s,t){var n=this.findOutputSlot("onExecuted");n!=-1&&this.triggerSlot(n,s,null,t)},LGraphNode.prototype.changeMode=function(s){switch(s){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=s,!0},LGraphNode.prototype.executePendingActions=function(){if(!(!this._waiting_actions||!this._waiting_actions.length)){for(var s=0;s<this._waiting_actions.length;++s){var t=this._waiting_actions[s];this.onAction(t[0],t[1],t[2],t[3],t[4])}this._waiting_actions.length=0}},LGraphNode.prototype.doExecute=function(s,t){t=t||{},this.onExecute&&(t.action_call||(t.action_call=this.id+"_exec_"+Math.floor(Math.random()*9999)),this.graph.nodes_executing[this.id]=!0,this.onExecute(s,t),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,t&&t.action_call&&(this.action_call=t.action_call,this.graph.nodes_executedAction[this.id]=t.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(s,t)},LGraphNode.prototype.actionDo=function(s,t,n,Ae){n=n||{},this.onAction&&(n.action_call||(n.action_call=this.id+"_"+(s||"action")+"_"+Math.floor(Math.random()*9999)),this.graph.nodes_actioning[this.id]=s||"actioning",this.onAction(s,t,n,Ae),this.graph.nodes_actioning[this.id]=!1,n&&n.action_call&&(this.action_call=n.action_call,this.graph.nodes_executedAction[this.id]=n.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(t,n)},LGraphNode.prototype.trigger=function(s,t,n){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var Ae=0;Ae<this.outputs.length;++Ae){var Ne=this.outputs[Ae];!Ne||Ne.type!==LiteGraph.EVENT||s&&Ne.name!=s||this.triggerSlot(Ae,t,null,n)}}},LGraphNode.prototype.triggerSlot=function(s,t,n,Ae){if(Ae=Ae||{},!!this.outputs){if(s==null){console.error("slot must be a number");return}s.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");var Ne=this.outputs[s];if(Ne){var tr=Ne.links;if(!(!tr||!tr.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var er=0;er<tr.length;++er){var ir=tr[er];if(!(n!=null&&n!=ir)){var sr=this.graph.links[tr[er]];if(sr){sr._last_time=LiteGraph.getTime();var rr=this.graph.getNodeById(sr.target_id);if(rr){var nr=rr.inputs[sr.target_slot];if(rr.mode===LiteGraph.ON_TRIGGER)Ae.action_call||(Ae.action_call=this.id+"_trigg_"+Math.floor(Math.random()*9999)),rr.onExecute&&rr.doExecute(t,Ae);else if(rr.onAction){Ae.action_call||(Ae.action_call=this.id+"_act_"+Math.floor(Math.random()*9999));var nr=rr.inputs[sr.target_slot];LiteGraph.use_deferred_actions&&rr.onExecute?(rr._waiting_actions||(rr._waiting_actions=[]),rr._waiting_actions.push([nr.name,t,Ae,sr.target_slot])):rr.actionDo(nr.name,t,Ae,sr.target_slot)}}}}}}}}},LGraphNode.prototype.clearTriggeredSlot=function(s,t){if(this.outputs){var n=this.outputs[s];if(n){var Ae=n.links;if(!(!Ae||!Ae.length))for(var Ne=0;Ne<Ae.length;++Ne){var tr=Ae[Ne];if(!(t!=null&&t!=tr)){var er=this.graph.links[Ae[Ne]];er&&(er._last_time=0)}}}}},LGraphNode.prototype.setSize=function(s){this.size=s,this.onResize&&this.onResize(this.size)},LGraphNode.prototype.addProperty=function(s,t,n,Ae){var Ne={name:s,type:n,default_value:t};if(Ae)for(var tr in Ae)Ne[tr]=Ae[tr];return this.properties_info||(this.properties_info=[]),this.properties_info.push(Ne),this.properties||(this.properties={}),this.properties[s]=t,Ne},LGraphNode.prototype.addOutput=function(s,t,n){var Ae={name:s,type:t,links:null};if(n)for(var Ne in n)Ae[Ne]=n[Ne];return this.outputs||(this.outputs=[]),this.outputs.push(Ae),this.onOutputAdded&&this.onOutputAdded(Ae),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,t,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),Ae},LGraphNode.prototype.addOutputs=function(s){for(var t=0;t<s.length;++t){var n=s[t],Ae={name:n[0],type:n[1],link:null};if(s[2])for(var Ne in n[2])Ae[Ne]=n[2][Ne];this.outputs||(this.outputs=[]),this.outputs.push(Ae),this.onOutputAdded&&this.onOutputAdded(Ae),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,n[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(s){this.disconnectOutput(s),this.outputs.splice(s,1);for(var t=s;t<this.outputs.length;++t)if(!(!this.outputs[t]||!this.outputs[t].links))for(var n=this.outputs[t].links,Ae=0;Ae<n.length;++Ae){var Ne=this.graph.links[n[Ae]];Ne&&(Ne.origin_slot-=1)}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(s),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(s,t,n){t=t||0;var Ae={name:s,type:t,link:null};if(n)for(var Ne in n)Ae[Ne]=n[Ne];return this.inputs||(this.inputs=[]),this.inputs.push(Ae),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(Ae),LiteGraph.registerNodeAndSlotType(this,t),this.setDirtyCanvas(!0,!0),Ae},LGraphNode.prototype.addInputs=function(s){for(var t=0;t<s.length;++t){var n=s[t],Ae={name:n[0],type:n[1],link:null};if(s[2])for(var Ne in n[2])Ae[Ne]=n[2][Ne];this.inputs||(this.inputs=[]),this.inputs.push(Ae),this.onInputAdded&&this.onInputAdded(Ae),LiteGraph.registerNodeAndSlotType(this,n[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(s){this.disconnectInput(s);for(var t=this.inputs.splice(s,1),n=s;n<this.inputs.length;++n)if(this.inputs[n]){var Ae=this.graph.links[this.inputs[n].link];Ae&&(Ae.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(s,t[0]),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(s,t,n,Ae){var Ne={name:s,type:t,pos:n,direction:Ae,links:null};return this.connections.push(Ne),Ne},LGraphNode.prototype.computeSize=function(s){if(this.constructor.size)return this.constructor.size.concat();var t=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),n=s||new Float32Array([0,0]);t=Math.max(t,1);var Ae=LiteGraph.NODE_TEXT_SIZE,Ne=hr(this.title),tr=0,er=0;if(this.inputs)for(var ir=0,sr=this.inputs.length;ir<sr;++ir){var rr=this.inputs[ir],nr=rr.label||rr.name||"",ar=hr(nr);tr<ar&&(tr=ar)}if(this.outputs)for(var ir=0,sr=this.outputs.length;ir<sr;++ir){var or=this.outputs[ir],nr=or.label||or.name||"",ar=hr(nr);er<ar&&(er=ar)}n[0]=Math.max(tr+er+10,Ne),n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH*1.5)),n[1]=(this.constructor.slot_start_y||0)+t*LiteGraph.NODE_SLOT_HEIGHT;var ur=0;if(this.widgets&&this.widgets.length){for(var ir=0,sr=this.widgets.length;ir<sr;++ir)this.widgets[ir].computeSize?ur+=this.widgets[ir].computeSize(n[0])[1]+4:ur+=LiteGraph.NODE_WIDGET_HEIGHT+4;ur+=8}this.widgets_up?n[1]=Math.max(n[1],ur):this.widgets_start_y!=null?n[1]=Math.max(n[1],ur+this.widgets_start_y):n[1]+=ur;function hr(cr){return cr?Ae*cr.length*.6:0}return this.constructor.min_height&&n[1]<this.constructor.min_height&&(n[1]=this.constructor.min_height),n[1]+=6,n},LGraphNode.prototype.getPropertyInfo=function(s){var t=null;if(this.properties_info){for(var n=0;n<this.properties_info.length;++n)if(this.properties_info[n].name==s){t=this.properties_info[n];break}}return this.constructor["@"+s]&&(t=this.constructor["@"+s]),this.constructor.widgets_info&&this.constructor.widgets_info[s]&&(t=this.constructor.widgets_info[s]),!t&&this.onGetPropertyInfo&&(t=this.onGetPropertyInfo(s)),t||(t={}),t.type||(t.type=typeof this.properties[s]),t.widget=="combo"&&(t.type="enum"),t},LGraphNode.prototype.addWidget=function(s,t,n,Ae,Ne){this.widgets||(this.widgets=[]),!Ne&&Ae&&Ae.constructor===Object&&(Ne=Ae,Ae=null),Ne&&Ne.constructor===String&&(Ne={property:Ne}),Ae&&Ae.constructor===String&&(Ne||(Ne={}),Ne.property=Ae,Ae=null),Ae&&Ae.constructor!==Function&&(console.warn("addWidget: callback must be a function"),Ae=null);var tr={type:s.toLowerCase(),name:t,value:n,callback:Ae,options:Ne||{}};if(tr.options.y!==void 0&&(tr.y=tr.options.y),!Ae&&!tr.options.callback&&!tr.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),s=="combo"&&!tr.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(tr),this.setSize(this.computeSize()),tr},LGraphNode.prototype.addCustomWidget=function(s){return this.widgets||(this.widgets=[]),this.widgets.push(s),s},LGraphNode.prototype.getBounding=function(s,t){s=s||new Float32Array(4);const n=this.pos,Ae=this.flags.collapsed,Ne=this.size;let tr=0,er=1,ir=0,sr=0;return t&&(tr=4,er=6+tr,ir=4,sr=5+ir),s[0]=n[0]-tr,s[1]=n[1]-LiteGraph.NODE_TITLE_HEIGHT-ir,s[2]=Ae?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+er:Ne[0]+er,s[3]=Ae?LiteGraph.NODE_TITLE_HEIGHT+sr:Ne[1]+LiteGraph.NODE_TITLE_HEIGHT+sr,this.onBounding&&this.onBounding(s),s},LGraphNode.prototype.isPointInside=function(s,t,n,Ae){n=n||0;var Ne=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(Ae&&(Ne=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(s,t,this.pos[0]-n,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-n,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*n,LiteGraph.NODE_TITLE_HEIGHT+2*n))return!0}else if(this.pos[0]-4-n<s&&this.pos[0]+this.size[0]+4+n>s&&this.pos[1]-Ne-n<t&&this.pos[1]+this.size[1]+n>t)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(s,t){var n=new Float32Array(2);if(this.inputs)for(var Ae=0,Ne=this.inputs.length;Ae<Ne;++Ae){var tr=this.inputs[Ae];if(this.getConnectionPos(!0,Ae,n),isInsideRectangle(s,t,n[0]-10,n[1]-5,20,10))return{input:tr,slot:Ae,link_pos:n}}if(this.outputs)for(var Ae=0,Ne=this.outputs.length;Ae<Ne;++Ae){var er=this.outputs[Ae];if(this.getConnectionPos(!1,Ae,n),isInsideRectangle(s,t,n[0]-10,n[1]-5,20,10))return{output:er,slot:Ae,link_pos:n}}return null},LGraphNode.prototype.findInputSlot=function(s,t){if(!this.inputs)return-1;for(var n=0,Ae=this.inputs.length;n<Ae;++n)if(s==this.inputs[n].name)return t?this.inputs[n]:n;return-1},LGraphNode.prototype.findOutputSlot=function(s,t){if(t=t||!1,!this.outputs)return-1;for(var n=0,Ae=this.outputs.length;n<Ae;++n)if(s==this.outputs[n].name)return t?this.outputs[n]:n;return-1},LGraphNode.prototype.findInputSlotFree=function(t){var t=t||{},n={returnObj:!1,typesNotAccepted:[]},Ae=Object.assign(n,t);if(!this.inputs)return-1;for(var Ne=0,tr=this.inputs.length;Ne<tr;++Ne)if(!(this.inputs[Ne].link&&this.inputs[Ne].link!=null)&&!(Ae.typesNotAccepted&&Ae.typesNotAccepted.includes&&Ae.typesNotAccepted.includes(this.inputs[Ne].type)))return Ae.returnObj?this.inputs[Ne]:Ne;return-1},LGraphNode.prototype.findOutputSlotFree=function(t){var t=t||{},n={returnObj:!1,typesNotAccepted:[]},Ae=Object.assign(n,t);if(!this.outputs)return-1;for(var Ne=0,tr=this.outputs.length;Ne<tr;++Ne)if(!(this.outputs[Ne].links&&this.outputs[Ne].links!=null)&&!(Ae.typesNotAccepted&&Ae.typesNotAccepted.includes&&Ae.typesNotAccepted.includes(this.outputs[Ne].type)))return Ae.returnObj?this.outputs[Ne]:Ne;return-1},LGraphNode.prototype.findInputSlotByType=function(s,t,n,Ae){return this.findSlotByType(!0,s,t,n,Ae)},LGraphNode.prototype.findOutputSlotByType=function(s,t,n,Ae){return this.findSlotByType(!1,s,t,n,Ae)},LGraphNode.prototype.findSlotByType=function(s,t,n,Ae,Ne){s=s||!1,n=n||!1,Ae=Ae||!1,Ne=Ne||!1;var tr=s?this.inputs:this.outputs;if(!tr)return-1;(t==""||t=="*")&&(t=0);for(var er=0,ir=tr.length;er<ir;++er){var sr=(t+"").toLowerCase().split(","),rr=tr[er].type=="0"||tr[er].type=="*"?"0":tr[er].type;rr=(rr+"").toLowerCase().split(",");for(var nr=0;nr<sr.length;nr++)for(var ar=0;ar<rr.length;ar++)if(sr[nr]=="_event_"&&(sr[nr]=LiteGraph.EVENT),rr[nr]=="_event_"&&(rr[nr]=LiteGraph.EVENT),sr[nr]=="*"&&(sr[nr]=0),rr[nr]=="*"&&(rr[nr]=0),sr[nr]==rr[ar]){if(Ae&&tr[er].links&&tr[er].links!==null)continue;return n?tr[er]:er}}if(Ae&&!Ne)for(var er=0,ir=tr.length;er<ir;++er){var sr=(t+"").toLowerCase().split(","),rr=tr[er].type=="0"||tr[er].type=="*"?"0":tr[er].type;rr=(rr+"").toLowerCase().split(",");for(var nr=0;nr<sr.length;nr++)for(var ar=0;ar<rr.length;ar++)if(sr[nr]=="*"&&(sr[nr]=0),rr[nr]=="*"&&(rr[nr]=0),sr[nr]==rr[ar])return n?tr[er]:er}return-1},LGraphNode.prototype.connectByType=function(s,t,n,Ne){var Ne=Ne||{},tr={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},er=Object.assign(tr,Ne);t&&t.constructor===Number&&(t=this.graph.getNodeById(t));var ir=t.findInputSlotByType(n,!1,!0);if(ir>=0&&ir!==null)return this.connect(s,t,ir);if(er.createEventInCase&&n==LiteGraph.EVENT)return this.connect(s,t,-1);if(er.generalTypeInCase){var ir=t.findInputSlotByType(0,!1,!0,!0);if(ir>=0)return this.connect(s,t,ir)}if(er.firstFreeIfOutputGeneralInCase&&(n==0||n=="*"||n=="")){var ir=t.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(ir>=0)return this.connect(s,t,ir)}return console.debug("no way to connect type: ",n," to targetNODE ",t),null},LGraphNode.prototype.connectByTypeOutput=function(s,t,n,Ne){var Ne=Ne||{},tr={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},er=Object.assign(tr,Ne);t&&t.constructor===Number&&(t=this.graph.getNodeById(t));var ir=t.findOutputSlotByType(n,!1,!0);if(ir>=0&&ir!==null)return t.connect(ir,this,s);if(er.generalTypeInCase){var ir=t.findOutputSlotByType(0,!1,!0,!0);if(ir>=0)return t.connect(ir,this,s)}if(er.createEventInCase&&n==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){var ir=t.addOnExecutedOutput();return t.connect(ir,this,s)}if(er.firstFreeIfInputGeneralInCase&&(n==0||n=="*"||n=="")){var ir=t.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(ir>=0)return t.connect(ir,this,s)}return console.debug("no way to connect byOUT type: ",n," to sourceNODE ",t),null},LGraphNode.prototype.connect=function(s,t,n){if(n=n||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(s.constructor===String){if(s=this.findOutputSlot(s),s==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+s),null}else if(!this.outputs||s>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(t&&t.constructor===Number&&(t=this.graph.getNodeById(t)),!t)throw"target node is null";if(t==this)return null;if(n.constructor===String){if(n=t.findInputSlot(n),n==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+n),null}else if(n===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)t.changeMode(LiteGraph.ON_TRIGGER),n=t.findInputSlot("onTrigger");else return null;else if(!t.inputs||n>=t.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;var Ae=!1,Ne=t.inputs[n],tr=null,er=this.outputs[s];if(!this.outputs[s])return null;if(t.onBeforeConnectInput&&(n=t.onBeforeConnectInput(n)),n===!1||n===null||!LiteGraph.isValidConnection(er.type,Ne.type))return this.setDirtyCanvas(!1,!0),Ae&&this.graph.connectionChange(this,tr),null;if(t.onConnectInput&&t.onConnectInput(n,er.type,er,this,s)===!1||this.onConnectOutput&&this.onConnectOutput(s,Ne.type,Ne,t,n)===!1)return null;if(t.inputs[n]&&t.inputs[n].link!=null&&(this.graph.beforeChange(),t.disconnectInput(n,{doProcessChange:!1}),Ae=!0),er.links!==null&&er.links.length)switch(er.type){case LiteGraph.EVENT:LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(s,!1,{doProcessChange:!1}),Ae=!0);break}var ir;return LiteGraph.use_uuids?ir=LiteGraph.uuidv4():ir=++this.graph.last_link_id,tr=new LLink(ir,Ne.type||er.type,this.id,s,t.id,n),this.graph.links[tr.id]=tr,er.links==null&&(er.links=[]),er.links.push(tr.id),t.inputs[n].link=tr.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,s,!0,tr,er),t.onConnectionsChange&&t.onConnectionsChange(LiteGraph.INPUT,n,!0,tr,Ne),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,t,n,this,s),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,s,t,n)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,tr),tr},LGraphNode.prototype.disconnectOutput=function(s,t){if(s.constructor===String){if(s=this.findOutputSlot(s),s==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+s),!1}else if(!this.outputs||s>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var n=this.outputs[s];if(!n||!n.links||n.links.length==0)return!1;if(t){if(t.constructor===Number&&(t=this.graph.getNodeById(t)),!t)throw"Target Node not found";for(var Ae=0,Ne=n.links.length;Ae<Ne;Ae++){var tr=n.links[Ae],er=this.graph.links[tr];if(er.target_id==t.id){n.links.splice(Ae,1);var ir=t.inputs[er.target_slot];ir.link=null,delete this.graph.links[tr],this.graph&&this.graph._version++,t.onConnectionsChange&&t.onConnectionsChange(LiteGraph.INPUT,er.target_slot,!1,er,ir),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,s,!1,er,n),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,s),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,s),this.graph.onNodeConnectionChange(LiteGraph.INPUT,t,er.target_slot));break}}}else{for(var Ae=0,Ne=n.links.length;Ae<Ne;Ae++){var tr=n.links[Ae],er=this.graph.links[tr];if(er){var t=this.graph.getNodeById(er.target_id),ir=null;this.graph&&this.graph._version++,t&&(ir=t.inputs[er.target_slot],ir.link=null,t.onConnectionsChange&&t.onConnectionsChange(LiteGraph.INPUT,er.target_slot,!1,er,ir),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,t,er.target_slot)),delete this.graph.links[tr],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,s,!1,er,n),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,s),this.graph.onNodeConnectionChange(LiteGraph.INPUT,t,er.target_slot))}}n.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(s){if(s.constructor===String){if(s=this.findInputSlot(s),s==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+s),!1}else if(!this.inputs||s>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var t=this.inputs[s];if(!t)return!1;var n=this.inputs[s].link;if(n!=null){this.inputs[s].link=null;var Ae=this.graph.links[n];if(Ae){var Ne=this.graph.getNodeById(Ae.origin_id);if(!Ne)return!1;var tr=Ne.outputs[Ae.origin_slot];if(!tr||!tr.links||tr.links.length==0)return!1;for(var er=0,ir=tr.links.length;er<ir;er++)if(tr.links[er]==n){tr.links.splice(er,1);break}delete this.graph.links[n],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,s,!1,Ae,t),Ne.onConnectionsChange&&Ne.onConnectionsChange(LiteGraph.OUTPUT,er,!1,Ae,tr),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,Ne,er),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,s))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(s,t,n){n=n||new Float32Array(2);var Ae=0;s&&this.inputs&&(Ae=this.inputs.length),!s&&this.outputs&&(Ae=this.outputs.length);var Ne=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var tr=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(n[0]=this.pos[0]+tr*.5,s?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]):(s?n[0]=this.pos[0]:n[0]=this.pos[0]+tr,n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),n}return s&&t==-1?(n[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,n[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,n):s&&Ae>t&&this.inputs[t].pos?(n[0]=this.pos[0]+this.inputs[t].pos[0],n[1]=this.pos[1]+this.inputs[t].pos[1],n):!s&&Ae>t&&this.outputs[t].pos?(n[0]=this.pos[0]+this.outputs[t].pos[0],n[1]=this.pos[1]+this.outputs[t].pos[1],n):this.horizontal?(n[0]=this.pos[0]+(t+.5)*(this.size[0]/Ae),s?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]+this.size[1],n):(s?n[0]=this.pos[0]+Ne:n[0]=this.pos[0]+this.size[0]+1-Ne,n[1]=this.pos[1]+(t+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),n)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(s){this.console||(this.console=[]),this.console.push(s),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,s)},LGraphNode.prototype.setDirtyCanvas=function(s,t){this.graph&&this.graph.sendActionToCanvas("setDirty",[s,t])},LGraphNode.prototype.loadImage=function(s){var t=new Image;t.src=LiteGraph.node_images_path+s,t.ready=!1;var n=this;return t.onload=function(){this.ready=!0,n.setDirtyCanvas(!0)},t},LGraphNode.prototype.captureInput=function(s){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var t=this.graph.list_of_graphcanvas,n=0;n<t.length;++n){var Ae=t[n];!s&&Ae.node_capturing_input!=this||(Ae.node_capturing_input=s?this:null)}},LGraphNode.prototype.collapse=function(s){this.graph._version++,!(this.constructor.collapsable===!1&&!s)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(s){this.graph._version++,s===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=s},LGraphNode.prototype.localToScreen=function(s,t,n){return[(s+this.pos[0])*n.scale+n.offset[0],(t+this.pos[1])*n.scale+n.offset[1]]};function LGraphGroup(s){this._ctor(s)}global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(s){this.title=s||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(s){this.title=s.title,this._bounding.set(s.bounding),this.color=s.color,this.font_size=s.font_size},LGraphGroup.prototype.serialize=function(){var s=this._bounding;return{title:this.title,bounding:[Math.round(s[0]),Math.round(s[1]),Math.round(s[2]),Math.round(s[3])],color:this.color,font_size:this.font_size}},LGraphGroup.prototype.move=function(s,t,n){if(this._pos[0]+=s,this._pos[1]+=t,!n)for(var Ae=0;Ae<this._nodes.length;++Ae){var Ne=this._nodes[Ae];Ne.pos[0]+=s,Ne.pos[1]+=t}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var s=this.graph._nodes,t=new Float32Array(4),n=0;n<s.length;++n){var Ae=s[n];Ae.getBounding(t),overlapBounding(this._bounding,t)&&this._nodes.push(Ae)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas;function DragAndScale(s,t){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),s&&(this.element=s,t||this.bindEvents(s))}LiteGraph.DragAndScale=DragAndScale,DragAndScale.prototype.bindEvents=function(s){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(s,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(s,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(s,"up",this._binded_mouse_callback),s.addEventListener("mousewheel",this._binded_mouse_callback,!1),s.addEventListener("wheel",this._binded_mouse_callback,!1)},DragAndScale.prototype.computeVisibleArea=function(s){if(!this.element){this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0;return}var t=this.element.width,n=this.element.height,Ae=-this.offset[0],Ne=-this.offset[1];s&&(Ae+=s[0]/this.scale,Ne+=s[1]/this.scale,t=s[2],n=s[3]);var tr=Ae+t/this.scale,er=Ne+n/this.scale;this.visible_area[0]=Ae,this.visible_area[1]=Ne,this.visible_area[2]=tr-Ae,this.visible_area[3]=er-Ne},DragAndScale.prototype.onMouse=function(s){if(this.enabled){var t=this.element,n=t.getBoundingClientRect(),Ae=s.clientX-n.left,Ne=s.clientY-n.top;s.canvasx=Ae,s.canvasy=Ne,s.dragging=this.dragging;var tr=!this.viewport||this.viewport&&Ae>=this.viewport[0]&&Ae<this.viewport[0]+this.viewport[2]&&Ne>=this.viewport[1]&&Ne<this.viewport[1]+this.viewport[3],er=!1;if(this.onmouse&&(er=this.onmouse(s)),s.type==LiteGraph.pointerevents_method+"down"&&tr)this.dragging=!0,LiteGraph.pointerListenerRemove(t,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(s.type==LiteGraph.pointerevents_method+"move"){if(!er){var ir=Ae-this.last_mouse[0],sr=Ne-this.last_mouse[1];this.dragging&&this.mouseDrag(ir,sr)}}else s.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"move",this._binded_mouse_callback)):tr&&(s.type=="mousewheel"||s.type=="wheel"||s.type=="DOMMouseScroll")&&(s.eventType="mousewheel",s.type=="wheel"?s.wheel=-s.deltaY:s.wheel=s.wheelDeltaY!=null?s.wheelDeltaY:s.detail*-60,s.delta=s.wheelDelta?s.wheelDelta/40:s.deltaY?-s.deltaY/3:0,this.changeDeltaScale(1+s.delta*.05));if(this.last_mouse[0]=Ae,this.last_mouse[1]=Ne,tr)return s.preventDefault(),s.stopPropagation(),!1}},DragAndScale.prototype.toCanvasContext=function(s){s.scale(this.scale,this.scale),s.translate(this.offset[0],this.offset[1])},DragAndScale.prototype.convertOffsetToCanvas=function(s){return[(s[0]+this.offset[0])*this.scale,(s[1]+this.offset[1])*this.scale]},DragAndScale.prototype.convertCanvasToOffset=function(s,t){return t=t||[0,0],t[0]=s[0]/this.scale-this.offset[0],t[1]=s[1]/this.scale-this.offset[1],t},DragAndScale.prototype.mouseDrag=function(s,t){this.offset[0]+=s/this.scale,this.offset[1]+=t/this.scale,this.onredraw&&this.onredraw(this)},DragAndScale.prototype.changeScale=function(s,t){if(s<this.min_scale?s=this.min_scale:s>this.max_scale&&(s=this.max_scale),s!=this.scale&&this.element){var n=this.element.getBoundingClientRect();if(n){t=t||[n.width*.5,n.height*.5];var Ae=this.convertCanvasToOffset(t);this.scale=s,Math.abs(this.scale-1)<.01&&(this.scale=1);var Ne=this.convertCanvasToOffset(t),tr=[Ne[0]-Ae[0],Ne[1]-Ae[1]];this.offset[0]+=tr[0],this.offset[1]+=tr[1],this.onredraw&&this.onredraw(this)}}},DragAndScale.prototype.changeDeltaScale=function(s,t){this.changeScale(this.scale*s,t)},DragAndScale.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0};function LGraphCanvas(s,t,n){this.options=n=n||{},this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,s&&s.constructor===String&&(s=document.querySelector(s)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=""+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=n.viewport||null,t&&t.attachCanvas(this),this.setCanvas(s,n.skip_events),this.clear(),n.skip_render||this.startRendering(),this.autoresize=n.autoresize}global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",LGraphCanvas.link_type_colors={"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(s,t){if(this.graph!=s){if(t||this.clear(),!s&&this.graph){this.graph.detachCanvas(this);return}s.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}},LGraphCanvas.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph},LGraphCanvas.prototype.openSubgraph=function(s){if(!s)throw"graph cannot be null";if(this.graph==s)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),s.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(!(!this._graph_stack||this._graph_stack.length==0)){var s=this.graph._subgraph_node,t=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},t.attachCanvas(this),this.setDirty(!0,!0),s&&(this.centerOnNode(s),this.selectNodes([s])),this.ds.offset=[0,0],this.ds.scale=1}},LGraphCanvas.prototype.getCurrentGraph=function(){return this.graph},LGraphCanvas.prototype.setCanvas=function(s,t){if(s&&s.constructor===String&&(s=document.getElementById(s),!s))throw"Error creating LiteGraph canvas: Canvas not found";if(s!==this.canvas&&(!s&&this.canvas&&(t||this.unbindEvents()),this.canvas=s,this.ds.element=s,!!s)){if(s.className+=" lgraphcanvas",s.data=this,s.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),s.getContext==null)throw s.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+s.localName:"This browser doesn't support Canvas";var n=this.ctx=s.getContext("2d");n==null&&(s.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),t||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(t){return t.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(t){return t.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}var s=this.canvas,t=this.getCanvasWindow(),n=t.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(s,"down",this._mousedown_callback,!0),s.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(s,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(s,"move",this._mousemove_callback),s.addEventListener("contextmenu",this._doNothing),s.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),s.setAttribute("tabindex",1),s.addEventListener("keydown",this._key_callback,!0),n.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),s.addEventListener("dragover",this._doNothing,!1),s.addEventListener("dragend",this._doNothing,!1),s.addEventListener("drop",this._ondrop_callback,!1),s.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},LGraphCanvas.prototype.unbindEvents=function(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}var s=this.getCanvasWindow(),t=s.document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),t.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},LGraphCanvas.getFileExtension=function(s){var t=s.indexOf("?");t!=-1&&(s=s.substr(0,t));var n=s.lastIndexOf(".");return n==-1?"":s.substr(n+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if(typeof GL>"u")throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas>"u")throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(s,t){s&&(this.dirty_canvas=!0),t&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var s=this.canvas.ownerDocument;return s.defaultView||s.parentWindow},LGraphCanvas.prototype.startRendering=function(){if(this.is_rendering)return;this.is_rendering=!0,s.call(this);function s(){this.pause_rendering||this.draw();var t=this.getCanvasWindow();this.is_rendering&&t.requestAnimationFrame(s.bind(this))}},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.blockClick=function(){this.block_click=!0,this.last_mouseclick=0},LGraphCanvas.prototype.processMouseDown=function(s){if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(s);var t=this.getCanvasWindow();t.document,LGraphCanvas.active_canvas=this;var n=this,Ae=s.clientX,Ne=s.clientY;this.ds.viewport=this.viewport;var tr=!this.viewport||this.viewport&&Ae>=this.viewport[0]&&Ae<this.viewport[0]+this.viewport[2]&&Ne>=this.viewport[1]&&Ne<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(t.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(t.document,"up",this._mouseup_callback,!0)),!!tr){var er=this.graph.getNodeOnPos(s.canvasX,s.canvasY,this.visible_nodes,5),ir=!1,sr=LiteGraph.getTime(),rr=s.isPrimary===void 0||!s.isPrimary,nr=sr-this.last_mouseclick<300&&rr;if(this.mouse[0]=s.clientX,this.mouse[1]=s.clientY,this.graph_mouse[0]=s.canvasX,this.graph_mouse[1]=s.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&rr?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(t),!(this.onMouse&&this.onMouse(s)==!0)){if(s.which==1&&!this.pointer_is_double){s.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=s.canvasX,this.dragging_rectangle[1]=s.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,ir=!0),LiteGraph.alt_drag_do_clone_nodes&&s.altKey&&er&&this.allow_interaction&&!ir&&!this.read_only&&(cloned=er.clone())&&(cloned.pos[0]+=5,cloned.pos[1]+=5,this.graph.add(cloned,!1,{doCalcSize:!1}),er=cloned,ir=!0,dr||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=er),this.selected_nodes[er.id]||this.processNodeSelected(er,s)));var ar=!1;if(er&&(this.allow_interaction||er.flags.allow_interaction)&&!ir&&!this.read_only){if(!this.live_mode&&!er.flags.pinned&&this.bringToFront(er),this.allow_interaction&&!this.connecting_node&&!er.flags.collapsed&&!this.live_mode)if(!ir&&er.resizable!==!1&&isInsideRectangle(s.canvasX,s.canvasY,er.pos[0]+er.size[0]-5,er.pos[1]+er.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=er,this.canvas.style.cursor="se-resize",ir=!0;else{if(er.outputs)for(var or=0,ur=er.outputs.length;or<ur;++or){var hr=er.outputs[or],cr=er.getConnectionPos(!1,or);if(isInsideRectangle(s.canvasX,s.canvasY,cr[0]-15,cr[1]-10,30,20)){this.connecting_node=er,this.connecting_output=hr,this.connecting_output.slot_index=or,this.connecting_pos=er.getConnectionPos(!1,or),this.connecting_slot=or,LiteGraph.shift_click_do_break_link_from&&s.shiftKey&&er.disconnectOutput(or),nr?er.onOutputDblClick&&er.onOutputDblClick(or,s):er.onOutputClick&&er.onOutputClick(or,s),ir=!0;break}}if(er.inputs)for(var or=0,ur=er.inputs.length;or<ur;++or){var vr=er.inputs[or],cr=er.getConnectionPos(!0,or);if(isInsideRectangle(s.canvasX,s.canvasY,cr[0]-15,cr[1]-10,30,20)){if(nr?er.onInputDblClick&&er.onInputDblClick(or,s):er.onInputClick&&er.onInputClick(or,s),vr.link!==null){var mr=this.graph.links[vr.link];LiteGraph.click_do_break_link_to&&(er.disconnectInput(or),this.dirty_bgcanvas=!0,ir=!0),(this.allow_reconnect_links||s.shiftKey)&&(LiteGraph.click_do_break_link_to||er.disconnectInput(or),this.connecting_node=this.graph._nodes_by_id[mr.origin_id],this.connecting_slot=mr.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,ir=!0)}ir||(this.connecting_node=er,this.connecting_input=vr,this.connecting_input.slot_index=or,this.connecting_pos=er.getConnectionPos(!0,or),this.connecting_slot=or,this.dirty_bgcanvas=!0,ir=!0)}}}if(!ir){var dr=!1,lr=[s.canvasX-er.pos[0],s.canvasY-er.pos[1]],gr=this.processNodeWidgets(er,this.graph_mouse,s);if(gr&&(dr=!0,this.node_widget=[er,gr]),this.allow_interaction&&nr&&this.selected_nodes[er.id]&&(er.onDblClick&&er.onDblClick(s,lr,this),this.processNodeDblClicked(er),dr=!0),er.onMouseDown&&er.onMouseDown(s,lr,this))dr=!0;else{if(er.subgraph&&!er.skip_subgraph_button&&!er.flags.collapsed&&lr[0]>er.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&lr[1]<0){var n=this;setTimeout(function(){n.openSubgraph(er.subgraph)},10)}this.live_mode&&(ar=!0,dr=!0)}dr?er.is_selected||this.processNodeSelected(er,s):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=er),this.processNodeSelected(er,s)),this.dirty_canvas=!0}}else if(!ir){if(!this.read_only)for(var or=0;or<this.visible_links.length;++or){var fr=this.visible_links[or],yr=fr._pos;if(!(!yr||s.canvasX<yr[0]-4||s.canvasX>yr[0]+4||s.canvasY<yr[1]-4||s.canvasY>yr[1]+4)){this.showLinkMenu(fr,s),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(s.canvasX,s.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){s.ctrlKey&&(this.dragging_rectangle=null);var Er=distance([s.canvasX,s.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);Er*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}nr&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(s),s.preventDefault(),s.stopPropagation()),ar=!0}!ir&&ar&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(s.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(er&&this.allow_interaction&&!ir&&!this.read_only&&!this.connecting_node&&!er.flags.collapsed&&!this.live_mode){var wr=!1,Dr=!1,kr=!1;if(er.outputs)for(var or=0,ur=er.outputs.length;or<ur;++or){var hr=er.outputs[or],cr=er.getConnectionPos(!1,or);if(isInsideRectangle(s.canvasX,s.canvasY,cr[0]-15,cr[1]-10,30,20)){wr=hr,Dr=or,kr=!0;break}}if(er.inputs)for(var or=0,ur=er.inputs.length;or<ur;++or){var vr=er.inputs[or],cr=er.getConnectionPos(!0,or);if(isInsideRectangle(s.canvasX,s.canvasY,cr[0]-15,cr[1]-10,30,20)){wr=vr,Dr=or,kr=!1;break}}if(wr&&Dr!==!1){var zr=.5-(Dr+1)/(kr?er.outputs.length:er.inputs.length),Vr=er.getBounding(),Hr=[kr?Vr[0]+Vr[2]:Vr[0],s.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:kr?er:null,slotFrom:kr?Dr:null,nodeTo:kr?null:er,slotTo:kr?null:Dr,position:Hr,nodeType:"AUTO",posAdd:[kr?30:-30,-zr*130],posSizeFix:[kr?0:-1,0]})}}}else!ir&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(s.which==3||this.pointer_is_double)&&this.allow_interaction&&!ir&&!this.read_only&&(er&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[er.id]||s.shiftKey||s.ctrlKey||s.metaKey)?this.selected_nodes[er.id]||this.selectNodes([er],!0):this.selectNodes([er])),this.processContextMenu(er,s));return this.last_mouse[0]=s.clientX,this.last_mouse[1]=s.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!t.document.activeElement||t.document.activeElement.nodeName.toLowerCase()!="input"&&t.document.activeElement.nodeName.toLowerCase()!="textarea")&&s.preventDefault(),s.stopPropagation(),this.onMouseDown&&this.onMouseDown(s),!1}}}},LGraphCanvas.prototype.processMouseMove=function(s){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(s);var t=[s.clientX,s.clientY];this.mouse[0]=t[0],this.mouse[1]=t[1];var n=[t[0]-this.last_mouse[0],t[1]-this.last_mouse[1]];if(this.last_mouse=t,this.graph_mouse[0]=s.canvasX,this.graph_mouse[1]=s.canvasY,this.block_click)return s.preventDefault(),!1;s.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,s,this.node_widget[1]),this.dirty_canvas=!0);var Ae=this.graph.getNodeOnPos(s.canvasX,s.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=s.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=s.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[s.canvasX-this.selected_group.pos[0],s.canvasY-this.selected_group.pos[1]];else{var Ne=n[0]/this.ds.scale,tr=n[1]/this.ds.scale;this.selected_group.move(Ne,tr,s.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=n[0]/this.ds.scale,this.ds.offset[1]+=n[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||Ae&&Ae.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var er=0,ir=this.graph._nodes.length;er<ir;++er)this.graph._nodes[er].mouseOver&&Ae!=this.graph._nodes[er]&&(this.graph._nodes[er].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(s),this.node_over=null,this.dirty_canvas=!0);if(Ae){if(Ae.redraw_on_mouse&&(this.dirty_canvas=!0),Ae.mouseOver||(Ae.mouseOver=!0,this.node_over=Ae,this.dirty_canvas=!0,Ae.onMouseEnter&&Ae.onMouseEnter(s)),Ae.onMouseMove&&Ae.onMouseMove(s,[s.canvasX-Ae.pos[0],s.canvasY-Ae.pos[1]],this),this.connecting_node){if(this.connecting_output){var sr=this._highlight_input||[0,0];if(!this.isOverNodeBox(Ae,s.canvasX,s.canvasY)){var rr=this.isOverNodeInput(Ae,s.canvasX,s.canvasY,sr);if(rr!=-1&&Ae.inputs[rr]){var nr=Ae.inputs[rr].type;LiteGraph.isValidConnection(this.connecting_output.type,nr)&&(this._highlight_input=sr,this._highlight_input_slot=Ae.inputs[rr])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input){var sr=this._highlight_output||[0,0];if(!this.isOverNodeBox(Ae,s.canvasX,s.canvasY)){var rr=this.isOverNodeOutput(Ae,s.canvasX,s.canvasY,sr);if(rr!=-1&&Ae.outputs[rr]){var nr=Ae.outputs[rr].type;LiteGraph.isValidConnection(this.connecting_input.type,nr)&&(this._highlight_output=sr)}else this._highlight_output=null}}}this.canvas&&(isInsideRectangle(s.canvasX,s.canvasY,Ae.pos[0]+Ae.size[0]-5,Ae.pos[1]+Ae.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{for(var ar=null,er=0;er<this.visible_links.length;++er){var or=this.visible_links[er],ur=or._pos;if(!(!ur||s.canvasX<ur[0]-4||s.canvasX>ur[0]+4||s.canvasY<ur[1]-4||s.canvasY>ur[1]+4)){ar=or;break}}ar!=this.over_link_center&&(this.over_link_center=ar,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=Ae&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(s,[s.canvasX-this.node_capturing_input.pos[0],s.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(var er in this.selected_nodes){var hr=this.selected_nodes[er];hr.pos[0]+=n[0]/this.ds.scale,hr.pos[1]+=n[1]/this.ds.scale,hr.is_selected||this.processNodeSelected(hr,s)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var cr=[s.canvasX-this.resizing_node.pos[0],s.canvasY-this.resizing_node.pos[1]],vr=this.resizing_node.computeSize();cr[0]=Math.max(vr[0],cr[0]),cr[1]=Math.max(vr[1],cr[1]),this.resizing_node.setSize(cr),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return s.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(s){var t=s.isPrimary===void 0||s.isPrimary;if(!t)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var n=this.getCanvasWindow(),Ae=n.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(Ae,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(Ae,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(s);var Ne=LiteGraph.getTime();if(s.click_time=Ne-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),s.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,s),this.node_widget=null,this.selected_group){var tr=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),er=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(tr,er,s.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var ir=this.graph.getNodeOnPos(s.canvasX,s.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var sr=this.graph._nodes,rr=new Float32Array(4),nr=Math.abs(this.dragging_rectangle[2]),ar=Math.abs(this.dragging_rectangle[3]),or=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-nr:this.dragging_rectangle[0],ur=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-ar:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=or,this.dragging_rectangle[1]=ur,this.dragging_rectangle[2]=nr,this.dragging_rectangle[3]=ar,!ir||nr>10&&ar>10){for(var hr=[],cr=0;cr<sr.length;++cr){var vr=sr[cr];vr.getBounding(rr),overlapBounding(this.dragging_rectangle,rr)&&hr.push(vr)}hr.length&&this.selectNodes(hr,s.shiftKey)}else this.selectNodes([ir],s.shiftKey||s.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var mr=this.connecting_output||this.connecting_input,dr=mr.type;if(ir){if(this.connecting_output){var lr=this.isOverNodeInput(ir,s.canvasX,s.canvasY);lr!=-1?this.connecting_node.connect(this.connecting_slot,ir,lr):this.connecting_node.connectByType(this.connecting_slot,ir,dr)}else if(this.connecting_input){var lr=this.isOverNodeOutput(ir,s.canvasX,s.canvasY);lr!=-1?ir.connect(lr,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,ir,dr)}}else LiteGraph.release_link_on_empty_shows_menu&&(s.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(s,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(s,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:s}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:s}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){var ir=this.node_dragged;ir&&s.click_time<300&&isInsideRectangle(s.canvasX,s.canvasY,ir.pos[0],ir.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&ir.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null}else{var ir=this.graph.getNodeOnPos(s.canvasX,s.canvasY,this.visible_nodes);!ir&&s.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(s,[s.canvasX-this.node_over.pos[0],s.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(s,[s.canvasX-this.node_capturing_input.pos[0],s.canvasY-this.node_capturing_input.pos[1]])}}else s.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):s.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return t&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),s.stopPropagation(),s.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(s){if(!(!this.graph||!this.allow_dragcanvas)){var t=s.wheelDeltaY!=null?s.wheelDeltaY:s.detail*-60;this.adjustMouseEvent(s);var n=s.clientX,Ae=s.clientY,Ne=!this.viewport||this.viewport&&n>=this.viewport[0]&&n<this.viewport[0]+this.viewport[2]&&Ae>=this.viewport[1]&&Ae<this.viewport[1]+this.viewport[3];if(Ne){var tr=this.ds.scale;return t>0?tr*=1.1:t<0&&(tr*=1/1.1),this.ds.changeScale(tr,[s.clientX,s.clientY]),this.graph.change(),s.preventDefault(),!1}}},LGraphCanvas.prototype.isOverNodeBox=function(s,t,n){var Ae=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(t,n,s.pos[0]+2,s.pos[1]+2-Ae,Ae-4,Ae-4)},LGraphCanvas.prototype.isOverNodeInput=function(s,t,n,Ae){if(s.inputs)for(var Ne=0,tr=s.inputs.length;Ne<tr;++Ne){s.inputs[Ne];var er=s.getConnectionPos(!0,Ne),ir=!1;if(s.horizontal?ir=isInsideRectangle(t,n,er[0]-5,er[1]-10,10,20):ir=isInsideRectangle(t,n,er[0]-10,er[1]-5,40,10),ir)return Ae&&(Ae[0]=er[0],Ae[1]=er[1]),Ne}return-1},LGraphCanvas.prototype.isOverNodeOutput=function(s,t,n,Ae){if(s.outputs)for(var Ne=0,tr=s.outputs.length;Ne<tr;++Ne){s.outputs[Ne];var er=s.getConnectionPos(!1,Ne),ir=!1;if(s.horizontal?ir=isInsideRectangle(t,n,er[0]-5,er[1]-10,10,20):ir=isInsideRectangle(t,n,er[0]-10,er[1]-5,40,10),ir)return Ae&&(Ae[0]=er[0],Ae[1]=er[1]),Ne}return-1},LGraphCanvas.prototype.processKey=function(s){if(this.graph){var t=!1;if(s.target.localName!="input"){if(s.type=="keydown"){if(s.keyCode==32&&(this.dragging_canvas=!0,t=!0),s.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),t=!0),s.keyCode==65&&s.ctrlKey&&(this.selectNodes(),t=!0),s.keyCode===67&&(s.metaKey||s.ctrlKey)&&!s.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),t=!0),s.keyCode===86&&(s.metaKey||s.ctrlKey)&&this.pasteFromClipboard(s.shiftKey),(s.keyCode==46||s.keyCode==8)&&s.target.localName!="input"&&s.target.localName!="textarea"&&(this.deleteSelectedNodes(),t=!0),this.selected_nodes)for(var n in this.selected_nodes)this.selected_nodes[n].onKeyDown&&this.selected_nodes[n].onKeyDown(s)}else if(s.type=="keyup"&&(s.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(var n in this.selected_nodes)this.selected_nodes[n].onKeyUp&&this.selected_nodes[n].onKeyUp(s);if(this.graph.change(),t)return s.preventDefault(),s.stopImmediatePropagation(),!1}}},LGraphCanvas.prototype.copyToClipboard=function(){var s={nodes:[],links:[]},t=0,n=[];for(var Ae in this.selected_nodes){var Ne=this.selected_nodes[Ae];Ne.clonable!==!1&&(Ne._relative_id=t,n.push(Ne),t+=1)}for(var Ae=0;Ae<n.length;++Ae){var Ne=n[Ae];if(Ne.clonable!==!1){var tr=Ne.clone();if(!tr){console.warn("node type not found: "+Ne.type);continue}if(s.nodes.push(tr.serialize()),Ne.inputs&&Ne.inputs.length)for(var er=0;er<Ne.inputs.length;++er){var ir=Ne.inputs[er];if(!(!ir||ir.link==null)){var sr=this.graph.links[ir.link];if(sr){var rr=this.graph.getNodeById(sr.origin_id);rr&&s.links.push([rr._relative_id,sr.origin_slot,Ne._relative_id,sr.target_slot,rr.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(s))},LGraphCanvas.prototype.pasteFromClipboard=function(s=!1){if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&s)){var t=localStorage.getItem("litegrapheditor_clipboard");if(t){this.graph.beforeChange();for(var n=JSON.parse(t),Ae=!1,Ne=!1,tr=0;tr<n.nodes.length;++tr)Ae?(Ae[0]>n.nodes[tr].pos[0]&&(Ae[0]=n.nodes[tr].pos[0],Ne[0]=tr),Ae[1]>n.nodes[tr].pos[1]&&(Ae[1]=n.nodes[tr].pos[1],Ne[1]=tr)):(Ae=[n.nodes[tr].pos[0],n.nodes[tr].pos[1]],Ne=[tr,tr]);for(var er=[],tr=0;tr<n.nodes.length;++tr){var ir=n.nodes[tr],sr=LiteGraph.createNode(ir.type);sr&&(sr.configure(ir),sr.pos[0]+=this.graph_mouse[0]-Ae[0],sr.pos[1]+=this.graph_mouse[1]-Ae[1],this.graph.add(sr,{doProcessChange:!1}),er.push(sr))}for(var tr=0;tr<n.links.length;++tr){var rr=n.links[tr],nr,ar=rr[0];if(ar!=null)nr=er[ar];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&s){var or=rr[4];or&&(nr=this.graph.getNodeById(or))}var ur=er[rr[2]];nr&&ur?nr.connect(rr[1],ur,rr[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(er),this.graph.afterChange()}}},LGraphCanvas.prototype.processDrop=function(s){s.preventDefault(),this.adjustMouseEvent(s);var t=s.clientX,n=s.clientY,Ae=!this.viewport||this.viewport&&t>=this.viewport[0]&&t<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3];if(Ae){var Ne=[s.canvasX,s.canvasY],tr=this.graph?this.graph.getNodeOnPos(Ne[0],Ne[1]):null;if(!tr){var er=null;this.onDropItem&&(er=this.onDropItem(event)),er||this.checkDropItem(s);return}if(tr.onDropFile||tr.onDropData){var ir=s.dataTransfer.files;if(ir&&ir.length)for(var sr=0;sr<ir.length;sr++){var rr=s.dataTransfer.files[0],nr=rr.name;if(LGraphCanvas.getFileExtension(nr),tr.onDropFile&&tr.onDropFile(rr),tr.onDropData){var ar=new FileReader;ar.onload=function(ur){var hr=ur.target.result;tr.onDropData(hr,nr,rr)};var or=rr.type.split("/")[0];or=="text"||or==""?ar.readAsText(rr):or=="image"?ar.readAsDataURL(rr):ar.readAsArrayBuffer(rr)}}}return tr.onDropItem&&tr.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}},LGraphCanvas.prototype.checkDropItem=function(s){if(s.dataTransfer.files.length){var t=s.dataTransfer.files[0],n=LGraphCanvas.getFileExtension(t.name).toLowerCase(),Ae=LiteGraph.node_types_by_file_extension[n];if(Ae){this.graph.beforeChange();var Ne=LiteGraph.createNode(Ae.type);Ne.pos=[s.canvasX,s.canvasY],this.graph.add(Ne),Ne.onDropFile&&Ne.onDropFile(t),this.graph.afterChange()}}},LGraphCanvas.prototype.processNodeDblClicked=function(s){this.onShowNodePanel?this.onShowNodePanel(s):this.showShowNodePanel(s),this.onNodeDblClicked&&this.onNodeDblClicked(s),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(s,t){this.selectNode(s,t&&(t.shiftKey||t.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(s)},LGraphCanvas.prototype.selectNode=function(s,t){s==null?this.deselectAllNodes():this.selectNodes([s],t)},LGraphCanvas.prototype.selectNodes=function(s,t){t||this.deselectAllNodes(),s=s||this.graph._nodes,typeof s=="string"&&(s=[s]);for(var n in s){var Ae=s[n];if(Ae.is_selected){this.deselectNode(Ae);continue}if(!Ae.is_selected&&Ae.onSelected&&Ae.onSelected(),Ae.is_selected=!0,this.selected_nodes[Ae.id]=Ae,Ae.inputs)for(var Ne=0;Ne<Ae.inputs.length;++Ne)this.highlighted_links[Ae.inputs[Ne].link]=!0;if(Ae.outputs)for(var Ne=0;Ne<Ae.outputs.length;++Ne){var tr=Ae.outputs[Ne];if(tr.links)for(var er=0;er<tr.links.length;++er)this.highlighted_links[tr.links[er]]=!0}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(s){if(s.is_selected){if(s.onDeselected&&s.onDeselected(),s.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(s),s.inputs)for(var t=0;t<s.inputs.length;++t)delete this.highlighted_links[s.inputs[t].link];if(s.outputs)for(var t=0;t<s.outputs.length;++t){var n=s.outputs[t];if(n.links)for(var Ae=0;Ae<n.links.length;++Ae)delete this.highlighted_links[n.links[Ae]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(this.graph){for(var s=this.graph._nodes,t=0,n=s.length;t<n;++t){var Ae=s[t];Ae.is_selected&&(Ae.onDeselected&&Ae.onDeselected(),Ae.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(Ae))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var s in this.selected_nodes){var t=this.selected_nodes[s];if(!t.block_delete){if(t.inputs&&t.inputs.length&&t.outputs&&t.outputs.length&&LiteGraph.isValidConnection(t.inputs[0].type,t.outputs[0].type)&&t.inputs[0].link&&t.outputs[0].links&&t.outputs[0].links.length){var n=t.graph.links[t.inputs[0].link],Ae=t.graph.links[t.outputs[0].links[0]],Ne=t.getInputNode(0),tr=t.getOutputNodes(0)[0];Ne&&tr&&Ne.connect(n.origin_slot,tr,Ae.target_slot)}this.graph.remove(t),this.onNodeDeselected&&this.onNodeDeselected(t)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()},LGraphCanvas.prototype.centerOnNode=function(s){this.ds.offset[0]=-s.pos[0]-s.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-s.pos[1]-s.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(s){var t=0,n=0;if(this.canvas){var Ae=this.canvas.getBoundingClientRect();t=s.clientX-Ae.left,n=s.clientY-Ae.top}else t=s.clientX,n=s.clientY;this.last_mouse_position[0]=t,this.last_mouse_position[1]=n,s.canvasX=t/this.ds.scale-this.ds.offset[0],s.canvasY=n/this.ds.scale-this.ds.offset[1]},LGraphCanvas.prototype.setZoom=function(s,t){this.ds.changeScale(s,t),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(s,t){return this.ds.convertOffsetToCanvas(s,t)},LGraphCanvas.prototype.convertCanvasToOffset=function(s,t){return this.ds.convertCanvasToOffset(s,t)},LGraphCanvas.prototype.convertEventToCanvasOffset=function(s){var t=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([s.clientX-t.left,s.clientY-t.top])},LGraphCanvas.prototype.bringToFront=function(s){var t=this.graph._nodes.indexOf(s);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.push(s))},LGraphCanvas.prototype.sendToBack=function(s){var t=this.graph._nodes.indexOf(s);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.unshift(s))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(s,t){var n=t||[];n.length=0,s=s||this.graph._nodes;for(var Ae=0,Ne=s.length;Ae<Ne;++Ae){var tr=s[Ae];this.live_mode&&!tr.onDrawBackground&&!tr.onDrawForeground||overlapBounding(this.visible_area,tr.getBounding(temp,!0))&&n.push(tr)}return n},LGraphCanvas.prototype.draw=function(s,t){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var n=LiteGraph.getTime();this.render_time=(n-this.last_draw_time)*.001,this.last_draw_time=n,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||t||this.always_render_background||this.graph&&this.graph._last_trigger_time&&n-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||s)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var s=this.ctx;if(s){var t=this.canvas;s.start2D&&!this.viewport&&(s.start2D(),s.restore(),s.setTransform(1,0,0,1,0,0));var n=this.viewport||this.dirty_area;if(n&&(s.save(),s.beginPath(),s.rect(n[0],n[1],n[2],n[3]),s.clip()),this.clear_background&&(n?s.clearRect(n[0],n[1],n[2],n[3]):s.clearRect(0,0,t.width,t.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():s.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(t,s),this.show_info&&this.renderInfo(s,n?n[0]:0,n?n[1]:0),this.graph){s.save(),this.ds.toCanvasContext(s);for(var Ae=this.computeVisibleNodes(null,this.visible_nodes),Ne=0;Ne<Ae.length;++Ne){var tr=Ae[Ne];s.save(),s.translate(tr.pos[0],tr.pos[1]),this.drawNode(tr,s),s.restore()}if(this.render_execution_order&&this.drawExecutionOrder(s),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(s)),this.connecting_pos!=null){s.lineWidth=this.connections_width;var er=null,ir=this.connecting_output||this.connecting_input,sr=ir.type,rr=ir.dir;rr==null&&(this.connecting_output?rr=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:rr=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var nr=ir.shape;switch(sr){case LiteGraph.EVENT:er=LiteGraph.EVENT_LINK_COLOR;break;default:er=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(s,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,er,rr,LiteGraph.CENTER),s.beginPath(),sr===LiteGraph.EVENT||nr===LiteGraph.BOX_SHAPE?(s.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),s.fill(),s.beginPath(),s.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):nr===LiteGraph.ARROW_SHAPE?(s.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),s.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),s.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),s.closePath()):(s.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),s.fill(),s.beginPath(),s.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),s.fill(),s.fillStyle="#ffcc00",this._highlight_input){s.beginPath();var ar=this._highlight_input_slot.shape;ar===LiteGraph.ARROW_SHAPE?(s.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),s.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),s.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),s.closePath()):s.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),s.fill()}this._highlight_output&&(s.beginPath(),ar===LiteGraph.ARROW_SHAPE?(s.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),s.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),s.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),s.closePath()):s.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),s.fill())}this.dragging_rectangle&&(s.strokeStyle="#FFF",s.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(s,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(s,null),this.onDrawForeground&&this.onDrawForeground(s,this.visible_rect),s.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(s),this.onDrawOverlay&&this.onDrawOverlay(s),n&&s.restore(),s.finish2D&&s.finish2D()}},LGraphCanvas.prototype.drawSubgraphPanel=function(s){var t=this.graph,n=t._subgraph_node;if(!n){console.warn("subgraph without subnode");return}this.drawSubgraphPanelLeft(t,n,s),this.drawSubgraphPanelRight(t,n,s)},LGraphCanvas.prototype.drawSubgraphPanelLeft=function(s,t,n){var Ae=t.inputs?t.inputs.length:0,Ne=200,tr=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(10,10,Ne,(Ae+1)*tr+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left",n.fillText("Graph Inputs",20,34),this.drawButton(Ne-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var er=50;if(n.font="14px Arial",t.inputs)for(var ir=0;ir<t.inputs.length;++ir){var sr=t.inputs[ir];if(!sr.not_subgraph_input){if(this.drawButton(20,er+2,Ne-20,tr-2)){var rr=t.constructor.input_node_type||"graph/input";this.graph.beforeChange();var nr=LiteGraph.createNode(rr);nr?(s.add(nr),this.block_click=!1,this.last_click_position=null,this.selectNodes([nr]),this.node_dragged=nr,this.dragging_canvas=!1,nr.setProperty("name",sr.name),nr.setProperty("type",sr.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",rr)}n.fillStyle="#9C9",n.beginPath(),n.arc(Ne-16,er+tr*.5,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(sr.name,30,er+tr*.75),n.fillStyle="#777",n.fillText(sr.type,130,er+tr*.75),er+=tr}}this.drawButton(20,er+2,Ne-20,tr-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(t)},LGraphCanvas.prototype.drawSubgraphPanelRight=function(s,t,n){var Ae=t.outputs?t.outputs.length:0,Ne=this.bgcanvas.width,tr=200,er=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(Ne-tr-10,10,tr,(Ae+1)*er+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left";var ir="Graph Outputs",sr=n.measureText(ir).width;if(n.fillText(ir,Ne-sr-20,34),this.drawButton(Ne-tr,20,20,20,"X","#151515")){this.closeSubgraph();return}var rr=50;if(n.font="14px Arial",t.outputs)for(var nr=0;nr<t.outputs.length;++nr){var ar=t.outputs[nr];if(!ar.not_subgraph_input){if(this.drawButton(Ne-tr,rr+2,tr-20,er-2)){var or=t.constructor.output_node_type||"graph/output";this.graph.beforeChange();var ur=LiteGraph.createNode(or);ur?(s.add(ur),this.block_click=!1,this.last_click_position=null,this.selectNodes([ur]),this.node_dragged=ur,this.dragging_canvas=!1,ur.setProperty("name",ar.name),ur.setProperty("type",ar.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",or)}n.fillStyle="#9C9",n.beginPath(),n.arc(Ne-tr+16,rr+er*.5,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(ar.name,Ne-tr+30,rr+er*.75),n.fillStyle="#777",n.fillText(ar.type,Ne-tr+130,rr+er*.75),rr+=er}}this.drawButton(Ne-tr,rr+2,tr-20,er-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(t)},LGraphCanvas.prototype.drawButton=function(s,t,n,Ae,Ne,tr,er,ir){var sr=this.ctx;tr=tr||LiteGraph.NODE_DEFAULT_COLOR,er=er||"#555",ir=ir||LiteGraph.NODE_TEXT_COLOR;var rr=this.ds.convertOffsetToCanvas(this.graph_mouse),nr=LiteGraph.isInsideRectangle(rr[0],rr[1],s,t,n,Ae);if(rr=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,rr){var ar=this.canvas.getBoundingClientRect();rr[0]-=ar.left,rr[1]-=ar.top}var or=rr&&LiteGraph.isInsideRectangle(rr[0],rr[1],s,t,n,Ae);sr.fillStyle=nr?er:tr,or&&(sr.fillStyle="#AAA"),sr.beginPath(),sr.roundRect(s,t,n,Ae,[4]),sr.fill(),Ne!=null&&Ne.constructor==String&&(sr.fillStyle=ir,sr.textAlign="center",sr.font=(Ae*.65|0)+"px Arial",sr.fillText(Ne,s+n*.5,t+Ae*.75),sr.textAlign="left");var ur=or&&!this.block_click;return or&&this.blockClick(),ur},LGraphCanvas.prototype.isAreaClicked=function(s,t,n,Ae,Ne){var tr=this.mouse;LiteGraph.isInsideRectangle(tr[0],tr[1],s,t,n,Ae),tr=this.last_click_position;var er=tr&&LiteGraph.isInsideRectangle(tr[0],tr[1],s,t,n,Ae),ir=er&&!this.block_click;return er&&Ne&&this.blockClick(),ir},LGraphCanvas.prototype.renderInfo=function(s,t,n){t=t||10,n=n||this.canvas.height-80,s.save(),s.translate(t,n),s.font="10px Arial",s.fillStyle="#888",s.textAlign="left",this.graph?(s.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13*1),s.fillText("I: "+this.graph.iteration,5,13*2),s.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,13*3),s.fillText("V: "+this.graph._version,5,13*4),s.fillText("FPS:"+this.fps.toFixed(2),5,13*5)):s.fillText("No graph selected",5,13*1),s.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var s=this.bgcanvas;(s.width!=this.canvas.width||s.height!=this.canvas.height)&&(s.width=this.canvas.width,s.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var t=this.bgctx;t.start&&t.start();var n=this.viewport||[0,0,t.canvas.width,t.canvas.height];if(this.clear_background&&t.clearRect(n[0],n[1],n[2],n[3]),this._graph_stack&&this._graph_stack.length){t.save(),this._graph_stack[this._graph_stack.length-1];var Ae=this.graph._subgraph_node;t.strokeStyle=Ae.bgcolor,t.lineWidth=10,t.strokeRect(1,1,s.width-2,s.height-2),t.lineWidth=1,t.font="40px Arial",t.textAlign="center",t.fillStyle=Ae.bgcolor||"#AAA";for(var Ne="",tr=1;tr<this._graph_stack.length;++tr)Ne+=this._graph_stack[tr]._subgraph_node.getTitle()+" >> ";t.fillText(Ne+Ae.getTitle(),s.width*.5,40),t.restore()}var er=!1;if(this.onRenderBackground&&(er=this.onRenderBackground(s,t)),this.viewport||(t.restore(),t.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(t.save(),this.ds.toCanvasContext(t),this.ds.scale<1.5&&!er&&this.clear_background_color&&(t.fillStyle=this.clear_background_color,t.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!er){if(this.zoom_modify_alpha?t.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:t.globalAlpha=this.editor_alpha,t.imageSmoothingEnabled=t.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var ir=this;this._bg_img.onload=function(){ir.draw(!0,!0)}}var sr=null;this._pattern==null&&this._bg_img.width>0?(sr=t.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=sr):sr=this._pattern,sr&&(t.fillStyle=sr,t.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),t.fillStyle="transparent"),t.globalAlpha=1,t.imageSmoothingEnabled=t.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(s,t),this.onDrawBackground&&this.onDrawBackground(t,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(t.strokeStyle="#235",t.strokeRect(0,0,s.width,s.height)),this.render_connections_shadows?(t.shadowColor="#000",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=6):t.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(t),t.shadowColor="rgba(0,0,0,0)",t.restore()}t.finish&&t.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(s,t){this.current_node=s;var n=s.color||s.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,Ae=s.bgcolor||s.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;s.mouseOver;var Ne=this.ds.scale<.6;if(this.live_mode){s.flags.collapsed||(t.shadowColor="transparent",s.onDrawForeground&&s.onDrawForeground(t,this,this.canvas));return}var tr=this.editor_alpha;if(t.globalAlpha=tr,this.render_shadows&&!Ne?(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,t.shadowOffsetX=2*this.ds.scale,t.shadowOffsetY=2*this.ds.scale,t.shadowBlur=3*this.ds.scale):t.shadowColor="transparent",!(s.flags.collapsed&&s.onDrawCollapsed&&s.onDrawCollapsed(t,this)==!0)){var er=s._shape||LiteGraph.BOX_SHAPE,ir=temp_vec2;temp_vec2.set(s.size);var sr=s.horizontal;if(s.flags.collapsed){t.font=this.inner_text_font;var rr=s.getTitle?s.getTitle():s.title;rr!=null&&(s._collapsed_width=Math.min(s.size[0],t.measureText(rr).width+LiteGraph.NODE_TITLE_HEIGHT*2),ir[0]=s._collapsed_width,ir[1]=0)}s.clip_area&&(t.save(),t.beginPath(),er==LiteGraph.BOX_SHAPE?t.rect(0,0,ir[0],ir[1]):er==LiteGraph.ROUND_SHAPE?t.roundRect(0,0,ir[0],ir[1],[10]):er==LiteGraph.CIRCLE_SHAPE&&t.arc(ir[0]*.5,ir[1]*.5,ir[0]*.5,0,Math.PI*2),t.clip()),s.has_errors&&(Ae="red"),this.drawNodeShape(s,t,ir,n,Ae,s.is_selected,s.mouseOver),t.shadowColor="transparent",s.onDrawForeground&&s.onDrawForeground(t,this,this.canvas),t.textAlign=sr?"center":"left",t.font=this.inner_text_font;var nr=!Ne,ar=this.connecting_output,or=this.connecting_input;t.lineWidth=1;var ur=0,hr=new Float32Array(2);if(s.flags.collapsed){if(this.render_collapsed_slots){var Er=null,wr=null;if(s.inputs)for(var cr=0;cr<s.inputs.length;cr++){var vr=s.inputs[cr];if(vr.link!=null){Er=vr;break}}if(s.outputs)for(var cr=0;cr<s.outputs.length;cr++){var vr=s.outputs[cr];!vr.links||!vr.links.length||(wr=vr)}if(Er){var Dr=0,kr=LiteGraph.NODE_TITLE_HEIGHT*-.5;sr&&(Dr=s._collapsed_width*.5,kr=-LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#686",t.beginPath(),vr.type===LiteGraph.EVENT||vr.shape===LiteGraph.BOX_SHAPE?t.rect(Dr-7+.5,kr-4,14,8):vr.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(Dr+8,kr),t.lineTo(Dr+-4,kr-4),t.lineTo(Dr+-4,kr+4),t.closePath()):t.arc(Dr,kr,4,0,Math.PI*2),t.fill()}if(wr){var Dr=s._collapsed_width,kr=LiteGraph.NODE_TITLE_HEIGHT*-.5;sr&&(Dr=s._collapsed_width*.5,kr=0),t.fillStyle="#686",t.strokeStyle="black",t.beginPath(),vr.type===LiteGraph.EVENT||vr.shape===LiteGraph.BOX_SHAPE?t.rect(Dr-7+.5,kr-4,14,8):vr.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(Dr+6,kr),t.lineTo(Dr-6,kr-4),t.lineTo(Dr-6,kr+4),t.closePath()):t.arc(Dr,kr,4,0,Math.PI*2),t.fill()}}}else{if(s.inputs)for(var cr=0;cr<s.inputs.length;cr++){var vr=s.inputs[cr],mr=vr.type,dr=vr.shape;t.globalAlpha=tr,this.connecting_output&&!LiteGraph.isValidConnection(vr.type,ar.type)&&(t.globalAlpha=.4*tr),t.fillStyle=vr.link!=null?vr.color_on||this.default_connection_color_byType[mr]||this.default_connection_color.input_on:vr.color_off||this.default_connection_color_byTypeOff[mr]||this.default_connection_color_byType[mr]||this.default_connection_color.input_off;var lr=s.getConnectionPos(!0,cr,hr);lr[0]-=s.pos[0],lr[1]-=s.pos[1],ur<lr[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(ur=lr[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.beginPath(),mr=="array"&&(dr=LiteGraph.GRID_SHAPE);var gr=!0;if(vr.type===LiteGraph.EVENT||vr.shape===LiteGraph.BOX_SHAPE?sr?t.rect(lr[0]-5+.5,lr[1]-8+.5,10,14):t.rect(lr[0]-6+.5,lr[1]-5+.5,14,10):dr===LiteGraph.ARROW_SHAPE?(t.moveTo(lr[0]+8,lr[1]+.5),t.lineTo(lr[0]-4,lr[1]+6+.5),t.lineTo(lr[0]-4,lr[1]-6+.5),t.closePath()):dr===LiteGraph.GRID_SHAPE?(t.rect(lr[0]-4,lr[1]-4,2,2),t.rect(lr[0]-1,lr[1]-4,2,2),t.rect(lr[0]+2,lr[1]-4,2,2),t.rect(lr[0]-4,lr[1]-1,2,2),t.rect(lr[0]-1,lr[1]-1,2,2),t.rect(lr[0]+2,lr[1]-1,2,2),t.rect(lr[0]-4,lr[1]+2,2,2),t.rect(lr[0]-1,lr[1]+2,2,2),t.rect(lr[0]+2,lr[1]+2,2,2),gr=!1):Ne?t.rect(lr[0]-4,lr[1]-4,8,8):t.arc(lr[0],lr[1],4,0,Math.PI*2),t.fill(),nr){var fr=vr.label!=null?vr.label:vr.name;fr&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,sr||vr.dir==LiteGraph.UP?t.fillText(fr,lr[0],lr[1]-10):t.fillText(fr,lr[0]+10,lr[1]+5))}}if(t.textAlign=sr?"center":"right",t.strokeStyle="black",s.outputs)for(var cr=0;cr<s.outputs.length;cr++){var vr=s.outputs[cr],mr=vr.type,dr=vr.shape;this.connecting_input&&!LiteGraph.isValidConnection(mr,or.type)&&(t.globalAlpha=.4*tr);var lr=s.getConnectionPos(!1,cr,hr);lr[0]-=s.pos[0],lr[1]-=s.pos[1],ur<lr[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(ur=lr[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fillStyle=vr.links&&vr.links.length?vr.color_on||this.default_connection_color_byType[mr]||this.default_connection_color.output_on:vr.color_off||this.default_connection_color_byTypeOff[mr]||this.default_connection_color_byType[mr]||this.default_connection_color.output_off,t.beginPath(),mr=="array"&&(dr=LiteGraph.GRID_SHAPE);var gr=!0;if(mr===LiteGraph.EVENT||dr===LiteGraph.BOX_SHAPE?sr?t.rect(lr[0]-5+.5,lr[1]-8+.5,10,14):t.rect(lr[0]-6+.5,lr[1]-5+.5,14,10):dr===LiteGraph.ARROW_SHAPE?(t.moveTo(lr[0]+8,lr[1]+.5),t.lineTo(lr[0]-4,lr[1]+6+.5),t.lineTo(lr[0]-4,lr[1]-6+.5),t.closePath()):dr===LiteGraph.GRID_SHAPE?(t.rect(lr[0]-4,lr[1]-4,2,2),t.rect(lr[0]-1,lr[1]-4,2,2),t.rect(lr[0]+2,lr[1]-4,2,2),t.rect(lr[0]-4,lr[1]-1,2,2),t.rect(lr[0]-1,lr[1]-1,2,2),t.rect(lr[0]+2,lr[1]-1,2,2),t.rect(lr[0]-4,lr[1]+2,2,2),t.rect(lr[0]-1,lr[1]+2,2,2),t.rect(lr[0]+2,lr[1]+2,2,2),gr=!1):Ne?t.rect(lr[0]-4,lr[1]-4,8,8):t.arc(lr[0],lr[1],4,0,Math.PI*2),t.fill(),!Ne&&gr&&t.stroke(),nr){var fr=vr.label!=null?vr.label:vr.name;fr&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,sr||vr.dir==LiteGraph.DOWN?t.fillText(fr,lr[0],lr[1]-8):t.fillText(fr,lr[0]-10,lr[1]+5))}}if(t.textAlign="left",t.globalAlpha=1,s.widgets){var yr=ur;(sr||s.widgets_up)&&(yr=2),s.widgets_start_y!=null&&(yr=s.widgets_start_y),this.drawNodeWidgets(s,yr,t,this.node_widget&&this.node_widget[0]==s?this.node_widget[1]:null)}}s.clip_area&&t.restore(),t.globalAlpha=1}},LGraphCanvas.prototype.drawLinkTooltip=function(s,t){var n=t._pos;if(s.fillStyle="black",s.beginPath(),s.arc(n[0],n[1],3,0,Math.PI*2),s.fill(),t.data!=null&&!(this.onDrawLinkTooltip&&this.onDrawLinkTooltip(s,t,this)==!0)){var Ae=t.data,Ne=null;if(Ae.constructor===Number?Ne=Ae.toFixed(2):Ae.constructor===String?Ne='"'+Ae+'"':Ae.constructor===Boolean?Ne=String(Ae):Ae.toToolTip?Ne=Ae.toToolTip():Ne="["+Ae.constructor.name+"]",Ne!=null){Ne=Ne.substr(0,30),s.font="14px Courier New";var tr=s.measureText(Ne),er=tr.width+20,ir=24;s.shadowColor="black",s.shadowOffsetX=2,s.shadowOffsetY=2,s.shadowBlur=3,s.fillStyle="#454",s.beginPath(),s.roundRect(n[0]-er*.5,n[1]-15-ir,er,ir,[3]),s.moveTo(n[0]-10,n[1]-15),s.lineTo(n[0]+10,n[1]-15),s.lineTo(n[0],n[1]-5),s.fill(),s.shadowColor="transparent",s.textAlign="center",s.fillStyle="#CEC",s.fillText(Ne,n[0],n[1]-15-ir*.3)}}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(s,t,n,Ae,Ne,tr,er){t.strokeStyle=Ae,t.fillStyle=Ne;var ir=LiteGraph.NODE_TITLE_HEIGHT,sr=this.ds.scale<.5,rr=s._shape||s.constructor.shape||LiteGraph.ROUND_SHAPE,nr=s.constructor.title_mode,ar=!0;nr==LiteGraph.TRANSPARENT_TITLE||nr==LiteGraph.NO_TITLE?ar=!1:nr==LiteGraph.AUTOHIDE_TITLE&&er&&(ar=!0);var or=tmp_area;or[0]=0,or[1]=ar?-ir:0,or[2]=n[0]+1,or[3]=ar?n[1]+ir:n[1];var ur=t.globalAlpha;if(t.beginPath(),rr==LiteGraph.BOX_SHAPE||sr?t.fillRect(or[0],or[1],or[2],or[3]):rr==LiteGraph.ROUND_SHAPE||rr==LiteGraph.CARD_SHAPE?t.roundRect(or[0],or[1],or[2],or[3],rr==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):rr==LiteGraph.CIRCLE_SHAPE&&t.arc(n[0]*.5,n[1]*.5,n[0]*.5,0,Math.PI*2),t.fill(),!s.flags.collapsed&&ar&&(t.shadowColor="transparent",t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(0,-1,or[2],2)),t.shadowColor="transparent",s.onDrawBackground&&s.onDrawBackground(t,this,this.canvas,this.graph_mouse),ar||nr==LiteGraph.TRANSPARENT_TITLE){if(s.onDrawTitleBar)s.onDrawTitleBar(t,ir,n,this.ds.scale,Ae);else if(nr!=LiteGraph.TRANSPARENT_TITLE&&(s.constructor.title_color||this.render_title_colored)){var hr=s.constructor.title_color||Ae;if(s.flags.collapsed&&(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var cr=LGraphCanvas.gradients[hr];cr||(cr=LGraphCanvas.gradients[hr]=t.createLinearGradient(0,0,400,0),cr.addColorStop(0,hr),cr.addColorStop(1,"#000")),t.fillStyle=cr}else t.fillStyle=hr;t.beginPath(),rr==LiteGraph.BOX_SHAPE||sr?t.rect(0,-ir,n[0]+1,ir):(rr==LiteGraph.ROUND_SHAPE||rr==LiteGraph.CARD_SHAPE)&&t.roundRect(0,-ir,n[0]+1,ir,s.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),t.fill(),t.shadowColor="transparent"}var vr=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[s.mode]&&(vr=LiteGraph.NODE_MODES_COLORS[s.mode]),LiteGraph.node_box_coloured_when_on&&(vr=s.action_triggered?"#FFF":s.execute_triggered?"#AAA":vr);var mr=10;if(s.onDrawTitleBox?s.onDrawTitleBox(t,ir,n,this.ds.scale):rr==LiteGraph.ROUND_SHAPE||rr==LiteGraph.CIRCLE_SHAPE||rr==LiteGraph.CARD_SHAPE?(sr&&(t.fillStyle="black",t.beginPath(),t.arc(ir*.5,ir*-.5,mr*.5+1,0,Math.PI*2),t.fill()),t.fillStyle=s.boxcolor||vr||LiteGraph.NODE_DEFAULT_BOXCOLOR,sr?t.fillRect(ir*.5-mr*.5,ir*-.5-mr*.5,mr,mr):(t.beginPath(),t.arc(ir*.5,ir*-.5,mr*.5,0,Math.PI*2),t.fill())):(sr&&(t.fillStyle="black",t.fillRect((ir-mr)*.5-1,(ir+mr)*-.5-1,mr+2,mr+2)),t.fillStyle=s.boxcolor||vr||LiteGraph.NODE_DEFAULT_BOXCOLOR,t.fillRect((ir-mr)*.5,(ir+mr)*-.5,mr,mr)),t.globalAlpha=ur,s.onDrawTitleText&&s.onDrawTitleText(t,ir,n,this.ds.scale,this.title_text_font,tr),!sr){t.font=this.title_text_font;var dr=String(s.getTitle());dr&&(tr?t.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:t.fillStyle=s.constructor.title_text_color||this.node_title_color,s.flags.collapsed?(t.textAlign="left",t.measureText(dr),t.fillText(dr.substr(0,20),ir,LiteGraph.NODE_TITLE_TEXT_Y-ir),t.textAlign="left"):(t.textAlign="left",t.fillText(dr,ir,LiteGraph.NODE_TITLE_TEXT_Y-ir)))}if(!s.flags.collapsed&&s.subgraph&&!s.skip_subgraph_button){var lr=LiteGraph.NODE_TITLE_HEIGHT,gr=s.size[0]-lr,fr=LiteGraph.isInsideRectangle(this.graph_mouse[0]-s.pos[0],this.graph_mouse[1]-s.pos[1],gr+2,-lr+2,lr-4,lr-4);t.fillStyle=fr?"#888":"#555",rr==LiteGraph.BOX_SHAPE||sr?t.fillRect(gr+2,-lr+2,lr-4,lr-4):(t.beginPath(),t.roundRect(gr+2,-lr+2,lr-4,lr-4,[4]),t.fill()),t.fillStyle="#333",t.beginPath(),t.moveTo(gr+lr*.2,-lr*.6),t.lineTo(gr+lr*.8,-lr*.6),t.lineTo(gr+lr*.5,-lr*.3),t.fill()}s.onDrawTitle&&s.onDrawTitle(t)}tr&&(s.onBounding&&s.onBounding(or),nr==LiteGraph.TRANSPARENT_TITLE&&(or[1]-=ir,or[3]+=ir),t.lineWidth=1,t.globalAlpha=.8,t.beginPath(),rr==LiteGraph.BOX_SHAPE?t.rect(-6+or[0],-6+or[1],12+or[2],12+or[3]):rr==LiteGraph.ROUND_SHAPE||rr==LiteGraph.CARD_SHAPE&&s.flags.collapsed?t.roundRect(-6+or[0],-6+or[1],12+or[2],12+or[3],[this.round_radius*2]):rr==LiteGraph.CARD_SHAPE?t.roundRect(-6+or[0],-6+or[1],12+or[2],12+or[3],[this.round_radius*2,2,this.round_radius*2,2]):rr==LiteGraph.CIRCLE_SHAPE&&t.arc(n[0]*.5,n[1]*.5,n[0]*.5+6,0,Math.PI*2),t.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,t.stroke(),t.strokeStyle=Ae,t.globalAlpha=1),s.execute_triggered>0&&s.execute_triggered--,s.action_triggered>0&&s.action_triggered--};var margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);LGraphCanvas.prototype.drawConnections=function(s){var t=LiteGraph.getTime(),n=this.visible_area;margin_area[0]=n[0]-20,margin_area[1]=n[1]-20,margin_area[2]=n[2]+40,margin_area[3]=n[3]+40,s.lineWidth=this.connections_width,s.fillStyle="#AAA",s.strokeStyle="#AAA",s.globalAlpha=this.editor_alpha;for(var Ae=this.graph._nodes,Ne=0,tr=Ae.length;Ne<tr;++Ne){var er=Ae[Ne];if(!(!er.inputs||!er.inputs.length))for(var ir=0;ir<er.inputs.length;++ir){var sr=er.inputs[ir];if(!(!sr||sr.link==null)){var rr=sr.link,nr=this.graph.links[rr];if(nr){var ar=this.graph.getNodeById(nr.origin_id);if(ar!=null){var or=nr.origin_slot,ur=null;or==-1?ur=[ar.pos[0]+10,ar.pos[1]+10]:ur=ar.getConnectionPos(!1,or,tempA);var hr=er.getConnectionPos(!0,ir,tempB);if(link_bounding[0]=ur[0],link_bounding[1]=ur[1],link_bounding[2]=hr[0]-ur[0],link_bounding[3]=hr[1]-ur[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!overlapBounding(link_bounding,margin_area)){var cr=ar.outputs[or],vr=er.inputs[ir];if(!(!cr||!vr)){var mr=cr.dir||(ar.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),dr=vr.dir||(er.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(s,ur,hr,nr,!1,0,null,mr,dr),nr&&nr._last_time&&t-nr._last_time<1e3){var lr=2-(t-nr._last_time)*.002,gr=s.globalAlpha;s.globalAlpha=gr*lr,this.renderLink(s,ur,hr,nr,!0,lr,"white",mr,dr),s.globalAlpha=gr}}}}}}}}s.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(s,t,n,Ae,Ne,tr,er,ir,sr,rr){Ae&&this.visible_links.push(Ae),!er&&Ae&&(er=Ae.color||LGraphCanvas.link_type_colors[Ae.type]),er||(er=this.default_link_color),Ae!=null&&this.highlighted_links[Ae.id]&&(er="#FFF"),ir=ir||LiteGraph.RIGHT,sr=sr||LiteGraph.LEFT;var nr=distance(t,n);this.render_connections_border&&this.ds.scale>.6&&(s.lineWidth=this.connections_width+4),s.lineJoin="round",rr=rr||1,rr>1&&(s.lineWidth=.5),s.beginPath();for(var ar=0;ar<rr;ar+=1){var or=(ar-(rr-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){s.moveTo(t[0],t[1]+or);var ur=0,hr=0,cr=0,vr=0;switch(ir){case LiteGraph.LEFT:ur=nr*-.25;break;case LiteGraph.RIGHT:ur=nr*.25;break;case LiteGraph.UP:hr=nr*-.25;break;case LiteGraph.DOWN:hr=nr*.25;break}switch(sr){case LiteGraph.LEFT:cr=nr*-.25;break;case LiteGraph.RIGHT:cr=nr*.25;break;case LiteGraph.UP:vr=nr*-.25;break;case LiteGraph.DOWN:vr=nr*.25;break}s.bezierCurveTo(t[0]+ur,t[1]+hr+or,n[0]+cr,n[1]+vr+or,n[0],n[1]+or)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){s.moveTo(t[0],t[1]+or);var ur=0,hr=0,cr=0,vr=0;switch(ir){case LiteGraph.LEFT:ur=-1;break;case LiteGraph.RIGHT:ur=1;break;case LiteGraph.UP:hr=-1;break;case LiteGraph.DOWN:hr=1;break}switch(sr){case LiteGraph.LEFT:cr=-1;break;case LiteGraph.RIGHT:cr=1;break;case LiteGraph.UP:vr=-1;break;case LiteGraph.DOWN:vr=1;break}var mr=15;s.lineTo(t[0]+ur*mr,t[1]+hr*mr+or),s.lineTo(n[0]+cr*mr,n[1]+vr*mr+or),s.lineTo(n[0],n[1]+or)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){s.moveTo(t[0],t[1]);var dr=t[0],lr=t[1],gr=n[0],fr=n[1];ir==LiteGraph.RIGHT?dr+=10:lr+=10,sr==LiteGraph.LEFT?gr-=10:fr-=10,s.lineTo(dr,lr),s.lineTo((dr+gr)*.5,lr),s.lineTo((dr+gr)*.5,fr),s.lineTo(gr,fr),s.lineTo(n[0],n[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!Ne&&(s.strokeStyle="rgba(0,0,0,0.5)",s.stroke()),s.lineWidth=this.connections_width,s.fillStyle=s.strokeStyle=er,s.stroke();var yr=this.computeConnectionPoint(t,n,.5,ir,sr);if(Ae&&Ae._pos&&(Ae._pos[0]=yr[0],Ae._pos[1]=yr[1]),this.ds.scale>=.6&&this.highquality_render&&sr!=LiteGraph.CENTER){if(this.render_connection_arrows){var Er=this.computeConnectionPoint(t,n,.25,ir,sr),wr=this.computeConnectionPoint(t,n,.26,ir,sr),Dr=this.computeConnectionPoint(t,n,.75,ir,sr),kr=this.computeConnectionPoint(t,n,.76,ir,sr),zr=0,Vr=0;this.render_curved_connections?(zr=-Math.atan2(wr[0]-Er[0],wr[1]-Er[1]),Vr=-Math.atan2(kr[0]-Dr[0],kr[1]-Dr[1])):Vr=zr=n[1]>t[1]?0:Math.PI,s.save(),s.translate(Er[0],Er[1]),s.rotate(zr),s.beginPath(),s.moveTo(-5,-3),s.lineTo(0,7),s.lineTo(5,-3),s.fill(),s.restore(),s.save(),s.translate(Dr[0],Dr[1]),s.rotate(Vr),s.beginPath(),s.moveTo(-5,-3),s.lineTo(0,7),s.lineTo(5,-3),s.fill(),s.restore()}s.beginPath(),s.arc(yr[0],yr[1],5,0,Math.PI*2),s.fill()}if(tr){s.fillStyle=er;for(var ar=0;ar<5;++ar){var Hr=(LiteGraph.getTime()*.001+ar*.2)%1,yr=this.computeConnectionPoint(t,n,Hr,ir,sr);s.beginPath(),s.arc(yr[0],yr[1],5,0,2*Math.PI),s.fill()}}},LGraphCanvas.prototype.computeConnectionPoint=function(s,t,n,Ae,Ne){Ae=Ae||LiteGraph.RIGHT,Ne=Ne||LiteGraph.LEFT;var tr=distance(s,t),er=s,ir=[s[0],s[1]],sr=[t[0],t[1]],rr=t;switch(Ae){case LiteGraph.LEFT:ir[0]+=tr*-.25;break;case LiteGraph.RIGHT:ir[0]+=tr*.25;break;case LiteGraph.UP:ir[1]+=tr*-.25;break;case LiteGraph.DOWN:ir[1]+=tr*.25;break}switch(Ne){case LiteGraph.LEFT:sr[0]+=tr*-.25;break;case LiteGraph.RIGHT:sr[0]+=tr*.25;break;case LiteGraph.UP:sr[1]+=tr*-.25;break;case LiteGraph.DOWN:sr[1]+=tr*.25;break}var nr=(1-n)*(1-n)*(1-n),ar=3*((1-n)*(1-n))*n,or=3*(1-n)*(n*n),ur=n*n*n,hr=nr*er[0]+ar*ir[0]+or*sr[0]+ur*rr[0],cr=nr*er[1]+ar*ir[1]+or*sr[1]+ur*rr[1];return[hr,cr]},LGraphCanvas.prototype.drawExecutionOrder=function(s){s.shadowColor="transparent",s.globalAlpha=.25,s.textAlign="center",s.strokeStyle="white",s.globalAlpha=.75;for(var t=this.visible_nodes,n=0;n<t.length;++n){var Ae=t[n];s.fillStyle="black",s.fillRect(Ae.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,Ae.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),Ae.order==0&&s.strokeRect(Ae.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,Ae.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),s.fillStyle="#FFF",s.fillText(Ae.order,Ae.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,Ae.pos[1]-6)}s.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(s,t,n,Ae){if(!s.widgets||!s.widgets.length)return 0;var Ne=s.size[0],tr=s.widgets;t+=2;var er=LiteGraph.NODE_WIDGET_HEIGHT,ir=this.ds.scale>.5;n.save(),n.globalAlpha=this.editor_alpha;for(var sr=LiteGraph.WIDGET_OUTLINE_COLOR,rr=LiteGraph.WIDGET_BGCOLOR,nr=LiteGraph.WIDGET_TEXT_COLOR,ar=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,or=15,ur=0;ur<tr.length;++ur){var hr=tr[ur],cr=t;hr.y&&(cr=hr.y),hr.last_y=cr,n.strokeStyle=sr,n.fillStyle="#222",n.textAlign="left",hr.disabled&&(n.globalAlpha*=.5);var vr=hr.width||Ne;switch(hr.type){case"button":hr.clicked&&(n.fillStyle="#AAA",hr.clicked=!1,this.dirty_canvas=!0),n.fillRect(or,cr,vr-or*2,er),ir&&!hr.disabled&&n.strokeRect(or,cr,vr-or*2,er),ir&&(n.textAlign="center",n.fillStyle=nr,n.fillText(hr.label||hr.name,vr*.5,cr+er*.7));break;case"toggle":if(n.textAlign="left",n.strokeStyle=sr,n.fillStyle=rr,n.beginPath(),ir?n.roundRect(or,cr,vr-or*2,er,[er*.5]):n.rect(or,cr,vr-or*2,er),n.fill(),ir&&!hr.disabled&&n.stroke(),n.fillStyle=hr.value?"#89A":"#333",n.beginPath(),n.arc(vr-or*2,cr+er*.5,er*.36,0,Math.PI*2),n.fill(),ir){n.fillStyle=ar;const yr=hr.label||hr.name;yr!=null&&n.fillText(yr,or*2,cr+er*.7),n.fillStyle=hr.value?nr:ar,n.textAlign="right",n.fillText(hr.value?hr.options.on||"true":hr.options.off||"false",vr-40,cr+er*.7)}break;case"slider":n.fillStyle=rr,n.fillRect(or,cr,vr-or*2,er);var mr=hr.options.max-hr.options.min,dr=(hr.value-hr.options.min)/mr;if(dr<0&&(dr=0),dr>1&&(dr=1),n.fillStyle=hr.options.hasOwnProperty("slider_color")?hr.options.slider_color:Ae==hr?"#89A":"#678",n.fillRect(or,cr,dr*(vr-or*2),er),ir&&!hr.disabled&&n.strokeRect(or,cr,vr-or*2,er),hr.marker){var lr=(hr.marker-hr.options.min)/mr;lr<0&&(lr=0),lr>1&&(lr=1),n.fillStyle=hr.options.hasOwnProperty("marker_color")?hr.options.marker_color:"#AA9",n.fillRect(or+lr*(vr-or*2),cr,2,er)}ir&&(n.textAlign="center",n.fillStyle=nr,n.fillText(hr.label||hr.name+"  "+Number(hr.value).toFixed(hr.options.precision!=null?hr.options.precision:3),vr*.5,cr+er*.7));break;case"number":case"combo":if(n.textAlign="left",n.strokeStyle=sr,n.fillStyle=rr,n.beginPath(),ir?n.roundRect(or,cr,vr-or*2,er,[er*.5]):n.rect(or,cr,vr-or*2,er),n.fill(),ir)if(hr.disabled||n.stroke(),n.fillStyle=nr,hr.disabled||(n.beginPath(),n.moveTo(or+16,cr+5),n.lineTo(or+6,cr+er*.5),n.lineTo(or+16,cr+er-5),n.fill(),n.beginPath(),n.moveTo(vr-or-16,cr+5),n.lineTo(vr-or-6,cr+er*.5),n.lineTo(vr-or-16,cr+er-5),n.fill()),n.fillStyle=ar,n.fillText(hr.label||hr.name,or*2+5,cr+er*.7),n.fillStyle=nr,n.textAlign="right",hr.type=="number")n.fillText(Number(hr.value).toFixed(hr.options.precision!==void 0?hr.options.precision:3),vr-or*2-20,cr+er*.7);else{var gr=hr.value;if(hr.options.values){var fr=hr.options.values;fr.constructor===Function&&(fr=fr()),fr&&fr.constructor!==Array&&(gr=fr[hr.value])}n.fillText(gr,vr-or*2-20,cr+er*.7)}break;case"string":case"text":if(n.textAlign="left",n.strokeStyle=sr,n.fillStyle=rr,n.beginPath(),ir?n.roundRect(or,cr,vr-or*2,er,[er*.5]):n.rect(or,cr,vr-or*2,er),n.fill(),ir){hr.disabled||n.stroke(),n.save(),n.beginPath(),n.rect(or,cr,vr-or*2,er),n.clip(),n.fillStyle=ar;const yr=hr.label||hr.name;yr!=null&&n.fillText(yr,or*2,cr+er*.7),n.fillStyle=nr,n.textAlign="right",n.fillText(String(hr.value).substr(0,30),vr-or*2,cr+er*.7),n.restore()}break;default:hr.draw&&hr.draw(n,s,vr,cr,er);break}t+=(hr.computeSize?hr.computeSize(vr)[1]:er)+4,n.globalAlpha=this.editor_alpha}n.restore(),n.textAlign="left"},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":var old_value=w.value;if(event.type==LiteGraph.pointerevents_method+"move"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));var delta=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=delta*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+delta:index=values_list.indexOf(w.value)+delta,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let s=function(t,n,Ae){return values!=values_list&&(t=text_values.indexOf(t)),this.value=t,inner_value_change(this,t),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:s.bind(w)},ref_window)}}else if(event.type==LiteGraph.pointerevents_method+"up"&&w.type=="number"){var delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,(function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(s){}this.value=Number(v),inner_value_change(this,this.value)}).bind(w),event)}old_value!=w.value&&setTimeout((function(){inner_value_change(this,this.value)}).bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,(function(s){inner_value_change(this,s)}).bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}}}function inner_value_change(s,t){s.type=="number"&&(t=Number(t)),s.value=t,s.options&&s.options.property&&node.properties[s.options.property]!==void 0&&node.setProperty(s.options.property,t),s.callback&&s.callback(s.value,that,node,pos,event)}return null},LGraphCanvas.prototype.drawGroups=function(s,t){if(this.graph){var n=this.graph._groups;t.save(),t.globalAlpha=.5*this.editor_alpha;for(var Ae=0;Ae<n.length;++Ae){var Ne=n[Ae];if(overlapBounding(this.visible_area,Ne._bounding)){t.fillStyle=Ne.color||"#335",t.strokeStyle=Ne.color||"#335";var tr=Ne._pos,er=Ne._size;t.globalAlpha=.25*this.editor_alpha,t.beginPath(),t.rect(tr[0]+.5,tr[1]+.5,er[0],er[1]),t.fill(),t.globalAlpha=this.editor_alpha,t.stroke(),t.beginPath(),t.moveTo(tr[0]+er[0],tr[1]+er[1]),t.lineTo(tr[0]+er[0]-10,tr[1]+er[1]),t.lineTo(tr[0]+er[0],tr[1]+er[1]-10),t.fill();var ir=Ne.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;t.font=ir+"px Arial",t.textAlign="left",t.fillText(Ne.title,tr[0]+4,tr[1]+ir)}}t.restore()}},LGraphCanvas.prototype.adjustNodesSize=function(){for(var s=this.graph._nodes,t=0;t<s.length;++t)s[t].size=s[t].computeSize();this.setDirty(!0,!0)},LGraphCanvas.prototype.resize=function(s,t){if(!s&&!t){var n=this.canvas.parentNode;s=n.offsetWidth,t=n.offsetHeight}this.canvas.width==s&&this.canvas.height==t||(this.canvas.width=s,this.canvas.height=t,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(s){if(!s){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var t=this,n=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var Ae=setInterval(function(){t.editor_alpha*=n,t.dirty_canvas=!0,t.dirty_bgcanvas=!0,n<1&&t.editor_alpha<.01&&(clearInterval(Ae),n<1&&(t.live_mode=!0)),n>1&&t.editor_alpha>.99&&(clearInterval(Ae),t.editor_alpha=1)},1)},LGraphCanvas.prototype.onNodeSelectionChange=function(s){},LGraphCanvas.onGroupAdd=function(s,t,n){var Ae=LGraphCanvas.active_canvas;Ae.getCanvasWindow();var Ne=new LiteGraph.LGraphGroup;Ne.pos=Ae.convertEventToCanvasOffset(n),Ae.graph.add(Ne)},LGraphCanvas.getBoundaryNodes=function(s){let t=null,n=null,Ae=null,Ne=null;for(const tr in s){const er=s[tr],[ir,sr]=er.pos,[rr,nr]=er.size;(t===null||sr<t.pos[1])&&(t=er),(n===null||ir+rr>n.pos[0]+n.size[0])&&(n=er),(Ae===null||sr+nr>Ae.pos[1]+Ae.size[1])&&(Ae=er),(Ne===null||ir<Ne.pos[0])&&(Ne=er)}return{top:t,right:n,bottom:Ae,left:Ne}},LGraphCanvas.prototype.boundaryNodesForSelection=function(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))},LGraphCanvas.alignNodes=function(s,t,n){if(!s)return;const Ae=LGraphCanvas.active_canvas;let Ne=[];n===void 0?Ne=LGraphCanvas.getBoundaryNodes(s):Ne={top:n,right:n,bottom:n,left:n};for(const[tr,er]of Object.entries(Ae.selected_nodes))switch(t){case"right":er.pos[0]=Ne.right.pos[0]+Ne.right.size[0]-er.size[0];break;case"left":er.pos[0]=Ne.left.pos[0];break;case"top":er.pos[1]=Ne.top.pos[1];break;case"bottom":er.pos[1]=Ne.bottom.pos[1]+Ne.bottom.size[1]-er.size[1];break}Ae.dirty_canvas=!0,Ae.dirty_bgcanvas=!0},LGraphCanvas.onNodeAlign=function(s,t,n,Ae,Ne){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:tr,parentMenu:Ae});function tr(er){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,er.toLowerCase(),Ne)}},LGraphCanvas.onGroupAlign=function(s,t,n,Ae){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:Ne,parentMenu:Ae});function Ne(tr){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,tr.toLowerCase())}},LGraphCanvas.onMenuAdd=function(s,t,n,Ae,Ne){var tr=LGraphCanvas.active_canvas,er=tr.getCanvasWindow(),ir=tr.graph;if(!ir)return;function sr(rr,nr){var ar=LiteGraph.getNodeTypesCategories(tr.filter||ir.filter).filter(function(hr){return hr.startsWith(rr)}),or=[];ar.map(function(hr){if(hr){var cr=new RegExp("^("+rr+")"),vr=hr.replace(cr,"").split("/")[0],mr=rr===""?vr+"/":rr+vr+"/",dr=vr;dr.indexOf("::")!=-1&&(dr=dr.split("::")[1]);var lr=or.findIndex(function(gr){return gr.value===mr});lr===-1&&or.push({value:mr,content:dr,has_submenu:!0,callback:function(gr,fr,yr,Er){sr(gr.value,Er)}})}});var ur=LiteGraph.getNodeTypesInCategory(rr.slice(0,-1),tr.filter||ir.filter);ur.map(function(hr){if(!hr.skip_list){var cr={value:hr.type,content:hr.title,has_submenu:!1,callback:function(vr,mr,dr,lr){var gr=lr.getFirstEvent();tr.graph.beforeChange();var fr=LiteGraph.createNode(vr.value);fr&&(fr.pos=tr.convertEventToCanvasOffset(gr),tr.graph.add(fr)),Ne&&Ne(fr),tr.graph.afterChange()}};or.push(cr)}}),new LiteGraph.ContextMenu(or,{event:n,parentMenu:nr},er)}return sr("",Ae),!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(s,sr,n,Ae,Ne){if(!Ne)return;var tr=this,er=LGraphCanvas.active_canvas,ir=er.getCanvasWindow(),sr=Ne.optional_inputs;Ne.onGetInputs&&(sr=Ne.onGetInputs());var rr=[];if(sr)for(var nr=0;nr<sr.length;nr++){var ar=sr[nr];if(!ar){rr.push(null);continue}var or=ar[0];ar[2]||(ar[2]={}),ar[2].label&&(or=ar[2].label),ar[2].removable=!0;var ur={content:or,value:ar};ar[1]==LiteGraph.ACTION&&(ur.className="event"),rr.push(ur)}if(Ne.onMenuNodeInputs){var hr=Ne.onMenuNodeInputs(rr);hr&&(rr=hr)}if(!rr.length){console.log("no input entries");return}new LiteGraph.ContextMenu(rr,{event:n,callback:cr,parentMenu:Ae,node:Ne},ir);function cr(vr,mr,dr){Ne&&(vr.callback&&vr.callback.call(tr,Ne,vr,mr,dr),vr.value&&(Ne.graph.beforeChange(),Ne.addInput(vr.value[0],vr.value[1],vr.value[2]),Ne.onNodeInputAdd&&Ne.onNodeInputAdd(vr.value),Ne.setDirtyCanvas(!0,!0),Ne.graph.afterChange()))}return!1},LGraphCanvas.showMenuNodeOptionalOutputs=function(s,sr,n,Ae,Ne){if(!Ne)return;var tr=this,er=LGraphCanvas.active_canvas,ir=er.getCanvasWindow(),sr=Ne.optional_outputs;Ne.onGetOutputs&&(sr=Ne.onGetOutputs());var rr=[];if(sr)for(var nr=0;nr<sr.length;nr++){var ar=sr[nr];if(!ar){rr.push(null);continue}if(!(Ne.flags&&Ne.flags.skip_repeated_outputs&&Ne.findOutputSlot(ar[0])!=-1)){var or=ar[0];ar[2]||(ar[2]={}),ar[2].label&&(or=ar[2].label),ar[2].removable=!0;var ur={content:or,value:ar};ar[1]==LiteGraph.EVENT&&(ur.className="event"),rr.push(ur)}}if(this.onMenuNodeOutputs&&(rr=this.onMenuNodeOutputs(rr)),LiteGraph.do_add_triggers_slots&&Ne.findOutputSlot("onExecuted")==-1&&rr.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),Ne.onMenuNodeOutputs){var hr=Ne.onMenuNodeOutputs(rr);hr&&(rr=hr)}if(!rr.length)return;new LiteGraph.ContextMenu(rr,{event:n,callback:cr,parentMenu:Ae,node:Ne},ir);function cr(vr,mr,dr){if(Ne&&(vr.callback&&vr.callback.call(tr,Ne,vr,mr,dr),!!vr.value)){var lr=vr.value[1];if(lr&&(lr.constructor===Object||lr.constructor===Array)){var gr=[];for(var fr in lr)gr.push({content:fr,value:lr[fr]});return new LiteGraph.ContextMenu(gr,{event:mr,callback:cr,parentMenu:Ae,node:Ne}),!1}else Ne.graph.beforeChange(),Ne.addOutput(vr.value[0],vr.value[1],vr.value[2]),Ne.onNodeOutputAdd&&Ne.onNodeOutputAdd(vr.value),Ne.setDirtyCanvas(!0,!0),Ne.graph.afterChange()}}return!1},LGraphCanvas.onShowMenuNodeProperties=function(s,t,n,Ae,Ne){if(!Ne||!Ne.properties)return;var tr=LGraphCanvas.active_canvas,er=tr.getCanvasWindow(),ir=[];for(var sr in Ne.properties){var s=Ne.properties[sr]!==void 0?Ne.properties[sr]:" ";typeof s=="object"&&(s=JSON.stringify(s));var rr=Ne.getPropertyInfo(sr);(rr.type=="enum"||rr.type=="combo")&&(s=LGraphCanvas.getPropertyPrintableValue(s,rr.values)),s=LGraphCanvas.decodeHTML(s),ir.push({content:"<span class='property_name'>"+(rr.label?rr.label:sr)+"</span><span class='property_value'>"+s+"</span>",value:sr})}if(!ir.length)return;new LiteGraph.ContextMenu(ir,{event:n,callback:nr,parentMenu:Ae,allow_html:!0,node:Ne},er);function nr(ar,or,ur,hr){if(Ne){var cr=this.getBoundingClientRect();tr.showEditPropertyValue(Ne,ar.value,{position:[cr.left,cr.top]})}}return!1},LGraphCanvas.decodeHTML=function(s){var t=document.createElement("div");return t.innerText=s,t.innerHTML},LGraphCanvas.onMenuResizeNode=function(s,t,n,Ae,Ne){if(Ne){var tr=function(sr){sr.size=sr.computeSize(),sr.onResize&&sr.onResize(sr.size)},er=LGraphCanvas.active_canvas;if(!er.selected_nodes||Object.keys(er.selected_nodes).length<=1)tr(Ne);else for(var ir in er.selected_nodes)tr(er.selected_nodes[ir]);Ne.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.showLinkMenu=function(s,t){var n=this,Ae=n.graph.getNodeById(s.origin_id),Ne=n.graph.getNodeById(s.target_id),tr=!1;Ae&&Ae.outputs&&Ae.outputs[s.origin_slot]&&(tr=Ae.outputs[s.origin_slot].type);var er=!1;Ne&&Ne.outputs&&Ne.outputs[s.target_slot]&&(er=Ne.inputs[s.target_slot].type);var ir=["Add Node",null,"Delete",null],sr=new LiteGraph.ContextMenu(ir,{event:t,title:s.data!=null?s.data.constructor.name:null,callback:rr});function rr(nr,ar,or){switch(nr){case"Add Node":LGraphCanvas.onMenuAdd(null,null,or,sr,function(ur){!ur.inputs||!ur.inputs.length||!ur.outputs||!ur.outputs.length||Ae.connectByType(s.origin_slot,ur,tr)&&(ur.connectByType(s.target_slot,Ne,er),ur.pos[0]-=ur.size[0]*.5)});break;case"Delete":n.graph.removeLink(s.id);break}}return!1},LGraphCanvas.prototype.createDefaultNodeForSlot=function(t){var t=t||{},n=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},t),Ae=this,Ne=n.nodeFrom&&n.slotFrom!==null,tr=!Ne&&n.nodeTo&&n.slotTo!==null;if(!Ne&&!tr)return console.warn("No data passed to createDefaultNodeForSlot "+n.nodeFrom+" "+n.slotFrom+" "+n.nodeTo+" "+n.slotTo),!1;if(!n.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;var er=Ne?n.nodeFrom:n.nodeTo,ir=Ne?n.slotFrom:n.slotTo,sr=!1;switch(typeof ir){case"string":sr=Ne?er.findOutputSlot(ir,!1):er.findInputSlot(ir,!1),ir=Ne?er.outputs[ir]:er.inputs[ir];break;case"object":sr=Ne?er.findOutputSlot(ir.name):er.findInputSlot(ir.name);break;case"number":sr=ir,ir=Ne?er.outputs[ir]:er.inputs[ir];break;case"undefined":default:return console.warn("Cant get slot information "+ir),!1}(ir===!1||sr===!1)&&console.warn("createDefaultNodeForSlot bad slotX "+ir+" "+sr);var rr=ir.type==LiteGraph.EVENT?"_event_":ir.type,nr=Ne?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(nr&&nr[rr]){if(ir.link,nodeNewType=!1,typeof nr[rr]=="object"||typeof nr[rr]=="array"){for(var ar in nr[rr])if(n.nodeType==nr[rr][ar]||n.nodeType=="AUTO"){nodeNewType=nr[rr][ar];break}}else(n.nodeType==nr[rr]||n.nodeType=="AUTO")&&(nodeNewType=nr[rr]);if(nodeNewType){var or=!1;typeof nodeNewType=="object"&&nodeNewType.node&&(or=nodeNewType,nodeNewType=nodeNewType.node);var ur=LiteGraph.createNode(nodeNewType);if(ur){if(or){if(or.properties)for(var hr in or.properties)ur.addProperty(hr,or.properties[hr]);if(or.inputs){ur.inputs=[];for(var hr in or.inputs)ur.addOutput(or.inputs[hr][0],or.inputs[hr][1])}if(or.outputs){ur.outputs=[];for(var hr in or.outputs)ur.addOutput(or.outputs[hr][0],or.outputs[hr][1])}or.title&&(ur.title=or.title),or.json&&ur.configure(or.json)}return Ae.graph.add(ur),ur.pos=[n.position[0]+n.posAdd[0]+(n.posSizeFix[0]?n.posSizeFix[0]*ur.size[0]:0),n.position[1]+n.posAdd[1]+(n.posSizeFix[1]?n.posSizeFix[1]*ur.size[1]:0)],Ne?n.nodeFrom.connectByType(sr,ur,rr):n.nodeTo.connectByTypeOutput(sr,ur,rr),!0}else console.log("failed creating "+nodeNewType)}}return!1},LGraphCanvas.prototype.showConnectionMenu=function(t){var t=t||{},n=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},t),Ae=this,Ne=n.nodeFrom&&n.slotFrom,tr=!Ne&&n.nodeTo&&n.slotTo;if(!Ne&&!tr)return console.warn("No data passed to showConnectionMenu"),!1;var er=Ne?n.nodeFrom:n.nodeTo,ir=Ne?n.slotFrom:n.slotTo,sr=!1;switch(typeof ir){case"string":sr=Ne?er.findOutputSlot(ir,!1):er.findInputSlot(ir,!1),ir=Ne?er.outputs[ir]:er.inputs[ir];break;case"object":sr=Ne?er.findOutputSlot(ir.name):er.findInputSlot(ir.name);break;case"number":sr=ir,ir=Ne?er.outputs[ir]:er.inputs[ir];break;default:return console.warn("Cant get slot information "+ir),!1}var rr=["Add Node",null];Ae.allow_searchbox&&(rr.push("Search"),rr.push(null));var nr=ir.type==LiteGraph.EVENT?"_event_":ir.type,ar=Ne?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(ar&&ar[nr])if(typeof ar[nr]=="object"||typeof ar[nr]=="array")for(var or in ar[nr])rr.push(ar[nr][or]);else rr.push(ar[nr]);var ur=new LiteGraph.ContextMenu(rr,{event:n.e,title:(ir&&ir.name!=""?ir.name+(nr?" | ":""):"")+(ir&&nr?nr:""),callback:hr});function hr(cr,vr,mr){switch(cr){case"Add Node":LGraphCanvas.onMenuAdd(null,null,mr,ur,function(dr){Ne?n.nodeFrom.connectByType(sr,dr,nr):n.nodeTo.connectByTypeOutput(sr,dr,nr)});break;case"Search":Ne?Ae.showSearchBox(mr,{node_from:n.nodeFrom,slot_from:ir,type_filter_in:nr}):Ae.showSearchBox(mr,{node_to:n.nodeTo,slot_from:ir,type_filter_out:nr});break;default:Ae.createDefaultNodeForSlot(Object.assign(n,{position:[n.e.canvasX,n.e.canvasY],nodeType:cr}));break}}return!1},LGraphCanvas.onShowPropertyEditor=function(s,t,n,Ae,Ne){var tr=s.property||"title",er=Ne[tr],ir=document.createElement("div");ir.is_modified=!1,ir.className="graphdialog",ir.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",ir.close=function(){ir.parentNode&&ir.parentNode.removeChild(ir)};var sr=ir.querySelector(".name");sr.innerText=tr;var rr=ir.querySelector(".value");rr&&(rr.value=er,rr.addEventListener("blur",function(lr){this.focus()}),rr.addEventListener("keydown",function(lr){if(ir.is_modified=!0,lr.keyCode==27)ir.close();else if(lr.keyCode==13)mr();else if(lr.keyCode!=13&&lr.target.localName!="textarea")return;lr.preventDefault(),lr.stopPropagation()}));var nr=LGraphCanvas.active_canvas,ar=nr.canvas,or=ar.getBoundingClientRect(),ur=-20,hr=-20;or&&(ur-=or.left,hr-=or.top),event?(ir.style.left=event.clientX+ur+"px",ir.style.top=event.clientY+hr+"px"):(ir.style.left=ar.width*.5+ur+"px",ir.style.top=ar.height*.5+hr+"px");var cr=ir.querySelector("button");cr.addEventListener("click",mr),ar.parentNode.appendChild(ir),rr&&rr.focus();var vr=null;ir.addEventListener("mouseleave",function(lr){LiteGraph.dialog_close_on_mouse_leave&&!ir.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(vr=setTimeout(ir.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),ir.addEventListener("mouseenter",function(lr){LiteGraph.dialog_close_on_mouse_leave&&vr&&clearTimeout(vr)});function mr(){rr&&dr(rr.value)}function dr(lr){s.type=="Number"?lr=Number(lr):s.type=="Boolean"&&(lr=!!lr),Ne[tr]=lr,ir.parentNode&&ir.parentNode.removeChild(ir),Ne.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.prompt=function(s,t,n,Ae,Ne){var tr=this;s=s||"";var er=document.createElement("div");er.is_modified=!1,er.className="graphdialog rounded",Ne?er.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":er.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",er.close=function(){tr.prompt_box=null,er.parentNode&&er.parentNode.removeChild(er)};var ir=LGraphCanvas.active_canvas,sr=ir.canvas;sr.parentNode.appendChild(er),this.ds.scale>1&&(er.style.transform="scale("+this.ds.scale+")");var rr=null,nr=!1;LiteGraph.pointerListenerAdd(er,"leave",function(lr){nr||LiteGraph.dialog_close_on_mouse_leave&&!er.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(rr=setTimeout(er.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(er,"enter",function(lr){LiteGraph.dialog_close_on_mouse_leave&&rr&&clearTimeout(rr)});var ar=er.querySelectorAll("select");ar&&ar.forEach(function(lr){lr.addEventListener("click",function(gr){nr++}),lr.addEventListener("blur",function(gr){nr=0}),lr.addEventListener("change",function(gr){nr=-1})}),tr.prompt_box&&tr.prompt_box.close(),tr.prompt_box=er;var or=er.querySelector(".name");or.innerText=s;var ur=er.querySelector(".value");ur.value=t;var hr=ur;hr.addEventListener("keydown",function(lr){if(er.is_modified=!0,lr.keyCode==27)er.close();else if(lr.keyCode==13&&lr.target.localName!="textarea")n&&n(this.value),er.close();else return;lr.preventDefault(),lr.stopPropagation()});var cr=er.querySelector("button");cr.addEventListener("click",function(lr){n&&n(hr.value),tr.setDirty(!0),er.close()});var vr=sr.getBoundingClientRect(),mr=-20,dr=-20;return vr&&(mr-=vr.left,dr-=vr.top),Ae?(er.style.left=Ae.clientX+mr+"px",er.style.top=Ae.clientY+dr+"px"):(er.style.left=sr.width*.5+mr+"px",er.style.top=sr.height*.5+dr+"px"),setTimeout(function(){hr.focus()},10),er},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(s,t){var n={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};t=Object.assign(n,t||{});var Ae=this,Ne=LGraphCanvas.active_canvas,tr=Ne.canvas,er=tr.ownerDocument||document,ir=document.createElement("div");if(ir.className="litegraph litesearchbox graphdialog rounded",ir.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",t.do_type_filter&&(ir.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",ir.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),ir.innerHTML+="<div class='helper'></div>",er.fullscreenElement?er.fullscreenElement.appendChild(ir):(er.body.appendChild(ir),er.body.style.overflow="hidden"),t.do_type_filter)var sr=ir.querySelector(".slot_in_type_filter"),rr=ir.querySelector(".slot_out_type_filter");if(ir.close=function(){Ae.search_box=null,this.blur(),tr.focus(),er.body.style.overflow="",setTimeout(function(){Ae.canvas.focus()},20),ir.parentNode&&ir.parentNode.removeChild(ir)},this.ds.scale>1&&(ir.style.transform="scale("+this.ds.scale+")"),t.hide_on_mouse_leave){var nr=!1,ar=null;LiteGraph.pointerListenerAdd(ir,"enter",function(zr){ar&&(clearTimeout(ar),ar=null)}),LiteGraph.pointerListenerAdd(ir,"leave",function(zr){nr||(ar=setTimeout(function(){ir.close()},500))}),t.do_type_filter&&(sr.addEventListener("click",function(zr){nr++}),sr.addEventListener("blur",function(zr){nr=0}),sr.addEventListener("change",function(zr){nr=-1}),rr.addEventListener("click",function(zr){nr++}),rr.addEventListener("blur",function(zr){nr=0}),rr.addEventListener("change",function(zr){nr=-1}))}Ae.search_box&&Ae.search_box.close(),Ae.search_box=ir;var or=ir.querySelector(".helper"),ur=null,hr=null,cr=null,vr=ir.querySelector("input");if(vr&&(vr.addEventListener("blur",function(zr){Ae.search_box&&this.focus()}),vr.addEventListener("keydown",function(zr){if(zr.keyCode==38)Dr(!1);else if(zr.keyCode==40)Dr(!0);else if(zr.keyCode==27)ir.close();else if(zr.keyCode==13)kr(),cr?wr(cr.innerHTML):ur?wr(ur):ir.close();else{hr&&clearInterval(hr),hr=setTimeout(kr,250);return}return zr.preventDefault(),zr.stopPropagation(),zr.stopImmediatePropagation(),!0})),t.do_type_filter){if(sr){var mr=LiteGraph.slot_types_in,dr=mr.length;(t.type_filter_in==LiteGraph.EVENT||t.type_filter_in==LiteGraph.ACTION)&&(t.type_filter_in="_event_");for(var lr=0;lr<dr;lr++){var gr=document.createElement("option");gr.value=mr[lr],gr.innerHTML=mr[lr],sr.appendChild(gr),t.type_filter_in!==!1&&(t.type_filter_in+"").toLowerCase()==(mr[lr]+"").toLowerCase()&&(gr.selected=!0)}sr.addEventListener("change",function(){kr()})}if(rr){var mr=LiteGraph.slot_types_out,dr=mr.length;(t.type_filter_out==LiteGraph.EVENT||t.type_filter_out==LiteGraph.ACTION)&&(t.type_filter_out="_event_");for(var lr=0;lr<dr;lr++){var gr=document.createElement("option");gr.value=mr[lr],gr.innerHTML=mr[lr],rr.appendChild(gr),t.type_filter_out!==!1&&(t.type_filter_out+"").toLowerCase()==(mr[lr]+"").toLowerCase()&&(gr.selected=!0)}rr.addEventListener("change",function(){kr()})}}var fr=tr.getBoundingClientRect(),yr=(s?s.clientX:fr.left+fr.width*.5)-80,Er=(s?s.clientY:fr.top+fr.height*.5)-20;ir.style.left=yr+"px",ir.style.top=Er+"px",s.layerY>fr.height-200&&(or.style.maxHeight=fr.height-s.layerY-20+"px"),vr.focus(),t.show_all_on_open&&kr();function wr(zr){if(zr)if(Ae.onSearchBoxSelection)Ae.onSearchBoxSelection(zr,s,Ne);else{var Vr=LiteGraph.searchbox_extras[zr.toLowerCase()];Vr&&(zr=Vr.type),Ne.graph.beforeChange();var Hr=LiteGraph.createNode(zr);if(Hr&&(Hr.pos=Ne.convertEventToCanvasOffset(s),Ne.graph.add(Hr,!1)),Vr&&Vr.data){if(Vr.data.properties)for(var Sr in Vr.data.properties)Hr.addProperty(Sr,Vr.data.properties[Sr]);if(Vr.data.inputs){Hr.inputs=[];for(var Sr in Vr.data.inputs)Hr.addOutput(Vr.data.inputs[Sr][0],Vr.data.inputs[Sr][1])}if(Vr.data.outputs){Hr.outputs=[];for(var Sr in Vr.data.outputs)Hr.addOutput(Vr.data.outputs[Sr][0],Vr.data.outputs[Sr][1])}Vr.data.title&&(Hr.title=Vr.data.title),Vr.data.json&&Hr.configure(Vr.data.json)}if(t.node_from){var Ar=!1;switch(typeof t.slot_from){case"string":Ar=t.node_from.findOutputSlot(t.slot_from);break;case"object":t.slot_from.name?Ar=t.node_from.findOutputSlot(t.slot_from.name):Ar=-1,Ar==-1&&typeof t.slot_from.slot_index<"u"&&(Ar=t.slot_from.slot_index);break;case"number":Ar=t.slot_from;break;default:Ar=0}typeof t.node_from.outputs[Ar]<"u"&&Ar!==!1&&Ar>-1&&t.node_from.connectByType(Ar,Hr,t.node_from.outputs[Ar].type)}if(t.node_to){var Ar=!1;switch(typeof t.slot_from){case"string":Ar=t.node_to.findInputSlot(t.slot_from);break;case"object":t.slot_from.name?Ar=t.node_to.findInputSlot(t.slot_from.name):Ar=-1,Ar==-1&&typeof t.slot_from.slot_index<"u"&&(Ar=t.slot_from.slot_index);break;case"number":Ar=t.slot_from;break;default:Ar=0}typeof t.node_to.inputs[Ar]<"u"&&Ar!==!1&&Ar>-1&&t.node_to.connectByTypeOutput(Ar,Hr,t.node_to.inputs[Ar].type)}Ne.graph.afterChange()}ir.close()}function Dr(zr){var Vr=cr;cr&&cr.classList.remove("selected"),cr?(cr=zr?cr.nextSibling:cr.previousSibling,cr||(cr=Vr)):cr=zr?or.childNodes[0]:or.childNodes[or.childNodes.length],cr&&(cr.classList.add("selected"),cr.scrollIntoView({block:"end",behavior:"smooth"}))}function kr(){hr=null;var zr=vr.value;if(ur=null,or.innerHTML="",!zr&&!t.show_all_if_empty)return;if(Ae.onSearchBox){var Vr=Ae.onSearchBox(or,zr,Ne);if(Vr)for(var Hr=0;Hr<Vr.length;++Hr)Br(Vr[Hr])}else{let jr=function(Yr,Qr){var Qr=Qr||{},pr={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},br=Object.assign(pr,Qr),Cr=LiteGraph.registered_node_types[Yr];if(Ar&&Cr.filter!=Ar||(!t.show_all_if_empty||zr)&&Yr.toLowerCase().indexOf(zr)===-1)return!1;if(t.do_type_filter&&!br.skipFilter){var Rr=Yr,Fr=_r.value;if(br.inTypeOverride!==!1&&(Fr=br.inTypeOverride),_r&&Fr&&LiteGraph.registered_slot_in_types[Fr]&&LiteGraph.registered_slot_in_types[Fr].nodes){var Mr=LiteGraph.registered_slot_in_types[Fr].nodes.includes(Rr);if(Mr===!1)return!1}var Fr=Nr.value;if(br.outTypeOverride!==!1&&(Fr=br.outTypeOverride),Nr&&Fr&&LiteGraph.registered_slot_out_types[Fr]&&LiteGraph.registered_slot_out_types[Fr].nodes){var Mr=LiteGraph.registered_slot_out_types[Fr].nodes.includes(Rr);if(Mr===!1)return!1}}return!0};var Sr=0;zr=zr.toLowerCase();var Ar=Ne.filter||Ne.graph.filter;if(t.do_type_filter&&Ae.search_box)var _r=Ae.search_box.querySelector(".slot_in_type_filter"),Nr=Ae.search_box.querySelector(".slot_out_type_filter");else var _r=!1,Nr=!1;for(var Hr in LiteGraph.searchbox_extras){var Tr=LiteGraph.searchbox_extras[Hr];if(!((!t.show_all_if_empty||zr)&&Tr.desc.toLowerCase().indexOf(zr)===-1)){var Lr=LiteGraph.registered_node_types[Tr.type];if(!(Lr&&Lr.filter!=Ar)&&jr(Tr.type)&&(Br(Tr.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&Sr++>LGraphCanvas.search_limit))break}}var Ir=null;if(Array.prototype.filter)var Gr=Object.keys(LiteGraph.registered_node_types),Ir=Gr.filter(jr);else{Ir=[];for(var Hr in LiteGraph.registered_node_types)jr(Hr)&&Ir.push(Hr)}for(var Hr=0;Hr<Ir.length&&(Br(Ir[Hr]),!(LGraphCanvas.search_limit!==-1&&Sr++>LGraphCanvas.search_limit));Hr++);if(t.show_general_after_typefiltered&&(_r.value||Nr.value)){filtered_extra=[];for(var Hr in LiteGraph.registered_node_types)jr(Hr,{inTypeOverride:_r&&_r.value?"*":!1,outTypeOverride:Nr&&Nr.value?"*":!1})&&filtered_extra.push(Hr);for(var Hr=0;Hr<filtered_extra.length&&(Br(filtered_extra[Hr],"generic_type"),!(LGraphCanvas.search_limit!==-1&&Sr++>LGraphCanvas.search_limit));Hr++);}if((_r.value||Nr.value)&&or.childNodes.length==0&&t.show_general_if_none_on_typefilter){filtered_extra=[];for(var Hr in LiteGraph.registered_node_types)jr(Hr,{skipFilter:!0})&&filtered_extra.push(Hr);for(var Hr=0;Hr<filtered_extra.length&&(Br(filtered_extra[Hr],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&Sr++>LGraphCanvas.search_limit));Hr++);}}function Br(jr,Yr){var to=document.createElement("div");ur||(ur=jr),to.innerText=jr,to.dataset.type=escape(jr),to.className="litegraph lite-search-item",Yr&&(to.className+=" "+Yr),to.addEventListener("click",function(Qr){wr(unescape(this.dataset.type))}),or.appendChild(to)}}return ir},LGraphCanvas.prototype.showEditPropertyValue=function(s,t,n){if(!s||s.properties[t]===void 0)return;n=n||{};var Ae=s.getPropertyInfo(t),Ne=Ae.type,tr="";if(Ne=="string"||Ne=="number"||Ne=="array"||Ne=="object")tr="<input autofocus type='text' class='value'/>";else if((Ne=="enum"||Ne=="combo")&&Ae.values){tr="<select autofocus type='text' class='value'>";for(var er in Ae.values){var ir=er;Ae.values.constructor===Array&&(ir=Ae.values[er]),tr+="<option value='"+ir+"' "+(ir==s.properties[t]?"selected":"")+">"+Ae.values[er]+"</option>"}tr+="</select>"}else if(Ne=="boolean"||Ne=="toggle")tr="<input autofocus type='checkbox' class='value' "+(s.properties[t]?"checked":"")+"/>";else{console.warn("unknown type: "+Ne);return}var sr=this.createDialog("<span class='name'>"+(Ae.label?Ae.label:t)+"</span>"+tr+"<button>OK</button>",n),rr=!1;if((Ne=="enum"||Ne=="combo")&&Ae.values)rr=sr.querySelector("select"),rr.addEventListener("change",function(ur){sr.modified(),or(ur.target.value)});else if(Ne=="boolean"||Ne=="toggle")rr=sr.querySelector("input"),rr&&rr.addEventListener("click",function(ur){sr.modified(),or(!!rr.checked)});else if(rr=sr.querySelector("input"),rr){rr.addEventListener("blur",function(hr){this.focus()});var ir=s.properties[t]!==void 0?s.properties[t]:"";Ne!=="string"&&(ir=JSON.stringify(ir)),rr.value=ir,rr.addEventListener("keydown",function(hr){if(hr.keyCode==27)sr.close();else if(hr.keyCode==13)ar();else if(hr.keyCode!=13){sr.modified();return}hr.preventDefault(),hr.stopPropagation()})}rr&&rr.focus();var nr=sr.querySelector("button");nr.addEventListener("click",ar);function ar(){or(rr.value)}function or(ur){Ae&&Ae.values&&Ae.values.constructor===Object&&Ae.values[ur]!=null&&(ur=Ae.values[ur]),typeof s.properties[t]=="number"&&(ur=Number(ur)),(Ne=="array"||Ne=="object")&&(ur=JSON.parse(ur)),s.properties[t]=ur,s.graph&&s.graph._version++,s.onPropertyChanged&&s.onPropertyChanged(t,ur),n.onclose&&n.onclose(),sr.close(),s.setDirtyCanvas(!0,!0)}return sr},LGraphCanvas.prototype.createDialog=function(s,t){var n={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};t=Object.assign(n,t||{});var Ae=document.createElement("div");Ae.className="graphdialog",Ae.innerHTML=s,Ae.is_modified=!1;var Ne=this.canvas.getBoundingClientRect(),tr=-20,er=-20;if(Ne&&(tr-=Ne.left,er-=Ne.top),t.position?(tr+=t.position[0],er+=t.position[1]):t.event?(tr+=t.event.clientX,er+=t.event.clientY):(tr+=this.canvas.width*.5,er+=this.canvas.height*.5),Ae.style.left=tr+"px",Ae.style.top=er+"px",this.canvas.parentNode.appendChild(Ae),t.checkForInput){var ir=[],sr=!1;(ir=Ae.querySelectorAll("input"))&&ir.forEach(function(or){or.addEventListener("keydown",function(ur){if(Ae.modified(),ur.keyCode==27)Ae.close();else if(ur.keyCode!=13)return;ur.preventDefault(),ur.stopPropagation()}),sr||or.focus()})}Ae.modified=function(){Ae.is_modified=!0},Ae.close=function(){Ae.parentNode&&Ae.parentNode.removeChild(Ae)};var rr=null,nr=!1;Ae.addEventListener("mouseleave",function(or){nr||(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!Ae.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(rr=setTimeout(Ae.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),Ae.addEventListener("mouseenter",function(or){(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&rr&&clearTimeout(rr)});var ar=Ae.querySelectorAll("select");return ar&&ar.forEach(function(or){or.addEventListener("click",function(ur){nr++}),or.addEventListener("blur",function(ur){nr=0}),or.addEventListener("change",function(ur){nr=-1})}),Ae},LGraphCanvas.prototype.createPanel=function(s,t){t=t||{};var n=t.window||window,Ae=document.createElement("div");if(Ae.className="litegraph dialog",Ae.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",Ae.header=Ae.querySelector(".dialog-header"),t.width&&(Ae.style.width=t.width+(t.width.constructor===Number?"px":"")),t.height&&(Ae.style.height=t.height+(t.height.constructor===Number?"px":"")),t.closable){var Ne=document.createElement("span");Ne.innerHTML="&#10005;",Ne.classList.add("close"),Ne.addEventListener("click",function(){Ae.close()}),Ae.header.appendChild(Ne)}return Ae.title_element=Ae.querySelector(".dialog-title"),Ae.title_element.innerText=s,Ae.content=Ae.querySelector(".dialog-content"),Ae.alt_content=Ae.querySelector(".dialog-alt-content"),Ae.footer=Ae.querySelector(".dialog-footer"),Ae.close=function(){Ae.onClose&&typeof Ae.onClose=="function"&&Ae.onClose(),Ae.parentNode&&Ae.parentNode.removeChild(Ae),this.parentNode&&this.parentNode.removeChild(this)},Ae.toggleAltContent=function(tr){if(typeof tr<"u")var er=tr?"block":"none",ir=tr?"none":"block";else var er=Ae.alt_content.style.display!="block"?"block":"none",ir=Ae.alt_content.style.display!="block"?"none":"block";Ae.alt_content.style.display=er,Ae.content.style.display=ir},Ae.toggleFooterVisibility=function(tr){if(typeof tr<"u")var er=tr?"block":"none";else var er=Ae.footer.style.display!="block"?"block":"none";Ae.footer.style.display=er},Ae.clear=function(){this.content.innerHTML=""},Ae.addHTML=function(tr,er,ir){var sr=document.createElement("div");return er&&(sr.className=er),sr.innerHTML=tr,ir?Ae.footer.appendChild(sr):Ae.content.appendChild(sr),sr},Ae.addButton=function(tr,er,ir){var sr=document.createElement("button");return sr.innerText=tr,sr.options=ir,sr.classList.add("btn"),sr.addEventListener("click",er),Ae.footer.appendChild(sr),sr},Ae.addSeparator=function(){var tr=document.createElement("div");tr.className="separator",Ae.content.appendChild(tr)},Ae.addWidget=function(tr,er,ir,sr,rr){sr=sr||{};var nr=String(ir);tr=tr.toLowerCase(),tr=="number"&&(nr=ir.toFixed(3));var ar=document.createElement("div");ar.className="property",ar.innerHTML="<span class='property_name'></span><span class='property_value'></span>",ar.querySelector(".property_name").innerText=sr.label||er;var or=ar.querySelector(".property_value");if(or.innerText=nr,ar.dataset.property=er,ar.dataset.type=sr.type||tr,ar.options=sr,ar.value=ir,tr=="code")ar.addEventListener("click",function(hr){Ae.inner_showCodePad(this.dataset.property)});else if(tr=="boolean")ar.classList.add("boolean"),ir&&ar.classList.add("bool-on"),ar.addEventListener("click",function(){var hr=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",ur(hr,this.value)});else if(tr=="string"||tr=="number")or.setAttribute("contenteditable",!0),or.addEventListener("keydown",function(hr){hr.code=="Enter"&&(tr!="string"||!hr.shiftKey)&&(hr.preventDefault(),this.blur())}),or.addEventListener("blur",function(){var hr=this.innerText,cr=this.parentNode.dataset.property,vr=this.parentNode.dataset.type;vr=="number"&&(hr=Number(hr)),ur(cr,hr)});else if(tr=="enum"||tr=="combo"){var nr=LGraphCanvas.getPropertyPrintableValue(ir,sr.values);or.innerText=nr,or.addEventListener("click",function(cr){var vr=sr.values||[],mr=this.parentNode.dataset.property,dr=this;new LiteGraph.ContextMenu(vr,{event:cr,className:"dark",callback:lr},n);function lr(gr,fr,yr){return dr.innerText=gr,ur(mr,gr),!1}})}Ae.content.appendChild(ar);function ur(hr,cr){sr.callback&&sr.callback(hr,cr,sr),rr&&rr(hr,cr,sr)}return ar},Ae.onOpen&&typeof Ae.onOpen=="function"&&Ae.onOpen(),Ae},LGraphCanvas.getPropertyPrintableValue=function(s,t){if(!t||t.constructor===Array)return String(s);if(t.constructor===Object){var n="";for(var Ae in t)if(t[Ae]==s){n=Ae;break}return String(s)+" ("+n+")"}},LGraphCanvas.prototype.closePanels=function(){var s=document.querySelector("#node-panel");s&&s.close();var s=document.querySelector("#option-panel");s&&s.close()},LGraphCanvas.prototype.showShowGraphOptionsPanel=function(s,t,n,Ae){if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!t||!t.event||!t.event.target||!t.event.target.lgraphcanvas){console.warn("Canvas not found");return}var Ne=t.event.target.lgraphcanvas}else var Ne=this;Ne.closePanels();var tr=Ne.getCanvasWindow();panel=Ne.createPanel("Options",{closable:!0,window:tr,onOpen:function(){Ne.OPTIONPANEL_IS_OPEN=!0},onClose:function(){Ne.OPTIONPANEL_IS_OPEN=!1,Ne.options_panel=null}}),Ne.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function er(){panel.content.innerHTML="";var ir=function(ar,or,ur){switch(ar){default:ur&&ur.key&&(ar=ur.key),ur.values&&(or=Object.values(ur.values).indexOf(or)),Ne[ar]=or;break}},sr=LiteGraph.availableCanvasOptions;sr.sort();for(var rr in sr){var nr=sr[rr];panel.addWidget("boolean",nr,Ne[nr],{key:nr,on:"True",off:"False"},ir)}Ne.links_render_mode,panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[Ne.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},ir),panel.addSeparator(),panel.footer.innerHTML=""}er(),Ne.canvas.parentNode.appendChild(panel)},LGraphCanvas.prototype.showShowNodePanel=function(s){this.SELECTED_NODE=s,this.closePanels();var t=this.getCanvasWindow(),n=this,Ae=this.createPanel(s.title||"",{closable:!0,window:t,onOpen:function(){n.NODEPANEL_IS_OPEN=!0},onClose:function(){n.NODEPANEL_IS_OPEN=!1,n.node_panel=null}});n.node_panel=Ae,Ae.id="node-panel",Ae.node=s,Ae.classList.add("settings");function Ne(){Ae.content.innerHTML="",Ae.addHTML("<span class='node_type'>"+s.type+"</span><span class='node_desc'>"+(s.constructor.desc||"")+"</span><span class='separator'></span>"),Ae.addHTML("<h3>Properties</h3>");var tr=function(nr,ar){switch(n.graph.beforeChange(s),nr){case"Title":s.title=ar;break;case"Mode":var or=Object.values(LiteGraph.NODE_MODES).indexOf(ar);or>=0&&LiteGraph.NODE_MODES[or]?s.changeMode(or):console.warn("unexpected mode: "+ar);break;case"Color":LGraphCanvas.node_colors[ar]?(s.color=LGraphCanvas.node_colors[ar].color,s.bgcolor=LGraphCanvas.node_colors[ar].bgcolor):console.warn("unexpected color: "+ar);break;default:s.setProperty(nr,ar);break}n.graph.afterChange(),n.dirty_canvas=!0};Ae.addWidget("string","Title",s.title,{},tr),Ae.addWidget("combo","Mode",LiteGraph.NODE_MODES[s.mode],{values:LiteGraph.NODE_MODES},tr);var er="";s.color!==void 0&&(er=Object.keys(LGraphCanvas.node_colors).filter(function(nr){return LGraphCanvas.node_colors[nr].color==s.color})),Ae.addWidget("combo","Color",er,{values:Object.keys(LGraphCanvas.node_colors)},tr);for(var ir in s.properties){var sr=s.properties[ir],rr=s.getPropertyInfo(ir);rr.type,!(s.onAddPropertyToPanel&&s.onAddPropertyToPanel(ir,Ae))&&Ae.addWidget(rr.widget||rr.type,ir,sr,rr,tr)}Ae.addSeparator(),s.onShowCustomPanelInfo&&s.onShowCustomPanelInfo(Ae),Ae.footer.innerHTML="",Ae.addButton("Delete",function(){s.block_delete||(s.graph.remove(s),Ae.close())}).classList.add("delete")}Ae.inner_showCodePad=function(tr){Ae.classList.remove("settings"),Ae.classList.add("centered"),Ae.alt_content.innerHTML="<textarea class='code'></textarea>";var er=Ae.alt_content.querySelector("textarea"),ir=function(){Ae.toggleAltContent(!1),Ae.toggleFooterVisibility(!0),er.parentNode.removeChild(er),Ae.classList.add("settings"),Ae.classList.remove("centered"),Ne()};er.value=s.properties[tr],er.addEventListener("keydown",function(nr){nr.code=="Enter"&&nr.ctrlKey&&(s.setProperty(tr,er.value),ir())}),Ae.toggleAltContent(!0),Ae.toggleFooterVisibility(!1),er.style.height="calc(100% - 40px)";var sr=Ae.addButton("Assign",function(){s.setProperty(tr,er.value),ir()});Ae.alt_content.appendChild(sr);var rr=Ae.addButton("Close",ir);rr.style.float="right",Ae.alt_content.appendChild(rr)},Ne(),this.canvas.parentNode.appendChild(Ae)},LGraphCanvas.prototype.showSubgraphPropertiesDialog=function(s){console.log("showing subgraph properties dialog");var t=this.canvas.parentNode.querySelector(".subgraph_dialog");t&&t.close();var n=this.createPanel("Subgraph Inputs",{closable:!0,width:500});n.node=s,n.classList.add("subgraph_dialog");function Ae(){if(n.clear(),s.inputs)for(var er=0;er<s.inputs.length;++er){var ir=s.inputs[er];if(!ir.not_subgraph_input){var sr="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",rr=n.addHTML(sr,"subgraph_property");rr.dataset.name=ir.name,rr.dataset.slot=er,rr.querySelector(".name").innerText=ir.name,rr.querySelector(".type").innerText=ir.type,rr.querySelector("button").addEventListener("click",function(nr){s.removeInput(Number(this.parentNode.dataset.slot)),Ae()})}}}var Ne=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",tr=n.addHTML(Ne,"subgraph_property extra",!0);return tr.querySelector("button").addEventListener("click",function(er){var ir=this.parentNode,sr=ir.querySelector(".name").value,rr=ir.querySelector(".type").value;!sr||s.findInputSlot(sr)!=-1||(s.addInput(sr,rr),ir.querySelector(".name").value="",ir.querySelector(".type").value="",Ae())}),Ae(),this.canvas.parentNode.appendChild(n),n},LGraphCanvas.prototype.showSubgraphPropertiesDialogRight=function(s){var t=this.canvas.parentNode.querySelector(".subgraph_dialog");t&&t.close();var n=this.createPanel("Subgraph Outputs",{closable:!0,width:500});n.node=s,n.classList.add("subgraph_dialog");function Ae(){if(n.clear(),s.outputs)for(var ir=0;ir<s.outputs.length;++ir){var sr=s.outputs[ir];if(!sr.not_subgraph_output){var rr="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",nr=n.addHTML(rr,"subgraph_property");nr.dataset.name=sr.name,nr.dataset.slot=ir,nr.querySelector(".name").innerText=sr.name,nr.querySelector(".type").innerText=sr.type,nr.querySelector("button").addEventListener("click",function(ar){s.removeOutput(Number(this.parentNode.dataset.slot)),Ae()})}}}var Ne=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",tr=n.addHTML(Ne,"subgraph_property extra",!0);tr.querySelector(".name").addEventListener("keydown",function(ir){ir.keyCode==13&&er.apply(this)}),tr.querySelector("button").addEventListener("click",function(ir){er.apply(this)});function er(){var ir=this.parentNode,sr=ir.querySelector(".name").value,rr=ir.querySelector(".type").value;!sr||s.findOutputSlot(sr)!=-1||(s.addOutput(sr,rr),ir.querySelector(".name").value="",ir.querySelector(".type").value="",Ae())}return Ae(),this.canvas.parentNode.appendChild(n),n},LGraphCanvas.prototype.checkPanels=function(){if(this.canvas)for(var s=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),t=0;t<s.length;++t){var n=s[t];n.node&&(!n.node.graph||n.graph!=this.graph)&&n.close()}},LGraphCanvas.onMenuNodeCollapse=function(s,t,n,Ae,Ne){Ne.graph.beforeChange();var tr=function(sr){sr.collapse()},er=LGraphCanvas.active_canvas;if(!er.selected_nodes||Object.keys(er.selected_nodes).length<=1)tr(Ne);else for(var ir in er.selected_nodes)tr(er.selected_nodes[ir]);Ne.graph.afterChange()},LGraphCanvas.onMenuNodePin=function(s,t,n,Ae,Ne){Ne.pin()},LGraphCanvas.onMenuNodeMode=function(s,t,n,Ae,Ne){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:n,callback:tr,parentMenu:Ae,node:Ne});function tr(er){if(Ne){var ir=Object.values(LiteGraph.NODE_MODES).indexOf(er),sr=function(ar){ir>=0&&LiteGraph.NODE_MODES[ir]?ar.changeMode(ir):(console.warn("unexpected mode: "+er),ar.changeMode(LiteGraph.ALWAYS))},rr=LGraphCanvas.active_canvas;if(!rr.selected_nodes||Object.keys(rr.selected_nodes).length<=1)sr(Ne);else for(var nr in rr.selected_nodes)sr(rr.selected_nodes[nr])}}return!1},LGraphCanvas.onMenuNodeColors=function(s,t,n,Ae,Ne){if(!Ne)throw"no node for color";var tr=[];tr.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(var er in LGraphCanvas.node_colors){var ir=LGraphCanvas.node_colors[er],s={value:er,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+ir.color+"; background-color:"+ir.bgcolor+"'>"+er+"</span>"};tr.push(s)}new LiteGraph.ContextMenu(tr,{event:n,callback:sr,parentMenu:Ae,node:Ne});function sr(rr){if(Ne){var nr=rr.value?LGraphCanvas.node_colors[rr.value]:null,ar=function(hr){nr?hr.constructor===LiteGraph.LGraphGroup?hr.color=nr.groupcolor:(hr.color=nr.color,hr.bgcolor=nr.bgcolor):(delete hr.color,delete hr.bgcolor)},or=LGraphCanvas.active_canvas;if(!or.selected_nodes||Object.keys(or.selected_nodes).length<=1)ar(Ne);else for(var ur in or.selected_nodes)ar(or.selected_nodes[ur]);Ne.setDirtyCanvas(!0,!0)}}return!1},LGraphCanvas.onMenuNodeShapes=function(s,t,n,Ae,Ne){if(!Ne)throw"no node passed";new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:n,callback:tr,parentMenu:Ae,node:Ne});function tr(er){if(Ne){Ne.graph.beforeChange();var ir=function(nr){nr.shape=er},sr=LGraphCanvas.active_canvas;if(!sr.selected_nodes||Object.keys(sr.selected_nodes).length<=1)ir(Ne);else for(var rr in sr.selected_nodes)ir(sr.selected_nodes[rr]);Ne.graph.afterChange(),Ne.setDirtyCanvas(!0)}}return!1},LGraphCanvas.onMenuNodeRemove=function(s,t,n,Ae,Ne){if(!Ne)throw"no node passed";var tr=Ne.graph;tr.beforeChange();var er=function(rr){rr.removable!==!1&&tr.remove(rr)},ir=LGraphCanvas.active_canvas;if(!ir.selected_nodes||Object.keys(ir.selected_nodes).length<=1)er(Ne);else for(var sr in ir.selected_nodes)er(ir.selected_nodes[sr]);tr.afterChange(),Ne.setDirtyCanvas(!0,!0)},LGraphCanvas.onMenuNodeToSubgraph=function(s,t,n,Ae,Ne){var tr=Ne.graph,er=LGraphCanvas.active_canvas;if(er){var ir=Object.values(er.selected_nodes||{});ir.length||(ir=[Ne]);var sr=LiteGraph.createNode("graph/subgraph");sr.pos=Ne.pos.concat(),tr.add(sr),sr.buildFromNodes(ir),er.deselectAllNodes(),Ne.setDirtyCanvas(!0,!0)}},LGraphCanvas.onMenuNodeClone=function(s,t,n,Ae,Ne){Ne.graph.beforeChange();var tr={},er=function(rr){if(rr.clonable!==!1){var nr=rr.clone();nr&&(nr.pos=[rr.pos[0]+5,rr.pos[1]+5],rr.graph.add(nr),tr[nr.id]=nr)}},ir=LGraphCanvas.active_canvas;if(!ir.selected_nodes||Object.keys(ir.selected_nodes).length<=1)er(Ne);else for(var sr in ir.selected_nodes)er(ir.selected_nodes[sr]);Object.keys(tr).length&&ir.selectNodes(tr),Ne.graph.afterChange(),Ne.setDirtyCanvas(!0,!0)},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var s=null;if(this.getMenuOptions?s=this.getMenuOptions():(s=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&s.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&s.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var t=this.getExtraMenuOptions(this,s);t&&(s=s.concat(t))}return s},LGraphCanvas.prototype.getNodeMenuOptions=function(s){var t=null;if(s.getMenuOptions?t=s.getMenuOptions(this):(t=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],s.resizable!==!1&&t.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),t.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),s.onGetInputs){var n=s.onGetInputs();n&&n.length&&(t[0].disabled=!1)}if(s.onGetOutputs){var Ae=s.onGetOutputs();Ae&&Ae.length&&(t[1].disabled=!1)}if(s.getExtraMenuOptions){var Ne=s.getExtraMenuOptions(this,t);Ne&&(Ne.push(null),t=Ne.concat(t))}return s.clonable!==!1&&t.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&t.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),t.push(null,{content:"Remove",disabled:!(s.removable!==!1&&!s.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),s.graph&&s.graph.onGetNodeMenuOptions&&s.graph.onGetNodeMenuOptions(t,s),t},LGraphCanvas.prototype.getGroupMenuOptions=function(s){var t=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return t},LGraphCanvas.prototype.processContextMenu=function(s,t){var n=this,Ae=LGraphCanvas.active_canvas,Ne=Ae.getCanvasWindow(),tr=null,er={event:t,callback:nr,extra:s};s&&(er.title=s.type);var ir=null;if(s&&(ir=s.getSlotInPosition(t.canvasX,t.canvasY),LGraphCanvas.active_node=s),ir){if(tr=[],s.getSlotMenuOptions)tr=s.getSlotMenuOptions(ir);else{ir&&ir.output&&ir.output.links&&ir.output.links.length&&tr.push({content:"Disconnect Links",slot:ir});var sr=ir.input||ir.output;sr.removable&&tr.push(sr.locked?"Cannot remove":{content:"Remove Slot",slot:ir}),sr.nameLocked||tr.push({content:"Rename Slot",slot:ir})}er.title=(ir.input?ir.input.type:ir.output.type)||"*",ir.input&&ir.input.type==LiteGraph.ACTION&&(er.title="Action"),ir.output&&ir.output.type==LiteGraph.EVENT&&(er.title="Event")}else if(s)tr=this.getNodeMenuOptions(s);else{tr=this.getCanvasMenuOptions();var rr=this.graph.getGroupOnPos(t.canvasX,t.canvasY);rr&&tr.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:rr,options:this.getGroupMenuOptions(rr)}})}if(!tr)return;new LiteGraph.ContextMenu(tr,er,Ne);function nr(ar,or,ur){if(ar){if(ar.content=="Remove Slot"){var hr=ar.slot;s.graph.beforeChange(),hr.input?s.removeInput(hr.slot):hr.output&&s.removeOutput(hr.slot),s.graph.afterChange();return}else if(ar.content=="Disconnect Links"){var hr=ar.slot;s.graph.beforeChange(),hr.output?s.disconnectOutput(hr.slot):hr.input&&s.disconnectInput(hr.slot),s.graph.afterChange();return}else if(ar.content=="Rename Slot"){var hr=ar.slot,cr=hr.input?s.getInputInfo(hr.slot):s.getOutputInfo(hr.slot),vr=n.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",or),mr=vr.querySelector("input");mr&&cr&&(mr.value=cr.label||"");var dr=function(){s.graph.beforeChange(),mr.value&&(cr&&(cr.label=mr.value),n.setDirty(!0)),vr.close(),s.graph.afterChange()};vr.querySelector("button").addEventListener("click",dr),mr.addEventListener("keydown",function(gr){if(vr.is_modified=!0,gr.keyCode==27)vr.close();else if(gr.keyCode==13)dr();else if(gr.keyCode!=13&&gr.target.localName!="textarea")return;gr.preventDefault(),gr.stopPropagation()}),mr.focus()}}}};function compareObjects(s,t){for(var n in s)if(s[n]!=t[n])return!1;return!0}LiteGraph.compareObjects=compareObjects;function distance(s,t){return Math.sqrt((t[0]-s[0])*(t[0]-s[0])+(t[1]-s[1])*(t[1]-s[1]))}LiteGraph.distance=distance;function colorToString(s){return"rgba("+Math.round(s[0]*255).toFixed()+","+Math.round(s[1]*255).toFixed()+","+Math.round(s[2]*255).toFixed()+","+(s.length==4?s[3].toFixed(2):"1.0")+")"}LiteGraph.colorToString=colorToString;function isInsideRectangle(s,t,n,Ae,Ne,tr){return n<s&&n+Ne>s&&Ae<t&&Ae+tr>t}LiteGraph.isInsideRectangle=isInsideRectangle;function growBounding(s,t,n){t<s[0]?s[0]=t:t>s[2]&&(s[2]=t),n<s[1]?s[1]=n:n>s[3]&&(s[3]=n)}LiteGraph.growBounding=growBounding;function isInsideBounding(s,t){return!(s[0]<t[0][0]||s[1]<t[0][1]||s[0]>t[1][0]||s[1]>t[1][1])}LiteGraph.isInsideBounding=isInsideBounding;function overlapBounding(s,t){var n=s[0]+s[2],Ae=s[1]+s[3],Ne=t[0]+t[2],tr=t[1]+t[3];return!(s[0]>Ne||s[1]>tr||n<t[0]||Ae<t[1])}LiteGraph.overlapBounding=overlapBounding;function hex2num(s){s.charAt(0)=="#"&&(s=s.slice(1)),s=s.toUpperCase();for(var t="0123456789ABCDEF",n=new Array(3),Ae=0,Ne,tr,er=0;er<6;er+=2)Ne=t.indexOf(s.charAt(er)),tr=t.indexOf(s.charAt(er+1)),n[Ae]=Ne*16+tr,Ae++;return n}LiteGraph.hex2num=hex2num;function num2hex(s){for(var t="0123456789ABCDEF",n="#",Ae,Ne,tr=0;tr<3;tr++)Ae=s[tr]/16,Ne=s[tr]%16,n+=t.charAt(Ae)+t.charAt(Ne);return n}LiteGraph.num2hex=num2hex;function ContextMenu(s,t){t=t||{},this.options=t;var n=this;t.parentMenu&&(t.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),t.parentMenu=null):(this.parentMenu=t.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var Ae=null;t.event&&(Ae=t.event.constructor.name),Ae!=="MouseEvent"&&Ae!=="CustomEvent"&&Ae!=="PointerEvent"&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+Ae+")"),t.event=null);var Ne=document.createElement("div");Ne.className="litegraph litecontextmenu litemenubar-panel",t.className&&(Ne.className+=" "+t.className),Ne.style.minWidth=100,Ne.style.minHeight=100,Ne.style.pointerEvents="none",setTimeout(function(){Ne.style.pointerEvents="auto"},100),LiteGraph.pointerListenerAdd(Ne,"up",function(vr){return vr.preventDefault(),!0},!0),Ne.addEventListener("contextmenu",function(vr){return vr.button!=2||vr.preventDefault(),!1},!0),LiteGraph.pointerListenerAdd(Ne,"down",function(vr){if(vr.button==2)return n.close(),vr.preventDefault(),!0},!0);function tr(vr){var mr=parseInt(Ne.style.top);return Ne.style.top=(mr+vr.deltaY*t.scroll_speed).toFixed()+"px",vr.preventDefault(),!0}if(t.scroll_speed||(t.scroll_speed=.1),Ne.addEventListener("wheel",tr,!0),Ne.addEventListener("mousewheel",tr,!0),this.root=Ne,t.title){var er=document.createElement("div");er.className="litemenu-title",er.innerHTML=t.title,Ne.appendChild(er)}for(var ir=0;ir<s.length;ir++){var sr=s.constructor==Array?s[ir]:ir;sr!=null&&sr.constructor!==String&&(sr=sr.content===void 0?String(sr):sr.content);var rr=s[ir];this.addItem(sr,rr,t)}LiteGraph.pointerListenerAdd(Ne,"enter",function(vr){Ne.closing_timer&&clearTimeout(Ne.closing_timer)});var nr=document;t.event&&(nr=t.event.target.ownerDocument),nr||(nr=document),nr.fullscreenElement?nr.fullscreenElement.appendChild(Ne):nr.body.appendChild(Ne);var ar=t.left||0,or=t.top||0;if(t.event){if(ar=t.event.clientX-10,or=t.event.clientY-10,t.title&&(or-=20),t.parentMenu){var ur=t.parentMenu.root.getBoundingClientRect();ar=ur.left+ur.width}var hr=document.body.getBoundingClientRect(),cr=Ne.getBoundingClientRect();hr.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),hr.width&&ar>hr.width-cr.width-10&&(ar=hr.width-cr.width-10),hr.height&&or>hr.height-cr.height-10&&(or=hr.height-cr.height-10)}Ne.style.left=ar+"px",Ne.style.top=or+"px",t.scale&&(Ne.style.transform="scale("+t.scale+")")}ContextMenu.prototype.addItem=function(s,t,n){var Ae=this;n=n||{};var Ne=document.createElement("div");Ne.className="litemenu-entry submenu";var tr=!1;t===null?Ne.classList.add("separator"):(Ne.innerHTML=t&&t.title?t.title:s,Ne.value=t,t&&(t.disabled&&(tr=!0,Ne.classList.add("disabled")),(t.submenu||t.has_submenu)&&Ne.classList.add("has_submenu")),typeof t=="function"?(Ne.dataset.value=s,Ne.onclick_callback=t):Ne.dataset.value=t,t.className&&(Ne.className+=" "+t.className)),this.root.appendChild(Ne),tr||Ne.addEventListener("click",ir),!tr&&n.autoopen&&LiteGraph.pointerListenerAdd(Ne,"enter",er);function er(sr){var rr=this.value;!rr||!rr.has_submenu||ir.call(this,sr)}function ir(sr){var rr=this.value,nr=!0;if(Ae.current_submenu&&Ae.current_submenu.close(sr),n.callback){var ar=n.callback.call(this,rr,n,sr,Ae,n.node);ar===!0&&(nr=!1)}if(rr){if(rr.callback&&!n.ignore_item_callbacks&&rr.disabled!==!0){var ar=rr.callback.call(this,rr,n,sr,Ae,n.extra);ar===!0&&(nr=!1)}if(rr.submenu){if(!rr.submenu.options)throw"ContextMenu submenu needs options";new Ae.constructor(rr.submenu.options,{callback:rr.submenu.callback,event:sr,parentMenu:Ae,ignore_item_callbacks:rr.submenu.ignore_item_callbacks,title:rr.submenu.title,extra:rr.submenu.extra,autoopen:n.autoopen}),nr=!1}}nr&&!Ae.lock&&Ae.close()}return Ne},ContextMenu.prototype.close=function(s,t){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!t&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,s===void 0?this.parentMenu.close():s&&!ContextMenu.isCursorOverElement(s,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",s)),this.current_submenu&&this.current_submenu.close(s,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(s,t,n,Ae){var Ne=document.createEvent("CustomEvent");return Ne.initCustomEvent(t,!0,!0,n),Ne.srcElement=Ae,s.dispatchEvent?s.dispatchEvent(Ne):s.__events&&s.__events.dispatchEvent(Ne),Ne},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(s,t){var n=s.clientX,Ae=s.clientY,Ne=t.getBoundingClientRect();return Ne?Ae>Ne.top&&Ae<Ne.top+Ne.height&&n>Ne.left&&n<Ne.left+Ne.width:!1},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(s){s=s||window;var t=s.document.querySelectorAll(".litecontextmenu");if(t.length){for(var n=[],Ae=0;Ae<t.length;Ae++)n.push(t[Ae]);for(var Ae=0;Ae<n.length;Ae++)n[Ae].close?n[Ae].close():n[Ae].parentNode&&n[Ae].parentNode.removeChild(n[Ae])}},LiteGraph.extendClass=function(s,t){for(var n in t)s.hasOwnProperty(n)||(s[n]=t[n]);if(t.prototype)for(var n in t.prototype)t.prototype.hasOwnProperty(n)&&(s.prototype.hasOwnProperty(n)||(t.prototype.__lookupGetter__(n)?s.prototype.__defineGetter__(n,t.prototype.__lookupGetter__(n)):s.prototype[n]=t.prototype[n],t.prototype.__lookupSetter__(n)&&s.prototype.__defineSetter__(n,t.prototype.__lookupSetter__(n))))};function CurveEditor(s){this.points=s,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}CurveEditor.sampleCurve=function(s,t){if(t){for(var n=0;n<t.length-1;++n){var Ae=t[n],Ne=t[n+1];if(!(Ne[0]<s)){var tr=Ne[0]-Ae[0];if(Math.abs(tr)<1e-5)return Ae[1];var er=(s-Ae[0])/tr;return Ae[1]*(1-er)+Ne[1]*er}}return 0}},CurveEditor.prototype.draw=function(s,t,n,Ae,Ne,tr){var er=this.points;if(er){this.size=t;var ir=t[0]-this.margin*2,sr=t[1]-this.margin*2;Ne=Ne||"#666",s.save(),s.translate(this.margin,this.margin),Ae&&(s.fillStyle="#111",s.fillRect(0,0,ir,sr),s.fillStyle="#222",s.fillRect(ir*.5,0,1,sr),s.strokeStyle="#333",s.strokeRect(0,0,ir,sr)),s.strokeStyle=Ne,tr&&(s.globalAlpha=.5),s.beginPath();for(var rr=0;rr<er.length;++rr){var nr=er[rr];s.lineTo(nr[0]*ir,(1-nr[1])*sr)}if(s.stroke(),s.globalAlpha=1,!tr)for(var rr=0;rr<er.length;++rr){var nr=er[rr];s.fillStyle=this.selected==rr?"#FFF":this.nearest==rr?"#DDD":"#AAA",s.beginPath(),s.arc(nr[0]*ir,(1-nr[1])*sr,2,0,Math.PI*2),s.fill()}s.restore()}},CurveEditor.prototype.onMouseDown=function(s,t){var n=this.points;if(n&&!(s[1]<0)){var Ae=this.size[0]-this.margin*2,Ne=this.size[1]-this.margin*2,tr=s[0]-this.margin,er=s[1]-this.margin,ir=[tr,er],sr=30/t.ds.scale;if(this.selected=this.getCloserPoint(ir,sr),this.selected==-1){var rr=[tr/Ae,1-er/Ne];n.push(rr),n.sort(function(nr,ar){return nr[0]-ar[0]}),this.selected=n.indexOf(rr),this.must_update=!0}if(this.selected!=-1)return!0}},CurveEditor.prototype.onMouseMove=function(s,t){var n=this.points;if(n){var Ae=this.selected;if(!(Ae<0)){var Ne=(s[0]-this.margin)/(this.size[0]-this.margin*2),tr=(s[1]-this.margin)/(this.size[1]-this.margin*2),er=[s[0]-this.margin,s[1]-this.margin],ir=30/t.ds.scale;this._nearest=this.getCloserPoint(er,ir);var sr=n[Ae];if(sr){var rr=Ae==0||Ae==n.length-1;if(!rr&&(s[0]<-10||s[0]>this.size[0]+10||s[1]<-10||s[1]>this.size[1]+10)){n.splice(Ae,1),this.selected=-1;return}rr?sr[0]=Ae==0?0:1:sr[0]=clamp(Ne,0,1),sr[1]=1-clamp(tr,0,1),n.sort(function(nr,ar){return nr[0]-ar[0]}),this.selected=n.indexOf(sr),this.must_update=!0}}}},CurveEditor.prototype.onMouseUp=function(s,t){return this.selected=-1,!1},CurveEditor.prototype.getCloserPoint=function(s,t){var n=this.points;if(!n)return-1;t=t||30;for(var Ae=this.size[0]-this.margin*2,Ne=this.size[1]-this.margin*2,tr=n.length,er=[0,0],ir=1e6,sr=-1,rr=0;rr<tr;++rr){var nr=n[rr];er[0]=nr[0]*Ae,er[1]=(1-nr[1])*Ne,er[0]<s[0];var ar=vec2.distance(s,er);ar>ir||ar>t||(sr=rr,ir=ar)}return sr},LiteGraph.CurveEditor=CurveEditor,LiteGraph.getParameterNames=function(s){return(s+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},LiteGraph.pointerListenerAdd=function(s,t,n,Ae=!1){if(!(!s||!s.addEventListener||!t||typeof n!="function")){var Ne=LiteGraph.pointerevents_method,tr=t;if(Ne=="pointer"&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log("Converting pointer["+tr+"] : down move up cancel enter TO touchstart touchmove touchend, etc .."),tr){case"down":{Ne="touch",tr="start";break}case"move":{Ne="touch";break}case"up":{Ne="touch",tr="end";break}case"cancel":{Ne="touch";break}case"enter":{console.log("debug: Should I send a move event?");break}default:console.warn("PointerEvent not available in this browser ? The event "+tr+" would not be called")}switch(tr){case"down":case"up":case"move":case"over":case"out":case"enter":s.addEventListener(Ne+tr,n,Ae);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(Ne!="mouse")return s.addEventListener(Ne+tr,n,Ae);default:return s.addEventListener(tr,n,Ae)}}},LiteGraph.pointerListenerRemove=function(s,t,n,Ae=!1){if(!(!s||!s.removeEventListener||!t||typeof n!="function"))switch(t){case"down":case"up":case"move":case"over":case"out":case"enter":(LiteGraph.pointerevents_method=="pointer"||LiteGraph.pointerevents_method=="mouse")&&s.removeEventListener(LiteGraph.pointerevents_method+t,n,Ae);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(LiteGraph.pointerevents_method=="pointer")return s.removeEventListener(LiteGraph.pointerevents_method+t,n,Ae);default:return s.removeEventListener(t,n,Ae)}};function clamp(s,t,n){return t>s?t:n<s?n:s}global.clamp=clamp,typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(s){window.setTimeout(s,1e3/60)})})(commonjsGlobal),exports.LiteGraph=commonjsGlobal.LiteGraph,exports.LGraph=commonjsGlobal.LGraph,exports.LLink=commonjsGlobal.LLink,exports.LGraphNode=commonjsGlobal.LGraphNode,exports.LGraphGroup=commonjsGlobal.LGraphGroup,exports.DragAndScale=commonjsGlobal.DragAndScale,exports.LGraphCanvas=commonjsGlobal.LGraphCanvas,exports.ContextMenu=commonjsGlobal.ContextMenu,function(s){var t=s.LiteGraph;function n(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}n.title="Time",n.desc="Time",n.prototype.onExecute=function(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)},t.registerNodeType("basic/time",n);function Ae(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new t.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}Ae.title="Subgraph",Ae.desc="Graph inside a node",Ae.title_color="#334",Ae.prototype.onGetInputs=function(){return[["enabled","boolean"]]},Ae.prototype.onDblClick=function(Sr,Ar,_r){var Nr=this;setTimeout(function(){_r.openSubgraph(Nr.subgraph)},10)},Ae.prototype.onAction=function(Sr,Ar){this.subgraph.onAction(Sr,Ar)},Ae.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(var Sr=0;Sr<this.inputs.length;Sr++){var Ar=this.inputs[Sr],_r=this.getInputData(Sr);this.subgraph.setInputData(Ar.name,_r)}if(this.subgraph.runStep(),this.outputs)for(var Sr=0;Sr<this.outputs.length;Sr++){var Nr=this.outputs[Sr],_r=this.subgraph.getOutputData(Nr.name);this.setOutputData(Sr,_r)}}},Ae.prototype.sendEventToAllNodes=function(Sr,Ar,_r){this.enabled&&this.subgraph.sendEventToAllNodes(Sr,Ar,_r)},Ae.prototype.onDrawBackground=function(Sr,Ar,_r,Nr){if(this.flags.collapsed)return;var Tr=this.size[1]-t.NODE_TITLE_HEIGHT+.5,Lr=t.isInsideRectangle(Nr[0],Nr[1],this.pos[0],this.pos[1]+Tr,this.size[0],t.NODE_TITLE_HEIGHT);let Ir=t.isInsideRectangle(Nr[0],Nr[1],this.pos[0],this.pos[1]+Tr,this.size[0]/2,t.NODE_TITLE_HEIGHT);Sr.fillStyle=Lr?"#555":"#222",Sr.beginPath(),this._shape==t.BOX_SHAPE?Ir?Sr.rect(0,Tr,this.size[0]/2+1,t.NODE_TITLE_HEIGHT):Sr.rect(this.size[0]/2,Tr,this.size[0]/2+1,t.NODE_TITLE_HEIGHT):Ir?Sr.roundRect(0,Tr,this.size[0]/2+1,t.NODE_TITLE_HEIGHT,[0,0,8,8]):Sr.roundRect(this.size[0]/2,Tr,this.size[0]/2+1,t.NODE_TITLE_HEIGHT,[0,0,8,8]),Lr?Sr.fill():Sr.fillRect(0,Tr,this.size[0]+1,t.NODE_TITLE_HEIGHT),Sr.textAlign="center",Sr.font="24px Arial",Sr.fillStyle=Lr?"#DDD":"#999",Sr.fillText("+",this.size[0]*.25,Tr+24),Sr.fillText("+",this.size[0]*.75,Tr+24)},Ae.prototype.onMouseDown=function(Sr,Ar,_r){var Nr=this.size[1]-t.NODE_TITLE_HEIGHT+.5;console.log(0),Ar[1]>Nr&&(Ar[0]<this.size[0]/2?(console.log(1),_r.showSubgraphPropertiesDialog(this)):(console.log(2),_r.showSubgraphPropertiesDialogRight(this)))},Ae.prototype.computeSize=function(){var Sr=this.inputs?this.inputs.length:0,Ar=this.outputs?this.outputs.length:0;return[200,Math.max(Sr,Ar)*t.NODE_SLOT_HEIGHT+t.NODE_TITLE_HEIGHT]},Ae.prototype.onSubgraphTrigger=function(Sr,Ar){var _r=this.findOutputSlot(Sr);_r!=-1&&this.triggerSlot(_r)},Ae.prototype.onSubgraphNewInput=function(Sr,Ar){var _r=this.findInputSlot(Sr);_r==-1&&this.addInput(Sr,Ar)},Ae.prototype.onSubgraphRenamedInput=function(Sr,Ar){var _r=this.findInputSlot(Sr);if(_r!=-1){var Nr=this.getInputInfo(_r);Nr.name=Ar}},Ae.prototype.onSubgraphTypeChangeInput=function(Sr,Ar){var _r=this.findInputSlot(Sr);if(_r!=-1){var Nr=this.getInputInfo(_r);Nr.type=Ar}},Ae.prototype.onSubgraphRemovedInput=function(Sr){var Ar=this.findInputSlot(Sr);Ar!=-1&&this.removeInput(Ar)},Ae.prototype.onSubgraphNewOutput=function(Sr,Ar){var _r=this.findOutputSlot(Sr);_r==-1&&this.addOutput(Sr,Ar)},Ae.prototype.onSubgraphRenamedOutput=function(Sr,Ar){var _r=this.findOutputSlot(Sr);if(_r!=-1){var Nr=this.getOutputInfo(_r);Nr.name=Ar}},Ae.prototype.onSubgraphTypeChangeOutput=function(Sr,Ar){var _r=this.findOutputSlot(Sr);if(_r!=-1){var Nr=this.getOutputInfo(_r);Nr.type=Ar}},Ae.prototype.onSubgraphRemovedOutput=function(Sr){var Ar=this.findOutputSlot(Sr);Ar!=-1&&this.removeOutput(Ar)},Ae.prototype.getExtraMenuOptions=function(Sr){var Ar=this;return[{content:"Open",callback:function(){Sr.openSubgraph(Ar.subgraph)}}]},Ae.prototype.onResize=function(Sr){Sr[1]+=20},Ae.prototype.serialize=function(){var Sr=t.LGraphNode.prototype.serialize.call(this);return Sr.subgraph=this.subgraph.serialize(),Sr},Ae.prototype.reassignSubgraphUUIDs=function(Sr){const Ar={nodeIDs:{},linkIDs:{}};for(const _r of Sr.nodes){const Nr=_r.id,Tr=t.uuidv4();if(_r.id=Tr,Ar.nodeIDs[Nr]||Ar.nodeIDs[Tr])throw new Error(`New/old node UUID wasn't unique in changed map! ${Nr} ${Tr}`);Ar.nodeIDs[Nr]=Tr,Ar.nodeIDs[Tr]=Nr}for(const _r of Sr.links){const Nr=_r[0],Tr=t.uuidv4();if(_r[0]=Tr,Ar.linkIDs[Nr]||Ar.linkIDs[Tr])throw new Error(`New/old link UUID wasn't unique in changed map! ${Nr} ${Tr}`);Ar.linkIDs[Nr]=Tr,Ar.linkIDs[Tr]=Nr;const Lr=_r[1],Ir=_r[3];if(!Ar.nodeIDs[Lr])throw new Error(`Old node UUID not found in mapping! ${Lr}`);if(_r[1]=Ar.nodeIDs[Lr],!Ar.nodeIDs[Ir])throw new Error(`Old node UUID not found in mapping! ${Ir}`);_r[3]=Ar.nodeIDs[Ir]}for(const _r of Sr.nodes){if(_r.inputs)for(const Nr of _r.inputs)Nr.link&&(Nr.link=Ar.linkIDs[Nr.link]);if(_r.outputs)for(const Nr of _r.outputs)Nr.links&&(Nr.links=Nr.links.map(Tr=>Ar.linkIDs[Tr]))}for(const _r of Sr.nodes)if(_r.type==="graph/subgraph"){const Nr=reassignGraphUUIDs(_r.subgraph);Ar.nodeIDs.assign(Nr.nodeIDs),Ar.linkIDs.assign(Nr.linkIDs)}},Ae.prototype.clone=function(){var Sr=t.createNode(this.type),Ar=this.serialize();if(t.use_uuids){const _r=t.cloneObject(Ar.subgraph);this.reassignSubgraphUUIDs(_r),Ar.subgraph=_r}return delete Ar.id,delete Ar.inputs,delete Ar.outputs,Sr.configure(Ar),Sr},Ae.prototype.buildFromNodes=function(Sr){for(var Ar={},_r=0,Nr=0;Nr<Sr.length;++Nr){var Tr=Sr[Nr];Ar[Tr.id]=Tr,_r=Math.min(Tr.pos[0],_r),Math.max(Tr.pos[0],_r)}for(var Nr=0;Nr<Sr.length;++Nr){var Tr=Sr[Nr];if(Tr.inputs)for(var Lr=0;Lr<Tr.inputs.length;++Lr){var Ir=Tr.inputs[Lr];if(!(!Ir||!Ir.link)){var Gr=Tr.graph.links[Ir.link];Gr&&(Ar[Gr.origin_id]||this.subgraph.addInput(Ir.name,Gr.type))}}if(Tr.outputs)for(var Lr=0;Lr<Tr.outputs.length;++Lr){var Br=Tr.outputs[Lr];if(!(!Br||!Br.links||!Br.links.length))for(var jr=!1,Yr=0;Yr<Br.links.length;++Yr){var Gr=Tr.graph.links[Br.links[Yr]];if(Gr&&!Ar[Gr.target_id]){jr=!0;break}}}}},t.Subgraph=Ae,t.registerNodeType("graph/subgraph",Ae);function Ne(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var Sr=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function(Ar){Ar&&Sr.setProperty("name",Ar)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function(Ar){Sr.setProperty("type",Ar)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function(Ar){Sr.setProperty("value",Ar)}),this.widgets_up=!0,this.size=[180,90]}Ne.title="Input",Ne.desc="Input of the graph",Ne.prototype.onConfigure=function(){this.updateType()},Ne.prototype.updateType=function(){var Sr=this.properties.type;this.type_widget.value=Sr,this.outputs[0].type!=Sr&&(t.isValidConnection(this.outputs[0].type,Sr)||this.disconnectOutput(0),this.outputs[0].type=Sr),Sr=="number"?(this.value_widget.type="number",this.value_widget.value=0):Sr=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):Sr=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,Sr)},Ne.prototype.onPropertyChanged=function(Sr,Ar){if(Sr=="name"){if(Ar==""||Ar==this.name_in_graph||Ar=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,Ar):this.graph.addInput(Ar,this.properties.type)),this.name_widget.value=Ar,this.name_in_graph=Ar}else Sr=="type"&&this.updateType()},Ne.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},Ne.prototype.onAction=function(Sr,Ar){this.properties.type==t.EVENT&&this.triggerSlot(0,Ar)},Ne.prototype.onExecute=function(){var Sr=this.properties.name,Ar=this.graph.inputs[Sr];if(!Ar){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,Ar.value!==void 0?Ar.value:this.properties.value)},Ne.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},t.GraphInput=Ne,t.registerNodeType("graph/input",Ne);function tr(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}tr.title="Output",tr.desc="Output of the graph",tr.prototype.onPropertyChanged=function(Sr,Ar){if(Sr=="name"){if(Ar==""||Ar==this.name_in_graph||Ar=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,Ar):this.graph.addOutput(Ar,this.properties.type)),this.name_widget.value=Ar,this.name_in_graph=Ar}else Sr=="type"&&this.updateType()},tr.prototype.updateType=function(){var Sr=this.properties.type;this.type_widget&&(this.type_widget.value=Sr),this.inputs[0].type!=Sr&&((Sr=="action"||Sr=="event")&&(Sr=t.EVENT),t.isValidConnection(this.inputs[0].type,Sr)||this.disconnectInput(0),this.inputs[0].type=Sr),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,Sr)},tr.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},tr.prototype.onAction=function(Sr,Ar){this.properties.type==t.ACTION&&this.graph.trigger(this.properties.name,Ar)},tr.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},tr.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},t.GraphOutput=tr,t.registerNodeType("graph/output",tr);function er(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}er.title="Const Number",er.desc="Constant number",er.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},er.prototype.getTitle=function(){return this.flags.collapsed?this.properties.value:this.title},er.prototype.setValue=function(Sr){this.setProperty("value",Sr)},er.prototype.onDrawBackground=function(Sr){this.outputs[0].label=this.properties.value.toFixed(3)},t.registerNodeType("basic/const",er);function ir(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}ir.title="Const Boolean",ir.desc="Constant boolean",ir.prototype.getTitle=er.prototype.getTitle,ir.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},ir.prototype.setValue=er.prototype.setValue,ir.prototype.onGetInputs=function(){return[["toggle",t.ACTION]]},ir.prototype.onAction=function(Sr){this.setValue(!this.properties.value)},t.registerNodeType("basic/boolean",ir);function sr(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}sr.title="Const String",sr.desc="Constant string",sr.prototype.getTitle=er.prototype.getTitle,sr.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},sr.prototype.setValue=er.prototype.setValue,sr.prototype.onDropFile=function(Sr){var Ar=this,_r=new FileReader;_r.onload=function(Nr){Ar.setProperty("value",Nr.target.result)},_r.readAsText(Sr)},t.registerNodeType("basic/string",sr);function rr(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}rr.title="Const Object",rr.desc="Constant Object",rr.prototype.onExecute=function(){this.setOutputData(0,this._object)},t.registerNodeType("basic/object",rr);function nr(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}nr.title="Const File",nr.desc="Fetches a file from an url",nr["@type"]={type:"enum",values:["text","arraybuffer","blob","json"]},nr.prototype.onPropertyChanged=function(Sr,Ar){Sr=="url"&&(Ar==null||Ar==""?this._data=null:this.fetchFile(Ar))},nr.prototype.onExecute=function(){var Sr=this.getInputData(0)||this.properties.url;Sr&&(Sr!=this._url||this._type!=this.properties.type)&&this.fetchFile(Sr),this.setOutputData(0,this._data)},nr.prototype.setValue=er.prototype.setValue,nr.prototype.fetchFile=function(Sr){var Ar=this;if(!Sr||Sr.constructor!==String){Ar._data=null,Ar.boxcolor=null;return}this._url=Sr,this._type=this.properties.type,Sr.substr(0,4)=="http"&&t.proxy&&(Sr=t.proxy+Sr.substr(Sr.indexOf(":")+3)),fetch(Sr).then(function(_r){if(!_r.ok)throw new Error("File not found");if(Ar.properties.type=="arraybuffer")return _r.arrayBuffer();if(Ar.properties.type=="text")return _r.text();if(Ar.properties.type=="json")return _r.json();if(Ar.properties.type=="blob")return _r.blob()}).then(function(_r){Ar._data=_r,Ar.boxcolor="#AEA"}).catch(function(_r){Ar._data=null,Ar.boxcolor="red",console.error("error fetching file:",Sr)})},nr.prototype.onDropFile=function(Sr){var Ar=this;this._url=Sr.name,this._type=this.properties.type,this.properties.url=Sr.name;var _r=new FileReader;if(_r.onload=function(Nr){Ar.boxcolor="#AEA";var Tr=Nr.target.result;Ar.properties.type=="json"&&(Tr=JSON.parse(Tr)),Ar._data=Tr},Ar.properties.type=="arraybuffer")_r.readAsArrayBuffer(Sr);else if(Ar.properties.type=="text"||Ar.properties.type=="json")_r.readAsText(Sr);else if(Ar.properties.type=="blob")return _r.readAsBinaryString(Sr)},t.registerNodeType("basic/file",nr);function ar(){this.addInput("parse",t.ACTION),this.addInput("json","string"),this.addOutput("done",t.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}ar.title="JSON Parse",ar.desc="Parses JSON String into object",ar.prototype.parse=function(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}},ar.prototype.onExecute=function(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)},ar.prototype.onAction=function(Sr){Sr=="parse"&&this.parse()},t.registerNodeType("basic/jsonparse",ar);function or(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}or.title="Const Data",or.desc="Constant Data",or.prototype.onPropertyChanged=function(Sr,Ar){if(this.widget.value=Ar,!(Ar==null||Ar==""))try{this._value=JSON.parse(Ar),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},or.prototype.onExecute=function(){this.setOutputData(0,this._value)},or.prototype.setValue=er.prototype.setValue,t.registerNodeType("basic/data",or);function ur(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}ur.title="Const Array",ur.desc="Constant Array",ur.prototype.onPropertyChanged=function(Sr,Ar){if(this.widget.value=Ar,!(Ar==null||Ar==""))try{Ar[0]!="["?this._value=JSON.parse("["+Ar+"]"):this._value=JSON.parse(Ar),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},ur.prototype.onExecute=function(){var Sr=this.getInputData(0);if(Sr&&Sr.length){this._value||(this._value=new Array),this._value.length=Sr.length;for(var Ar=0;Ar<Sr.length;++Ar)this._value[Ar]=Sr[Ar]}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)},ur.prototype.setValue=er.prototype.setValue,t.registerNodeType("basic/array",ur);function hr(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}hr.title="Set Array",hr.desc="Sets index of array",hr.prototype.onExecute=function(){var Sr=this.getInputData(0);if(Sr){var Ar=this.getInputData(1);Ar!==void 0&&(this.properties.index&&(Sr[Math.floor(this.properties.index)]=Ar),this.setOutputData(0,Sr))}},t.registerNodeType("basic/set_array",hr);function cr(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}cr.title="Array[i]",cr.desc="Returns an element from an array",cr.prototype.onExecute=function(){var Sr=this.getInputData(0),Ar=this.getInputData(1);Ar==null&&(Ar=this.properties.index),!(Sr==null||Ar==null)&&this.setOutputData(0,Sr[Math.floor(Number(Ar))])},t.registerNodeType("basic/array[]",cr);function vr(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}vr.title="Table[row][col]",vr.desc="Returns an element from a table",vr.prototype.onExecute=function(){var Sr=this.getInputData(0),_r=this.getInputData(1),Ar=this.getInputData(2);if(_r==null&&(_r=this.properties.row),Ar==null&&(Ar=this.properties.column),!(Sr==null||_r==null||Ar==null)){var _r=Sr[Math.floor(Number(_r))];_r?this.setOutputData(0,_r[Math.floor(Number(Ar))]):this.setOutputData(0,null)}},t.registerNodeType("basic/table[][]",vr);function mr(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}mr.title="Object property",mr.desc="Outputs the property of an object",mr.prototype.setValue=function(Sr){this.properties.value=Sr,this.widget.value=Sr},mr.prototype.getTitle=function(){return this.flags.collapsed?"in."+this.properties.value:this.title},mr.prototype.onPropertyChanged=function(Sr,Ar){this.widget.value=Ar},mr.prototype.onExecute=function(){var Sr=this.getInputData(0);Sr!=null&&this.setOutputData(0,Sr[this.properties.value])},t.registerNodeType("basic/object_property",mr);function dr(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}dr.title="Object keys",dr.desc="Outputs an array with the keys of an object",dr.prototype.onExecute=function(){var Sr=this.getInputData(0);Sr!=null&&this.setOutputData(0,Object.keys(Sr))},t.registerNodeType("basic/object_keys",dr);function lr(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}lr.title="Set Object",lr.desc="Adds propertiesrty to object",lr.prototype.onExecute=function(){var Sr=this.getInputData(0);if(Sr){var Ar=this.getInputData(1);Ar!==void 0&&(this.properties.property&&(Sr[this.properties.property]=Ar),this.setOutputData(0,Sr))}},t.registerNodeType("basic/set_object",lr);function gr(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var Sr=this;this.addWidget("button","clear","",function(){Sr._result={}}),this.size=this.computeSize()}gr.title="Merge Objects",gr.desc="Creates an object copying properties from others",gr.prototype.onExecute=function(){var Sr=this.getInputData(0),Ar=this.getInputData(1),_r=this._result;if(Sr)for(var Nr in Sr)_r[Nr]=Sr[Nr];if(Ar)for(var Nr in Ar)_r[Nr]=Ar[Nr];this.setOutputData(0,_r)},t.registerNodeType("basic/merge_objects",gr);function fr(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:fr.LITEGRAPH},this.value=null}fr.title="Variable",fr.desc="store/read variable value",fr.LITEGRAPH=0,fr.GRAPH=1,fr.GLOBALSCOPE=2,fr["@container"]={type:"enum",values:{litegraph:fr.LITEGRAPH,graph:fr.GRAPH,global:fr.GLOBALSCOPE}},fr.prototype.onExecute=function(){var Sr=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),Sr[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,Sr[this.properties.varname])},fr.prototype.getContainer=function(){switch(this.properties.container){case fr.GRAPH:return this.graph?this.graph.vars:{};case fr.GLOBALSCOPE:return s;case fr.LITEGRAPH:default:return t.Globals}},fr.prototype.getTitle=function(){return this.properties.varname},t.registerNodeType("basic/variable",fr),t.wrapFunctionAsNode("basic/length",yr,[""],"number");function yr(Sr){return Sr&&Sr.length!=null?Number(Sr.length):0}t.wrapFunctionAsNode("basic/not",function(Sr){return!Sr},[""],"boolean");function Er(){this.size=[60,30],this.addInput("data",0),this.addInput("download",t.ACTION),this.properties={filename:"data.json"},this.value=null;var Sr=this;this.addWidget("button","Download","",function(Ar){Sr.value&&Sr.downloadAsFile()})}Er.title="Download",Er.desc="Download some data",Er.prototype.downloadAsFile=function(){if(this.value!=null){var Sr=null;this.value.constructor===String?Sr=this.value:Sr=JSON.stringify(this.value);var Ar=new Blob([Sr]),_r=URL.createObjectURL(Ar),Nr=document.createElement("a");Nr.setAttribute("href",_r),Nr.setAttribute("download",this.properties.filename),Nr.style.display="none",document.body.appendChild(Nr),Nr.click(),document.body.removeChild(Nr),setTimeout(function(){URL.revokeObjectURL(_r)},1e3*60)}},Er.prototype.onAction=function(Sr,Ar){var _r=this;setTimeout(function(){_r.downloadAsFile()},100)},Er.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},Er.prototype.getTitle=function(){return this.flags.collapsed?this.properties.filename:this.title},t.registerNodeType("basic/download",Er);function wr(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}wr.title="Watch",wr.desc="Show value of input",wr.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},wr.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},wr.toString=function(Sr){if(Sr==null)return"null";if(Sr.constructor===Number)return Sr.toFixed(3);if(Sr.constructor===Array){for(var Ar="[",_r=0;_r<Sr.length;++_r)Ar+=wr.toString(Sr[_r])+(_r+1!=Sr.length?",":"");return Ar+="]",Ar}else return String(Sr)},wr.prototype.onDrawBackground=function(Sr){this.inputs[0].label=wr.toString(this.value)},t.registerNodeType("basic/watch",wr);function Dr(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}Dr.title="Cast",Dr.desc="Allows to connect different types",Dr.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},t.registerNodeType("basic/cast",Dr);function kr(){this.mode=t.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",t.EVENT),this.addInput("msg",0)}kr.title="Console",kr.desc="Show value inside the console",kr.prototype.onAction=function(Sr,Ar){var _r=this.getInputData(1);_r||(_r=this.properties.msg),_r||(_r="Event: "+Ar),Sr=="log"?console.log(_r):Sr=="warn"?console.warn(_r):Sr=="error"&&console.error(_r)},kr.prototype.onExecute=function(){var Sr=this.getInputData(1);Sr||(Sr=this.properties.msg),Sr!=null&&typeof Sr<"u"&&(this.properties.msg=Sr,console.log(Sr))},kr.prototype.onGetInputs=function(){return[["log",t.ACTION],["warn",t.ACTION],["error",t.ACTION]]},t.registerNodeType("basic/console",kr);function zr(){this.mode=t.ON_EVENT,this.addProperty("msg",""),this.addInput("",t.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}zr.title="Alert",zr.desc="Show an alert window",zr.color="#510",zr.prototype.onConfigure=function(Sr){this.widget.value=Sr.properties.msg},zr.prototype.onAction=function(Sr,Ar){var _r=this.properties.msg;setTimeout(function(){alert(_r)},10)},t.registerNodeType("basic/alert",zr);function Vr(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}Vr.prototype.onConfigure=function(Sr){Sr.properties.onExecute&&t.allow_scripts?this.compileCode(Sr.properties.onExecute):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Vr.title="Script",Vr.desc="executes a code (max 256 characters)",Vr.widgets_info={onExecute:{type:"code"}},Vr.prototype.onPropertyChanged=function(Sr,Ar){Sr=="onExecute"&&t.allow_scripts?this.compileCode(Ar):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Vr.prototype.compileCode=function(Sr){if(this._func=null,Sr.length>256)console.warn("Script too long, max 256 chars");else{for(var Ar=Sr.toLowerCase(),_r=["script","body","document","eval","nodescript","function"],Nr=0;Nr<_r.length;++Nr)if(Ar.indexOf(_r[Nr])!=-1){console.warn("invalid script");return}try{this._func=new Function("A","B","C","DATA","node",Sr)}catch(Tr){console.error("Error parsing script"),console.error(Tr)}}},Vr.prototype.onExecute=function(){if(this._func)try{var Sr=this.getInputData(0),Ar=this.getInputData(1),_r=this.getInputData(2);this.setOutputData(0,this._func(Sr,Ar,_r,this.data,this))}catch(Nr){console.error("Error in script"),console.error(Nr)}},Vr.prototype.onGetOutputs=function(){return[["C",""]]},t.registerNodeType("basic/script",Vr);function Hr(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:Hr.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:Hr.values}),this.size=[80,60]}Hr.values=["==","!="],Hr["@OP"]={type:"enum",title:"operation",values:Hr.values},Hr.title="Compare *",Hr.desc="evaluates condition between A and B",Hr.prototype.getTitle=function(){return"*A "+this.properties.OP+" *B"},Hr.prototype.onExecute=function(){var Sr=this.getInputData(0);Sr===void 0?Sr=this.properties.A:this.properties.A=Sr;var Ar=this.getInputData(1);Ar===void 0?Ar=this.properties.B:this.properties.B=Ar;var _r=!1;if(typeof Sr==typeof Ar)switch(this.properties.OP){case"==":case"!=":switch(_r=!0,typeof Sr){case"object":var Nr=Object.getOwnPropertyNames(Sr),Tr=Object.getOwnPropertyNames(Ar);if(Nr.length!=Tr.length){_r=!1;break}for(var Lr=0;Lr<Nr.length;Lr++){var Ir=Nr[Lr];if(Sr[Ir]!==Ar[Ir]){_r=!1;break}}break;default:_r=Sr==Ar}this.properties.OP=="!="&&(_r=!_r);break}this.setOutputData(0,_r),this.setOutputData(1,!_r)},t.registerNodeType("basic/CompareValues",Hr)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.size=[60,30],this.addInput("event",t.ACTION)}n.title="Log Event",n.desc="Log event in console",n.prototype.onAction=function(cr,vr,mr){console.log(cr,vr)},t.registerNodeType("events/log",n);function Ae(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",t.EVENT),this.addOutput("change",t.EVENT),this.addOutput("false",t.EVENT),this.properties={only_on_change:!0},this.prev=0}Ae.title="TriggerEvent",Ae.desc="Triggers event if input evaluates to true",Ae.prototype.onExecute=function(cr,vr){var mr=this.getInputData(0),dr=mr!=this.prev;this.prev===0&&(dr=!1);var lr=dr&&this.properties.only_on_change||!dr&&!this.properties.only_on_change;mr&&lr&&this.triggerSlot(0,cr,null,vr),!mr&&lr&&this.triggerSlot(2,cr,null,vr),dr&&this.triggerSlot(1,cr,null,vr),this.prev=mr},t.registerNodeType("events/trigger",Ae);function Ne(){var cr=this;this.addInput("",t.ACTION),this.addInput("",t.ACTION),this.addInput("",t.ACTION),this.addOutput("",t.EVENT),this.addOutput("",t.EVENT),this.addOutput("",t.EVENT),this.addWidget("button","+",null,function(){cr.addInput("",t.ACTION),cr.addOutput("",t.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}Ne.title="Sequence",Ne.desc="Triggers a sequence of events when an event arrives",Ne.prototype.getTitle=function(){return""},Ne.prototype.onAction=function(cr,vr,mr){if(this.outputs){mr=mr||{};for(var dr=0;dr<this.outputs.length;++dr)this.outputs[dr],mr.action_call?mr.action_call=mr.action_call+"_seq_"+dr:mr.action_call=this.id+"_"+(cr||"action")+"_seq_"+dr+"_"+Math.floor(Math.random()*9999),this.triggerSlot(dr,vr,null,mr)}},t.registerNodeType("events/sequence",Ne);function tr(){var cr=this;this.addInput("",t.ACTION),this.addInput("",t.ACTION),this.addOutput("",t.EVENT),this.addWidget("button","+",null,function(){cr.addInput("",t.ACTION),cr.size[0]=90}),this.size=[90,70],this.ready=[]}tr.title="WaitAll",tr.desc="Wait until all input events arrive then triggers output",tr.prototype.getTitle=function(){return""},tr.prototype.onDrawBackground=function(cr){if(!this.flags.collapsed)for(var vr=0;vr<this.inputs.length;++vr){var mr=vr*t.NODE_SLOT_HEIGHT+10;cr.fillStyle=this.ready[vr]?"#AFB":"#000",cr.fillRect(20,mr,10,10)}},tr.prototype.onAction=function(cr,vr,mr,dr){if(dr!=null){this.ready.length=this.outputs.length,this.ready[dr]=!0;for(var lr=0;lr<this.ready.length;++lr)if(!this.ready[lr])return;this.reset(),this.triggerSlot(0)}},tr.prototype.reset=function(){this.ready.length=0},t.registerNodeType("events/waitAll",tr);function er(){var cr=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",t.ACTION),this.addInput("reset",t.ACTION),this.addOutput("index","number"),this.addOutput("",t.EVENT),this.addOutput("",t.EVENT),this.addOutput("",t.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){cr.addOutput("",t.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}er.title="Stepper",er.desc="Trigger events sequentially when an tick arrives",er.prototype.onDrawBackground=function(cr){if(!this.flags.collapsed){var vr=this.properties.index||0;cr.fillStyle="#AFB";var mr=this.size[0],dr=(vr+1)*t.NODE_SLOT_HEIGHT+4;cr.beginPath(),cr.moveTo(mr-30,dr),cr.lineTo(mr-30,dr+t.NODE_SLOT_HEIGHT),cr.lineTo(mr-15,dr+t.NODE_SLOT_HEIGHT*.5),cr.fill()}},er.prototype.onExecute=function(){var cr=this.getInputData(0);cr!=null&&(cr=Math.floor(cr),cr=clamp(cr,0,this.outputs?this.outputs.length-2:0),cr!=this.properties.index&&(this.properties.index=cr,this.triggerSlot(cr+1))),this.setOutputData(0,this.properties.index)},er.prototype.onAction=function(cr,vr){if(cr=="reset")this.properties.index=0;else if(cr=="step"){this.triggerSlot(this.properties.index+1,vr);var mr=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%mr}},t.registerNodeType("events/stepper",er);function ir(){this.size=[60,30],this.addInput("event",t.ACTION),this.addOutput("event",t.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}ir.title="Filter Event",ir.desc="Blocks events that do not match the filter",ir.prototype.onAction=function(cr,vr,mr){if(vr!=null&&!(this.properties.equal_to&&this.properties.equal_to!=vr)){if(this.properties.has_property){var dr=vr[this.properties.has_property];if(dr==null||this.properties.property_equal_to&&this.properties.property_equal_to!=dr)return}this.triggerSlot(0,vr,null,mr)}},t.registerNodeType("events/filter",ir);function sr(){this.addInput("in",t.ACTION),this.addInput("cond","boolean"),this.addOutput("true",t.EVENT),this.addOutput("false",t.EVENT),this.size=[120,60],this._value=!1}sr.title="Branch",sr.desc="If condition is true, outputs triggers true, otherwise false",sr.prototype.onExecute=function(){this._value=this.getInputData(1)},sr.prototype.onAction=function(cr,vr,mr){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,vr,null,mr)},t.registerNodeType("events/branch",sr);function rr(){this.addInput("inc",t.ACTION),this.addInput("dec",t.ACTION),this.addInput("reset",t.ACTION),this.addOutput("change",t.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}rr.title="Counter",rr.desc="Counts events",rr.prototype.getTitle=function(){return this.flags.collapsed?String(this.num):this.title},rr.prototype.onAction=function(cr,vr,mr){var dr=this.num;cr=="inc"?this.num+=1:cr=="dec"?this.num-=1:cr=="reset"&&(this.num=0),this.num!=dr&&this.trigger("change",this.num)},rr.prototype.onDrawBackground=function(cr){this.flags.collapsed||(cr.fillStyle="#AAA",cr.font="20px Arial",cr.textAlign="center",cr.fillText(this.num,this.size[0]*.5,this.size[1]*.5))},rr.prototype.onExecute=function(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)},t.registerNodeType("events/counter",rr);function nr(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",t.ACTION),this.addOutput("on_time",t.EVENT),this._pending=[]}nr.title="Delay",nr.desc="Delays one event",nr.prototype.onAction=function(cr,vr,mr){var dr=this.properties.time_in_ms;dr<=0?this.trigger(null,vr,mr):this._pending.push([dr,vr])},nr.prototype.onExecute=function(cr,vr){var mr=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var dr=0;dr<this._pending.length;++dr){var lr=this._pending[dr];lr[0]-=mr,!(lr[0]>0)&&(this._pending.splice(dr,1),--dr,this.trigger(null,lr[1],vr))}},nr.prototype.onGetInputs=function(){return[["event",t.ACTION],["time_in_ms","number"]]},t.registerNodeType("events/delay",nr);function ar(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",t.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}ar.title="Timer",ar.desc="Sends an event every N milliseconds",ar.prototype.onStart=function(){this.time=0},ar.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},ar.on_color="#AAA",ar.off_color="#222",ar.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?ar.on_color:ar.off_color,this.triggered=!1},ar.prototype.onExecute=function(){var cr=this.graph.elapsed_time*1e3,vr=this.time==0;if(this.time+=cr,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!vr&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)},ar.prototype.onGetInputs=function(){return[["interval","number"]]},ar.prototype.onGetOutputs=function(){return[["tick","boolean"]]},t.registerNodeType("events/timer",ar);function or(){this.addInput("go",t.ACTION),this.addInput("green",t.ACTION),this.addInput("red",t.ACTION),this.addOutput("continue",t.EVENT),this.addOutput("blocked",t.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var cr=this;this.addWidget("button","reset","",function(){cr._ready=!1})}or.title="Semaphore Event",or.desc="Until both events are not triggered, it doesnt continue.",or.prototype.onExecute=function(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"},or.prototype.onAction=function(cr,vr){cr=="go"?this.triggerSlot(this._ready?0:1):cr=="green"?this._ready=!0:cr=="red"&&(this._ready=!1)},t.registerNodeType("events/semaphore",or);function ur(){this.addInput("in",t.ACTION),this.addInput("reset",t.ACTION),this.addOutput("out",t.EVENT),this._once=!1,this.properties={};var cr=this;this.addWidget("button","reset","",function(){cr._once=!1})}ur.title="Once",ur.desc="Only passes an event once, then gets locked",ur.prototype.onAction=function(cr,vr){cr=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,vr)):cr=="reset"&&(this._once=!1)},t.registerNodeType("events/once",ur);function hr(){this.addInput("data",0),this.addInput("assign",t.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var cr=this;this.addWidget("button","store","",function(){cr.properties.data=cr._last_value})}hr.title="Data Store",hr.desc="Stores data and only changes when event is received",hr.prototype.onExecute=function(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)},hr.prototype.onAction=function(cr,vr,mr){this.properties.data=this._last_value},hr.prototype.onSerialize=function(cr){cr.data!=null&&(this.properties.serialize==!1||cr.data.constructor!==String&&cr.data.constructor!==Number&&cr.data.constructor!==Boolean&&cr.data.constructor!==Array&&cr.data.constructor!==Object)&&(cr.data=null)},t.registerNodeType("basic/data_store",hr)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.addOutput("",t.EVENT),this.addOutput("","boolean"),this.addProperty("text","click me"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}n.title="Button",n.desc="Triggers an event",n.font="Arial",n.prototype.onDrawForeground=function(or){if(!this.flags.collapsed){var ur=10;if(or.fillStyle="black",or.fillRect(ur+1,ur+1,this.size[0]-ur*2,this.size[1]-ur*2),or.fillStyle="#AAF",or.fillRect(ur-1,ur-1,this.size[0]-ur*2,this.size[1]-ur*2),or.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",or.fillRect(ur,ur,this.size[0]-ur*2,this.size[1]-ur*2),this.properties.text||this.properties.text===0){var hr=this.properties.font_size||30;or.textAlign="center",or.fillStyle=this.clicked?"black":"white",or.font=hr+"px "+n.font,or.fillText(this.properties.text,this.size[0]*.5,this.size[1]*.5+hr*.3),or.textAlign="left"}}},n.prototype.onMouseDown=function(or,ur){if(ur[0]>1&&ur[1]>1&&ur[0]<this.size[0]-2&&ur[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0},n.prototype.onExecute=function(){this.setOutputData(1,this.clicked)},n.prototype.onMouseUp=function(or){this.clicked=!1},t.registerNodeType("widget/button",n);function Ae(){this.addInput("","boolean"),this.addInput("e",t.ACTION),this.addOutput("v","boolean"),this.addOutput("e",t.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}Ae.title="Toggle",Ae.desc="Toggles between true or false",Ae.prototype.onDrawForeground=function(or){if(!this.flags.collapsed){var ur=this.size[1]*.5,hr=.25,cr=this.size[1]*.8;or.font=this.properties.font||(ur*.8).toFixed(0)+"px Arial";var vr=or.measureText(this.title).width,mr=(this.size[0]-(vr+ur))*.5;or.fillStyle="#AAA",or.fillRect(mr,cr-ur,ur,ur),or.fillStyle=this.properties.value?"#AEF":"#000",or.fillRect(mr+ur*hr,cr-ur+ur*hr,ur*(1-hr*2),ur*(1-hr*2)),or.textAlign="left",or.fillStyle="#AAA",or.fillText(this.title,ur*1.2+mr,cr*.85),or.textAlign="left"}},Ae.prototype.onAction=function(or){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},Ae.prototype.onExecute=function(){var or=this.getInputData(0);or!=null&&(this.properties.value=or),this.setOutputData(0,this.properties.value)},Ae.prototype.onMouseDown=function(or,ur){if(ur[0]>1&&ur[1]>1&&ur[0]<this.size[0]-2&&ur[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},t.registerNodeType("widget/toggle",Ae);function Ne(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}Ne.title="Number",Ne.desc="Widget to select number value",Ne.pixels_threshold=10,Ne.markers_color="#666",Ne.prototype.onDrawForeground=function(or){var ur=this.size[0]*.5,hr=this.size[1];hr>30?(or.fillStyle=Ne.markers_color,or.beginPath(),or.moveTo(ur,hr*.1),or.lineTo(ur+hr*.1,hr*.2),or.lineTo(ur+hr*-.1,hr*.2),or.fill(),or.beginPath(),or.moveTo(ur,hr*.9),or.lineTo(ur+hr*.1,hr*.8),or.lineTo(ur+hr*-.1,hr*.8),or.fill(),or.font=(hr*.7).toFixed(1)+"px Arial"):or.font=(hr*.8).toFixed(1)+"px Arial",or.textAlign="center",or.font=(hr*.7).toFixed(1)+"px Arial",or.fillStyle="#EEE",or.fillText(this.properties.value.toFixed(this._precision),ur,hr*.75)},Ne.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},Ne.prototype.onPropertyChanged=function(or,ur){var hr=(this.properties.step+"").split(".");this._precision=hr.length>1?hr[1].length:0},Ne.prototype.onMouseDown=function(or,ur){if(!(ur[1]<0))return this.old_y=or.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},Ne.prototype.onMouseMove=function(or){if(this.mouse_captured){var ur=this.old_y-or.canvasY;or.shiftKey&&(ur*=10),(or.metaKey||or.altKey)&&(ur*=.1),this.old_y=or.canvasY;var hr=this._remainder+ur/Ne.pixels_threshold;this._remainder=hr%1,hr=hr|0;var cr=clamp(this.properties.value+hr*this.properties.step,this.properties.min,this.properties.max);this.properties.value=cr,this.graph._version++,this.setDirtyCanvas(!0)}},Ne.prototype.onMouseUp=function(or,ur){if(or.click_time<200){var hr=ur[1]>this.size[1]*.5?-1:1;this.properties.value=clamp(this.properties.value+hr*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},t.registerNodeType("widget/number",Ne);function tr(){this.addOutput("","string"),this.addOutput("change",t.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var or=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,function(ur){or.properties.value=ur,or.triggerSlot(1,ur)},{property:"value",values:this._values})}tr.title="Combo",tr.desc="Widget to select from a list",tr.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},tr.prototype.onPropertyChanged=function(or,ur){or=="values"?(this._values=ur.split(";"),this.widget.options.values=this._values):or=="value"&&(this.widget.value=ur)},t.registerNodeType("widget/combo",tr);function er(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}er.title="Knob",er.desc="Circular controller",er.size=[80,100],er.prototype.onDrawForeground=function(or){if(!this.flags.collapsed){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var ur=this.size[0]*.5,hr=this.size[1]*.5,cr=Math.min(this.size[0],this.size[1])*.5-5;or.globalAlpha=1,or.save(),or.translate(ur,hr),or.rotate(Math.PI*.75),or.fillStyle="rgba(0,0,0,0.5)",or.beginPath(),or.moveTo(0,0),or.arc(0,0,cr,0,Math.PI*1.5),or.fill(),or.strokeStyle="black",or.fillStyle=this.properties.color,or.lineWidth=2,or.beginPath(),or.moveTo(0,0),or.arc(0,0,cr-4,0,Math.PI*1.5*Math.max(.01,this.value)),or.closePath(),or.fill(),or.lineWidth=1,or.globalAlpha=1,or.restore(),or.fillStyle="black",or.beginPath(),or.arc(ur,hr,cr*.75,0,Math.PI*2,!0),or.fill(),or.fillStyle=this.mouseOver?"white":this.properties.color,or.beginPath();var vr=this.value*Math.PI*1.5+Math.PI*.75;or.arc(ur+Math.cos(vr)*cr*.65,hr+Math.sin(vr)*cr*.65,cr*.05,0,Math.PI*2,!0),or.fill(),or.fillStyle=this.mouseOver?"white":"#AAA",or.font=Math.floor(cr*.5)+"px Arial",or.textAlign="center",or.fillText(this.properties.value.toFixed(this.properties.precision),ur,hr+cr*.15)}},er.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=t.colorToString([this.value,this.value,this.value])},er.prototype.onMouseDown=function(or){return this.center=[this.size[0]*.5,this.size[1]*.5+20],this.radius=this.size[0]*.5,or.canvasY-this.pos[1]<20||t.distance([or.canvasX,or.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius?!1:(this.oldmouse=[or.canvasX-this.pos[0],or.canvasY-this.pos[1]],this.captureInput(!0),!0)},er.prototype.onMouseMove=function(or){if(this.oldmouse){var ur=[or.canvasX-this.pos[0],or.canvasY-this.pos[1]],hr=this.value;hr-=(ur[1]-this.oldmouse[1])*.01,hr>1?hr=1:hr<0&&(hr=0),this.value=hr,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=ur,this.setDirtyCanvas(!0)}},er.prototype.onMouseUp=function(or){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},er.prototype.onPropertyChanged=function(or,ur){if(or=="min"||or=="max"||or=="value")return this.properties[or]=parseFloat(ur),!0},t.registerNodeType("widget/knob",er);function ir(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var or=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,function(ur){or.properties.value=ur},this.properties),this.widgets_up=!0}ir.title="Inner Slider",ir.prototype.onPropertyChanged=function(or,ur){or=="value"&&(this.slider.value=ur)},ir.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},t.registerNodeType("widget/internal_slider",ir);function sr(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}sr.title="H.Slider",sr.desc="Linear slider controller",sr.prototype.onDrawForeground=function(or){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),or.globalAlpha=1,or.lineWidth=1,or.fillStyle="#000",or.fillRect(2,2,this.size[0]-4,this.size[1]-4),or.fillStyle=this.properties.color,or.beginPath(),or.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),or.fill()},sr.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=t.colorToString([this.value,this.value,this.value])},sr.prototype.onMouseDown=function(or){return or.canvasY-this.pos[1]<0?!1:(this.oldmouse=[or.canvasX-this.pos[0],or.canvasY-this.pos[1]],this.captureInput(!0),!0)},sr.prototype.onMouseMove=function(or){if(this.oldmouse){var ur=[or.canvasX-this.pos[0],or.canvasY-this.pos[1]],hr=this.value,cr=ur[0]-this.oldmouse[0];hr+=cr/this.size[0],hr>1?hr=1:hr<0&&(hr=0),this.value=hr,this.oldmouse=ur,this.setDirtyCanvas(!0)}},sr.prototype.onMouseUp=function(or){this.oldmouse=null,this.captureInput(!1)},sr.prototype.onMouseLeave=function(or){},t.registerNodeType("widget/hslider",sr);function rr(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}rr.title="Progress",rr.desc="Shows data in linear progress",rr.prototype.onExecute=function(){var or=this.getInputData(0);or!=null&&(this.properties.value=or)},rr.prototype.onDrawForeground=function(or){or.lineWidth=1,or.fillStyle=this.properties.color;var ur=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);ur=Math.min(1,ur),ur=Math.max(0,ur),or.fillRect(2,2,(this.size[0]-4)*ur,this.size[1]-4)},t.registerNodeType("widget/progress",rr);function nr(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}nr.title="Text",nr.desc="Shows the input value",nr.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],nr.prototype.onDrawForeground=function(or){or.fillStyle=this.properties.color;var ur=this.properties.value;this.properties.glowSize?(or.shadowColor=this.properties.color,or.shadowOffsetX=0,or.shadowOffsetY=0,or.shadowBlur=this.properties.glowSize):or.shadowColor="transparent";var hr=this.properties.fontsize;if(or.textAlign=this.properties.align,or.font=hr.toString()+"px "+this.properties.font,this.str=typeof ur=="number"?ur.toFixed(this.properties.decimals):ur,typeof this.str=="string")for(var cr=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),vr=0;vr<cr.length;vr++)or.fillText(cr[vr],this.properties.align=="left"?15:this.size[0]-15,hr*-.15+hr*(parseInt(vr)+1));or.shadowColor="transparent",this.last_ctx=or,or.textAlign="left"},nr.prototype.onExecute=function(){var or=this.getInputData(0);or!=null&&(this.properties.value=or)},nr.prototype.resize=function(){if(this.last_ctx){var or=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var ur=0,hr=0;hr<or.length;hr++){var cr=this.last_ctx.measureText(or[hr]).width;ur<cr&&(ur=cr)}this.size[0]=ur+20,this.size[1]=4+or.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},nr.prototype.onPropertyChanged=function(or,ur){return this.properties[or]=ur,this.str=typeof ur=="number"?ur.toFixed(3):ur,!0},t.registerNodeType("widget/text",nr);function ar(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}ar.title="Panel",ar.desc="Non interactive panel",ar.widgets=[{name:"update",text:"Update",type:"button"}],ar.prototype.createGradient=function(or){if(this.properties.bgcolorTop==""||this.properties.bgcolorBottom==""){this.lineargradient=0;return}this.lineargradient=or.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)},ar.prototype.onDrawForeground=function(or){this.flags.collapsed||(this.lineargradient==null&&this.createGradient(or),this.lineargradient&&(or.lineWidth=1,or.strokeStyle=this.properties.borderColor,or.fillStyle=this.lineargradient,this.properties.shadowSize?(or.shadowColor="#000",or.shadowOffsetX=0,or.shadowOffsetY=0,or.shadowBlur=this.properties.shadowSize):or.shadowColor="transparent",or.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),or.fill(),or.shadowColor="transparent",or.stroke()))},t.registerNodeType("widget/panel",ar)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",t.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}n.title="Gamepad",n.desc="gets the input of the gamepad",n.CENTER=0,n.LEFT=1,n.RIGHT=2,n.UP=4,n.DOWN=8,n.zero=new Float32Array(2),n.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],n.prototype.onExecute=function(){var Ae=this.getGamepad(),Ne=this.properties.threshold||0;if(Ae&&(this._left_axis[0]=Math.abs(Ae.xbox.axes.lx)>Ne?Ae.xbox.axes.lx:0,this._left_axis[1]=Math.abs(Ae.xbox.axes.ly)>Ne?Ae.xbox.axes.ly:0,this._right_axis[0]=Math.abs(Ae.xbox.axes.rx)>Ne?Ae.xbox.axes.rx:0,this._right_axis[1]=Math.abs(Ae.xbox.axes.ry)>Ne?Ae.xbox.axes.ry:0,this._triggers[0]=Math.abs(Ae.xbox.axes.ltrigger)>Ne?Ae.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(Ae.xbox.axes.rtrigger)>Ne?Ae.xbox.axes.rtrigger:0),this.outputs)for(var tr=0;tr<this.outputs.length;tr++){var er=this.outputs[tr];if(!(!er.links||!er.links.length)){var ir=null;if(Ae)switch(er.name){case"left_axis":ir=this._left_axis;break;case"right_axis":ir=this._right_axis;break;case"left_x_axis":ir=this._left_axis[0];break;case"left_y_axis":ir=this._left_axis[1];break;case"right_x_axis":ir=this._right_axis[0];break;case"right_y_axis":ir=this._right_axis[1];break;case"trigger_left":ir=this._triggers[0];break;case"trigger_right":ir=this._triggers[1];break;case"a_button":ir=Ae.xbox.buttons.a?1:0;break;case"b_button":ir=Ae.xbox.buttons.b?1:0;break;case"x_button":ir=Ae.xbox.buttons.x?1:0;break;case"y_button":ir=Ae.xbox.buttons.y?1:0;break;case"lb_button":ir=Ae.xbox.buttons.lb?1:0;break;case"rb_button":ir=Ae.xbox.buttons.rb?1:0;break;case"ls_button":ir=Ae.xbox.buttons.ls?1:0;break;case"rs_button":ir=Ae.xbox.buttons.rs?1:0;break;case"hat_left":ir=Ae.xbox.hatmap&n.LEFT;break;case"hat_right":ir=Ae.xbox.hatmap&n.RIGHT;break;case"hat_up":ir=Ae.xbox.hatmap&n.UP;break;case"hat_down":ir=Ae.xbox.hatmap&n.DOWN;break;case"hat":ir=Ae.xbox.hatmap;break;case"start_button":ir=Ae.xbox.buttons.start?1:0;break;case"back_button":ir=Ae.xbox.buttons.back?1:0;break;case"button_pressed":for(var sr=0;sr<this._current_buttons.length;++sr)this._current_buttons[sr]&&!this._previous_buttons[sr]&&this.triggerSlot(tr,n.buttons[sr]);break}else switch(er.name){case"button_pressed":break;case"left_axis":case"right_axis":ir=n.zero;break;default:ir=0}this.setOutputData(tr,ir)}}},n.mapping={a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11},n.mapping_array=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"],n.prototype.getGamepad=function(){var Ae=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!Ae)return null;var Ne=Ae.call(navigator),tr=null;this._previous_buttons.set(this._current_buttons);for(var er=this.properties.gamepad_index;er<4;er++)if(Ne[er]){tr=Ne[er];var ir=this.xbox_mapping;ir||(ir=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:n.CENTER}),ir.axes.lx=tr.axes[0],ir.axes.ly=tr.axes[1],ir.axes.rx=tr.axes[2],ir.axes.ry=tr.axes[3],ir.axes.ltrigger=tr.buttons[6].value,ir.axes.rtrigger=tr.buttons[7].value,ir.hat="",ir.hatmap=n.CENTER;for(var sr=0;sr<tr.buttons.length;sr++)if(this._current_buttons[sr]=tr.buttons[sr].pressed,sr<12)ir.buttons[n.mapping_array[sr]]=tr.buttons[sr].pressed,tr.buttons[sr].was_pressed&&this.trigger(n.mapping_array[sr]+"_button_event");else switch(sr){case 12:tr.buttons[sr].pressed&&(ir.hat+="up",ir.hatmap|=n.UP);break;case 13:tr.buttons[sr].pressed&&(ir.hat+="down",ir.hatmap|=n.DOWN);break;case 14:tr.buttons[sr].pressed&&(ir.hat+="left",ir.hatmap|=n.LEFT);break;case 15:tr.buttons[sr].pressed&&(ir.hat+="right",ir.hatmap|=n.RIGHT);break;case 16:ir.buttons.home=tr.buttons[sr].pressed;break}return tr.xbox=ir,tr}},n.prototype.onDrawBackground=function(Ae){if(!this.flags.collapsed){var Ne=this._left_axis,tr=this._right_axis;Ae.strokeStyle="#88A",Ae.strokeRect((Ne[0]+1)*.5*this.size[0]-4,(Ne[1]+1)*.5*this.size[1]-4,8,8),Ae.strokeStyle="#8A8",Ae.strokeRect((tr[0]+1)*.5*this.size[0]-4,(tr[1]+1)*.5*this.size[1]-4,8,8);var er=this.size[1]/this._current_buttons.length;Ae.fillStyle="#AEB";for(var ir=0;ir<this._current_buttons.length;++ir)this._current_buttons[ir]&&Ae.fillRect(0,er*ir,6,er)}},n.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",t.EVENT],["b_button_event",t.EVENT],["x_button_event",t.EVENT],["y_button_event",t.EVENT],["lb_button_event",t.EVENT],["rb_button_event",t.EVENT],["ls_button_event",t.EVENT],["rs_button_event",t.EVENT],["start_button_event",t.EVENT],["back_button_event",t.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",t.EVENT]]},t.registerNodeType("input/gamepad",n)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}n.title="Converter",n.desc="type A to type B",n.prototype.onExecute=function(){var _r=this.getInputData(0);if(_r!=null&&this.outputs)for(var Nr=0;Nr<this.outputs.length;Nr++){var Tr=this.outputs[Nr];if(!(!Tr.links||!Tr.links.length)){var Lr=null;switch(Tr.name){case"number":Lr=_r.length?_r[0]:parseFloat(_r);break;case"vec2":case"vec3":case"vec4":var Lr=null,Ir=1;switch(Tr.name){case"vec2":Ir=2;break;case"vec3":Ir=3;break;case"vec4":Ir=4;break}var Lr=new Float32Array(Ir);if(_r.length)for(var Gr=0;Gr<_r.length&&Gr<Lr.length;Gr++)Lr[Gr]=_r[Gr];else Lr[0]=parseFloat(_r);break}this.setOutputData(Nr,Lr)}}},n.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},t.registerNodeType("math/converter",n);function Ae(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}Ae.title="Bypass",Ae.desc="removes the type",Ae.prototype.onExecute=function(){var _r=this.getInputData(0);this.setOutputData(0,_r)},t.registerNodeType("math/bypass",Ae);function Ne(){this.addInput("in"),this.addOutput("out")}Ne.title="to Number",Ne.desc="Cast to number",Ne.prototype.onExecute=function(){var _r=this.getInputData(0);this.setOutputData(0,Number(_r))},t.registerNodeType("math/to_number",Ne);function tr(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}tr.title="Range",tr.desc="Convert a number from one range to another",tr.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},tr.prototype.onExecute=function(){if(this.inputs)for(var _r=0;_r<this.inputs.length;_r++){var Nr=this.inputs[_r],Tr=this.getInputData(_r);Tr!==void 0&&(this.properties[Nr.name]=Tr)}var Tr=this.properties.in;(Tr==null||Tr.constructor!==Number)&&(Tr=0);var Lr=this.properties.in_min,Ir=this.properties.in_max,Gr=this.properties.out_min,Br=this.properties.out_max;this._last_v=(Tr-Lr)/(Ir-Lr)*(Br-Gr)+Gr,this.setOutputData(0,this._last_v),this.setOutputData(1,clamp(this._last_v,Gr,Br))},tr.prototype.onDrawBackground=function(_r){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},tr.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},t.registerNodeType("math/range",tr);function er(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}er.title="Rand",er.desc="Random number",er.prototype.onExecute=function(){if(this.inputs)for(var _r=0;_r<this.inputs.length;_r++){var Nr=this.inputs[_r],Tr=this.getInputData(_r);Tr!==void 0&&(this.properties[Nr.name]=Tr)}var Lr=this.properties.min,Ir=this.properties.max;this._last_v=Math.random()*(Ir-Lr)+Lr,this.setOutputData(0,this._last_v)},er.prototype.onDrawBackground=function(_r){this.outputs[0].label=(this._last_v||0).toFixed(3)},er.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},t.registerNodeType("math/rand",er);function ir(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}ir.title="Noise",ir.desc="Random number with temporal continuity",ir.data=null,ir.getValue=function(Ir,Nr){if(!ir.data){ir.data=new Float32Array(1024);for(var Tr=0;Tr<ir.data.length;++Tr)ir.data[Tr]=Math.random()}Ir=Ir%1024,Ir<0&&(Ir+=1024);var Lr=Math.floor(Ir),Ir=Ir-Lr,Gr=ir.data[Lr],Br=ir.data[Lr==1023?0:Lr+1];return Nr&&(Ir=Ir*Ir*Ir*(Ir*(Ir*6-15)+10)),Gr*(1-Ir)+Br*Ir},ir.prototype.onExecute=function(){var _r=this.getInputData(0)||0,Nr=this.properties.octaves||1,Tr=0,Lr=1,Ir=this.properties.seed||0;_r+=Ir;for(var Gr=this.properties.speed||1,Br=0,jr=0;jr<Nr&&(Tr+=ir.getValue(_r*(1+jr)*Gr,this.properties.smooth)*Lr,Br+=Lr,Lr*=this.properties.persistence,!(Lr<.001));++jr);Tr/=Br;var Yr=this.properties.min,to=this.properties.max;this._last_v=Tr*(to-Yr)+Yr,this.setOutputData(0,this._last_v)},ir.prototype.onDrawBackground=function(_r){this.outputs[0].label=(this._last_v||0).toFixed(3)},t.registerNodeType("math/noise",ir);function sr(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}sr.title="Spikes",sr.desc="spike every random time",sr.prototype.onExecute=function(){var _r=this.graph.elapsed_time;this._remaining_time-=_r,this._blink_time-=_r;var Nr=0;if(this._blink_time>0){var Tr=this._blink_time/this.properties.duration;Nr=1/(Math.pow(Tr*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,Nr)},t.registerNodeType("math/spikes",sr);function rr(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}rr.title="Clamp",rr.desc="Clamp number between min and max",rr.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&(_r=Math.max(this.properties.min,_r),_r=Math.min(this.properties.max,_r),this.setOutputData(0,_r))},rr.prototype.getCode=function(_r){var Nr="";return this.isInputConnected(0)&&(Nr+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),Nr},t.registerNodeType("math/clamp",rr);function nr(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}nr.title="Lerp",nr.desc="Linear Interpolation",nr.prototype.onExecute=function(){var _r=this.getInputData(0);_r==null&&(_r=0);var Nr=this.getInputData(1);Nr==null&&(Nr=0);var Tr=this.properties.f,Lr=this.getInputData(2);Lr!==void 0&&(Tr=Lr),this.setOutputData(0,_r*(1-Tr)+Nr*Tr)},nr.prototype.onGetInputs=function(){return[["f","number"]]},t.registerNodeType("math/lerp",nr);function ar(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}ar.title="Abs",ar.desc="Absolute",ar.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&this.setOutputData(0,Math.abs(_r))},t.registerNodeType("math/abs",ar);function or(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}or.title="Floor",or.desc="Floor number to remove fractional part",or.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&this.setOutputData(0,Math.floor(_r))},t.registerNodeType("math/floor",or);function ur(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}ur.title="Frac",ur.desc="Returns fractional part",ur.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&this.setOutputData(0,_r%1)},t.registerNodeType("math/frac",ur);function hr(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}hr.title="Smoothstep",hr.desc="Smoothstep",hr.prototype.onExecute=function(){var _r=this.getInputData(0);if(_r!==void 0){var Nr=this.properties.A,Tr=this.properties.B;_r=clamp((_r-Nr)/(Tr-Nr),0,1),_r=_r*_r*(3-2*_r),this.setOutputData(0,_r)}},t.registerNodeType("math/smoothstep",hr);function cr(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}cr.title="Scale",cr.desc="v * factor",cr.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&this.setOutputData(0,_r*this.properties.factor)},t.registerNodeType("math/scale",cr);function vr(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}vr.title="Gate",vr.desc="if v is true, then outputs A, otherwise B",vr.prototype.onExecute=function(){var _r=this.getInputData(0);this.setOutputData(0,this.getInputData(_r?1:2))},t.registerNodeType("math/gate",vr);function mr(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}mr.title="Average",mr.desc="Average Filter",mr.prototype.onExecute=function(){var _r=this.getInputData(0);_r==null&&(_r=0);var Nr=this._values.length;this._values[this._current%Nr]=_r,this._current+=1,this._current>Nr&&(this._current=0);for(var Tr=0,Lr=0;Lr<Nr;++Lr)Tr+=this._values[Lr];this.setOutputData(0,Tr/Nr)},mr.prototype.onPropertyChanged=function(_r,Nr){Nr<1&&(Nr=1),this.properties.samples=Math.round(Nr);var Tr=this._values;this._values=new Float32Array(this.properties.samples),Tr.length<=this._values.length?this._values.set(Tr):this._values.set(Tr.subarray(0,this._values.length))},t.registerNodeType("math/average",mr);function dr(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}dr.title="TendTo",dr.desc="moves the output value always closer to the input",dr.prototype.onExecute=function(){var _r=this.getInputData(0);_r==null&&(_r=0);var Nr=this.properties.factor;this._value==null?this._value=_r:this._value=this._value*(1-Nr)+_r*Nr,this.setOutputData(0,this._value)},t.registerNodeType("math/tendTo",dr);function lr(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:lr.values}),this._func=lr.funcs[this.properties.OP],this._result=[]}lr.values=["+","-","*","/","%","^","max","min"],lr.funcs={"+":function(_r,Nr){return _r+Nr},"-":function(_r,Nr){return _r-Nr},x:function(_r,Nr){return _r*Nr},X:function(_r,Nr){return _r*Nr},"*":function(_r,Nr){return _r*Nr},"/":function(_r,Nr){return _r/Nr},"%":function(_r,Nr){return _r%Nr},"^":function(_r,Nr){return Math.pow(_r,Nr)},max:function(_r,Nr){return Math.max(_r,Nr)},min:function(_r,Nr){return Math.min(_r,Nr)}},lr.title="Operation",lr.desc="Easy math operators",lr["@OP"]={type:"enum",title:"operation",values:lr.values},lr.size=[100,60],lr.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},lr.prototype.setValue=function(_r){typeof _r=="string"&&(_r=parseFloat(_r)),this.properties.value=_r},lr.prototype.onPropertyChanged=function(_r,Nr){_r=="OP"&&(this._func=lr.funcs[this.properties.OP],this._func||(console.warn("Unknown operation: "+this.properties.OP),this._func=function(Tr){return Tr}))},lr.prototype.onExecute=function(){var _r=this.getInputData(0),Nr=this.getInputData(1);_r!=null?_r.constructor===Number&&(this.properties.A=_r):_r=this.properties.A,Nr!=null?this.properties.B=Nr:Nr=this.properties.B;var Tr=lr.funcs[this.properties.OP],Lr;if(_r.constructor===Number)Lr=0,Lr=Tr(_r,Nr);else if(_r.constructor===Array){Lr=this._result,Lr.length=_r.length;for(var Ir=0;Ir<_r.length;++Ir)Lr[Ir]=Tr(_r[Ir],Nr)}else{Lr={};for(var Ir in _r)Lr[Ir]=Tr(_r[Ir],Nr)}this.setOutputData(0,Lr)},lr.prototype.onDrawBackground=function(_r){this.flags.collapsed||(_r.font="40px Arial",_r.fillStyle="#666",_r.textAlign="center",_r.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+t.NODE_TITLE_HEIGHT)*.5),_r.textAlign="left")},t.registerNodeType("math/operation",lr),t.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),t.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});function gr(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}gr.title="Compare",gr.desc="compares between two values",gr.prototype.onExecute=function(){var _r=this.getInputData(0),Nr=this.getInputData(1);_r!==void 0?this.properties.A=_r:_r=this.properties.A,Nr!==void 0?this.properties.B=Nr:Nr=this.properties.B;for(var Tr=0,Lr=this.outputs.length;Tr<Lr;++Tr){var Ir=this.outputs[Tr];if(!(!Ir.links||!Ir.links.length)){var Gr;switch(Ir.name){case"A==B":Gr=_r==Nr;break;case"A!=B":Gr=_r!=Nr;break;case"A>B":Gr=_r>Nr;break;case"A<B":Gr=_r<Nr;break;case"A<=B":Gr=_r<=Nr;break;case"A>=B":Gr=_r>=Nr;break}this.setOutputData(Tr,Gr)}}},gr.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},t.registerNodeType("math/compare",gr),t.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),t.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),t.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),t.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),t.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),t.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});function fr(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:fr.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:fr.values}),this.size=[80,60]}fr.values=[">","<","==","!=","<=",">=","||","&&"],fr["@OP"]={type:"enum",title:"operation",values:fr.values},fr.title="Condition",fr.desc="evaluates condition between A and B",fr.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},fr.prototype.onExecute=function(){var _r=this.getInputData(0);_r===void 0?_r=this.properties.A:this.properties.A=_r;var Nr=this.getInputData(1);Nr===void 0?Nr=this.properties.B:this.properties.B=Nr;var Tr=!0;switch(this.properties.OP){case">":Tr=_r>Nr;break;case"<":Tr=_r<Nr;break;case"==":Tr=_r==Nr;break;case"!=":Tr=_r!=Nr;break;case"<=":Tr=_r<=Nr;break;case">=":Tr=_r>=Nr;break;case"||":Tr=_r||Nr;break;case"&&":Tr=_r&&Nr;break}this.setOutputData(0,Tr),this.setOutputData(1,!Tr)},t.registerNodeType("math/condition",fr);function yr(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}yr.title="Branch",yr.desc="If condition is true, outputs IN in true, otherwise in false",yr.prototype.onExecute=function(){var _r=this.getInputData(0),Nr=this.getInputData(1);Nr?(this.setOutputData(0,_r),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,_r))},t.registerNodeType("math/branch",yr);function Er(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}Er.title="Accumulate",Er.desc="Increments a value every time",Er.prototype.onExecute=function(){this.properties.value===null&&(this.properties.value=0);var _r=this.getInputData(0);_r!==null?this.properties.value+=_r:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)},t.registerNodeType("math/accumulate",Er);function wr(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}wr.title="Trigonometry",wr.desc="Sin Cos Tan",wr.prototype.onExecute=function(){var _r=this.getInputData(0);_r==null&&(_r=0);var Nr=this.properties.amplitude,Tr=this.findInputSlot("amplitude");Tr!=-1&&(Nr=this.getInputData(Tr));var Lr=this.properties.offset;Tr=this.findInputSlot("offset"),Tr!=-1&&(Lr=this.getInputData(Tr));for(var Ir=0,Gr=this.outputs.length;Ir<Gr;++Ir){var Br=this.outputs[Ir],jr;switch(Br.name){case"sin":jr=Math.sin(_r);break;case"cos":jr=Math.cos(_r);break;case"tan":jr=Math.tan(_r);break;case"asin":jr=Math.asin(_r);break;case"acos":jr=Math.acos(_r);break;case"atan":jr=Math.atan(_r);break}this.setOutputData(Ir,Nr*jr+Lr)}},wr.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},wr.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},t.registerNodeType("math/trigonometry",wr),t.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),t.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),t.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});function Dr(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(_r,Nr,Tr){Tr.properties.formula=_r}),this.addWidget("toggle","allow",t.allow_scripts,function(_r){t.allow_scripts=_r}),this._func=null}Dr.title="Formula",Dr.desc="Compute formula",Dr.size=[160,100],mr.prototype.onPropertyChanged=function(_r,Nr){_r=="formula"&&(this.code_widget.value=Nr)},Dr.prototype.onExecute=function(){if(t.allow_scripts){var _r=this.getInputData(0),Nr=this.getInputData(1);_r!=null?this.properties.x=_r:_r=this.properties.x,Nr!=null?this.properties.y=Nr:Nr=this.properties.y,this.properties.formula;var Tr;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),Tr=this._func(_r,Nr,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,Tr)}},Dr.prototype.getTitle=function(){return this._func_code||"Formula"},Dr.prototype.onDrawBackground=function(){var _r=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=_r)},t.registerNodeType("math/formula",Dr);function kr(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}kr.title="Vec2->XY",kr.desc="vector 2 to components",kr.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&(this.setOutputData(0,_r[0]),this.setOutputData(1,_r[1]))},t.registerNodeType("math3d/vec2-to-xy",kr);function zr(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}zr.title="XY->Vec2",zr.desc="components to vector2",zr.prototype.onExecute=function(){var _r=this.getInputData(0);_r==null&&(_r=this.properties.x);var Nr=this.getInputData(1);Nr==null&&(Nr=this.properties.y);var Tr=this._data;Tr[0]=_r,Tr[1]=Nr,this.setOutputData(0,Tr)},t.registerNodeType("math3d/xy-to-vec2",zr);function Vr(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}Vr.title="Vec3->XYZ",Vr.desc="vector 3 to components",Vr.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&(this.setOutputData(0,_r[0]),this.setOutputData(1,_r[1]),this.setOutputData(2,_r[2]))},t.registerNodeType("math3d/vec3-to-xyz",Vr);function Hr(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}Hr.title="XYZ->Vec3",Hr.desc="components to vector3",Hr.prototype.onExecute=function(){var _r=this.getInputData(0);_r==null&&(_r=this.properties.x);var Nr=this.getInputData(1);Nr==null&&(Nr=this.properties.y);var Tr=this.getInputData(2);Tr==null&&(Tr=this.properties.z);var Lr=this._data;Lr[0]=_r,Lr[1]=Nr,Lr[2]=Tr,this.setOutputData(0,Lr)},t.registerNodeType("math3d/xyz-to-vec3",Hr);function Sr(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}Sr.title="Vec4->XYZW",Sr.desc="vector 4 to components",Sr.prototype.onExecute=function(){var _r=this.getInputData(0);_r!=null&&(this.setOutputData(0,_r[0]),this.setOutputData(1,_r[1]),this.setOutputData(2,_r[2]),this.setOutputData(3,_r[3]))},t.registerNodeType("math3d/vec4-to-xyzw",Sr);function Ar(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}Ar.title="XYZW->Vec4",Ar.desc="components to vector4",Ar.prototype.onExecute=function(){var _r=this.getInputData(0);_r==null&&(_r=this.properties.x);var Nr=this.getInputData(1);Nr==null&&(Nr=this.properties.y);var Tr=this.getInputData(2);Tr==null&&(Tr=this.properties.z);var Lr=this.getInputData(3);Lr==null&&(Lr=this.properties.w);var Ir=this._data;Ir[0]=_r,Ir[1]=Nr,Ir[2]=Tr,Ir[3]=Lr,this.setOutputData(0,Ir)},t.registerNodeType("math3d/xyzw-to-vec4",Ar)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}n.title="mat4",n.temp_quat=new Float32Array([0,0,0,1]),n.temp_mat4=new Float32Array(16),n.temp_vec3=new Float32Array(3),n.prototype.onPropertyChanged=function(rr,nr){this._must_update=!0},n.prototype.onExecute=function(){var rr=this._result,nr=n.temp_quat,ar=n.temp_mat4,or=n.temp_vec3,ur=this.getInputData(0),hr=this.getInputData(1),cr=this.getInputData(2);(this._must_update||ur||hr||cr)&&(ur=ur||this.properties.T,hr=hr||this.properties.R,cr=cr||this.properties.S,mat4.identity(rr),mat4.translate(rr,rr,ur),this.properties.R_in_degrees?(or.set(hr),vec3.scale(or,or,DEG2RAD),quat.fromEuler(nr,or)):quat.fromEuler(nr,hr),mat4.fromQuat(ar,nr),mat4.multiply(rr,rr,ar),mat4.scale(rr,rr,cr)),this.setOutputData(0,rr)},t.registerNodeType("math3d/mat4",n);function Ae(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:Ae.values}),this._result=vec3.create()}Ae.values=["+","-","*","/","%","^","max","min","dot","cross"],t.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),t.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),Ae.title="Operation",Ae.desc="Easy math 3D operators",Ae["@OP"]={type:"enum",title:"operation",values:Ae.values},Ae.size=[100,60],Ae.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},Ae.prototype.onExecute=function(){var rr=this.getInputData(0),nr=this.getInputData(1);if(!(rr==null||nr==null)){rr.constructor===Number&&(rr=[rr,rr,rr]),nr.constructor===Number&&(nr=[nr,nr,nr]);var ar=this._result;switch(this.properties.OP){case"+":ar=vec3.add(ar,rr,nr);break;case"-":ar=vec3.sub(ar,rr,nr);break;case"x":case"X":case"*":ar=vec3.mul(ar,rr,nr);break;case"/":ar=vec3.div(ar,rr,nr);break;case"%":ar[0]=rr[0]%nr[0],ar[1]=rr[1]%nr[1],ar[2]=rr[2]%nr[2];break;case"^":ar[0]=Math.pow(rr[0],nr[0]),ar[1]=Math.pow(rr[1],nr[1]),ar[2]=Math.pow(rr[2],nr[2]);break;case"max":ar[0]=Math.max(rr[0],nr[0]),ar[1]=Math.max(rr[1],nr[1]),ar[2]=Math.max(rr[2],nr[2]);break;case"min":ar[0]=Math.min(rr[0],nr[0]),ar[1]=Math.min(rr[1],nr[1]),ar[2]=Math.min(rr[2],nr[2]);case"dot":ar=vec3.dot(rr,nr);break;case"cross":vec3.cross(ar,rr,nr);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,ar)}},Ae.prototype.onDrawBackground=function(rr){this.flags.collapsed||(rr.font="40px Arial",rr.fillStyle="#666",rr.textAlign="center",rr.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+t.NODE_TITLE_HEIGHT)*.5),rr.textAlign="left")},t.registerNodeType("math3d/operation",Ae);function Ne(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}Ne.title="vec3_scale",Ne.desc="scales the components of a vec3",Ne.prototype.onExecute=function(){var rr=this.getInputData(0);if(rr!=null){var nr=this.getInputData(1);nr==null&&(nr=this.properties.f);var ar=this._data;ar[0]=rr[0]*nr,ar[1]=rr[1]*nr,ar[2]=rr[2]*nr,this.setOutputData(0,ar)}},t.registerNodeType("math3d/vec3-scale",Ne);function tr(){this.addInput("in","vec3"),this.addOutput("out","number")}tr.title="vec3_length",tr.desc="returns the module of a vector",tr.prototype.onExecute=function(){var rr=this.getInputData(0);if(rr!=null){var nr=Math.sqrt(rr[0]*rr[0]+rr[1]*rr[1]+rr[2]*rr[2]);this.setOutputData(0,nr)}},t.registerNodeType("math3d/vec3-length",tr);function er(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}er.title="vec3_normalize",er.desc="returns the vector normalized",er.prototype.onExecute=function(){var rr=this.getInputData(0);if(rr!=null){var nr=Math.sqrt(rr[0]*rr[0]+rr[1]*rr[1]+rr[2]*rr[2]),ar=this._data;ar[0]=rr[0]/nr,ar[1]=rr[1]/nr,ar[2]=rr[2]/nr,this.setOutputData(0,ar)}},t.registerNodeType("math3d/vec3-normalize",er);function ir(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}ir.title="vec3_lerp",ir.desc="returns the interpolated vector",ir.prototype.onExecute=function(){var rr=this.getInputData(0);if(rr!=null){var nr=this.getInputData(1);if(nr!=null){var ar=this.getInputOrProperty("f"),or=this._data;or[0]=rr[0]*(1-ar)+nr[0]*ar,or[1]=rr[1]*(1-ar)+nr[1]*ar,or[2]=rr[2]*(1-ar)+nr[2]*ar,this.setOutputData(0,or)}}},t.registerNodeType("math3d/vec3-lerp",ir);function sr(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}if(sr.title="vec3_dot",sr.desc="returns the dot product",sr.prototype.onExecute=function(){var rr=this.getInputData(0);if(rr!=null){var nr=this.getInputData(1);if(nr!=null){var ar=rr[0]*nr[0]+rr[1]*nr[1]+rr[2]*nr[2];this.setOutputData(0,ar)}}},t.registerNodeType("math3d/vec3-dot",sr),s.glMatrix){let rr=function(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()},nr=function(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()},ar=function(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()},or=function(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()},ur=function(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}},hr=function(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()},cr=function(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()},vr=function(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()};rr.title="Quaternion",rr.desc="quaternion",rr.prototype.onExecute=function(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)},rr.prototype.onGetInputs=function(){return[["x","number"],["y","number"],["z","number"],["w","number"]]},t.registerNodeType("math3d/quaternion",rr),nr.title="Rotation",nr.desc="quaternion rotation",nr.prototype.onExecute=function(){var mr=this.getInputData(0);mr==null&&(mr=this.properties.angle);var dr=this.getInputData(1);dr==null&&(dr=this.properties.axis);var lr=quat.setAxisAngle(this._value,dr,mr*.0174532925);this.setOutputData(0,lr)},t.registerNodeType("math3d/rotation",nr),ar.title="Euler->Quat",ar.desc="Converts euler angles (in degrees) to quaternion",ar.prototype.onExecute=function(){var mr=this.getInputData(0);mr==null&&(mr=this.properties.euler),vec3.scale(this._degs,mr,DEG2RAD),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var dr=quat.fromEuler(this._value,this._degs);this.setOutputData(0,dr)},t.registerNodeType("math3d/euler_to_quat",ar),or.title="Euler->Quat",or.desc="Converts rotX,rotY,rotZ in degrees to quat",or.prototype.onExecute=function(){var mr=this.getInputData(0);mr&&(quat.toEuler(this._value,mr),vec3.scale(this._value,this._value,DEG2RAD),this.setOutputData(0,this._value))},t.registerNodeType("math3d/quat_to_euler",or),ur.title="Rot. Vec3",ur.desc="rotate a point",ur.prototype.onExecute=function(){var mr=this.getInputData(0);mr==null&&(mr=this.properties.vec);var dr=this.getInputData(1);dr==null?this.setOutputData(mr):this.setOutputData(0,vec3.transformQuat(vec3.create(),mr,dr))},t.registerNodeType("math3d/rotate_vec3",ur),hr.title="Mult. Quat",hr.desc="rotate quaternion",hr.prototype.onExecute=function(){var mr=this.getInputData(0);if(mr!=null){var dr=this.getInputData(1);if(dr!=null){var lr=quat.multiply(this._value,mr,dr);this.setOutputData(0,lr)}}},t.registerNodeType("math3d/mult-quat",hr),cr.title="Quat Slerp",cr.desc="quaternion spherical interpolation",cr.prototype.onExecute=function(){var mr=this.getInputData(0);if(mr!=null){var dr=this.getInputData(1);if(dr!=null){var lr=this.properties.factor;this.getInputData(2)!=null&&(lr=this.getInputData(2));var gr=quat.slerp(this._value,mr,dr,lr);this.setOutputData(0,gr)}}},t.registerNodeType("math3d/quat-slerp",cr),vr.title="Remap Range",vr.desc="remap a 3D range",vr.prototype.onExecute=function(){var mr=this.getInputData(0);mr&&this._value.set(mr);for(var dr=this.properties.range_min,lr=this.properties.range_max,gr=this.properties.target_min,fr=this.properties.target_max,yr=0;yr<3;++yr){var Er=lr[yr]-dr[yr];if(this._clamped[yr]=clamp(this._value[yr],dr[yr],lr[yr]),Er==0){this._value[yr]=(gr[yr]+fr[yr])*.5;continue}var wr=(this._value[yr]-dr[yr])/Er;this.properties.clamp&&(wr=clamp(wr,0,1));var Dr=fr[yr]-gr[yr];this._value[yr]=gr[yr]+wr*Dr}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)},t.registerNodeType("math3d/remap_range",vr)}else t.debug&&console.warn("No glmatrix found, some Math3D nodes may not work")}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(nr){if(nr&&nr.constructor===Object)try{return JSON.stringify(nr)}catch{return String(nr)}return String(nr)}t.wrapFunctionAsNode("string/toString",n,[""],"string");function Ae(nr,ar){return nr==ar}t.wrapFunctionAsNode("string/compare",Ae,["string","string"],"boolean");function Ne(nr,ar){return nr===void 0?ar:ar===void 0?nr:nr+ar}t.wrapFunctionAsNode("string/concatenate",Ne,["string","string"],"string");function tr(nr,ar){return nr===void 0||ar===void 0?!1:nr.indexOf(ar)!=-1}t.wrapFunctionAsNode("string/contains",tr,["string","string"],"boolean");function er(nr){return nr!=null&&nr.constructor===String?nr.toUpperCase():nr}t.wrapFunctionAsNode("string/toUpperCase",er,["string"],"string");function ir(nr,ar){if(ar==null&&(ar=this.properties.separator),nr==null)return[];if(nr.constructor===String)return nr.split(ar||" ");if(nr.constructor===Array){for(var or=[],ur=0;ur<nr.length;++ur)typeof nr[ur]=="string"&&(or[ur]=nr[ur].split(ar||" "));return or}return null}t.wrapFunctionAsNode("string/split",ir,["string,array","string"],"array",{separator:","});function sr(nr){return nr!=null&&nr.constructor===Number?nr.toFixed(this.properties.precision):nr}t.wrapFunctionAsNode("string/toFixed",sr,["number"],"string",{precision:0});function rr(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}rr.title="toTable",rr.desc="Splits a string to table",rr.prototype.onExecute=function(){var nr=this.getInputData(0);if(nr){var ar=this.properties.separator||",";(nr!=this._str||ar!=this._last_separator)&&(this._last_separator=ar,this._str=nr,this._table=nr.split(`
`).map(function(or){return or.trim().split(ar)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}},t.registerNodeType("string/toTable",rr)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}n.title="Selector",n.desc="selects an output",n.prototype.onDrawBackground=function(rr){if(!this.flags.collapsed){rr.fillStyle="#AFB";var nr=(this.selected+1)*t.NODE_SLOT_HEIGHT+6;rr.beginPath(),rr.moveTo(50,nr),rr.lineTo(50,nr+t.NODE_SLOT_HEIGHT),rr.lineTo(34,nr+t.NODE_SLOT_HEIGHT*.5),rr.fill()}},n.prototype.onExecute=function(){var rr=this.getInputData(0);(rr==null||rr.constructor!==Number)&&(rr=0),this.selected=rr=Math.round(rr)%(this.inputs.length-1);var nr=this.getInputData(rr+1);nr!==void 0&&this.setOutputData(0,nr)},n.prototype.onGetInputs=function(){return[["E",0],["F",0],["G",0],["H",0]]},t.registerNodeType("logic/selector",n);function Ae(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}Ae.title="Sequence",Ae.desc="select one element from a sequence from a string",Ae.prototype.onPropertyChanged=function(rr,nr){rr=="sequence"&&(this.values=nr.split(","))},Ae.prototype.onExecute=function(){var rr=this.getInputData(1);rr&&rr!=this.current_sequence&&(this.values=rr.split(","),this.current_sequence=rr);var nr=this.getInputData(0);nr==null&&(nr=0),this.index=nr=Math.round(nr)%this.values.length,this.setOutputData(0,this.values[nr])},t.registerNodeType("logic/sequence",Ae);function Ne(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}Ne.title="AND",Ne.desc="Return true if all inputs are true",Ne.prototype.onExecute=function(){var rr=!0;for(var nr in this.inputs)if(!this.getInputData(nr)){var rr=!1;break}this.setOutputData(0,rr)},Ne.prototype.onGetInputs=function(){return[["and","boolean"]]},t.registerNodeType("logic/AND",Ne);function tr(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}tr.title="OR",tr.desc="Return true if at least one input is true",tr.prototype.onExecute=function(){var rr=!1;for(var nr in this.inputs)if(this.getInputData(nr)){rr=!0;break}this.setOutputData(0,rr)},tr.prototype.onGetInputs=function(){return[["or","boolean"]]},t.registerNodeType("logic/OR",tr);function er(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}er.title="NOT",er.desc="Return the logical negation",er.prototype.onExecute=function(){var rr=!this.getInputData(0);this.setOutputData(0,rr)},t.registerNodeType("logic/NOT",er);function ir(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}ir.title="bool == bool",ir.desc="Compare for logical equality",ir.prototype.onExecute=function(){var rr=null,nr=!0;for(var ar in this.inputs)if(rr===null)rr=this.getInputData(ar);else if(rr!=this.getInputData(ar)){nr=!1;break}this.setOutputData(0,nr)},ir.prototype.onGetInputs=function(){return[["bool","boolean"]]},t.registerNodeType("logic/CompareBool",ir);function sr(){this.properties={},this.addInput("onTrigger",t.ACTION),this.addInput("condition","boolean"),this.addOutput("true",t.EVENT),this.addOutput("false",t.EVENT),this.mode=t.ON_TRIGGER}sr.title="Branch",sr.desc="Branch execution on condition",sr.prototype.onExecute=function(rr,nr){var ar=this.getInputData(1);ar?this.triggerSlot(0):this.triggerSlot(1)},t.registerNodeType("logic/IF",sr)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}n.title="Plot",n.desc="Plots data over time",n.colors=["#FFF","#F99","#9F9","#99F"],n.prototype.onExecute=function(ur){if(!this.flags.collapsed)for(var hr=this.size,cr=0;cr<4;++cr){var vr=this.getInputData(cr);if(vr!=null){var mr=this.values[cr];mr.push(vr),mr.length>hr[0]&&mr.shift()}}},n.prototype.onDrawBackground=function(ur){if(!this.flags.collapsed){var hr=this.size,cr=.5*hr[1]/this.properties.scale,vr=n.colors,mr=hr[1]*.5;if(ur.fillStyle="#000",ur.fillRect(0,0,hr[0],hr[1]),ur.strokeStyle="#555",ur.beginPath(),ur.moveTo(0,mr),ur.lineTo(hr[0],mr),ur.stroke(),this.inputs)for(var dr=0;dr<4;++dr){var lr=this.values[dr];if(!(!this.inputs[dr]||!this.inputs[dr].link)){ur.strokeStyle=vr[dr],ur.beginPath();var gr=lr[0]*cr*-1+mr;ur.moveTo(0,clamp(gr,0,hr[1]));for(var fr=1;fr<lr.length&&fr<hr[0];++fr){var gr=lr[fr]*cr*-1+mr;ur.lineTo(fr,clamp(gr,0,hr[1]))}ur.stroke()}}}},t.registerNodeType("graphics/plot",n);function Ae(){this.addOutput("frame","image"),this.properties={url:""}}Ae.title="Image",Ae.desc="Image loader",Ae.widgets=[{name:"load",text:"Load",type:"button"}],Ae.supported_extensions=["jpg","jpeg","png","gif"],Ae.prototype.onAdded=function(){this.properties.url!=""&&this.img==null&&this.loadImage(this.properties.url)},Ae.prototype.onDrawBackground=function(ur){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&ur.drawImage(this.img,0,0,this.size[0],this.size[1])},Ae.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},Ae.prototype.onPropertyChanged=function(ur,hr){return this.properties[ur]=hr,ur=="url"&&hr!=""&&this.loadImage(hr),!0},Ae.prototype.loadImage=function(ur,hr){if(ur==""){this.img=null;return}this.img=document.createElement("img"),ur.substr(0,4)=="http"&&t.proxy&&(ur=t.proxy+ur.substr(ur.indexOf(":")+3)),this.img.src=ur,this.boxcolor="#F95";var cr=this;this.img.onload=function(){hr&&hr(this),console.log("Image loaded, size: "+cr.img.width+"x"+cr.img.height),this.dirty=!0,cr.boxcolor="#9F9",cr.setDirtyCanvas(!0)},this.img.onerror=function(){console.log("error loading the image:"+ur)}},Ae.prototype.onWidget=function(ur,hr){hr.name=="load"&&this.loadImage(this.properties.url)},Ae.prototype.onDropFile=function(ur){var hr=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(ur),this.properties.url=this._url,this.loadImage(this._url,function(cr){hr.size[1]=cr.height/cr.width*hr.size[0]})},t.registerNodeType("graphics/image",Ae);function Ne(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}Ne.title="Palette",Ne.desc="Generates a color",Ne.prototype.onExecute=function(){var ur=[];this.properties.colorA!=null&&ur.push(hex2num(this.properties.colorA)),this.properties.colorB!=null&&ur.push(hex2num(this.properties.colorB)),this.properties.colorC!=null&&ur.push(hex2num(this.properties.colorC)),this.properties.colorD!=null&&ur.push(hex2num(this.properties.colorD));var hr=this.getInputData(0);if(hr==null&&(hr=.5),hr>1?hr=1:hr<0&&(hr=0),ur.length!=0){var cr=[0,0,0];if(hr==0)cr=ur[0];else if(hr==1)cr=ur[ur.length-1];else{var vr=(ur.length-1)*hr,mr=ur[Math.floor(vr)],dr=ur[Math.floor(vr)+1],lr=vr-Math.floor(vr);cr[0]=mr[0]*(1-lr)+dr[0]*lr,cr[1]=mr[1]*(1-lr)+dr[1]*lr,cr[2]=mr[2]*(1-lr)+dr[2]*lr}for(var gr=0;gr<cr.length;gr++)cr[gr]/=255;this.boxcolor=colorToString(cr),this.setOutputData(0,cr)}},t.registerNodeType("color/palette",Ne);function tr(){this.addInput("","image,canvas"),this.size=[200,200]}tr.title="Frame",tr.desc="Frame viewerew",tr.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],tr.prototype.onDrawBackground=function(ur){this.frame&&!this.flags.collapsed&&ur.drawImage(this.frame,0,0,this.size[0],this.size[1])},tr.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},tr.prototype.onWidget=function(ur,hr){if(hr.name=="resize"&&this.frame){var cr=this.frame.width,vr=this.frame.height;!cr&&this.frame.videoWidth!=null&&(cr=this.frame.videoWidth,vr=this.frame.videoHeight),cr&&vr&&(this.size=[cr,vr]),this.setDirtyCanvas(!0,!0)}else hr.name=="view"&&this.show()},tr.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},t.registerNodeType("graphics/frame",tr);function er(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}er.title="Image fade",er.desc="Fades between images",er.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],er.prototype.onAdded=function(){this.createCanvas();var ur=this.canvas.getContext("2d");ur.fillStyle="#000",ur.fillRect(0,0,this.properties.width,this.properties.height)},er.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},er.prototype.onExecute=function(){var ur=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var hr=this.getInputData(0);hr!=null&&ur.drawImage(hr,0,0,this.canvas.width,this.canvas.height);var cr=this.getInputData(2);cr==null?cr=this.properties.fade:this.properties.fade=cr,ur.globalAlpha=cr;var vr=this.getInputData(1);vr!=null&&ur.drawImage(vr,0,0,this.canvas.width,this.canvas.height),ur.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},t.registerNodeType("graphics/imagefade",er);function ir(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}ir.title="Crop",ir.desc="Crop Image",ir.prototype.onAdded=function(){this.createCanvas()},ir.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},ir.prototype.onExecute=function(){var ur=this.getInputData(0);if(ur)if(ur.width){var hr=this.canvas.getContext("2d");hr.drawImage(ur,-this.properties.x,-this.properties.y,ur.width*this.properties.scale,ur.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)},ir.prototype.onDrawBackground=function(ur){this.flags.collapsed||this.canvas&&ur.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},ir.prototype.onPropertyChanged=function(ur,hr){return this.properties[ur]=hr,ur=="scale"?(this.properties[ur]=parseFloat(hr),this.properties[ur]==0&&(console.error("Error in scale"),this.properties[ur]=1)):this.properties[ur]=parseInt(hr),this.createCanvas(),!0},t.registerNodeType("graphics/cropImage",ir);function sr(){this.addInput("clear",t.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}sr.title="Canvas",sr.desc="Canvas to render stuff",sr.prototype.onExecute=function(){var ur=this.canvas,hr=this.properties.width|0,cr=this.properties.height|0;ur.width!=hr&&(ur.width=hr),ur.height!=cr&&(ur.height=cr),this.properties.autoclear&&this.ctx.clearRect(0,0,ur.width,ur.height),this.setOutputData(0,ur)},sr.prototype.onAction=function(ur,hr){ur=="clear"&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},t.registerNodeType("graphics/canvas",sr);function rr(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}rr.title="DrawImage",rr.desc="Draws image into a canvas",rr.prototype.onExecute=function(){var ur=this.getInputData(0);if(ur){var hr=this.getInputOrProperty("img");if(hr){var cr=this.getInputOrProperty("x"),vr=this.getInputOrProperty("y"),mr=ur.getContext("2d");mr.drawImage(hr,cr,vr)}}},t.registerNodeType("graphics/drawImage",rr);function nr(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}nr.title="DrawRectangle",nr.desc="Draws rectangle in canvas",nr.prototype.onExecute=function(){var ur=this.getInputData(0);if(ur){var hr=this.getInputOrProperty("x"),cr=this.getInputOrProperty("y"),vr=this.getInputOrProperty("w"),mr=this.getInputOrProperty("h"),dr=ur.getContext("2d");dr.fillRect(hr,cr,vr,mr)}},t.registerNodeType("graphics/drawRectangle",nr);function ar(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}ar.title="Video",ar.desc="Video playback",ar.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],ar.prototype.onExecute=function(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),!(!this._video||this._video.width==0))){var ur=this.getInputData(0);ur&&ur>=0&&ur<=1&&(this._video.currentTime=ur*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},ar.prototype.onStart=function(){this.play()},ar.prototype.onStop=function(){this.stop()},ar.prototype.loadVideo=function(ur){this._video_url=ur;var hr=ur.substr(0,10).indexOf(":"),cr="";hr!=-1&&(cr=ur.substr(0,hr));var vr="";cr&&(vr=ur.substr(0,ur.indexOf("/",cr.length+3)),vr=vr.substr(cr.length+3)),this.properties.use_proxy&&cr&&t.proxy&&vr!=location.host&&(ur=t.proxy+ur.substr(ur.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=ur,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var mr=this;this._video.addEventListener("loadedmetadata",function(dr){console.log("Duration: "+this.duration+" seconds"),console.log("Size: "+this.videoWidth+","+this.videoHeight),mr.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",function(dr){console.log("video loading...")}),this._video.addEventListener("error",function(dr){if(console.error("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:console.error("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:console.error("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:console.error("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("Sorry, your browser can't play this video.");break}}),this._video.addEventListener("ended",function(dr){console.log("Video Ended."),this.play()})},ar.prototype.onPropertyChanged=function(ur,hr){return this.properties[ur]=hr,ur=="url"&&hr!=""&&this.loadVideo(hr),!0},ar.prototype.play=function(){this._video&&this._video.videoWidth&&this._video.play()},ar.prototype.playPause=function(){this._video&&(this._video.paused?this.play():this.pause())},ar.prototype.stop=function(){this._video&&(this._video.pause(),this._video.currentTime=0)},ar.prototype.pause=function(){this._video&&(console.log("Video paused"),this._video.pause())},ar.prototype.onWidget=function(ur,hr){},t.registerNodeType("graphics/video",ar);function or(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}or.title="Webcam",or.desc="Webcam image",or.is_webcam_open=!1,or.prototype.openStream=function(){if(!navigator.mediaDevices.getUserMedia){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0;var ur={audio:!1,video:this.properties.filterFacingMode?{facingMode:this.properties.facingMode}:!0};navigator.mediaDevices.getUserMedia(ur).then(this.streamReady.bind(this)).catch(cr);var hr=this;function cr(vr){console.log("Webcam rejected",vr),hr._webcam_stream=!1,or.is_webcam_open=!1,hr.boxcolor="red",hr.trigger("stream_error")}},or.prototype.closeStream=function(){if(this._webcam_stream){var ur=this._webcam_stream.getTracks();if(ur.length)for(var hr=0;hr<ur.length;++hr)ur[hr].stop();or.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},or.prototype.onPropertyChanged=function(ur,hr){ur=="facingMode"&&(this.properties.facingMode=hr,this.closeStream(),this.openStream())},or.prototype.onRemoved=function(){this.closeStream()},or.prototype.streamReady=function(ur){this._webcam_stream=ur,this.boxcolor="green";var hr=this._video;hr||(hr=document.createElement("video"),hr.autoplay=!0,hr.srcObject=ur,this._video=hr,hr.onloadedmetadata=function(cr){console.log(cr),or.is_webcam_open=!0}),this.trigger("stream_ready",hr)},or.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var ur=1;ur<this.outputs.length;++ur)if(this.outputs[ur])switch(this.outputs[ur].name){case"width":this.setOutputData(ur,this._video.videoWidth);break;case"height":this.setOutputData(ur,this._video.videoHeight);break}}},or.prototype.getExtraMenuOptions=function(ur){var hr=this,cr=hr.properties.show?"Hide Frame":"Show Frame";return[{content:cr,callback:function(){hr.properties.show=!hr.properties.show}}]},or.prototype.onDrawBackground=function(ur){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(ur.save(),ur.drawImage(this._video,0,0,this.size[0],this.size[1]),ur.restore())},or.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",t.EVENT],["stream_closed",t.EVENT],["stream_error",t.EVENT]]},t.registerNodeType("graphics/webcam",or)}(commonjsGlobal),function(s){var t=s.LiteGraph,n=s.LGraphCanvas;if(s.LGraphTexture=null,typeof GL>"u")return;n.link_type_colors.Texture="#987";function Ae(){this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",filter:!0},this.size=[Ae.image_preview_size,Ae.image_preview_size]}s.LGraphTexture=Ae,Ae.title="Texture",Ae.desc="Texture",Ae.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},Ae.loadTextureCallback=null,Ae.image_preview_size=256,Ae.UNDEFINED=0,Ae.PASS_THROUGH=1,Ae.COPY=2,Ae.LOW=3,Ae.HIGH=4,Ae.REUSE=5,Ae.DEFAULT=2,Ae.MODE_VALUES={undefined:Ae.UNDEFINED,"pass through":Ae.PASS_THROUGH,copy:Ae.COPY,low:Ae.LOW,high:Ae.HIGH,reuse:Ae.REUSE,default:Ae.DEFAULT},Ae.getTexturesContainer=function(){return gl.textures},Ae.loadTexture=function(pr,br){br=br||{};var Cr=pr;Cr.substr(0,7)=="http://"&&t.proxy&&(Cr=t.proxy+Cr.substr(7));var Rr=Ae.getTexturesContainer(),Mr=Rr[pr]=GL.Texture.fromURL(Cr,br);return Mr},Ae.getTexture=function(pr){var br=this.getTexturesContainer();if(!br)throw"Cannot load texture, container of textures not found";var Cr=br[pr];return!Cr&&pr&&pr[0]!=":"?this.loadTexture(pr):Cr},Ae.getTargetTexture=function(pr,br,Cr){if(!pr)throw"LGraphTexture.getTargetTexture expects a reference texture";var Rr=null;switch(Cr){case Ae.LOW:Rr=gl.UNSIGNED_BYTE;break;case Ae.HIGH:Rr=gl.HIGH_PRECISION_FORMAT;break;case Ae.REUSE:return pr;case Ae.COPY:default:Rr=pr?pr.type:gl.UNSIGNED_BYTE;break}return(!br||br.width!=pr.width||br.height!=pr.height||br.type!=Rr||br.format!=pr.format)&&(br=new GL.Texture(pr.width,pr.height,{type:Rr,format:pr.format,filter:gl.LINEAR})),br},Ae.getTextureType=function(pr,br){var Cr=br?br.type:gl.UNSIGNED_BYTE;switch(pr){case Ae.HIGH:Cr=gl.HIGH_PRECISION_FORMAT;break;case Ae.LOW:Cr=gl.UNSIGNED_BYTE;break}return Cr},Ae.getWhiteTexture=function(){if(this._white_texture)return this._white_texture;var pr=this._white_texture=GL.Texture.fromMemory(1,1,[255,255,255,255],{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return pr},Ae.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var pr=new Uint8Array(512*512*4),br=0;br<512*512*4;++br)pr[br]=Math.random()*255;var Cr=GL.Texture.fromMemory(512,512,pr,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=Cr,Cr},Ae.prototype.onDropFile=function(pr,br,Cr){if(!pr)this._drop_texture=null,this.properties.name="";else{var Rr=null;if(typeof pr=="string")Rr=GL.Texture.fromURL(pr);else if(br.toLowerCase().indexOf(".dds")!=-1)Rr=GL.Texture.fromDDSInMemory(pr);else{var Mr=new Blob([Cr]),Fr=URL.createObjectURL(Mr);Rr=GL.Texture.fromURL(Fr)}this._drop_texture=Rr,this.properties.name=br}},Ae.prototype.getExtraMenuOptions=function(pr){var br=this;if(this._drop_texture)return[{content:"Clear",callback:function(){br._drop_texture=null,br.properties.name=""}}]},Ae.prototype.onExecute=function(){var pr=null;if(this.isOutputConnected(1)&&(pr=this.getInputData(0)),!pr&&this._drop_texture&&(pr=this._drop_texture),!pr&&this.properties.name&&(pr=Ae.getTexture(this.properties.name)),!pr){this.setOutputData(0,null),this.setOutputData(1,"");return}this._last_tex=pr,this.properties.filter===!1?pr.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):pr.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,pr),this.setOutputData(1,pr.fullpath||pr.filename);for(var br=2;br<this.outputs.length;br++){var Cr=this.outputs[br];if(Cr){var Rr=null;Cr.name=="width"?Rr=pr.width:Cr.name=="height"?Rr=pr.height:Cr.name=="aspect"&&(Rr=pr.width/pr.height),this.setOutputData(br,Rr)}}},Ae.prototype.onResourceRenamed=function(pr,br){this.properties.name==pr&&(this.properties.name=br)},Ae.prototype.onDrawBackground=function(pr){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&pr.webgl){pr.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);return}if(this._last_preview_tex!=this._last_tex)if(pr.webgl)this._canvas=this._last_tex;else{var br=Ae.generateLowResTexturePreview(this._last_tex);if(!br)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(br)}this._canvas&&(pr.save(),pr.webgl||(pr.translate(0,this.size[1]),pr.scale(1,-1)),pr.drawImage(this._canvas,0,0,this.size[0],this.size[1]),pr.restore())}},Ae.generateLowResTexturePreview=function(pr){if(!pr)return null;var br=Ae.image_preview_size,Cr=pr;if(pr.format==gl.DEPTH_COMPONENT)return null;(pr.width>br||pr.height>br)&&(Cr=this._preview_temp_tex,this._preview_temp_tex||(Cr=new GL.Texture(br,br,{minFilter:gl.NEAREST}),this._preview_temp_tex=Cr),pr.copyTo(Cr),pr=Cr);var Rr=this._preview_canvas;return Rr||(Rr=createCanvas(br,br),this._preview_canvas=Rr),Cr&&Cr.toCanvas(Rr),Rr},Ae.prototype.getResources=function(pr){return this.properties.name&&(pr[this.properties.name]=GL.Texture),pr},Ae.prototype.onGetInputs=function(){return[["in","Texture"]]},Ae.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},Ae.replaceCode=function(pr,br){return pr.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,function(Cr){return Cr=Cr.replace(/[\{\}]/g,""),br[Cr]||""})},t.registerNodeType("texture/texture",Ae);function Ne(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[Ae.image_preview_size,Ae.image_preview_size]}Ne.title="Preview",Ne.desc="Show a texture in the graph canvas",Ne.allow_preview=!1,Ne.prototype.onDrawBackground=function(pr){if(!this.flags.collapsed&&!(!pr.webgl&&!Ne.allow_preview)){var br=this.getInputData(0);if(br){var Cr=null;!br.handle&&pr.webgl?Cr=br:Cr=Ae.generateLowResTexturePreview(br),pr.save(),this.properties.flipY&&(pr.translate(0,this.size[1]),pr.scale(1,-1)),pr.drawImage(Cr,0,0,this.size[0],this.size[1]),pr.restore()}}},t.registerNodeType("texture/preview",Ne);function tr(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",generate_mipmaps:!1}}tr.title="Save",tr.desc="Save a texture in the repository",tr.prototype.getPreviewTexture=function(){return this._texture},tr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr){if(this.properties.generate_mipmaps&&(pr.bind(0),pr.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(pr.texture_type),pr.unbind(0)),this.properties.name)if(Ae.storeTexture)Ae.storeTexture(this.properties.name,pr);else{var br=Ae.getTexturesContainer();br[this.properties.name]=pr}this._texture=pr,this.setOutputData(0,pr),this.setOutputData(1,this.properties.name)}},t.registerNodeType("texture/save",tr);function er(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>			<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>",this.properties={value:1,pixelcode:"color + colorB * value",uvcode:"",precision:Ae.DEFAULT},this.has_error=!1}er.widgets_info={uvcode:{widget:"code"},pixelcode:{widget:"code"},precision:{widget:"combo",values:Ae.MODE_VALUES}},er.title="Operation",er.desc="Texture shader operation",er.presets={},er.prototype.getExtraMenuOptions=function(pr){var br=this,Cr=br.properties.show?"Hide Texture":"Show Texture";return[{content:Cr,callback:function(){br.properties.show=!br.properties.show}}]},er.prototype.onPropertyChanged=function(){this.has_error=!1},er.prototype.onDrawBackground=function(pr){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._tex&&this._tex.gl==pr&&(pr.save(),pr.drawImage(this._tex,0,0,this.size[0],this.size[1]),pr.restore())},er.prototype.onExecute=function(){var pr=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===Ae.PASS_THROUGH){this.setOutputData(0,pr);return}var br=this.getInputData(1);if(!(!this.properties.uvcode&&!this.properties.pixelcode)){var Cr=512,Rr=512;pr?(Cr=pr.width,Rr=pr.height):br&&(Cr=br.width,Rr=br.height),br||(br=GL.Texture.getWhiteTexture());var Mr=Ae.getTextureType(this.properties.precision,pr);!pr&&!this._tex?this._tex=new GL.Texture(Cr,Rr,{type:Mr,format:gl.RGBA,filter:gl.LINEAR}):this._tex=Ae.getTargetTexture(pr||this._tex,this._tex,this.properties.precision);var Fr="";this.properties.uvcode&&(Fr="uv = "+this.properties.uvcode,this.properties.uvcode.indexOf(";")!=-1&&(Fr=this.properties.uvcode));var xr="";this.properties.pixelcode&&(xr="result = "+this.properties.pixelcode,this.properties.pixelcode.indexOf(";")!=-1&&(xr=this.properties.pixelcode));var Or=this._shader;if(!this.has_error&&(!Or||this._shader_code!=Fr+"|"+xr)){var Pr=Ae.replaceCode(er.pixel_shader,{UV_CODE:Fr,PIXEL_CODE:xr});try{Or=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Pr),this.boxcolor="#00FF00"}catch(Wr){GL.Shader.dumpErrorToConsole(Wr,Shader.SCREEN_VERTEX_SHADER,Pr),this.boxcolor="#FF0000",this.has_error=!0;return}this._shader=Or,this._shader_code=Fr+"|"+xr}if(this._shader){var Ur=this.getInputData(2);Ur!=null?this.properties.value=Ur:Ur=parseFloat(this.properties.value);var $r=this.graph.getTime();this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),pr&&pr.bind(0),br&&br.bind(1);var Wr=Mesh.getScreenQuad();Or.uniforms({u_texture:0,u_textureB:1,value:Ur,texSize:[Cr,Rr,1/Cr,1/Rr],time:$r}).draw(Wr)}),this.setOutputData(0,this._tex)}}}},er.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform vec4 texSize;
			uniform float time;
			uniform float value;
			
			void main() {
				vec2 uv = v_coord;
				{{UV_CODE}};
				vec4 color4 = texture2D(u_texture, uv);
				vec3 color = color4.rgb;
				vec4 color4B = texture2D(u_textureB, uv);
				vec3 colorB = color4B.rgb;
				vec3 result = color;
				float alpha = 1.0;
				{{PIXEL_CODE}};
				gl_FragColor = vec4(result, alpha);
			}
			`,er.registerPreset=function(pr,br){er.presets[pr]=br},er.registerPreset("",""),er.registerPreset("bypass","color"),er.registerPreset("add","color + colorB * value"),er.registerPreset("substract","(color - colorB) * value"),er.registerPreset("mate","mix( color, colorB, color4B.a * value)"),er.registerPreset("invert","vec3(1.0) - color"),er.registerPreset("multiply","color * colorB * value"),er.registerPreset("divide","(color / colorB) / value"),er.registerPreset("difference","abs(color - colorB) * value"),er.registerPreset("max","max(color, colorB) * value"),er.registerPreset("min","min(color, colorB) * value"),er.registerPreset("displace","texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz"),er.registerPreset("grayscale","vec3(color.x + color.y + color.z) * value / 3.0"),er.registerPreset("saturation","mix( vec3(color.x + color.y + color.z) / 3.0, color, value )"),er.registerPreset("normalmap",`
			float z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;
			float z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;
			float z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;
			float z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;
			float z4 = color.x;
			float z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;
			float z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;
			float z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;
			float z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;
			vec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );
			normal.xy *= value;
			result.xyz = normalize(normal) * 0.5 + vec3(0.5);
		`),er.registerPreset("threshold","vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)"),er.prototype.onInspect=function(pr){var br=this;pr.addCombo("Presets","",{values:Object.keys(er.presets),callback:function(Cr){var Rr=er.presets[Cr];Rr&&(br.setProperty("pixelcode",Rr),br.title=Cr,pr.refresh())}})},t.registerNodeType("texture/operation",er);function ir(){this.addOutput("out","Texture"),this.properties={code:"",u_value:1,u_color:[1,1,1,1],width:512,height:512,precision:Ae.DEFAULT},this.properties.code=ir.pixel_shader,this._uniforms={u_value:1,u_color:vec4.create(),in_texture:0,texSize:vec4.create(),time:0}}ir.title="Shader",ir.desc="Texture shader",ir.widgets_info={code:{type:"code",lang:"glsl"},precision:{widget:"combo",values:Ae.MODE_VALUES}},ir.prototype.onPropertyChanged=function(pr,br){if(pr=="code"){var Cr=this.getShader();if(Cr){var Rr=Cr.uniformInfo;if(this.inputs)for(var Mr={},Fr=0;Fr<this.inputs.length;++Fr){var xr=this.getInputInfo(Fr);if(xr){if(Rr[xr.name]&&!Mr[xr.name]){Mr[xr.name]=!0;continue}this.removeInput(Fr),Fr--}}for(var Fr in Rr){var xr=Cr.uniformInfo[Fr];if(xr.loc!==null&&Fr!="time"){var Or="number";if(this._shader.samplers[Fr])Or="texture";else switch(xr.size){case 1:Or="number";break;case 2:Or="vec2";break;case 3:Or="vec3";break;case 4:Or="vec4";break;case 9:Or="mat3";break;case 16:Or="mat4";break;default:continue}var Pr=this.findInputSlot(Fr);if(Pr==-1){this.addInput(Fr,Or);continue}var Ur=this.getInputInfo(Pr);if(!Ur)this.addInput(Fr,Or);else{if(Ur.type==Or)continue;this.removeInput(Pr,Or),this.addInput(Fr,Or)}}}}}},ir.prototype.getShader=function(){if(this._shader&&this._shader_code==this.properties.code)return this._shader;if(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,this.properties.code),this._shader)this.boxcolor="green";else return this.boxcolor="red",null;return this._shader},ir.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getShader();if(pr){var br=0,Cr=null;if(this.inputs)for(var Rr=0;Rr<this.inputs.length;++Rr){var Mr=this.getInputInfo(Rr),Fr=this.getInputData(Rr);Fr!=null&&(Fr.constructor===GL.Texture&&(Fr.bind(br),Cr||(Cr=Fr),Fr=br,br++),pr.setUniform(Mr.name,Fr))}var xr=this._uniforms,Or=Ae.getTextureType(this.properties.precision,Cr),Pr=this.properties.width|0,Ur=this.properties.height|0;Pr==0&&(Pr=Cr?Cr.width:gl.canvas.width),Ur==0&&(Ur=Cr?Cr.height:gl.canvas.height),xr.texSize[0]=Pr,xr.texSize[1]=Ur,xr.texSize[2]=1/Pr,xr.texSize[3]=1/Ur,xr.time=this.graph.getTime(),xr.u_value=this.properties.u_value,xr.u_color.set(this.properties.u_color),(!this._tex||this._tex.type!=Or||this._tex.width!=Pr||this._tex.height!=Ur)&&(this._tex=new GL.Texture(Pr,Ur,{type:Or,format:gl.RGBA,filter:gl.LINEAR}));var $r=this._tex;$r.drawTo(function(){pr.uniforms(xr).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._tex)}}},ir.pixel_shader=`precision highp float;
	
	varying vec2 v_coord;
	uniform float time; //time in seconds
	uniform vec4 texSize; //tex resolution
	uniform float u_value;
	uniform vec4 u_color;

	void main() {
		vec2 uv = v_coord;
		vec3 color = vec3(0.0);
		//your code here
		color.xy=uv;

		gl_FragColor = vec4(color, 1.0);
	}
	`,t.registerNodeType("texture/shader",ir);function sr(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:Ae.DEFAULT}}sr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},sr.title="Scale/Offset",sr.desc="Applies an scaling and offseting",sr.prototype.onExecute=function(){var pr=this.getInputData(0);if(!(!this.isOutputConnected(0)||!pr)){if(this.properties.precision===Ae.PASS_THROUGH){this.setOutputData(0,pr);return}var br=pr.width,Cr=pr.height,Rr=this.precision===Ae.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===Ae.DEFAULT&&(Rr=pr.type),(!this._tex||this._tex.width!=br||this._tex.height!=Cr||this._tex.type!=Rr)&&(this._tex=new GL.Texture(br,Cr,{type:Rr,format:gl.RGBA,filter:gl.LINEAR}));var Mr=this._shader;Mr||(Mr=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,sr.pixel_shader));var Fr=this.getInputData(1);Fr?(this.properties.scale[0]=Fr[0],this.properties.scale[1]=Fr[1]):Fr=this.properties.scale;var xr=this.getInputData(2);xr?(this.properties.offset[0]=xr[0],this.properties.offset[1]=xr[1]):xr=this.properties.offset,this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),pr.bind(0);var Or=Mesh.getScreenQuad();Mr.uniforms({u_texture:0,u_scale:Fr,u_offset:xr}).draw(Or)}),this.setOutputData(0,this._tex)}},sr.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform vec2 u_scale;
			uniform vec2 u_offset;
			
			void main() {
				vec2 uv = v_coord;
				uv = uv / u_scale - u_offset;
				gl_FragColor = texture2D(u_texture, uv);
			}
			`,t.registerNodeType("texture/scaleOffset",sr);function rr(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,scale:[1,1],offset:[0,0],precision:Ae.DEFAULT},this._uniforms={u_texture:0,u_textureB:1,u_factor:1,u_scale:vec2.create(),u_offset:vec2.create()}}rr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},rr.title="Warp",rr.desc="Texture warp operation",rr.prototype.onExecute=function(){var pr=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===Ae.PASS_THROUGH){this.setOutputData(0,pr);return}var br=this.getInputData(1),Cr=512,Rr=512;gl.UNSIGNED_BYTE,pr?(Cr=pr.width,Rr=pr.height,pr.type):br&&(Cr=br.width,Rr=br.height,br.type),!pr&&!this._tex?this._tex=new GL.Texture(Cr,Rr,{type:this.precision===Ae.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR}):this._tex=Ae.getTargetTexture(pr||this._tex,this._tex,this.properties.precision);var Mr=this._shader;Mr||(Mr=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,rr.pixel_shader));var Fr=this.getInputData(2);Fr!=null?this.properties.factor=Fr:Fr=parseFloat(this.properties.factor);var xr=this._uniforms;xr.u_factor=Fr,xr.u_scale.set(this.properties.scale),xr.u_offset.set(this.properties.offset),this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),pr&&pr.bind(0),br&&br.bind(1);var Or=Mesh.getScreenQuad();Mr.uniforms(xr).draw(Or)}),this.setOutputData(0,this._tex)}},rr.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform float u_factor;
			uniform vec2 u_scale;
			uniform vec2 u_offset;
			
			void main() {
				vec2 uv = v_coord;
				uv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;
				gl_FragColor = texture2D(u_texture, uv);
			}
			`,t.registerNodeType("texture/warp",rr);function nr(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1,viewport:[0,0,1,1]},this.size[0]=130}nr.title="to Viewport",nr.desc="Texture to viewport",nr._prev_viewport=new Float32Array(4),nr.prototype.onDrawBackground=function(pr){if(!(this.flags.collapsed||this.size[1]<=40)){var br=this.getInputData(0);br&&pr.drawImage(pr==gl?br:gl.canvas,10,30,this.size[0]-20,this.size[1]-40)}},nr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var br=this.properties.gamma||1;this.isInputConnected(1)&&(br=this.getInputData(1)),pr.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST);var Cr=nr._prev_viewport;Cr.set(gl.viewport_data);var Rr=this.properties.viewport;if(gl.viewport(Cr[0]+Cr[2]*Rr[0],Cr[1]+Cr[3]*Rr[1],Cr[2]*Rr[2],Cr[3]*Rr[3]),gl.getViewport(),this.properties.antialiasing){nr._shader||(nr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,nr.aa_pixel_shader));var Mr=Mesh.getScreenQuad();pr.bind(0),nr._shader.uniforms({u_texture:0,uViewportSize:[pr.width,pr.height],u_igamma:1/br,inverseVP:[1/pr.width,1/pr.height]}).draw(Mr)}else br!=1?(nr._gamma_shader||(nr._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,nr.gamma_pixel_shader)),pr.toViewport(nr._gamma_shader,{u_texture:0,u_igamma:1/br})):pr.toViewport();gl.viewport(Cr[0],Cr[1],Cr[2],Cr[3])}},nr.prototype.onGetInputs=function(){return[["gamma","number"]]},nr.aa_pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 uViewportSize;
			uniform vec2 inverseVP;
			uniform float u_igamma;
			#define FXAA_REDUCE_MIN   (1.0/ 128.0)
			#define FXAA_REDUCE_MUL   (1.0 / 8.0)
			#define FXAA_SPAN_MAX     8.0
			
			/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */
			vec4 applyFXAA(sampler2D tex, vec2 fragCoord)
			{
				vec4 color = vec4(0.0);
				/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/
				vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
				vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
				vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
				vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
				vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
				vec3 luma = vec3(0.299, 0.587, 0.114);
				float lumaNW = dot(rgbNW, luma);
				float lumaNE = dot(rgbNE, luma);
				float lumaSW = dot(rgbSW, luma);
				float lumaSE = dot(rgbSE, luma);
				float lumaM  = dot(rgbM,  luma);
				float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
				float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
				
				vec2 dir;
				dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
				dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
				
				float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
				
				float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
				dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;
				
				vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + 
					texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
				vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + 
					texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);
				
				//return vec4(rgbA,1.0);
				float lumaB = dot(rgbB, luma);
				if ((lumaB < lumaMin) || (lumaB > lumaMax))
					color = vec4(rgbA, 1.0);
				else
					color = vec4(rgbB, 1.0);
				if(u_igamma != 1.0)
					color.xyz = pow( color.xyz, vec3(u_igamma) );
				return color;
			}
			
			void main() {
			   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;
			}
			`,nr.gamma_pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_igamma;
			void main() {
				vec4 color = texture2D( u_texture, v_coord);
				color.xyz = pow(color.xyz, vec3(u_igamma) );
			   gl_FragColor = color;
			}
			`,t.registerNodeType("texture/toviewport",nr);function ar(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:Ae.DEFAULT}}ar.title="Copy",ar.desc="Copy Texture",ar.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:Ae.MODE_VALUES}},ar.prototype.onExecute=function(){var pr=this.getInputData(0);if(!(!pr&&!this._temp_texture)&&this.isOutputConnected(0)){if(pr){var br=pr.width,Cr=pr.height;this.properties.size!=0&&(br=this.properties.size,Cr=this.properties.size);var Rr=this._temp_texture,Mr=pr.type;if(this.properties.precision===Ae.LOW?Mr=gl.UNSIGNED_BYTE:this.properties.precision===Ae.HIGH&&(Mr=gl.HIGH_PRECISION_FORMAT),!Rr||Rr.width!=br||Rr.height!=Cr||Rr.type!=Mr){var Fr=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(br)&&isPowerOfTwo(Cr)&&(Fr=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(br,Cr,{type:Mr,format:gl.RGBA,minFilter:Fr,magFilter:gl.LINEAR})}pr.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},t.registerNodeType("texture/copy",ar);function or(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:Ae.DEFAULT}}or.title="Downsample",or.desc="Downsample Texture",or.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:Ae.MODE_VALUES}},or.prototype.onExecute=function(){var pr=this.getInputData(0);if(!(!pr&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!pr||pr.texture_type!==GL.TEXTURE_2D)){if(this.properties.iterations<1){this.setOutputData(0,pr);return}var br=or._shader;br||(or._shader=br=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,or.pixel_shader));var Cr=pr.width|0,Rr=pr.height|0,Mr=pr.type;this.properties.precision===Ae.LOW?Mr=gl.UNSIGNED_BYTE:this.properties.precision===Ae.HIGH&&(Mr=gl.HIGH_PRECISION_FORMAT);var Fr=this.properties.iterations||1,xr=pr,Or=null,Pr=[],Ur={type:Mr,format:pr.format},$r=vec2.create(),Wr={u_offset:$r};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var Kr=0;Kr<Fr&&($r[0]=1/Cr,$r[1]=1/Rr,Cr=Cr>>1||0,Rr=Rr>>1||0,Or=GL.Texture.getTemporary(Cr,Rr,Ur),Pr.push(Or),xr.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),xr.copyTo(Or,br,Wr),!(Cr==1&&Rr==1));++Kr)xr=Or;this._texture=Pr.pop();for(var Kr=0;Kr<Pr.length;++Kr)GL.Texture.releaseTemporary(Pr[Kr]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},or.pixel_shader=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform vec2 u_offset;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = texture2D(u_texture, v_coord );
				color += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );
				color += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );
				color += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );
			   gl_FragColor = color * 0.25;
			}
			`,t.registerNodeType("texture/downsample",or);function ur(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:[512,512],generate_mipmaps:!1,precision:Ae.DEFAULT}}ur.title="Resize",ur.desc="Resize Texture",ur.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:Ae.MODE_VALUES}},ur.prototype.onExecute=function(){var pr=this.getInputData(0);if(!(!pr&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!pr||pr.texture_type!==GL.TEXTURE_2D)){var br=this.properties.size[0]|0,Cr=this.properties.size[1]|0;br==0&&(br=pr.width),Cr==0&&(Cr=pr.height);var Rr=pr.type;this.properties.precision===Ae.LOW?Rr=gl.UNSIGNED_BYTE:this.properties.precision===Ae.HIGH&&(Rr=gl.HIGH_PRECISION_FORMAT),(!this._texture||this._texture.width!=br||this._texture.height!=Cr||this._texture.type!=Rr)&&(this._texture=new GL.Texture(br,Cr,{type:Rr})),pr.copyTo(this._texture),this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},t.registerNodeType("texture/resize",ur);function hr(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={use_previous_frame:!0,high_quality:!1},this._uniforms={u_texture:0,u_mipmap_offset:0},this._luminance=new Float32Array(4)}hr.title="Average",hr.desc=`Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.
 If high_quality is true, then it generates the mipmaps first and reads from the lower one.`,hr.prototype.onExecute=function(){this.properties.use_previous_frame||this.updateAverage();var pr=this._luminance;this.setOutputData(0,this._temp_texture),this.setOutputData(1,pr),this.setOutputData(2,(pr[0]+pr[1]+pr[2])/3)},hr.prototype.onPreRenderExecute=function(){this.updateAverage()},hr.prototype.updateAverage=function(){var pr=this.getInputData(0);if(pr&&!(!this.isOutputConnected(0)&&!this.isOutputConnected(1)&&!this.isOutputConnected(2))){if(!hr._shader){hr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,hr.pixel_shader);for(var br=new Float32Array(16),Cr=0;Cr<br.length;++Cr)br[Cr]=Math.random();hr._shader.uniforms({u_samples_a:br.subarray(0,16),u_samples_b:br.subarray(16,32)})}var Rr=this._temp_texture,Mr=gl.UNSIGNED_BYTE;pr.type!=Mr&&(Mr=gl.FLOAT),(!Rr||Rr.type!=Mr)&&(this._temp_texture=new GL.Texture(1,1,{type:Mr,format:gl.RGBA,filter:gl.NEAREST})),this._uniforms.u_mipmap_offset=0,this.properties.high_quality&&((!this._temp_pot2_texture||this._temp_pot2_texture.type!=Mr)&&(this._temp_pot2_texture=new GL.Texture(512,512,{type:Mr,format:gl.RGBA,minFilter:gl.LINEAR_MIPMAP_LINEAR,magFilter:gl.LINEAR})),pr.copyTo(this._temp_pot2_texture),pr=this._temp_pot2_texture,pr.bind(0),gl.generateMipmap(GL.TEXTURE_2D),this._uniforms.u_mipmap_offset=9);var Fr=hr._shader,xr=this._uniforms;if(xr.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){pr.toViewport(Fr,xr)}),this.isOutputConnected(1)||this.isOutputConnected(2)){var Or=this._temp_texture.getPixels();if(Or){var Pr=this._luminance,Mr=this._temp_texture.type;Pr.set(Or),Mr==gl.UNSIGNED_BYTE?vec4.scale(Pr,Pr,1/255):Mr==GL.HALF_FLOAT||Mr==GL.HALF_FLOAT_OES}}}},hr.pixel_shader=`precision highp float;
			precision highp float;
			uniform mat4 u_samples_a;
			uniform mat4 u_samples_b;
			uniform sampler2D u_texture;
			uniform float u_mipmap_offset;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = vec4(0.0);
				//random average
				for(int i = 0; i < 4; ++i)
					for(int j = 0; j < 4; ++j)
					{
						color += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );
						color += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );
					}
			   gl_FragColor = color * 0.03125;
			}
			`,t.registerNodeType("texture/average",hr);function cr(){this.addInput("in","Texture"),this.addInput("factor","Number"),this.addOutput("out","Texture"),this.properties={factor:.5},this._uniforms={u_texture:0,u_textureB:1,u_factor:this.properties.factor}}cr.title="Smooth",cr.desc="Smooth texture over time",cr.prototype.onExecute=function(){var pr=this.getInputData(0);if(!(!pr||!this.isOutputConnected(0))){cr._shader||(cr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,cr.pixel_shader));var br=this._temp_texture;if(!br||br.type!=pr.type||br.width!=pr.width||br.height!=pr.height){var Cr={type:pr.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(pr.width,pr.height,Cr),this._temp_texture2=new GL.Texture(pr.width,pr.height,Cr),pr.copyTo(this._temp_texture2)}var Rr=this._temp_texture,Mr=this._temp_texture2,Fr=cr._shader,xr=this._uniforms;xr.u_factor=1-this.getInputOrProperty("factor"),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Rr.drawTo(function(){Mr.bind(1),pr.toViewport(Fr,xr)}),this.setOutputData(0,Rr),this._temp_texture=Mr,this._temp_texture2=Rr}},cr.pixel_shader=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_factor;
			varying vec2 v_coord;
			
			void main() {
				gl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );
			}
			`,t.registerNodeType("texture/temporal_smooth",cr);function vr(){this.addInput("in","Texture"),this.addOutput("avg","Texture"),this.addOutput("array","Texture"),this.properties={samples:64,frames_interval:1},this._uniforms={u_texture:0,u_textureB:1,u_samples:this.properties.samples,u_isamples:1/this.properties.samples},this.frame=0}vr.title="Lineal Avg Smooth",vr.desc="Smooth texture linearly over time",vr["@samples"]={type:"number",min:1,max:64,step:1,precision:1},vr.prototype.getPreviewTexture=function(){return this._temp_texture2},vr.prototype.onExecute=function(){var pr=this.getInputData(0);if(!(!pr||!this.isOutputConnected(0))){vr._shader||(vr._shader_copy=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,vr.pixel_shader_copy),vr._shader_avg=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,vr.pixel_shader_avg));var br=clamp(this.properties.samples,0,64),Cr=this.frame,Rr=this.properties.frames_interval;if(Rr==0||Cr%Rr==0){var Mr=this._temp_texture;if(!Mr||Mr.type!=pr.type||Mr.width!=br){var Fr={type:pr.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(br,1,Fr),this._temp_texture2=new GL.Texture(br,1,Fr),this._temp_texture_out=new GL.Texture(1,1,Fr)}var xr=this._temp_texture,Or=this._temp_texture2,Pr=vr._shader_copy,Ur=vr._shader_avg,$r=this._uniforms;$r.u_samples=br,$r.u_isamples=1/br,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),xr.drawTo(function(){Or.bind(1),pr.toViewport(Pr,$r)}),this._temp_texture_out.drawTo(function(){xr.toViewport(Ur,$r)}),this.setOutputData(0,this._temp_texture_out),this._temp_texture=Or,this._temp_texture2=xr}else this.setOutputData(0,this._temp_texture_out);this.setOutputData(1,this._temp_texture2),this.frame++}},vr.pixel_shader_copy=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_isamples;
			varying vec2 v_coord;
			
			void main() {
				if( v_coord.x <= u_isamples )
					gl_FragColor = texture2D( u_texture, vec2(0.5) );
				else
					gl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );
			}
			`,vr.pixel_shader_avg=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform int u_samples;
			uniform float u_isamples;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = vec4(0.0);
				for(int i = 0; i < 64; ++i)
				{
					color += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );
					if(i == (u_samples - 1))
						break;
				}
				gl_FragColor = color * u_isamples;
			}
			`,t.registerNodeType("texture/linear_avg_smooth",vr);function mr(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}mr.title="Image to Texture",mr.desc="Uploads an image to the GPU",mr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr){var br=pr.videoWidth||pr.width,Cr=pr.videoHeight||pr.height;if(pr.gltexture){this.setOutputData(0,pr.gltexture);return}var Rr=this._temp_texture;(!Rr||Rr.width!=br||Rr.height!=Cr)&&(this._temp_texture=new GL.Texture(br,Cr,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(pr)}catch(Mr){console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+Mr);return}this.setOutputData(0,this._temp_texture)}},t.registerNodeType("texture/imageToTexture",mr);function dr(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={enabled:!0,intensity:1,precision:Ae.DEFAULT,texture:null},dr._shader||(dr._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,dr.pixel_shader))}dr.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:Ae.MODE_VALUES}},dr.title="LUT",dr.desc="Apply LUT to Texture",dr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(this.properties.precision===Ae.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,pr);return}if(pr){var br=this.getInputData(1);if(br||(br=Ae.getTexture(this.properties.texture)),!br){this.setOutputData(0,pr);return}br.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var Cr=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=Cr=this.getInputData(2)),this._tex=Ae.getTargetTexture(pr,this._tex,this.properties.precision),this._tex.drawTo(function(){br.bind(1),pr.toViewport(dr._shader,{u_texture:0,u_textureB:1,u_amount:Cr})}),this.setOutputData(0,this._tex)}}},dr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_amount;
			
			void main() {
				 lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );
				 mediump float blueColor = textureColor.b * 63.0;
				 mediump vec2 quad1;
				 quad1.y = floor(floor(blueColor) / 8.0);
				 quad1.x = floor(blueColor) - (quad1.y * 8.0);
				 mediump vec2 quad2;
				 quad2.y = floor(ceil(blueColor) / 8.0);
				 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
				 highp vec2 texPos1;
				 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
				 texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
				 highp vec2 texPos2;
				 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
				 texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
				 lowp vec4 newColor1 = texture2D(u_textureB, texPos1);
				 lowp vec4 newColor2 = texture2D(u_textureB, texPos2);
				 lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
				 gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);
			}
			`,t.registerNodeType("texture/LUT",dr);function lr(){this.addInput("Texture","Texture"),this.addInput("Atlas","Texture"),this.addOutput("","Texture"),this.properties={enabled:!0,num_row_symbols:4,symbol_size:16,brightness:1,colorize:!1,filter:!1,invert:!1,precision:Ae.DEFAULT,generate_mipmaps:!1,texture:null},lr._shader||(lr._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,lr.pixel_shader)),this._uniforms={u_texture:0,u_textureB:1,u_row_simbols:4,u_simbol_size:16,u_res:vec2.create()}}lr.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:Ae.MODE_VALUES}},lr.title="Encode",lr.desc="Apply a texture atlas to encode a texture",lr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(this.properties.precision===Ae.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,pr);return}if(pr){var br=this.getInputData(1);if(br||(br=Ae.getTexture(this.properties.texture)),!br){this.setOutputData(0,pr);return}br.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var Cr=this._uniforms;Cr.u_row_simbols=Math.floor(this.properties.num_row_symbols),Cr.u_symbol_size=this.properties.symbol_size,Cr.u_brightness=this.properties.brightness,Cr.u_invert=this.properties.invert?1:0,Cr.u_colorize=this.properties.colorize?1:0,this._tex=Ae.getTargetTexture(pr,this._tex,this.properties.precision),Cr.u_res[0]=this._tex.width,Cr.u_res[1]=this._tex.height,this._tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),this._tex.drawTo(function(){br.bind(1),pr.toViewport(lr._shader,Cr)}),this.properties.generate_mipmaps&&(this._tex.bind(0),gl.generateMipmap(this._tex.texture_type),this._tex.unbind(0)),this.setOutputData(0,this._tex)}}},lr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_row_simbols;
			uniform float u_symbol_size;
			uniform float u_brightness;
			uniform float u_invert;
			uniform float u_colorize;
			uniform vec2 u_res;
			
			void main() {
				vec2 total_symbols = u_res / u_symbol_size;
				vec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate 
				vec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;
				lowp vec4 textureColor = texture2D(u_texture, uv );
				float lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);
				if( u_invert == 1.0 ) lum = 1.0 - lum;
				float index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));
				float col = mod( index, u_row_simbols );
				float row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;
				vec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;
				vec4 color = texture2D( u_textureB, simbol_uv );
				if(u_colorize == 1.0)
					color *= textureColor;
				gl_FragColor = color;
			}
			`,t.registerNodeType("texture/encode",lr);function gr(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),gr._shader||(gr._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,gr.pixel_shader))}gr.title="Texture to Channels",gr.desc="Split texture channels",gr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr){this._channels||(this._channels=Array(4));for(var br=gl.RGB,Cr=0,Rr=0;Rr<4;Rr++)this.isOutputConnected(Rr)?((!this._channels[Rr]||this._channels[Rr].width!=pr.width||this._channels[Rr].height!=pr.height||this._channels[Rr].type!=pr.type||this._channels[Rr].format!=br)&&(this._channels[Rr]=new GL.Texture(pr.width,pr.height,{type:pr.type,format:br,filter:gl.LINEAR})),Cr++):this._channels[Rr]=null;if(Cr){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);for(var Mr=Mesh.getScreenQuad(),Fr=gr._shader,xr=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],Rr=0;Rr<4;Rr++)this._channels[Rr]&&(this._channels[Rr].drawTo(function(){pr.bind(0),Fr.uniforms({u_texture:0,u_mask:xr[Rr]}).draw(Mr)}),this.setOutputData(Rr,this._channels[Rr]))}}},gr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec4 u_mask;
			
			void main() {
			   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );
			}
			`,t.registerNodeType("texture/textureChannels",gr);function fr(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:Ae.DEFAULT,R:1,G:1,B:1,A:1},this._color=vec4.create(),this._uniforms={u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3,u_color:this._color}}fr.title="Channels to Texture",fr.desc="Split texture channels",fr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},fr.prototype.onExecute=function(){var pr=Ae.getWhiteTexture(),br=this.getInputData(0)||pr,Cr=this.getInputData(1)||pr,Rr=this.getInputData(2)||pr,Mr=this.getInputData(3)||pr;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Fr=Mesh.getScreenQuad();fr._shader||(fr._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,fr.pixel_shader));var xr=fr._shader,Or=Math.max(br.width,Cr.width,Rr.width,Mr.width),Pr=Math.max(br.height,Cr.height,Rr.height,Mr.height),Ur=this.properties.precision==Ae.HIGH?Ae.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._texture||this._texture.width!=Or||this._texture.height!=Pr||this._texture.type!=Ur)&&(this._texture=new GL.Texture(Or,Pr,{type:Ur,format:gl.RGBA,filter:gl.LINEAR}));var $r=this._color;$r[0]=this.properties.R,$r[1]=this.properties.G,$r[2]=this.properties.B,$r[3]=this.properties.A;var Wr=this._uniforms;this._texture.drawTo(function(){br.bind(0),Cr.bind(1),Rr.bind(2),Mr.bind(3),xr.uniforms(Wr).draw(Fr)}),this.setOutputData(0,this._texture)},fr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_textureR;
			uniform sampler2D u_textureG;
			uniform sampler2D u_textureB;
			uniform sampler2D u_textureA;
			uniform vec4 u_color;
			
			void main() {
			   gl_FragColor = u_color * vec4( 						texture2D(u_textureR, v_coord).r,						texture2D(u_textureG, v_coord).r,						texture2D(u_textureB, v_coord).r,						texture2D(u_textureA, v_coord).r);
			}
			`,t.registerNodeType("texture/channelsTexture",fr);function yr(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:Ae.DEFAULT}}yr.title="Color",yr.desc="Generates a 1x1 texture with a constant color",yr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},yr.prototype.onDrawBackground=function(pr){var br=this.properties.color;pr.fillStyle="rgb("+Math.floor(clamp(br[0],0,1)*255)+","+Math.floor(clamp(br[1],0,1)*255)+","+Math.floor(clamp(br[2],0,1)*255)+")",this.flags.collapsed?this.boxcolor=pr.fillStyle:pr.fillRect(0,0,this.size[0],this.size[1])},yr.prototype.onExecute=function(){var pr=this.properties.precision==Ae.HIGH?Ae.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._tex||this._tex.type!=pr)&&(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:pr,minFilter:gl.NEAREST}));var br=this.properties.color;if(this.inputs)for(var Cr=0;Cr<this.inputs.length;Cr++){var Rr=this.inputs[Cr],Mr=this.getInputData(Cr);if(Mr!==void 0)switch(Rr.name){case"RGB":case"RGBA":br.set(Mr);break;case"R":br[0]=Mr;break;case"G":br[1]=Mr;break;case"B":br[2]=Mr;break;case"A":br[3]=Mr;break}}vec4.sqrDist(this._tex_color,br)>.001&&(this._tex_color.set(br),this._tex.fill(br)),this.setOutputData(0,this._tex)},yr.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},t.registerNodeType("texture/color",yr);function Er(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},Er._shader||(Er._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Er.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}Er.title="Gradient",Er.desc="Generates a gradient",Er["@A"]={type:"color"},Er["@B"]={type:"color"},Er["@texture_size"]={type:"enum",values:[32,64,128,256,512]},Er.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var pr=GL.Mesh.getScreenQuad(),br=Er._shader,Cr=this.getInputData(0);Cr||(Cr=this.properties.A);var Rr=this.getInputData(1);Rr||(Rr=this.properties.B);for(var Mr=2;Mr<this.inputs.length;Mr++){var Fr=this.inputs[Mr],xr=this.getInputData(Mr);xr!==void 0&&(this.properties[Fr.name]=xr)}var Or=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(Or.u_colorA,Cr),vec3.copy(Or.u_colorB,Rr);var Pr=parseInt(this.properties.texture_size);(!this._tex||this._tex.width!=Pr)&&(this._tex=new GL.Texture(Pr,Pr,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo(function(){br.uniforms(Or).draw(pr)}),this.setOutputData(0,this._tex)},Er.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},Er.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform float u_angle;
			uniform float u_scale;
			uniform vec3 u_colorA;
			uniform vec3 u_colorB;
			
			vec2 rotate(vec2 v, float angle)
			{
				vec2 result;
				float _cos = cos(angle);
				float _sin = sin(angle);
				result.x = v.x * _cos - v.y * _sin;
				result.y = v.x * _sin + v.y * _cos;
				return result;
			}
			void main() {
				float f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;
				vec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));
			   gl_FragColor = vec4(color,1.0);
			}
			`,t.registerNodeType("texture/gradient",Er);function wr(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,size_from_biggest:!0,invert:!1,precision:Ae.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}wr.title="Mix",wr.desc="Generates a texture mixing two textures",wr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},wr.prototype.onExecute=function(){var pr=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===Ae.PASS_THROUGH){this.setOutputData(0,pr);return}var br=this.getInputData(1);if(!(!pr||!br)){var Cr=this.getInputData(2),Rr=this.getInputData(3);this._tex=Ae.getTargetTexture(this.properties.size_from_biggest&&br.width>pr.width?br:pr,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Mr=Mesh.getScreenQuad(),Fr=null,xr=this._uniforms;if(Cr)Fr=wr._shader_tex,Fr||(Fr=wr._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,wr.pixel_shader,{MIX_TEX:""}));else{Fr=wr._shader_factor,Fr||(Fr=wr._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,wr.pixel_shader));var Or=Rr??this.properties.factor;xr.u_mix.set([Or,Or,Or,Or])}var Pr=this.properties.invert;this._tex.drawTo(function(){pr.bind(Pr?1:0),br.bind(Pr?0:1),Cr&&Cr.bind(2),Fr.uniforms(xr).draw(Mr)}),this.setOutputData(0,this._tex)}}},wr.prototype.onGetInputs=function(){return[["factor","number"]]},wr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_textureA;
			uniform sampler2D u_textureB;
			#ifdef MIX_TEX
				uniform sampler2D u_textureMix;
			#else
				uniform vec4 u_mix;
			#endif
			
			void main() {
				#ifdef MIX_TEX
				   vec4 f = texture2D(u_textureMix, v_coord);
				#else
				   vec4 f = u_mix;
				#endif
			   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );
			}
			`,t.registerNodeType("texture/mix",wr);function Dr(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:Ae.DEFAULT},Dr._shader||(Dr._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Dr.pixel_shader))}Dr.title="Edges",Dr.desc="Detects edges",Dr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},Dr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(this.properties.precision===Ae.PASS_THROUGH){this.setOutputData(0,pr);return}if(pr){this._tex=Ae.getTargetTexture(pr,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var br=Mesh.getScreenQuad(),Cr=Dr._shader,Rr=this.properties.invert,Mr=this.properties.factor,Fr=this.properties.threshold?1:0;this._tex.drawTo(function(){pr.bind(0),Cr.uniforms({u_texture:0,u_isize:[1/pr.width,1/pr.height],u_factor:Mr,u_threshold:Fr,u_invert:Rr?1:0}).draw(br)}),this.setOutputData(0,this._tex)}}},Dr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_isize;
			uniform int u_invert;
			uniform float u_factor;
			uniform float u_threshold;
			
			void main() {
				vec4 center = texture2D(u_texture, v_coord);
				vec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );
				vec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );
				vec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );
				vec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );
				vec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);
				diff *= u_factor;
				if(u_invert == 1)
					diff.xyz = vec3(1.0) - diff.xyz;
				if( u_threshold == 0.0 )
					gl_FragColor = vec4( diff.xyz, center.a );
				else
					gl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );
			}
			`,t.registerNodeType("texture/edges",Dr);function kr(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}kr.title="Depth Range",kr.desc="Generates a texture with a depth range",kr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(pr){var br=gl.UNSIGNED_BYTE;this.properties.high_precision&&(br=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=br||this._temp_texture.width!=pr.width||this._temp_texture.height!=pr.height)&&(this._temp_texture=new GL.Texture(pr.width,pr.height,{type:br,format:gl.RGBA,filter:gl.LINEAR}));var Cr=this._uniforms,Rr=this.properties.distance;this.isInputConnected(1)&&(Rr=this.getInputData(1),this.properties.distance=Rr);var Mr=this.properties.range;this.isInputConnected(2)&&(Mr=this.getInputData(2),this.properties.range=Mr),Cr.u_distance=Rr,Cr.u_range=Mr,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Fr=Mesh.getScreenQuad();kr._shader||(kr._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,kr.pixel_shader),kr._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,kr.pixel_shader,{ONLY_DEPTH:""}));var xr=this.properties.only_depth?kr._shader_onlydepth:kr._shader,Or=null;pr.near_far_planes?Or=pr.near_far_planes:window.LS&&LS.Renderer._main_camera?Or=LS.Renderer._main_camera._uniforms.u_camera_planes:Or=[.1,1e3],Cr.u_camera_planes=Or,this._temp_texture.drawTo(function(){pr.bind(0),xr.uniforms(Cr).draw(Fr)}),this._temp_texture.near_far_planes=Or,this.setOutputData(0,this._temp_texture)}}},kr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_camera_planes;
			uniform float u_distance;
			uniform float u_range;
			
			float LinearDepth()
			{
				float zNear = u_camera_planes.x;
				float zFar = u_camera_planes.y;
				float depth = texture2D(u_texture, v_coord).x;
				depth = depth * 2.0 - 1.0;
				return zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
			}
			
			void main() {
				float depth = LinearDepth();
				#ifdef ONLY_DEPTH
				   gl_FragColor = vec4(depth);
				#else
					float diff = abs(depth * u_camera_planes.y - u_distance);
					float dof = 1.0;
					if(diff <= u_range)
						dof = diff / u_range;
				   gl_FragColor = vec4(dof);
				#endif
			}
			`,t.registerNodeType("texture/depth_range",kr);function zr(){this.addInput("Texture","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:Ae.DEFAULT,invert:!1},this._uniforms={u_texture:0,u_camera_planes:null,u_ires:vec2.create()}}zr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},zr.title="Linear Depth",zr.desc="Creates a color texture with linear depth",zr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(!(!pr||pr.format!=gl.DEPTH_COMPONENT&&pr.format!=gl.DEPTH_STENCIL)){var br=this.properties.precision==Ae.HIGH?gl.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._temp_texture||this._temp_texture.type!=br||this._temp_texture.width!=pr.width||this._temp_texture.height!=pr.height)&&(this._temp_texture=new GL.Texture(pr.width,pr.height,{type:br,format:gl.RGB,filter:gl.LINEAR}));var Cr=this._uniforms;Cr.u_invert=this.properties.invert?1:0,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Rr=Mesh.getScreenQuad();zr._shader||(zr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,zr.pixel_shader));var Mr=zr._shader,Fr=null;pr.near_far_planes?Fr=pr.near_far_planes:window.LS&&LS.Renderer._main_camera?Fr=LS.Renderer._main_camera._uniforms.u_camera_planes:Fr=[.1,1e3],Cr.u_camera_planes=Fr,Cr.u_ires.set([0,0]),this._temp_texture.drawTo(function(){pr.bind(0),Mr.uniforms(Cr).draw(Rr)}),this._temp_texture.near_far_planes=Fr,this.setOutputData(0,this._temp_texture)}}},zr.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_camera_planes;
			uniform int u_invert;
			uniform vec2 u_ires;
			
			void main() {
				float zNear = u_camera_planes.x;
				float zFar = u_camera_planes.y;
				float depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;
				float f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
				if( u_invert == 1 )
					f = 1.0 - f;
				gl_FragColor = vec4(vec3(f),1.0);
			}
			`,t.registerNodeType("texture/linear_depth",zr);function Vr(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:Ae.DEFAULT}}Vr.title="Blur",Vr.desc="Blur a texture",Vr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},Vr.max_iterations=20,Vr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr&&this.isOutputConnected(0)){var br=this._final_texture;(!br||br.width!=pr.width||br.height!=pr.height||br.type!=pr.type)&&(br=this._final_texture=new GL.Texture(pr.width,pr.height,{type:pr.type,format:gl.RGBA,filter:gl.LINEAR}));var Cr=this.properties.iterations;if(this.isInputConnected(1)&&(Cr=this.getInputData(1),this.properties.iterations=Cr),Cr=Math.min(Math.floor(Cr),Vr.max_iterations),Cr==0){this.setOutputData(0,pr);return}var Rr=this.properties.intensity;this.isInputConnected(2)&&(Rr=this.getInputData(2),this.properties.intensity=Rr);var Mr=t.camera_aspect;!Mr&&window.gl!==void 0&&(Mr=gl.canvas.height/gl.canvas.width),Mr||(Mr=1),Mr=this.properties.preserve_aspect?Mr:1;var Fr=this.properties.scale||[1,1];pr.applyBlur(Mr*Fr[0],Fr[1],Rr,br);for(var xr=1;xr<Cr;++xr)br.applyBlur(Mr*Fr[0]*(xr+1),Fr[1]*(xr+1),Rr);this.setOutputData(0,br)}},t.registerNodeType("texture/blur",Vr);function Hr(){this.intensity=.5,this.persistence=.6,this.iterations=8,this.threshold=.8,this.scale=1,this.dirt_texture=null,this.dirt_factor=.5,this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}Hr.prototype.applyFX=function(pr,br,Cr,Rr){var Mr=pr.width,Fr=pr.height,xr={format:pr.format,type:pr.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},Or=this._uniforms,Pr=this._textures,Xr=Hr._cut_shader;Xr||(Xr=Hr._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Hr.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),Or.u_threshold=this.threshold;var Ur=Pr[0]=GL.Texture.getTemporary(Mr,Fr,xr);pr.blit(Ur,Xr.uniforms(Or));var $r=Ur,Wr=this.iterations;Wr=clamp(Wr,1,16)|0;var Kr=Or.u_texel_size,Jr=this.intensity;Or.u_intensity=1,Or.u_delta=this.scale;var Xr=Hr._shader;Xr||(Xr=Hr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Hr.scale_pixel_shader));for(var qr=1;qr<Wr&&(Mr=Mr>>1,(Fr|0)>1&&(Fr=Fr>>1),!(Mr<2));qr++)Ur=Pr[qr]=GL.Texture.getTemporary(Mr,Fr,xr),Kr[0]=1/$r.width,Kr[1]=1/$r.height,$r.blit(Ur,Xr.uniforms(Or)),$r=Ur;for(Rr&&(Kr[0]=1/$r.width,Kr[1]=1/$r.height,Or.u_intensity=Jr,Or.u_delta=1,$r.blit(Rr,Xr.uniforms(Or))),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),Or.u_intensity=this.persistence,Or.u_delta=.5,qr-=2;qr>=0;qr--)Ur=Pr[qr],Pr[qr]=null,Kr[0]=1/$r.width,Kr[1]=1/$r.height,$r.blit(Ur,Xr.uniforms(Or)),GL.Texture.releaseTemporary($r),$r=Ur;if(gl.disable(gl.BLEND),Cr&&$r.blit(Cr),br){var io=br,Zr=this.dirt_texture,eo=this.dirt_factor;Or.u_intensity=Jr,Xr=Zr?Hr._dirt_final_shader:Hr._final_shader,Xr||(Zr?Xr=Hr._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Hr.final_pixel_shader,{USE_DIRT:""}):Xr=Hr._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Hr.final_pixel_shader)),io.drawTo(function(){pr.bind(0),$r.bind(1),Zr&&(Xr.setUniform("u_dirt_factor",eo),Xr.setUniform("u_dirt_texture",Zr.bind(2))),Xr.toViewport(Or)})}GL.Texture.releaseTemporary($r)},Hr.cut_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform float u_threshold;
		void main() {
			gl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );
		}`,Hr.scale_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform vec2 u_texel_size;
		uniform float u_delta;
		uniform float u_intensity;
		
		vec4 sampleBox(vec2 uv) {
			vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
			vec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);
			return s * 0.25;
		}
		void main() {
			gl_FragColor = u_intensity * sampleBox( v_coord );
		}`,Hr.final_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform sampler2D u_glow_texture;
		#ifdef USE_DIRT
			uniform sampler2D u_dirt_texture;
		#endif
		uniform vec2 u_texel_size;
		uniform float u_delta;
		uniform float u_intensity;
		uniform float u_dirt_factor;
		
		vec4 sampleBox(vec2 uv) {
			vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
			vec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);
			return s * 0.25;
		}
		void main() {
			vec4 glow = sampleBox( v_coord );
			#ifdef USE_DIRT
				glow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );
			#endif
			gl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;
		}`;function Sr(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:Ae.DEFAULT},this.fx=new Hr}Sr.title="Glow",Sr.desc="Filters a texture giving it a glow effect",Sr.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:Ae.MODE_VALUES}},Sr.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},Sr.prototype.onGetOutputs=function(){return[["average","Texture"]]},Sr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr&&this.isAnyOutputConnected()){if(this.properties.precision===Ae.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,pr);return}pr.width,pr.height;var br=this.fx;br.threshold=this.getInputOrProperty("threshold"),br.iterations=this.getInputOrProperty("iterations"),br.intensity=this.getInputOrProperty("intensity"),br.persistence=this.getInputOrProperty("persistence"),br.dirt_texture=this.getInputData(1),br.dirt_factor=this.getInputOrProperty("dirt_factor"),br.scale=this.properties.scale;var Cr=Ae.getTextureType(this.properties.precision,pr),Rr=null;this.isOutputConnected(2)&&(Rr=this._average_texture,(!Rr||Rr.type!=pr.type||Rr.format!=pr.format)&&(Rr=this._average_texture=new GL.Texture(1,1,{type:pr.type,format:pr.format,filter:gl.LINEAR})));var Mr=null;this.isOutputConnected(1)&&(Mr=this._glow_texture,(!Mr||Mr.width!=pr.width||Mr.height!=pr.height||Mr.type!=Cr||Mr.format!=pr.format)&&(Mr=this._glow_texture=new GL.Texture(pr.width,pr.height,{type:Cr,format:pr.format,filter:gl.LINEAR})));var Fr=null;this.isOutputConnected(0)&&(Fr=this._final_texture,(!Fr||Fr.width!=pr.width||Fr.height!=pr.height||Fr.type!=Cr||Fr.format!=pr.format)&&(Fr=this._final_texture=new GL.Texture(pr.width,pr.height,{type:Cr,format:pr.format,filter:gl.LINEAR}))),br.applyFX(pr,Fr,Mr,Rr),this.isOutputConnected(0)&&this.setOutputData(0,Fr),this.isOutputConnected(1)&&this.setOutputData(1,Rr),this.isOutputConnected(2)&&this.setOutputData(2,Mr)}},t.registerNodeType("texture/glow",Sr);function Ar(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}Ar.title="Kuwahara Filter",Ar.desc="Filters a texture giving an artistic oil canvas painting",Ar.max_radius=10,Ar._shaders=[],Ar.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr&&this.isOutputConnected(0)){var br=this._temp_texture;(!br||br.width!=pr.width||br.height!=pr.height||br.type!=pr.type)&&(this._temp_texture=new GL.Texture(pr.width,pr.height,{type:pr.type,format:gl.RGBA,filter:gl.LINEAR}));var Cr=this.properties.radius;if(Cr=Math.min(Math.floor(Cr),Ar.max_radius),Cr==0){this.setOutputData(0,pr);return}var Rr=this.properties.intensity,Mr=t.camera_aspect;!Mr&&window.gl!==void 0&&(Mr=gl.canvas.height/gl.canvas.width),Mr||(Mr=1),Mr=this.properties.preserve_aspect?Mr:1,Ar._shaders[Cr]||(Ar._shaders[Cr]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Ar.pixel_shader,{RADIUS:Cr.toFixed(0)}));var Fr=Ar._shaders[Cr],xr=GL.Mesh.getScreenQuad();pr.bind(0),this._temp_texture.drawTo(function(){Fr.uniforms({u_texture:0,u_intensity:Rr,u_resolution:[pr.width,pr.height],u_iResolution:[1/pr.width,1/pr.height]}).draw(xr)}),this.setOutputData(0,this._temp_texture)}},Ar.pixel_shader=`
	precision highp float;
	varying vec2 v_coord;
	uniform sampler2D u_texture;
	uniform float u_intensity;
	uniform vec2 u_resolution;
	uniform vec2 u_iResolution;
	#ifndef RADIUS
		#define RADIUS 7
	#endif
	void main() {
	
		const int radius = RADIUS;
		vec2 fragCoord = v_coord;
		vec2 src_size = u_iResolution;
		vec2 uv = v_coord;
		float n = float((radius + 1) * (radius + 1));
		int i;
		int j;
		vec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);
		vec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);
		vec3 c;
		
		for (int j = -radius; j <= 0; ++j)  {
			for (int i = -radius; i <= 0; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m0 += c;
				s0 += c * c;
			}
		}
		
		for (int j = -radius; j <= 0; ++j)  {
			for (int i = 0; i <= radius; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m1 += c;
				s1 += c * c;
			}
		}
		
		for (int j = 0; j <= radius; ++j)  {
			for (int i = 0; i <= radius; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m2 += c;
				s2 += c * c;
			}
		}
		
		for (int j = 0; j <= radius; ++j)  {
			for (int i = -radius; i <= 0; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m3 += c;
				s3 += c * c;
			}
		}
		
		float min_sigma2 = 1e+2;
		m0 /= n;
		s0 = abs(s0 / n - m0 * m0);
		
		float sigma2 = s0.r + s0.g + s0.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m0, 1.0);
		}
		
		m1 /= n;
		s1 = abs(s1 / n - m1 * m1);
		
		sigma2 = s1.r + s1.g + s1.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m1, 1.0);
		}
		
		m2 /= n;
		s2 = abs(s2 / n - m2 * m2);
		
		sigma2 = s2.r + s2.g + s2.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m2, 1.0);
		}
		
		m3 /= n;
		s3 = abs(s3 / n - m3 * m3);
		
		sigma2 = s3.r + s3.g + s3.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m3, 1.0);
		}
	}
	`,t.registerNodeType("texture/kuwahara",Ar);function _r(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={sigma:1.4,k:1.6,p:21.7,epsilon:79,phi:.017}}_r.title="XDoG Filter",_r.desc="Filters a texture giving an artistic ink style",_r.max_radius=10,_r._shaders=[],_r.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr&&this.isOutputConnected(0)){var br=this._temp_texture;(!br||br.width!=pr.width||br.height!=pr.height||br.type!=pr.type)&&(this._temp_texture=new GL.Texture(pr.width,pr.height,{type:pr.type,format:gl.RGBA,filter:gl.LINEAR})),_r._xdog_shader||(_r._xdog_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,_r.xdog_pixel_shader));var Cr=_r._xdog_shader,Rr=GL.Mesh.getScreenQuad(),Mr=this.properties.sigma,Fr=this.properties.k,xr=this.properties.p,Or=this.properties.epsilon,Pr=this.properties.phi;pr.bind(0),this._temp_texture.drawTo(function(){Cr.uniforms({src:0,sigma:Mr,k:Fr,p:xr,epsilon:Or,phi:Pr,cvsWidth:pr.width,cvsHeight:pr.height}).draw(Rr)}),this.setOutputData(0,this._temp_texture)}},_r.xdog_pixel_shader=`
	precision highp float;
	uniform sampler2D src;

	uniform float cvsHeight;
	uniform float cvsWidth;

	uniform float sigma;
	uniform float k;
	uniform float p;
	uniform float epsilon;
	uniform float phi;
	varying vec2 v_coord;

	float cosh(float val)
	{
		float tmp = exp(val);
		float cosH = (tmp + 1.0 / tmp) / 2.0;
		return cosH;
	}

	float tanh(float val)
	{
		float tmp = exp(val);
		float tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);
		return tanH;
	}

	float sinh(float val)
	{
		float tmp = exp(val);
		float sinH = (tmp - 1.0 / tmp) / 2.0;
		return sinH;
	}

	void main(void){
		vec3 destColor = vec3(0.0);
		float tFrag = 1.0 / cvsHeight;
		float sFrag = 1.0 / cvsWidth;
		vec2 Frag = vec2(sFrag,tFrag);
		vec2 uv = gl_FragCoord.st;
		float twoSigmaESquared = 2.0 * sigma * sigma;
		float twoSigmaRSquared = twoSigmaESquared * k * k;
		int halfWidth = int(ceil( 1.0 * sigma * k ));

		const int MAX_NUM_ITERATION = 99999;
		vec2 sum = vec2(0.0);
		vec2 norm = vec2(0.0);

		for(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){
			if(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}
			int i = int(cnt / (2*halfWidth+1)) - halfWidth;
			int j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);

			float d = length(vec2(i,j));
			vec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), 
								exp( -d * d / twoSigmaRSquared ));

			vec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;

			norm += kernel;
			sum += kernel * L;
		}

		sum /= norm;

		float H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);
		float edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));
		destColor = vec3(edge);
		gl_FragColor = vec4(destColor, 1.0);
	}`,t.registerNodeType("texture/xDoG",_r);function Nr(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}Nr.title="Webcam",Nr.desc="Webcam texture",Nr.is_webcam_open=!1,Nr.prototype.openStream=function(){if(!navigator.getUserMedia)return;this._waiting_confirmation=!0;var pr={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(pr).then(this.streamReady.bind(this)).catch(Cr);var br=this;function Cr(Rr){Nr.is_webcam_open=!1,console.log("Webcam rejected",Rr),br._webcam_stream=!1,br.boxcolor="red",br.trigger("stream_error")}},Nr.prototype.closeStream=function(){if(this._webcam_stream){var pr=this._webcam_stream.getTracks();if(pr.length)for(var br=0;br<pr.length;++br)pr[br].stop();Nr.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},Nr.prototype.streamReady=function(pr){this._webcam_stream=pr,this.boxcolor="green";var br=this._video;br||(br=document.createElement("video"),br.autoplay=!0,br.srcObject=pr,this._video=br,br.onloadedmetadata=function(Cr){Nr.is_webcam_open=!0,console.log(Cr)}),this.trigger("stream_ready",br)},Nr.prototype.onPropertyChanged=function(pr,br){pr=="facingMode"&&(this.properties.facingMode=br,this.closeStream(),this.openStream())},Nr.prototype.onRemoved=function(){if(this._webcam_stream){var pr=this._webcam_stream.getTracks();if(pr.length)for(var br=0;br<pr.length;++br)pr[br].stop();this._webcam_stream=null,this._video=null}},Nr.prototype.onDrawBackground=function(pr){this.flags.collapsed||this.size[1]<=20||this._video&&(pr.save(),pr.webgl?this._video_texture&&pr.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):pr.drawImage(this._video,0,0,this.size[0],this.size[1]),pr.restore())},Nr.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){var pr=this._video.videoWidth,br=this._video.videoHeight,Cr=this._video_texture;if((!Cr||Cr.width!=pr||Cr.height!=br)&&(this._video_texture=new GL.Texture(pr,br,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name){var Rr=Ae.getTexturesContainer();Rr[this.properties.texture_name]=this._video_texture}this.setOutputData(0,this._video_texture);for(var Mr=1;Mr<this.outputs.length;++Mr)if(this.outputs[Mr])switch(this.outputs[Mr].name){case"width":this.setOutputData(Mr,this._video.videoWidth);break;case"height":this.setOutputData(Mr,this._video.videoHeight);break}}},Nr.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",t.EVENT],["stream_closed",t.EVENT],["stream_error",t.EVENT]]},t.registerNodeType("texture/webcam",Nr);function Tr(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:Ae.LOW},this._uniforms={u_texture:0,u_factor:1}}Tr.title="Lens FX",Tr.desc="distortion and chromatic aberration",Tr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},Tr.prototype.onGetInputs=function(){return[["enabled","boolean"]]},Tr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr&&this.isOutputConnected(0)){if(this.properties.precision===Ae.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,pr);return}var br=this._temp_texture;(!br||br.width!=pr.width||br.height!=pr.height||br.type!=pr.type)&&(br=this._temp_texture=new GL.Texture(pr.width,pr.height,{type:pr.type,format:gl.RGBA,filter:gl.LINEAR}));var Cr=Tr._shader;Cr||(Cr=Tr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Tr.pixel_shader));var Rr=this.getInputData(1);Rr==null&&(Rr=this.properties.factor);var Mr=this._uniforms;Mr.u_factor=Rr,gl.disable(gl.DEPTH_TEST),br.drawTo(function(){pr.bind(0),Cr.uniforms(Mr).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,br)}},Tr.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_factor;
			vec2 barrelDistortion(vec2 coord, float amt) {
				vec2 cc = coord - 0.5;
				float dist = dot(cc, cc);
				return coord + cc * dist * amt;
			}
			
			float sat( float t )
			{
				return clamp( t, 0.0, 1.0 );
			}
			
			float linterp( float t ) {
				return sat( 1.0 - abs( 2.0*t - 1.0 ) );
			}
			
			float remap( float t, float a, float b ) {
				return sat( (t - a) / (b - a) );
			}
			
			vec4 spectrum_offset( float t ) {
				vec4 ret;
				float lo = step(t,0.5);
				float hi = 1.0-lo;
				float w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );
				ret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);
			
				return pow( ret, vec4(1.0/2.2) );
			}
			
			const float max_distort = 2.2;
			const int num_iter = 12;
			const float reci_num_iter_f = 1.0 / float(num_iter);
			
			void main()
			{	
				vec2 uv=v_coord;
				vec4 sumcol = vec4(0.0);
				vec4 sumw = vec4(0.0);	
				for ( int i=0; i<num_iter;++i )
				{
					float t = float(i) * reci_num_iter_f;
					vec4 w = spectrum_offset( t );
					sumw += w;
					sumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );
				}
				gl_FragColor = sumcol / sumw;
			}`,t.registerNodeType("texture/lensfx",Tr);function Lr(){this.addInput("in",""),this.properties={precision:Ae.LOW,width:0,height:0,channels:1},this.addOutput("out","Texture")}Lr.title="Data->Tex",Lr.desc="Generates or applies a curve to a texture",Lr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},Lr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(pr){var br=this.properties.channels,Cr=this.properties.width,Rr=this.properties.height;(!Cr||!Rr)&&(Cr=Math.floor(pr.length/br),Rr=1);var Mr=gl.RGBA;br==3?Mr=gl.RGB:br==1&&(Mr=gl.LUMINANCE);var Fr=this._temp_texture,xr=Ae.getTextureType(this.properties.precision);(!Fr||Fr.width!=Cr||Fr.height!=Rr||Fr.type!=xr)&&(Fr=this._temp_texture=new GL.Texture(Cr,Rr,{type:xr,format:Mr,filter:gl.LINEAR})),Fr.uploadData(pr),this.setOutputData(0,Fr)}}},t.registerNodeType("texture/fromdata",Lr);function Ir(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={precision:Ae.LOW,split_channels:!1},this._values=new Uint8Array(256*4),this._values.fill(255),this._curve_texture=null,this._uniforms={u_texture:0,u_curve:1,u_range:1},this._must_update=!0,this._points={RGB:[[0,0],[1,1]],R:[[0,0],[1,1]],G:[[0,0],[1,1]],B:[[0,0],[1,1]]},this.curve_editor=null,this.addWidget("toggle","Split Channels",!1,"split_channels"),this.addWidget("combo","Channel","RGB",{values:["RGB","R","G","B"]}),this.curve_offset=68,this.size=[240,160]}Ir.title="Curve",Ir.desc="Generates or applies a curve to a texture",Ir.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},Ir.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0),br=this._temp_texture;if(!pr){(this._must_update||!this._curve_texture)&&this.updateCurve(),this.setOutputData(0,this._curve_texture);return}var Cr=Ae.getTextureType(this.properties.precision,pr);(!br||br.type!=Cr||br.width!=pr.width||br.height!=pr.height||br.format!=pr.format)&&(br=this._temp_texture=new GL.Texture(pr.width,pr.height,{type:Cr,format:pr.format,filter:gl.LINEAR}));var Rr=Ir._shader;Rr||(Rr=Ir._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Ir.pixel_shader)),(this._must_update||!this._curve_texture)&&this.updateCurve();var Mr=this._uniforms,Fr=this._curve_texture;br.drawTo(function(){gl.disable(gl.DEPTH_TEST),pr.bind(0),Fr.bind(1),Rr.uniforms(Mr).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,br)}},Ir.prototype.sampleCurve=function(pr,Cr){var Cr=Cr||this._points.RGB;if(Cr){for(var Rr=0;Rr<Cr.length-1;++Rr){var Mr=Cr[Rr],Fr=Cr[Rr+1];if(!(Fr[0]<pr)){var xr=Fr[0]-Mr[0];if(Math.abs(xr)<1e-5)return Mr[1];var Or=(pr-Mr[0])/xr;return Mr[1]*(1-Or)+Fr[1]*Or}}return 0}},Ir.prototype.updateCurve=function(){for(var pr=this._values,br=pr.length/4,Cr=this.properties.split_channels,Rr=0;Rr<br;++Rr){if(Cr)pr[Rr*4]=clamp(this.sampleCurve(Rr/br,this._points.R)*255,0,255),pr[Rr*4+1]=clamp(this.sampleCurve(Rr/br,this._points.G)*255,0,255),pr[Rr*4+2]=clamp(this.sampleCurve(Rr/br,this._points.B)*255,0,255);else{var Mr=this.sampleCurve(Rr/br);pr[Rr*4]=pr[Rr*4+1]=pr[Rr*4+2]=clamp(Mr*255,0,255)}pr[Rr*4+3]=255}this._curve_texture||(this._curve_texture=new GL.Texture(256,1,{format:gl.RGBA,magFilter:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE})),this._curve_texture.uploadData(pr,null,!0)},Ir.prototype.onSerialize=function(pr){var br={};for(var Cr in this._points)br[Cr]=this._points[Cr].concat();pr.curves=br},Ir.prototype.onConfigure=function(pr){this._points=pr.curves,this.curve_editor&&(curve_editor.points=this._points),this._must_update=!0},Ir.prototype.onMouseDown=function(pr,br,Cr){if(this.curve_editor){var Rr=this.curve_editor.onMouseDown([br[0],br[1]-this.curve_offset],Cr);return Rr&&this.captureInput(!0),Rr}},Ir.prototype.onMouseMove=function(pr,br,Cr){if(this.curve_editor)return this.curve_editor.onMouseMove([br[0],br[1]-this.curve_offset],Cr)},Ir.prototype.onMouseUp=function(pr,br,Cr){if(this.curve_editor)return this.curve_editor.onMouseUp([br[0],br[1]-this.curve_offset],Cr);this.captureInput(!1)},Ir.channel_line_colors={RGB:"#666",R:"#F33",G:"#3F3",B:"#33F"},Ir.prototype.onDrawBackground=function(pr,br){if(!this.flags.collapsed){this.curve_editor||(this.curve_editor=new t.CurveEditor(this._points.R)),pr.save(),pr.translate(0,this.curve_offset);var Cr=this.widgets[1].value;this.properties.split_channels?(Cr=="RGB"&&(this.widgets[1].value=Cr="R",this.widgets[1].disabled=!1),this.curve_editor.points=this._points.R,this.curve_editor.draw(pr,[this.size[0],this.size[1]-this.curve_offset],br,"#111",Ir.channel_line_colors.R,!0),pr.globalCompositeOperation="lighten",this.curve_editor.points=this._points.G,this.curve_editor.draw(pr,[this.size[0],this.size[1]-this.curve_offset],br,null,Ir.channel_line_colors.G,!0),this.curve_editor.points=this._points.B,this.curve_editor.draw(pr,[this.size[0],this.size[1]-this.curve_offset],br,null,Ir.channel_line_colors.B,!0),pr.globalCompositeOperation="source-over"):(this.widgets[1].value=Cr="RGB",this.widgets[1].disabled=!0),this.curve_editor.points=this._points[Cr],this.curve_editor.draw(pr,[this.size[0],this.size[1]-this.curve_offset],br,this.properties.split_channels?null:"#111",Ir.channel_line_colors[Cr]),pr.restore()}},Ir.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_curve;
			uniform float u_range;
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord ) * u_range;
				color.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;
				color.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;
				color.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;
				//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;
				gl_FragColor = color;
			}`,t.registerNodeType("texture/curve",Ir);function Gr(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:Ae.LOW},this._uniforms={u_texture:0,u_exposition:1}}Gr.title="Exposition",Gr.desc="Controls texture exposition",Gr.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:Ae.MODE_VALUES}},Gr.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr&&this.isOutputConnected(0)){var br=this._temp_texture;(!br||br.width!=pr.width||br.height!=pr.height||br.type!=pr.type)&&(br=this._temp_texture=new GL.Texture(pr.width,pr.height,{type:pr.type,format:gl.RGBA,filter:gl.LINEAR}));var Cr=Gr._shader;Cr||(Cr=Gr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Gr.pixel_shader)),this.properties.exposition;var Rr=this.getInputData(1);Rr!=null&&(this.properties.exposition=Rr);var Mr=this._uniforms;br.drawTo(function(){gl.disable(gl.DEPTH_TEST),pr.bind(0),Cr.uniforms(Mr).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,br)}},Gr.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_exposition;
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord );
				gl_FragColor = vec4( color.xyz * u_exposition, color.a );
			}`,t.registerNodeType("texture/exposition",Gr);function Br(){this.addInput("in","Texture"),this.addInput("avg","number,Texture"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:Ae.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}Br.title="Tone Mapping",Br.desc="Applies Tone Mapping to convert from high to low",Br.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES}},Br.prototype.onGetInputs=function(){return[["enabled","boolean"]]},Br.prototype.onExecute=function(){var pr=this.getInputData(0);if(pr&&this.isOutputConnected(0)){if(this.properties.precision===Ae.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,pr);return}var br=this._temp_texture;(!br||br.width!=pr.width||br.height!=pr.height||br.type!=pr.type)&&(br=this._temp_texture=new GL.Texture(pr.width,pr.height,{type:pr.type,format:gl.RGBA,filter:gl.LINEAR}));var Cr=this.getInputData(1);Cr==null&&(Cr=this.properties.average_lum);var Rr=this._uniforms,Mr=null;Cr.constructor===Number?(this.properties.average_lum=Cr,Rr.u_average_lum=this.properties.average_lum,Mr=Br._shader,Mr||(Mr=Br._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Br.pixel_shader))):Cr.constructor===GL.Texture&&(Rr.u_average_texture=Cr.bind(1),Mr=Br._shader_texture,Mr||(Mr=Br._shader_texture=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Br.pixel_shader,{AVG_TEXTURE:""}))),Rr.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,Rr.u_scale=this.properties.scale,Rr.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),br.drawTo(function(){pr.bind(0),Mr.uniforms(Rr).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._temp_texture)}},Br.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_scale;
			#ifdef AVG_TEXTURE
				uniform sampler2D u_average_texture;
			#else
				uniform float u_average_lum;
			#endif
			uniform float u_lumwhite2;
			uniform float u_igamma;
			vec3 RGB2xyY (vec3 rgb)
			{
				 const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,
										   0.2126, 0.7152, 0.0722,
										   0.0193, 0.1192, 0.9505);
				vec3 XYZ = RGB2XYZ * rgb;
				
				float f = (XYZ.x + XYZ.y + XYZ.z);
				return vec3(XYZ.x / f,
							XYZ.y / f,
							XYZ.y);
			}
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord );
				vec3 rgb = color.xyz;
				float average_lum = 0.0;
				#ifdef AVG_TEXTURE
					vec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;
					average_lum = (pixel.x + pixel.y + pixel.z) / 3.0;
				#else
					average_lum = u_average_lum;
				#endif
				//Ld - this part of the code is the same for both versions
				float lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));
				float L = (u_scale / average_lum) * lum;
				float Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);
				//first
				//vec3 xyY = RGB2xyY(rgb);
				//xyY.z *= Ld;
				//rgb = xyYtoRGB(xyY);
				//second
				rgb = (rgb / lum) * Ld;
				rgb = max(rgb,vec3(0.001));
				rgb = pow( rgb, vec3( u_igamma ) );
				gl_FragColor = vec4( rgb, color.a );
			}`,t.registerNodeType("texture/tonemapping",Br);function jr(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:Ae.DEFAULT},this._key=0,this._texture=null,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}jr.title="Perlin",jr.desc="Generates a perlin noise texture",jr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1},octaves:{type:"number",precision:0,step:1,min:1,max:50}},jr.prototype.onGetInputs=function(){return[["seed","number"],["persistence","number"],["octaves","number"],["scale","number"],["amplitude","number"],["offset","vec2"]]},jr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.properties.width|0,br=this.properties.height|0;pr==0&&(pr=gl.viewport_data[2]),br==0&&(br=gl.viewport_data[3]);var Cr=Ae.getTextureType(this.properties.precision),Rr=this._texture;(!Rr||Rr.width!=pr||Rr.height!=br||Rr.type!=Cr)&&(Rr=this._texture=new GL.Texture(pr,br,{type:Cr,format:gl.RGB,filter:gl.LINEAR}));var Mr=this.getInputOrProperty("persistence"),Fr=this.getInputOrProperty("octaves"),xr=this.getInputOrProperty("offset"),Or=this.getInputOrProperty("scale"),Pr=this.getInputOrProperty("amplitude"),Ur=this.getInputOrProperty("seed"),$r=""+pr+br+Cr+Mr+Fr+Or+Ur+xr[0]+xr[1]+Pr;if($r==this._key){this.setOutputData(0,Rr);return}this._key=$r;var Wr=this._uniforms;Wr.u_persistence=Mr,Wr.u_octaves=Fr,Wr.u_offset.set(xr),Wr.u_scale=Or,Wr.u_amplitude=Pr,Wr.u_seed=Ur*128,Wr.u_viewport[0]=pr,Wr.u_viewport[1]=br;var Kr=jr._shader;Kr||(Kr=jr._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,jr.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Rr.drawTo(function(){Kr.uniforms(Wr).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,Rr)}},jr.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform vec2 u_offset;
			uniform float u_scale;
			uniform float u_persistence;
			uniform int u_octaves;
			uniform float u_amplitude;
			uniform vec2 u_viewport;
			uniform float u_seed;
			#define M_PI 3.14159265358979323846
			
			float rand(vec2 c){	return fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }
			
			float noise(vec2 p, float freq ){
				float unit = u_viewport.x/freq;
				vec2 ij = floor(p/unit);
				vec2 xy = mod(p,unit)/unit;
				//xy = 3.*xy*xy-2.*xy*xy*xy;
				xy = .5*(1.-cos(M_PI*xy));
				float a = rand((ij+vec2(0.,0.)));
				float b = rand((ij+vec2(1.,0.)));
				float c = rand((ij+vec2(0.,1.)));
				float d = rand((ij+vec2(1.,1.)));
				float x1 = mix(a, b, xy.x);
				float x2 = mix(c, d, xy.x);
				return mix(x1, x2, xy.y);
			}
			
			float pNoise(vec2 p, int res){
				float persistance = u_persistence;
				float n = 0.;
				float normK = 0.;
				float f = 4.;
				float amp = 1.0;
				int iCount = 0;
				for (int i = 0; i<50; i++){
					n+=amp*noise(p, f);
					f*=2.;
					normK+=amp;
					amp*=persistance;
					if (iCount >= res)
						break;
					iCount++;
				}
				float nf = n/normK;
				return nf*nf*nf*nf;
			}
			void main() {
				vec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;
				vec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );
				gl_FragColor = color;
			}`,t.registerNodeType("texture/perlin",jr);function Yr(){this.addInput("v"),this.addOutput("out","Texture"),this.properties={code:Yr.default_code,width:512,height:512,clear:!0,precision:Ae.DEFAULT,use_html_canvas:!1},this._func=null,this._temp_texture=null,this.compileCode()}Yr.title="Canvas2D",Yr.desc="Executes Canvas2D code inside a texture or the viewport.",Yr.help="Set width and height to 0 to match viewport size.",Yr.default_code=`//vars: canvas,ctx,time
ctx.fillStyle='red';
ctx.fillRect(0,0,50,50);
`,Yr.widgets_info={precision:{widget:"combo",values:Ae.MODE_VALUES},code:{type:"code"},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1}},Yr.prototype.onPropertyChanged=function(pr,br){pr=="code"&&this.compileCode(br)},Yr.prototype.compileCode=function(pr){if(this._func=null,!!t.allow_scripts)try{this._func=new Function("canvas","ctx","time","script","v",pr),this.boxcolor="#00FF00"}catch(br){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(br)}},Yr.prototype.onExecute=function(){var pr=this._func;!pr||!this.isOutputConnected(0)||this.executeDraw(pr)},Yr.prototype.executeDraw=function(pr){var br=this.properties.width||gl.canvas.width,Cr=this.properties.height||gl.canvas.height,Rr=this._temp_texture,Mr=Ae.getTextureType(this.properties.precision);(!Rr||Rr.width!=br||Rr.height!=Cr||Rr.type!=Mr)&&(Rr=this._temp_texture=new GL.Texture(br,Cr,{format:gl.RGBA,filter:gl.LINEAR,type:Mr}));var Fr=this.getInputData(0),xr=this.properties,Or=this,Pr=this.graph.getTime(),Ur=gl,$r=gl.canvas;if((this.properties.use_html_canvas||!s.enableWebGLCanvas)&&(this._canvas?($r=this._canvas,Ur=this._ctx):($r=this._canvas=createCanvas(br.height),Ur=this._ctx=$r.getContext("2d")),$r.width=br,$r.height=Cr),Ur==gl)Rr.drawTo(function(){gl.start2D(),xr.clear&&(gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT));try{pr.draw?pr.draw.call(Or,$r,Ur,Pr,pr,Fr):pr.call(Or,$r,Ur,Pr,pr,Fr),Or.boxcolor="#00FF00"}catch(Wr){Or.boxcolor="#FF0000",console.error("Error executing script"),console.error(Wr)}gl.finish2D()});else{xr.clear&&Ur.clearRect(0,0,$r.width,$r.height);try{pr.draw?pr.draw.call(this,$r,Ur,Pr,pr,Fr):pr.call(this,$r,Ur,Pr,pr,Fr),this.boxcolor="#00FF00"}catch(Wr){this.boxcolor="#FF0000",console.error("Error executing script"),console.error(Wr)}Rr.uploadImage($r)}this.setOutputData(0,Rr)},t.registerNodeType("texture/canvas2D",Yr);function to(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:Ae.DEFAULT}}to.title="Matte",to.desc="Extracts background",to.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:Ae.MODE_VALUES}},to.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(this.properties.precision===Ae.PASS_THROUGH){this.setOutputData(0,pr);return}if(pr){this._tex=Ae.getTargetTexture(pr,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var br=this._uniforms,Cr=Mesh.getScreenQuad(),Rr=to._shader;Rr||(Rr=to._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,to.pixel_shader)),br.u_key_color=this.properties.key_color,br.u_threshold=this.properties.threshold,br.u_slope=this.properties.slope,this._tex.drawTo(function(){pr.bind(0),Rr.uniforms(br).draw(Cr)}),this.setOutputData(0,this._tex)}}},to.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec3 u_key_color;
			uniform float u_threshold;
			uniform float u_slope;
			
			void main() {
				vec3 color = texture2D( u_texture, v_coord ).xyz;
				float diff = length( normalize(color) - normalize(u_key_color) );
				float edge = u_threshold * (1.0 - u_slope);
				float alpha = smoothstep( edge, u_threshold, diff);
				gl_FragColor = vec4( color, alpha );
			}`,t.registerNodeType("texture/matte",to);function Qr(){this.addInput("in","texture"),this.addInput("yaw","number"),this.addOutput("out","texture"),this.properties={yaw:0}}Qr.title="CubemapToTexture2D",Qr.desc="Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation",Qr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var pr=this.getInputData(0);if(!(!pr||pr.texture_type!=GL.TEXTURE_CUBE_MAP)){this._last_tex&&(this._last_tex.height!=pr.height||this._last_tex.type!=pr.type)&&(this._last_tex=null);var br=this.getInputOrProperty("yaw");this._last_tex=GL.Texture.cubemapToTexture2D(pr,pr.height,this._last_tex,!0,br),this.setOutputData(0,this._last_tex)}}},t.registerNodeType("texture/cubemapToTexture2D",Qr)}(commonjsGlobal),function(s){if(typeof GL>"u")return;var t=s.LiteGraph;s.LGraphCanvas;var n="#345",Ae=t.Shaders={};Ae.GLSL_types=["float","vec2","vec3","vec4","mat3","mat4","sampler2D","samplerCube"];var Ne=Ae.GLSL_types_const=["float","vec2","vec3","vec4"],tr={radians:"T radians(T degrees)",degrees:"T degrees(T radians)",sin:"T sin(T angle)",cos:"T cos(T angle)",tan:"T tan(T angle)",asin:"T asin(T x)",acos:"T acos(T x)",atan:"T atan(T x)",atan2:"T atan(T x,T y)",pow:"T pow(T x,T y)",exp:"T exp(T x)",log:"T log(T x)",exp2:"T exp2(T x)",log2:"T log2(T x)",sqrt:"T sqrt(T x)",inversesqrt:"T inversesqrt(T x)",abs:"T abs(T x)",sign:"T sign(T x)",floor:"T floor(T x)",round:"T round(T x)",ceil:"T ceil(T x)",fract:"T fract(T x)",mod:"T mod(T x,T y)",min:"T min(T x,T y)",max:"T max(T x,T y)",clamp:"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)",mix:"T mix(T x,T y,T a)",step:"T step(T edge, T edge2, T x)",smoothstep:"T smoothstep(T edge, T edge2, T x)",length:"float length(T x)",distance:"float distance(T p0, T p1)",normalize:"T normalize(T x)",dot:"float dot(T x,T y)",cross:"vec3 cross(vec3 x,vec3 y)",reflect:"vec3 reflect(vec3 V,vec3 N)",refract:"vec3 refract(vec3 V,vec3 N, float IOR)"},er={},ir=[];sr(),Ae.ALL_TYPES="float,vec2,vec3,vec4";function sr(){ir.length=0;for(var Tr in tr){var Lr=tr[Tr],Ir=Lr.indexOf(" "),Gr=Lr.substr(0,Ir),Br=Lr.indexOf("(",Ir),jr=Lr.substr(Ir,Br-Ir).trim(),Yr=Lr.substr(Br+1,Lr.length-Br-2).split(",");for(var to in Yr){var Qr=Yr[to].split(" ").filter(function(pr){return pr});Yr[to]={type:Qr[0].trim(),name:Qr[1].trim()},Qr[2]=="="&&(Yr[to].value=Qr[3].trim())}er[Tr]={return_type:Gr,func:jr,params:Yr},ir.push(jr)}}function rr(Tr,Lr){Lr.color=n,Lr.filter="shader",Lr.prototype.clearDestination=function(){this.shader_destination={}},Lr.prototype.propagateDestination=function(Gr){if(this.shader_destination[Gr]=!0,this.inputs)for(var Br=0;Br<this.inputs.length;++Br){var jr=this.getInputNode(Br);jr&&jr.propagateDestination(Gr)}},Lr.prototype.onPropertyChanged||(Lr.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++}),t.registerNodeType("shader::"+Tr,Lr)}function nr(Tr,Lr){return"VAR_"+(Lr||"TEMP")+"_"+Tr.id}function ar(Tr,Lr){if(!Tr.inputs)return null;var Ir=Tr.getInputLink(Lr);if(!Ir)return null;var Gr=Tr.graph.getNodeById(Ir.origin_id);return Gr?Gr.getOutputVarName?Gr.getOutputVarName(Ir.origin_slot):"link_"+Gr.id+"_"+Ir.origin_slot:null}function or(Tr,Lr){return Tr.isOutputConnected(Lr)?"link_"+Tr.id+"_"+Lr:null}Ae.registerShaderNode=rr,Ae.getInputLinkID=ar,Ae.getOutputLinkID=or,Ae.getShaderNodeVarName=nr,Ae.parseGLSLDescriptions=sr;var ur=t.valueToGLSL=function(Lr,Ir,Gr){var Br=5;if(Gr!=null&&(Br=Gr),!Ir)if(Lr.constructor===Number)Ir="float";else if(Lr.length)switch(Lr.length){case 2:Ir="vec2";break;case 3:Ir="vec3";break;case 4:Ir="vec4";break;case 9:Ir="mat3";break;case 16:Ir="mat4";break;default:throw"unknown type for glsl value size"}else throw"unknown type for glsl value: "+Lr.constructor;switch(Ir){case"float":return Lr.toFixed(Br);case"vec2":return"vec2("+Lr[0].toFixed(Br)+","+Lr[1].toFixed(Br)+")";case"color3":case"vec3":return"vec3("+Lr[0].toFixed(Br)+","+Lr[1].toFixed(Br)+","+Lr[2].toFixed(Br)+")";case"color4":case"vec4":return"vec4("+Lr[0].toFixed(Br)+","+Lr[1].toFixed(Br)+","+Lr[2].toFixed(Br)+","+Lr[3].toFixed(Br)+")";case"mat3":return"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)";case"mat4":return"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)";default:throw Ir}return""},hr=t.varToTypeGLSL=function(Lr,Ir,Gr){if(Ir==Gr)return Lr;if(Lr==null)switch(Gr){case"float":return"0.0";case"vec2":return"vec2(0.0)";case"vec3":return"vec3(0.0)";case"vec4":return"vec4(0.0,0.0,0.0,1.0)";default:return null}if(!Gr)throw"error: no output type specified";if(Gr=="float")switch(Ir){case"vec2":case"vec3":case"vec4":return Lr+".x";default:return"0.0"}else if(Gr=="vec2")switch(Ir){case"float":return"vec2("+Lr+")";case"vec3":case"vec4":return Lr+".xy";default:return"vec2(0.0)"}else if(Gr=="vec3")switch(Ir){case"float":return"vec3("+Lr+")";case"vec2":return"vec3("+Lr+",0.0)";case"vec4":return Lr+".xyz";default:return"vec3(0.0)"}else if(Gr=="vec4")switch(Ir){case"float":return"vec4("+Lr+")";case"vec2":return"vec4("+Lr+",0.0,1.0)";case"vec3":return"vec4("+Lr+",1.0)";default:return"vec4(0.0,0.0,0.0,1.0)"}throw"type cannot be converted"},cr=t.convertVarToGLSLType=function(Lr,Ir,Gr){if(Ir==Gr)return Lr;if(Ir=="float")return Gr+"("+Lr+")";if(Gr=="vec2")return"vec2("+Lr+".xy)";if(Gr=="vec3"){if(Ir=="vec2")return"vec3("+Lr+",0.0)";if(Ir=="vec4")return"vec4("+Lr+".xyz)"}if(Gr=="vec4"){if(Ir=="vec2")return"vec4("+Lr+",0.0,0.0)";if(Gr=="vec3")return"vec4("+Lr+",1.0)"}return null};function vr(){this.vs_template="",this.fs_template="",this.buffer_names={uvs:"v_coord"},this.extra={},this._functions={},this._uniforms={},this._codeparts={},this._uniform_value=null}vr.prototype.clear=function(){this._uniforms={},this._functions={},this._codeparts={},this._uniform_value=null,this.extra={}},vr.prototype.addUniform=function(Tr,Lr,Ir){this._uniforms[Tr]=Lr,Ir!=null&&(this._uniform_value||(this._uniform_value={}),this._uniform_value[Tr]=Ir)},vr.prototype.addFunction=function(Tr,Lr){this._functions[Tr]=Lr},vr.prototype.addCode=function(Tr,Lr,Ir){Ir=Ir||{"":""};for(var Gr in Ir){var Br=Gr?Gr+"_"+Tr:Tr;this._codeparts[Br]?this._codeparts[Br]+=Lr+`
`:this._codeparts[Br]=Lr+`
`}},vr.prototype.computeCodeBlocks=function(Tr,Lr){this.clear();var Ir=Tr.findNodesByType("shader::output/vertex");Ir=Ir&&Ir.length?Ir[0]:null;var Gr=Tr.findNodesByType("shader::output/fragcolor");if(Gr=Gr&&Gr.length?Gr[0]:null,!Gr)return null;Tr.sendEventToAllNodes("clearDestination"),Ir&&Ir.propagateDestination("vs"),Gr&&Gr.propagateDestination("fs"),Tr.sendEventToAllNodes("onGetCode",this);var Br="";for(var jr in this._uniforms)Br+="uniform "+this._uniforms[jr]+" "+jr+`;
`;if(Lr)for(var jr in Lr)Br+="uniform "+Lr[jr]+" "+jr+`;
`;var Yr="";for(var jr in this._functions)Yr+="//"+jr+`
`+this._functions[jr]+`
`;var to=this._codeparts;return to.uniforms=Br,to.functions=Yr,to},vr.prototype.computeShaderCode=function(Tr){var Lr=this.computeCodeBlocks(Tr),Ir=GL.Shader.replaceCodeUsingContext(this.vs_template,Lr),Gr=GL.Shader.replaceCodeUsingContext(this.fs_template,Lr);return{vs_code:Ir,fs_code:Gr}},vr.prototype.computeShader=function(Tr,Lr){var Ir=this.computeShaderCode(Tr);if(console.log(Ir.vs_code,Ir.fs_code),!t.catch_exceptions)return this._shader_error=!0,Lr?Lr.updateShader(Ir.vs_code,Ir.fs_code):Lr=new GL.Shader(Ir.vs_code,Ir.fs_code),this._shader_error=!1,Lr;try{return Lr?Lr.updateShader(Ir.vs_code,Ir.fs_code):Lr=new GL.Shader(Ir.vs_code,Ir.fs_code),this._shader_error=!1,Lr}catch(Gr){return this._shader_error||(console.error(Gr),Gr.indexOf("Fragment shader")!=-1?console.log(Ir.fs_code.split(`
`).map(function(Br,jr){return jr+".- "+Br}).join(`
`)):console.log(Ir.vs_code)),this._shader_error=!0,null}return null},vr.prototype.getShader=function(Tr){if(this._shader&&this._shader._version==Tr._version)return this._shader;var Lr=this.computeShader(Tr,this._shader);return Lr?(this._shader=Lr,Lr._version=Tr._version,Lr):null},vr.prototype.fillUniforms=function(Tr,Lr){if(this._uniform_value)for(var Ir in this._uniform_value){var Gr=this._uniform_value[Ir];Gr!=null&&(Gr.constructor===Function?Tr[Ir]=Gr.call(this,Lr):Gr.constructor===GL.Texture||(Tr[Ir]=Gr))}},t.ShaderContext=t.Shaders.Context=vr;function mr(){this.subgraph=new t.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.filter="shader",this.addInput("in","texture"),this.addOutput("out","texture"),this.properties={width:0,height:0,alpha:!1,precision:typeof LGraphTexture<"u"?LGraphTexture.DEFAULT:2};var Tr=this.subgraph.findNodesByType("shader::input/uniform")[0];Tr.pos=[200,300];var Lr=t.createNode("shader::texture/sampler2D");Lr.pos=[400,300],this.subgraph.add(Lr);var Ir=t.createNode("shader::output/fragcolor");Ir.pos=[600,300],this.subgraph.add(Ir),Tr.connect(0,Lr),Lr.connect(0,Ir),this.size=[180,60],this.redraw_on_mouse=!0,this._uniforms={},this._shader=null,this._context=new vr,this._context.vs_template=`#define VERTEX
`+GL.Shader.SCREEN_VERTEX_SHADER,this._context.fs_template=mr.template}mr.template=`
	#define FRAGMENT
	precision highp float;
	varying vec2 v_coord;
	{{varying}}
	{{uniforms}}
	{{functions}}
	{{fs_functions}}
	void main() {

	vec2 uv = v_coord;
	vec4 fragcolor = vec4(0.0);
	vec4 fragcolor1 = vec4(0.0);
	{{fs_code}}
	gl_FragColor = fragcolor;
	}
		`,mr.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},mr.title="ShaderGraph",mr.desc="Builds a shader using a graph",mr.input_node_type="input/uniform",mr.output_node_type="output/fragcolor",mr.title_color=n,mr.prototype.onSerialize=function(Tr){Tr.subgraph=this.subgraph.serialize()},mr.prototype.onConfigure=function(Tr){this.subgraph.configure(Tr.subgraph)},mr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var Tr=this.getInputData(0);Tr&&Tr.constructor!=GL.Texture&&(Tr=null);var Lr=this.properties.width|0,Ir=this.properties.height|0;Lr==0&&(Lr=Tr?Tr.width:gl.viewport_data[2]),Ir==0&&(Ir=Tr?Tr.height:gl.viewport_data[3]);var Gr=LGraphTexture.getTextureType(this.properties.precision,Tr),Br=this._texture;(!Br||Br.width!=Lr||Br.height!=Ir||Br.type!=Gr)&&(Br=this._texture=new GL.Texture(Lr,Ir,{type:Gr,format:this.alpha?gl.RGBA:gl.RGB,filter:gl.LINEAR}));var jr=this.getShader(this.subgraph);if(jr){var Yr=this._uniforms;this._context.fillUniforms(Yr);var to=0;if(this.inputs)for(var Qr=0;Qr<this.inputs.length;++Qr){var pr=this.inputs[Qr],br=this.getInputData(Qr);pr.type=="texture"&&(br||(br=GL.Texture.getWhiteTexture()),br=br.bind(to++)),br!=null&&(Yr["u_"+pr.name]=br)}var Cr=GL.Mesh.getScreenQuad();gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),Br.drawTo(function(){jr.uniforms(Yr),jr.draw(Cr)}),this.setOutputData(0,Br)}}},mr.prototype.onInputAdded=function(Tr){var Lr=t.createNode("shader::input/uniform");Lr.setProperty("name",Tr.name),Lr.setProperty("type",Tr.type),this.subgraph.add(Lr)},mr.prototype.onInputRemoved=function(Tr,Lr){for(var Ir=this.subgraph.findNodesByType("shader::input/uniform"),Gr=0;Gr<Ir.length;++Gr){var Br=Ir[Gr];Br.properties.name==Lr.name&&this.subgraph.remove(Br)}},mr.prototype.computeSize=function(){var Tr=this.inputs?this.inputs.length:0,Lr=this.outputs?this.outputs.length:0;return[200,Math.max(Tr,Lr)*t.NODE_SLOT_HEIGHT+t.NODE_TITLE_HEIGHT+10]},mr.prototype.getShader=function(){var Tr=this._context.getShader(this.subgraph);return Tr?this.boxcolor=null:this.boxcolor="red",Tr},mr.prototype.onDrawBackground=function(Tr,Lr,Ir,Gr){if(!this.flags.collapsed){var Br=this.getOutputData(0),jr=this.inputs?this.inputs.length*t.NODE_SLOT_HEIGHT:0;Br&&Tr==Br.gl&&this.size[1]>jr+t.NODE_TITLE_HEIGHT&&Tr.drawImage(Br,10,Yr,this.size[0]-20,this.size[1]-jr-t.NODE_TITLE_HEIGHT);var Yr=this.size[1]-t.NODE_TITLE_HEIGHT+.5,to=t.isInsideRectangle(Gr[0],Gr[1],this.pos[0],this.pos[1]+Yr,this.size[0],t.NODE_TITLE_HEIGHT);Tr.fillStyle=to?"#555":"#222",Tr.beginPath(),this._shape==t.BOX_SHAPE?Tr.rect(0,Yr,this.size[0]+1,t.NODE_TITLE_HEIGHT):Tr.roundRect(0,Yr,this.size[0]+1,t.NODE_TITLE_HEIGHT,0,8),Tr.fill(),Tr.textAlign="center",Tr.font="24px Arial",Tr.fillStyle=to?"#DDD":"#999",Tr.fillText("+",this.size[0]*.5,Yr+24)}},mr.prototype.onMouseDown=function(Tr,Lr,Ir){var Gr=this.size[1]-t.NODE_TITLE_HEIGHT+.5;Lr[1]>Gr&&Ir.showSubgraphPropertiesDialog(this)},mr.prototype.onDrawSubgraphBackground=function(Tr){},mr.prototype.getExtraMenuOptions=function(Tr){var Lr=this,Ir=[{content:"Print Code",callback:function(){var Gr=Lr._context.computeShaderCode();console.log(Gr.vs_code,Gr.fs_code)}}];return Ir},t.registerNodeType("texture/shaderGraph",mr);function dr(){this.addOutput("out",""),this.properties={name:"",type:""}}dr.title="Uniform",dr.desc="Input data for the shader",dr.prototype.getTitle=function(){return this.properties.name&&this.flags.collapsed?this.properties.type+" "+this.properties.name:"Uniform"},dr.prototype.onPropertyChanged=function(Tr,Lr){this.outputs[0].name=this.properties.type+" "+this.properties.name},dr.prototype.onGetCode=function(Tr){if(this.shader_destination){var Lr=this.properties.type;if(!Lr){if(!Tr.onGetPropertyInfo)return;var Ir=Tr.onGetPropertyInfo(this.property.name);if(!Ir)return;Lr=Ir.type}Lr=="number"?Lr="float":Lr=="texture"&&(Lr="sampler2D"),Ae.GLSL_types.indexOf(Lr)!=-1&&(Tr.addUniform("u_"+this.properties.name,Lr),this.setOutputData(0,Lr))}},dr.prototype.getOutputVarName=function(Tr){return"u_"+this.properties.name},rr("input/uniform",dr);function lr(){this.addOutput("out","vec2"),this.properties={name:"coord",type:"vec2"}}lr.title="Attribute",lr.desc="Input data from mesh attribute",lr.prototype.getTitle=function(){return"att. "+this.properties.name},lr.prototype.onGetCode=function(Tr){if(this.shader_destination){var Lr=this.properties.type;!Lr||Ae.GLSL_types.indexOf(Lr)==-1||(Lr=="number"&&(Lr="float"),this.properties.name!="coord"&&Tr.addCode("varying"," varying "+Lr+" v_"+this.properties.name+";"),this.setOutputData(0,Lr))}},lr.prototype.getOutputVarName=function(Tr){return"v_"+this.properties.name},rr("input/attribute",lr);function gr(){this.addInput("tex","sampler2D"),this.addInput("uv","vec2"),this.addOutput("rgba","vec4"),this.addOutput("rgb","vec3")}gr.title="Sampler2D",gr.desc="Reads a pixel from a texture",gr.prototype.onGetCode=function(Tr){if(this.shader_destination){var Lr=ar(this,0),Ir=nr(this),Gr="vec4 "+Ir+` = vec4(0.0);
`;if(Lr){var Br=ar(this,1)||Tr.buffer_names.uvs;Gr+=Ir+" = texture2D("+Lr+","+Br+`);
`}var jr=or(this,0);jr&&(Gr+="vec4 "+or(this,0)+" = "+Ir+`;
`);var Yr=or(this,1);Yr&&(Gr+="vec3 "+or(this,1)+" = "+Ir+`.xyz;
`),Tr.addCode("code",Gr,this.shader_destination),this.setOutputData(0,"vec4"),this.setOutputData(1,"vec3")}},rr("texture/sampler2D",gr);function fr(){this.addOutput("","float"),this.properties={type:"float",value:0},this.addWidget("combo","type","float",null,{values:Ne,property:"type"}),this.updateWidgets()}fr.title="const",fr.prototype.getTitle=function(){return this.flags.collapsed?ur(this.properties.value,this.properties.type,2):"Const"},fr.prototype.onPropertyChanged=function(Tr,Lr){Tr=="type"&&(this.outputs[0].type!=Lr&&(this.disconnectOutput(0),this.outputs[0].type=Lr),this.widgets.length=1,this.updateWidgets()),Tr=="value"&&(Lr.length?(this.widgets[1].value=Lr[1],Lr.length>2&&(this.widgets[2].value=Lr[2]),Lr.length>3&&(this.widgets[3].value=Lr[3])):this.widgets[1].value=Lr)},fr.prototype.updateWidgets=function(Ir){var Lr=this,Ir=this.properties.value,Gr={step:.01};switch(this.properties.type){case"float":this.properties.value=0,this.addWidget("number","v",0,{step:.01,property:"value"});break;case"vec2":this.properties.value=Ir&&Ir.length==2?[Ir[0],Ir[1]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(Br){Lr.properties.value[0]=Br},Gr),this.addWidget("number","y",this.properties.value[1],function(Br){Lr.properties.value[1]=Br},Gr);break;case"vec3":this.properties.value=Ir&&Ir.length==3?[Ir[0],Ir[1],Ir[2]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(Br){Lr.properties.value[0]=Br},Gr),this.addWidget("number","y",this.properties.value[1],function(Br){Lr.properties.value[1]=Br},Gr),this.addWidget("number","z",this.properties.value[2],function(Br){Lr.properties.value[2]=Br},Gr);break;case"vec4":this.properties.value=Ir&&Ir.length==4?[Ir[0],Ir[1],Ir[2],Ir[3]]:[0,0,0,0],this.addWidget("number","x",this.properties.value[0],function(Br){Lr.properties.value[0]=Br},Gr),this.addWidget("number","y",this.properties.value[1],function(Br){Lr.properties.value[1]=Br},Gr),this.addWidget("number","z",this.properties.value[2],function(Br){Lr.properties.value[2]=Br},Gr),this.addWidget("number","w",this.properties.value[3],function(Br){Lr.properties.value[3]=Br},Gr);break;default:console.error("unknown type for constant")}},fr.prototype.onGetCode=function(Tr){if(this.shader_destination){var Lr=ur(this.properties.value,this.properties.type),Ir=or(this,0);if(Ir){var Gr="	"+this.properties.type+" "+Ir+" = "+Lr+";";Tr.addCode("code",Gr,this.shader_destination),this.setOutputData(0,this.properties.type)}}},rr("const/const",fr);function yr(){this.addInput("xy","vec2"),this.addInput("x","float"),this.addInput("y","float"),this.addOutput("xy","vec2"),this.addOutput("x","float"),this.addOutput("y","float"),this.properties={x:0,y:0}}yr.title="vec2",yr.varmodes=["xy","x","y"],yr.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},yr.prototype.onGetCode=function(Tr){if(this.shader_destination){for(var Lr=this.properties,Ir=nr(this),Gr="	vec2 "+Ir+" = "+ur([Lr.x,Lr.y])+`;
`,Br=0;Br<yr.varmodes.length;++Br){var jr=yr.varmodes[Br],Yr=ar(this,Br);Yr&&(Gr+="	"+Ir+"."+jr+" = "+Yr+`;
`)}for(var Br=0;Br<yr.varmodes.length;++Br){var jr=yr.varmodes[Br],to=or(this,Br);if(to){var Qr=Ne[jr.length-1];Gr+="	"+Qr+" "+to+" = "+Ir+"."+jr+`;
`,this.setOutputData(Br,Qr)}}Tr.addCode("code",Gr,this.shader_destination)}},rr("const/vec2",yr);function Er(){this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("xy","vec2"),this.addInput("xz","vec2"),this.addInput("yz","vec2"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("xz","vec2"),this.addOutput("yz","vec2"),this.properties={x:0,y:0,z:0}}Er.title="vec3",Er.varmodes=["xyz","x","y","z","xy","xz","yz"],Er.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},Er.prototype.onGetCode=function(Tr){if(this.shader_destination){for(var Lr=this.properties,Ir=nr(this),Gr="vec3 "+Ir+" = "+ur([Lr.x,Lr.y,Lr.z])+`;
`,Br=0;Br<Er.varmodes.length;++Br){var jr=Er.varmodes[Br],Yr=ar(this,Br);Yr&&(Gr+="	"+Ir+"."+jr+" = "+Yr+`;
`)}for(var Br=0;Br<Er.varmodes.length;++Br){var jr=Er.varmodes[Br],to=or(this,Br);if(to){var Qr=Ne[jr.length-1];Gr+="	"+Qr+" "+to+" = "+Ir+"."+jr+`;
`,this.setOutputData(Br,Qr)}}Tr.addCode("code",Gr,this.shader_destination)}},rr("const/vec3",Er);function wr(){this.addInput("xyzw","vec4"),this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("w","float"),this.addInput("xy","vec2"),this.addInput("yz","vec2"),this.addInput("zw","vec2"),this.addOutput("xyzw","vec4"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("yz","vec2"),this.addOutput("zw","vec2"),this.properties={x:0,y:0,z:0,w:0}}wr.title="vec4",wr.varmodes=["xyzw","xyz","x","y","z","w","xy","yz","zw"],wr.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},wr.prototype.onGetCode=function(Tr){if(this.shader_destination){for(var Lr=this.properties,Ir=nr(this),Gr="vec4 "+Ir+" = "+ur([Lr.x,Lr.y,Lr.z,Lr.w])+`;
`,Br=0;Br<wr.varmodes.length;++Br){var jr=wr.varmodes[Br],Yr=ar(this,Br);Yr&&(Gr+="	"+Ir+"."+jr+" = "+Yr+`;
`)}for(var Br=0;Br<wr.varmodes.length;++Br){var jr=wr.varmodes[Br],to=or(this,Br);if(to){var Qr=Ne[jr.length-1];Gr+="	"+Qr+" "+to+" = "+Ir+"."+jr+`;
`,this.setOutputData(Br,Qr)}}Tr.addCode("code",Gr,this.shader_destination)}},rr("const/vec4",wr);function Dr(){this.addInput("color",Ae.ALL_TYPES),this.block_delete=!0}Dr.title="FragColor",Dr.desc="Pixel final color",Dr.prototype.onGetCode=function(Tr){var Lr=ar(this,0);if(Lr){var Ir=this.getInputData(0),Gr=hr(Lr,Ir,"vec4");Tr.addCode("fs_code","fragcolor = "+Gr+";")}},rr("output/fragcolor",Dr);function kr(){this.addInput("A",Ae.ALL_TYPES),this.addInput("B",Ae.ALL_TYPES),this.addOutput("out",""),this.properties={operation:"*"},this.addWidget("combo","op.",this.properties.operation,{property:"operation",values:kr.operations})}kr.title="Operation",kr.operations=["+","-","*","/"],kr.prototype.getTitle=function(){return this.flags.collapsed?"A"+this.properties.operation+"B":"Operation"},kr.prototype.onGetCode=function(Tr){if(this.shader_destination&&this.isOutputConnected(0)){for(var Lr=[],Ir=0;Ir<3;++Ir)Lr.push({name:ar(this,Ir),type:this.getInputData(Ir)||"float"});var Gr=or(this,0);if(Gr){for(var Br=Lr[0].type,jr=Br,Yr=this.properties.operation,to=[],Ir=0;Ir<2;++Ir){var Qr=Lr[Ir].name;Qr==null&&(Qr=p.value!=null?p.value:"(1.0)",Lr[Ir].type="float"),Lr[Ir].type!=Br&&(Lr[Ir].type=="float"&&(Yr=="*"||Yr=="/")||(Qr=cr(Qr,Lr[Ir].type,Br))),to.push(Qr)}Tr.addCode("code",jr+" "+Gr+" = "+to[0]+Yr+to[1]+";",this.shader_destination),this.setOutputData(0,jr)}}},rr("math/operation",kr);function zr(){this.addInput("A",Ae.ALL_TYPES),this.addInput("B",Ae.ALL_TYPES),this.addOutput("out",""),this.properties={func:"floor"},this._current="floor",this.addWidget("combo","func",this.properties.func,{property:"func",values:ir})}zr.title="Func",zr.prototype.onPropertyChanged=function(Tr,Lr){if(this.graph&&this.graph._version++,Tr=="func"){var Ir=er[Lr];if(!Ir)return;for(var Gr=Ir.params.length;Gr<this.inputs.length;++Gr)this.removeInput(Gr);for(var Gr=0;Gr<Ir.params.length;++Gr){var Br=Ir.params[Gr];this.inputs[Gr]?this.inputs[Gr].name=Br.name+(Br.value?" ("+Br.value+")":""):this.addInput(Br.name,Ae.ALL_TYPES)}}},zr.prototype.getTitle=function(){return this.flags.collapsed?this.properties.func:"Func"},zr.prototype.onGetCode=function(Tr){if(this.shader_destination&&this.isOutputConnected(0)){for(var Lr=[],Ir=0;Ir<3;++Ir)Lr.push({name:ar(this,Ir),type:this.getInputData(Ir)||"float"});var Gr=or(this,0);if(Gr){var Br=er[this.properties.func];if(Br){var jr=Lr[0].type,Yr=Br.return_type;Yr=="T"&&(Yr=jr);for(var to=[],Ir=0;Ir<Br.params.length;++Ir){var Qr=Br.params[Ir],pr=Lr[Ir].name;pr==null&&(pr=Qr.value!=null?Qr.value:"(1.0)",Lr[Ir].type="float"),(Qr.type=="T"&&Lr[Ir].type!=jr||Qr.type!="T"&&Lr[Ir].type!=jr)&&(pr=cr(pr,Lr[Ir].type,jr)),to.push(pr)}Tr.addFunction("round",`float round(float v){ return floor(v+0.5); }
vec2 round(vec2 v){ return floor(v+vec2(0.5));}
vec3 round(vec3 v){ return floor(v+vec3(0.5));}
vec4 round(vec4 v){ return floor(v+vec4(0.5)); }
`),Tr.addCode("code",Yr+" "+Gr+" = "+Br.func+"("+to.join(",")+");",this.shader_destination),this.setOutputData(0,Yr)}}}},rr("math/func",zr);function Vr(){this.addInput("A",Ae.ALL_TYPES),this.addInput("B",Ae.ALL_TYPES),this.addOutput("C","vec4"),this.properties={code:"C = A+B",type:"vec4"},this.addWidget("text","code",this.properties.code,{property:"code"}),this.addWidget("combo","type",this.properties.type,{values:["float","vec2","vec3","vec4"],property:"type"})}Vr.title="Snippet",Vr.prototype.onPropertyChanged=function(Tr,Lr){this.graph&&this.graph._version++,Tr=="type"&&this.outputs[0].type!=Lr&&(this.disconnectOutput(0),this.outputs[0].type=Lr)},Vr.prototype.getTitle=function(){return this.flags.collapsed?this.properties.code:"Snippet"},Vr.prototype.onGetCode=function(Tr){if(!(!this.shader_destination||!this.isOutputConnected(0))){var Lr=ar(this,0);Lr||(Lr="1.0");var Ir=ar(this,1);Ir||(Ir="1.0");var Gr=or(this,0);if(Gr){var Br=this.getInputData(0)||"float",jr=this.getInputData(1)||"float",Yr=this.properties.type;if(Br=="T"||jr=="T")return null;var to="funcSnippet"+this.id,Qr=`
`+Yr+" "+to+"( "+Br+" A, "+jr+` B) {
`;Qr+="	"+Yr+" C = "+Yr+`(0.0);
`,Qr+="	"+this.properties.code+`;
`,Qr+=`	return C;
}
`,Tr.addCode("functions",Qr,this.shader_destination),Tr.addCode("code",Yr+" "+Gr+" = "+to+"("+Lr+","+Ir+");",this.shader_destination),this.setOutputData(0,Yr)}}},rr("utils/snippet",Vr);function Hr(){this.addOutput("out","float")}Hr.title="Rand",Hr.prototype.onGetCode=function(Tr){if(!(!this.shader_destination||!this.isOutputConnected(0))){var Lr=or(this,0);Tr.addUniform("u_rand"+this.id,"float",function(){return Math.random()}),Tr.addCode("code","float "+Lr+" = u_rand"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},rr("input/rand",Hr);function Sr(){this.addInput("out",Ae.ALL_TYPES),this.addInput("scale","float"),this.addOutput("out","float"),this.properties={type:"noise",scale:1},this.addWidget("combo","type",this.properties.type,{property:"type",values:Sr.NOISE_TYPES}),this.addWidget("number","scale",this.properties.scale,{property:"scale"})}Sr.NOISE_TYPES=["noise","rand"],Sr.title="noise",Sr.prototype.onGetCode=function(Tr){if(!(!this.shader_destination||!this.isOutputConnected(0))){var Lr=ar(this,0),Ir=or(this,0),Gr=this.getInputData(0);Lr||(Gr="vec2",Lr=Tr.buffer_names.uvs),Tr.addFunction("noise",Sr.shader_functions),Tr.addUniform("u_noise_scale"+this.id,"float",this.properties.scale),Gr=="float"?Tr.addCode("code","float "+Ir+" = snoise( vec2("+Lr+") * u_noise_scale"+this.id+");",this.shader_destination):Gr=="vec2"||Gr=="vec3"?Tr.addCode("code","float "+Ir+" = snoise("+Lr+" * u_noise_scale"+this.id+");",this.shader_destination):Gr=="vec4"&&Tr.addCode("code","float "+Ir+" = snoise("+Lr+".xyz * u_noise_scale"+this.id+");",this.shader_destination),this.setOutputData(0,"float")}},rr("math/noise",Sr),Sr.shader_functions=`
	vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
	
	float snoise(vec2 v){
	  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);
	  vec2 i  = floor(v + dot(v, C.yy) );
	  vec2 x0 = v -   i + dot(i, C.xx);
	  vec2 i1;
	  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
	  vec4 x12 = x0.xyxy + C.xxzz;
	  x12.xy -= i1;
	  i = mod(i, 289.0);
	  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
	  + i.x + vec3(0.0, i1.x, 1.0 ));
	  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);
	  m = m*m ;
	  m = m*m ;
	  vec3 x = 2.0 * fract(p * C.www) - 1.0;
	  vec3 h = abs(x) - 0.5;
	  vec3 ox = floor(x + 0.5);
	  vec3 a0 = x - ox;
	  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
	  vec3 g;
	  g.x  = a0.x  * x0.x  + h.x  * x0.y;
	  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
	  return 130.0 * dot(m, g);
	}
	vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
	vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
	
	float snoise(vec3 v){ 
	  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
	  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
	
	// First corner
	  vec3 i  = floor(v + dot(v, C.yyy) );
	  vec3 x0 =   v - i + dot(i, C.xxx) ;
	
	// Other corners
	  vec3 g = step(x0.yzx, x0.xyz);
	  vec3 l = 1.0 - g;
	  vec3 i1 = min( g.xyz, l.zxy );
	  vec3 i2 = max( g.xyz, l.zxy );
	
	  //  x0 = x0 - 0. + 0.0 * C 
	  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
	  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
	  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
	
	// Permutations
	  i = mod(i, 289.0 ); 
	  vec4 p = permute( permute( permute( 
	             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
	           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
	           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
	
	// Gradients
	// ( N*N points uniformly over a square, mapped onto an octahedron.)
	  float n_ = 1.0/7.0; // N=7
	  vec3  ns = n_ * D.wyz - D.xzx;
	
	  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
	
	  vec4 x_ = floor(j * ns.z);
	  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
	
	  vec4 x = x_ *ns.x + ns.yyyy;
	  vec4 y = y_ *ns.x + ns.yyyy;
	  vec4 h = 1.0 - abs(x) - abs(y);
	
	  vec4 b0 = vec4( x.xy, y.xy );
	  vec4 b1 = vec4( x.zw, y.zw );
	
	  vec4 s0 = floor(b0)*2.0 + 1.0;
	  vec4 s1 = floor(b1)*2.0 + 1.0;
	  vec4 sh = -step(h, vec4(0.0));
	
	  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
	  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
	
	  vec3 p0 = vec3(a0.xy,h.x);
	  vec3 p1 = vec3(a0.zw,h.y);
	  vec3 p2 = vec3(a1.xy,h.z);
	  vec3 p3 = vec3(a1.zw,h.w);
	
	//Normalise gradients
	  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
	  p0 *= norm.x;
	  p1 *= norm.y;
	  p2 *= norm.z;
	  p3 *= norm.w;
	
	// Mix final noise value
	  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
	  m = m * m;
	  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );
	}
	
	vec3 hash3( vec2 p ){
	    vec3 q = vec3( dot(p,vec2(127.1,311.7)), 
					   dot(p,vec2(269.5,183.3)), 
					   dot(p,vec2(419.2,371.9)) );
		return fract(sin(q)*43758.5453);
	}
	vec4 hash4( vec3 p ){
	    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), 
					   dot(p,vec3(269.5,183.3,335.1)), 
					   dot(p,vec3(314.5,235.1,467.3)), 
					   dot(p,vec3(419.2,371.9,114.9)) );
		return fract(sin(q)*43758.5453);
	}
	
	float iqnoise( in vec2 x, float u, float v ){
	    vec2 p = floor(x);
	    vec2 f = fract(x);
		
		float k = 1.0+63.0*pow(1.0-v,4.0);
		
		float va = 0.0;
		float wt = 0.0;
	    for( int j=-2; j<=2; j++ )
	    for( int i=-2; i<=2; i++ )
	    {
	        vec2 g = vec2( float(i),float(j) );
			vec3 o = hash3( p + g )*vec3(u,u,1.0);
			vec2 r = g - f + o.xy;
			float d = dot(r,r);
			float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );
			va += o.z*ww;
			wt += ww;
	    }
		
	    return va/wt;
	}
	`;function Ar(){this.addOutput("out","float")}Ar.title="Time",Ar.prototype.onGetCode=function(Tr){if(!(!this.shader_destination||!this.isOutputConnected(0))){var Lr=or(this,0);Tr.addUniform("u_time"+this.id,"float",function(){return getTime()*.001}),Tr.addCode("code","float "+Lr+" = u_time"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},rr("input/time",Ar);function _r(){this.addInput("in","T"),this.addOutput("out","float")}_r.title="Dither",_r.prototype.onGetCode=function(Tr){if(!(!this.shader_destination||!this.isOutputConnected(0))){var Lr=ar(this,0),Ir="float",Gr=or(this,0),Br=this.getInputData(0);Lr=hr(Lr,Br,"float"),Tr.addFunction("dither8x8",_r.dither_func),Tr.addCode("code",Ir+" "+Gr+" = dither8x8("+Lr+");",this.shader_destination),this.setOutputData(0,Ir)}},_r.dither_values=[.515625,.140625,.640625,.046875,.546875,.171875,.671875,.765625,.265625,.890625,.390625,.796875,.296875,.921875,.421875,.203125,.703125,.078125,.578125,.234375,.734375,.109375,.609375,.953125,.453125,.828125,.328125,.984375,.484375,.859375,.359375,.0625,.5625,.1875,.6875,.03125,.53125,.15625,.65625,.8125,.3125,.9375,.4375,.78125,.28125,.90625,.40625,.25,.75,.125,.625,.21875,.71875,.09375,.59375,1.0001,.5,.875,.375,.96875,.46875,.84375,.34375],_r.dither_func=`
			float dither8x8(float brightness) {
			  vec2 position = vec2(0.0);
			  #ifdef FRAGMENT
				position = gl_FragCoord.xy;
			  #endif
			  int x = int(mod(position.x, 8.0));
			  int y = int(mod(position.y, 8.0));
			  int index = x + y * 8;
			  float limit = 0.0;
			  if (x < 8) {
				if(index==0) limit = 0.015625;
				`+_r.dither_values.map(function(Tr,Lr){return"else if(index== "+(Lr+1)+") limit = "+Tr+";"}).join(`
`)+`
			  }
			  return brightness < limit ? 0.0 : 1.0;
			}
`,rr("math/dither",_r);function Nr(){this.addInput("",Ae.ALL_TYPES),this.addOutput("",""),this.properties={min_value:0,max_value:1,min_value2:0,max_value2:1},this.addWidget("number","min",0,{step:.1,property:"min_value"}),this.addWidget("number","max",1,{step:.1,property:"max_value"}),this.addWidget("number","min2",0,{step:.1,property:"min_value2"}),this.addWidget("number","max2",1,{step:.1,property:"max_value2"})}Nr.title="Remap",Nr.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},Nr.prototype.onConnectionsChange=function(){var Tr=this.getInputDataType(0);this.outputs[0].type=Tr||"T"},Nr.prototype.onGetCode=function(Tr){if(!(!this.shader_destination||!this.isOutputConnected(0))){var Lr=ar(this,0),Ir=or(this,0);if(!(!Lr&&!Ir)){var Gr=this.getInputDataType(0);if(this.outputs[0].type=Gr,Gr=="T"){console.warn("node type is T and cannot be resolved");return}if(!Lr){Tr.addCode("code","	"+Gr+" "+Ir+" = "+Gr+`(0.0);
`);return}var Br=ur(this.properties.min_value),jr=ur(this.properties.max_value),Yr=ur(this.properties.min_value2),to=ur(this.properties.max_value2);Tr.addCode("code",Gr+" "+Ir+" = ( ("+Lr+" - "+Br+") / ("+jr+" - "+Br+") ) * ("+to+" - "+Yr+") + "+Yr+";",this.shader_destination),this.setOutputData(0,Gr)}}},rr("math/remap",Nr)}(commonjsGlobal),function(s){var t=s.LiteGraph,n=new Float32Array(16),Ae=new Float32Array(16),Ne=new Float32Array(16),tr=new Float32Array(16),er={u_view:n,u_projection:Ae,u_viewprojection:Ne,u_model:tr};t.LGraphRender={onRequestCameraMatrices:null};function ir(){return Math.random()*1e5|0}function sr(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:sr.SPHERE,force_update:!1},this.points=new Float32Array(this.properties.num_points*3),this.normals=new Float32Array(this.properties.num_points*3),this.must_update=!0,this.version=0;var fr=this;this.addWidget("button","update",null,function(){fr.must_update=!0}),this.geometry={vertices:null,_id:ir()},this._old_obj=null,this._last_radius=null}s.LGraphPoints3D=sr,sr.RECTANGLE=1,sr.CIRCLE=2,sr.CUBE=10,sr.SPHERE=11,sr.HEMISPHERE=12,sr.INSIDE_SPHERE=13,sr.OBJECT=20,sr.OBJECT_UNIFORMLY=21,sr.OBJECT_INSIDE=22,sr.MODE_VALUES={rectangle:sr.RECTANGLE,circle:sr.CIRCLE,cube:sr.CUBE,sphere:sr.SPHERE,hemisphere:sr.HEMISPHERE,inside_sphere:sr.INSIDE_SPHERE,object:sr.OBJECT,object_uniformly:sr.OBJECT_UNIFORMLY,object_inside:sr.OBJECT_INSIDE},sr.widgets_info={mode:{widget:"combo",values:sr.MODE_VALUES}},sr.title="list of points",sr.desc="returns an array of points",sr.prototype.onPropertyChanged=function(fr,yr){this.must_update=!0},sr.prototype.onExecute=function(){var fr=this.getInputData(0);(fr!=this._old_obj||fr&&fr._version!=this._old_obj_version)&&(this._old_obj=fr,this.must_update=!0);var yr=this.getInputData(1);yr==null&&(yr=this.properties.radius),this._last_radius!=yr&&(this._last_radius=yr,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)},sr.prototype.updatePoints=function(){var fr=this.properties.num_points|0;fr<1&&(fr=1),(!this.points||this.points.length!=fr*3)&&(this.points=new Float32Array(fr*3)),this.properties.generate_normals?(!this.normals||this.normals.length!=this.points.length)&&(this.normals=new Float32Array(this.points.length)):this.normals=null;var yr=this._last_radius||this.properties.radius,Er=this.properties.mode,wr=this.getInputData(0);this._old_obj_version=wr?wr._version:null,this.points=sr.generatePoints(yr,fr,Er,this.points,this.normals,this.properties.regular,wr),this.version++},sr.generatePoints=function(fr,yr,Er,wr,Dr,kr,zr){var Vr=yr*3;(!wr||wr.length!=Vr)&&(wr=new Float32Array(Vr));var Hr=new Float32Array(3),Sr=new Float32Array([0,1,0]);if(kr){if(Er==sr.RECTANGLE){for(var Ar=Math.floor(Math.sqrt(yr)),_r=0;_r<Ar;++_r)for(var Nr=0;Nr<Ar;++Nr){var Tr=_r*3+Nr*3*Ar;wr[Tr]=(_r/Ar-.5)*fr*2,wr[Tr+1]=0,wr[Tr+2]=(Nr/Ar-.5)*fr*2}if(wr=new Float32Array(wr.subarray(0,Ar*Ar*3)),Dr)for(var _r=0;_r<Dr.length;_r+=3)Dr.set(Sr,_r)}else if(Er==sr.SPHERE){for(var Ar=Math.floor(Math.sqrt(yr)),_r=0;_r<Ar;++_r)for(var Nr=0;Nr<Ar;++Nr){var Tr=_r*3+Nr*3*Ar;polarToCartesian(Hr,_r/Ar*2*Math.PI,(Nr/Ar-.5)*2*Math.PI,fr),wr[Tr]=Hr[0],wr[Tr+1]=Hr[1],wr[Tr+2]=Hr[2]}wr=new Float32Array(wr.subarray(0,Ar*Ar*3)),Dr&&sr.generateSphericalNormals(wr,Dr)}else if(Er==sr.CIRCLE){for(var _r=0;_r<Vr;_r+=3){var Lr=2*Math.PI*(_r/Vr);wr[_r]=Math.cos(Lr)*fr,wr[_r+1]=0,wr[_r+2]=Math.sin(Lr)*fr}if(Dr)for(var _r=0;_r<Dr.length;_r+=3)Dr.set(Sr,_r)}}else if(Er==sr.RECTANGLE){for(var _r=0;_r<Vr;_r+=3)wr[_r]=(Math.random()-.5)*fr*2,wr[_r+1]=0,wr[_r+2]=(Math.random()-.5)*fr*2;if(Dr)for(var _r=0;_r<Dr.length;_r+=3)Dr.set(Sr,_r)}else if(Er==sr.CUBE){for(var _r=0;_r<Vr;_r+=3)wr[_r]=(Math.random()-.5)*fr*2,wr[_r+1]=(Math.random()-.5)*fr*2,wr[_r+2]=(Math.random()-.5)*fr*2;if(Dr)for(var _r=0;_r<Dr.length;_r+=3)Dr.set(Sr,_r)}else Er==sr.SPHERE?(sr.generateSphere(wr,Vr,fr),Dr&&sr.generateSphericalNormals(wr,Dr)):Er==sr.HEMISPHERE?(sr.generateHemisphere(wr,Vr,fr),Dr&&sr.generateSphericalNormals(wr,Dr)):Er==sr.CIRCLE?(sr.generateInsideCircle(wr,Vr,fr),Dr&&sr.generateSphericalNormals(wr,Dr)):Er==sr.INSIDE_SPHERE?(sr.generateInsideSphere(wr,Vr,fr),Dr&&sr.generateSphericalNormals(wr,Dr)):Er==sr.OBJECT?sr.generateFromObject(wr,Dr,Vr,zr,!1):Er==sr.OBJECT_UNIFORMLY?sr.generateFromObject(wr,Dr,Vr,zr,!0):Er==sr.OBJECT_INSIDE?sr.generateFromInsideObject(wr,Vr,zr):console.warn("wrong mode in LGraphPoints3D");return wr},sr.generateSphericalNormals=function(fr,yr){for(var Er=new Float32Array(3),wr=0;wr<yr.length;wr+=3)Er[0]=fr[wr],Er[1]=fr[wr+1],Er[2]=fr[wr+2],vec3.normalize(Er,Er),yr.set(Er,wr)},sr.generateSphere=function(fr,yr,Er){for(var wr=0;wr<yr;wr+=3){var Dr=Math.random(),kr=Math.random(),zr=2*Math.cos(2*Math.PI*Dr)*Math.sqrt(kr*(1-kr)),Vr=1-2*kr,Hr=2*Math.sin(2*Math.PI*Dr)*Math.sqrt(kr*(1-kr));fr[wr]=zr*Er,fr[wr+1]=Vr*Er,fr[wr+2]=Hr*Er}},sr.generateHemisphere=function(fr,yr,Er){for(var wr=0;wr<yr;wr+=3){var Dr=Math.random(),kr=Math.random(),zr=Math.cos(2*Math.PI*Dr)*Math.sqrt(1-kr*kr),Vr=kr,Hr=Math.sin(2*Math.PI*Dr)*Math.sqrt(1-kr*kr);fr[wr]=zr*Er,fr[wr+1]=Vr*Er,fr[wr+2]=Hr*Er}},sr.generateInsideCircle=function(fr,yr,Er){for(var wr=0;wr<yr;wr+=3){var Dr=Math.random(),kr=Math.random(),zr=Math.cos(2*Math.PI*Dr)*Math.sqrt(1-kr*kr),Vr=Math.sin(2*Math.PI*Dr)*Math.sqrt(1-kr*kr);fr[wr]=zr*Er,fr[wr+1]=0,fr[wr+2]=Vr*Er}},sr.generateInsideSphere=function(fr,yr,Er){for(var wr=0;wr<yr;wr+=3){var Dr=Math.random(),kr=Math.random(),zr=Dr*2*Math.PI,Vr=Math.acos(2*kr-1),Hr=Math.cbrt(Math.random())*Er,Sr=Math.sin(zr),Ar=Math.cos(zr),_r=Math.sin(Vr),Nr=Math.cos(Vr);fr[wr]=Hr*_r*Ar,fr[wr+1]=Hr*_r*Sr,fr[wr+2]=Hr*Nr}};function rr(fr,yr){var Er=fr.length,wr=0,Dr=0,kr=Er;if(Er==0)return-1;if(Er==1)return 0;for(;kr>=wr;){Dr=(kr+wr)*.5|0;var zr=fr[Dr];if(zr==yr)return Dr;if(wr==kr-1)return wr;zr<yr?wr=Dr:kr=Dr}return Dr}sr.generateFromObject=function(fr,yr,Er,wr,Dr){if(wr){var kr=null,zr=null,Vr=null,Hr=null;if(wr.constructor===GL.Mesh&&(kr=wr.vertexBuffers.vertices.data,zr=wr.vertexBuffers.normals?wr.vertexBuffers.normals.data:null,Vr=wr.indexBuffers.indices?wr.indexBuffers.indices.data:null,Vr||(Vr=wr.indexBuffers.triangles?wr.indexBuffers.triangles.data:null)),!kr)return null;var Sr=Vr?Vr.length/3:kr.length/(3*3),Ar=0;if(Dr){Hr=new Float32Array(Sr);for(var _r=0;_r<Sr;++_r){Vr?(Qr=Vr[_r*3]*3,pr=Vr[_r*3+1]*3,br=Vr[_r*3+2]*3):(Qr=_r*9,pr=_r*9+3,br=_r*9+6);var Nr=kr.subarray(Qr,Qr+3),Tr=kr.subarray(pr,pr+3),Lr=kr.subarray(br,br+3),Ir=vec3.distance(Nr,Tr),Gr=vec3.distance(Tr,Lr),Br=vec3.distance(Lr,Nr),jr=(Ir+Gr+Br)/2;Ar+=Math.sqrt(jr*(jr-Ir)*(jr-Gr)*(jr-Br)),Hr[_r]=Ar}for(var _r=0;_r<Sr;++_r)Hr[_r]/=Ar}for(var _r=0;_r<Er;_r+=3){var Yr=Math.random(),to=Dr?rr(Hr,Yr):Math.floor(Yr*Sr),Qr=0,pr=0,br=0;Vr?(Qr=Vr[to*3]*3,pr=Vr[to*3+1]*3,br=Vr[to*3+2]*3):(Qr=to*9,pr=to*9+3,br=to*9+6);var jr=Math.random(),Cr=Math.random(),Rr=Math.sqrt(jr),Mr=1-Rr,Fr=Rr*(1-Cr),xr=Cr*Rr;if(fr[_r]=Mr*kr[Qr]+Fr*kr[pr]+xr*kr[br],fr[_r+1]=Mr*kr[Qr+1]+Fr*kr[pr+1]+xr*kr[br+1],fr[_r+2]=Mr*kr[Qr+2]+Fr*kr[pr+2]+xr*kr[br+2],yr&&zr){yr[_r]=Mr*zr[Qr]+Fr*zr[pr]+xr*zr[br],yr[_r+1]=Mr*zr[Qr+1]+Fr*zr[pr+1]+xr*zr[br+1],yr[_r+2]=Mr*zr[Qr+2]+Fr*zr[pr+2]+xr*zr[br+2];var Or=yr.subarray(_r,_r+3);vec3.normalize(Or,Or)}}}},sr.generateFromInsideObject=function(fr,yr,Er){if(!(!Er||Er.constructor!==GL.Mesh)){var wr=Er.getBoundingBox();Er.octree||(Er.octree=new GL.Octree(Er));for(var Dr=Er.octree,kr=vec3.create(),zr=vec3.fromValues(1,0,0),Vr=vec3.create(),Hr=0,Sr=0;Hr<yr&&Sr<fr.length*10;){Sr+=1;var Ar=vec3.random(Vr);Ar[0]=(Ar[0]*2-1)*wr[3]+wr[0],Ar[1]=(Ar[1]*2-1)*wr[4]+wr[1],Ar[2]=(Ar[2]*2-1)*wr[5]+wr[2],kr.set(Ar);var _r=Dr.testRay(kr,zr,0,1e4,!0,GL.Octree.ALL);!_r||_r.length%2==0||(fr.set(Ar,Hr),Hr+=3)}}},t.registerNodeType("geometry/points3D",sr);function nr(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}nr.NORMAL=0,nr.VERTICAL=1,nr.SPHERICAL=2,nr.RANDOM=3,nr.RANDOM_VERTICAL=4,nr.modes={normal:0,vertical:1,spherical:2,random:3,random_vertical:4},nr.widgets_info={mode:{widget:"combo",values:nr.modes}},nr.title="points to inst",nr.prototype.onExecute=function(){var fr=this.getInputData(0);if(!fr){this.setOutputData(0,null);return}if(this.isOutputConnected(0)){var yr=fr._version!=this._version||fr._id!=this._geometry_id;(yr&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(fr)),this.setOutputData(0,this.matrices)}},nr.prototype.updateInstances=function(fr){var yr=fr.vertices;if(!yr)return null;var Er=fr.normals,wr=this.matrices,Dr=yr.length/3;wr.length!=Dr&&(wr.length=Dr);var kr=mat4.create(),zr=vec3.create();vec3.create();var Vr=vec3.fromValues(0,1,0),Hr=vec3.fromValues(0,0,-1);vec3.fromValues(1,0,0);for(var Sr=quat.create(),Ar=vec3.create(),_r=vec3.create(),Nr=vec3.create(),Tr=0;Tr<yr.length;Tr+=3){var Lr=Tr/3,Ir=wr[Lr];Ir||(Ir=wr[Lr]=mat4.create()),Ir.set(kr);var Gr=yr.subarray(Tr,Tr+3);switch(this.properties.mode){case nr.NORMAL:if(mat4.setTranslation(Ir,Gr),Er){var Br=Er.subarray(Tr,Tr+3);Nr.set(Br),vec3.normalize(Nr,Nr),vec3.cross(_r,Hr,Nr),vec3.normalize(_r,_r),vec3.cross(Ar,_r,Nr),vec3.normalize(Ar,Ar),Ir.set(_r,0),Ir.set(Nr,4),Ir.set(Ar,8),mat4.setTranslation(Ir,Gr)}break;case nr.VERTICAL:mat4.setTranslation(Ir,Gr);break;case nr.SPHERICAL:Ar.set(Gr),vec3.normalize(Ar,Ar),vec3.cross(_r,Vr,Ar),vec3.normalize(_r,_r),vec3.cross(Nr,Ar,_r),vec3.normalize(Nr,Nr),Ir.set(_r,0),Ir.set(Nr,4),Ir.set(Ar,8),mat4.setTranslation(Ir,Gr);break;case nr.RANDOM:zr[0]=Math.random()*2-1,zr[1]=Math.random()*2-1,zr[2]=Math.random()*2-1,vec3.normalize(zr,zr),quat.setAxisAngle(Sr,zr,Math.random()*2*Math.PI),mat4.fromQuat(Ir,Sr),mat4.setTranslation(Ir,Gr);break;case nr.RANDOM_VERTICAL:quat.setAxisAngle(Sr,Vr,Math.random()*2*Math.PI),mat4.fromQuat(Ir,Sr),mat4.setTranslation(Ir,Gr);break}}this._version=fr._version,this._geometry_id=fr._id},t.registerNodeType("geometry/points_to_instances",nr);function ar(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:ir(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}ar.title="Transform",ar.prototype.onExecute=function(){var fr=this.getInputData(0),yr=this.getInputData(1);if(fr){if(fr.constructor===Array){if(fr.length==0||(this.outputs[0].type="[mat4]",!this.isOutputConnected(0)))return;if(!yr){this.setOutputData(0,fr);return}this._output||(this._output=new Array),this._output.length!=fr.length&&(this._output.length=fr.length);for(var Er=0;Er<fr.length;++Er){var wr=this._output[Er];wr||(wr=this._output[Er]=mat4.create()),mat4.multiply(wr,fr[Er],yr)}this.setOutputData(0,this._output);return}if(!(!fr.vertices||!fr.vertices.length)){var Dr=fr;if(this.outputs[0].type="geometry",!!this.isOutputConnected(0)){if(!yr){this.setOutputData(0,Dr);return}var kr=typedArrayToArray(yr).join(",");(this.must_update||Dr._id!=this._last_geometry_id||Dr._version!=this._last_version||kr!=this._last_key)&&(this.updateGeometry(Dr,yr),this._last_key=kr,this._last_version=Dr._version,this._last_geometry_id=Dr._id,this.must_update=!1),this.setOutputData(0,this.geometry)}}}},ar.prototype.updateGeometry=function(fr,yr){var Er=fr.vertices,wr=this.geometry.vertices;(!wr||wr.length!=Er.length)&&(wr=this.geometry.vertices=new Float32Array(Er.length));for(var Dr=vec3.create(),kr=0,zr=wr.length;kr<zr;kr+=3)Dr[0]=Er[kr],Dr[1]=Er[kr+1],Dr[2]=Er[kr+2],mat4.multiplyVec3(Dr,yr,Dr),wr[kr]=Dr[0],wr[kr+1]=Dr[1],wr[kr+2]=Dr[2];if(fr.normals){(!this.geometry.normals||this.geometry.normals.length!=fr.normals.length)&&(this.geometry.normals=new Float32Array(fr.normals.length));var Vr=this.geometry.normals,Hr=mat4.invert(mat4.create(),yr);Hr&&mat4.transpose(Hr,Hr);for(var Sr=fr.normals,kr=0,zr=Vr.length;kr<zr;kr+=3)Dr[0]=Sr[kr],Dr[1]=Sr[kr+1],Dr[2]=Sr[kr+2],mat4.multiplyVec3(Dr,Hr,Dr),Vr[kr]=Dr[0],Vr[kr+1]=Dr[1],Vr[kr+2]=Dr[2]}this.geometry.type=fr.type,this.geometry._version++},t.registerNodeType("geometry/transform",ar);function or(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:ir()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}or.title="Polygon",or.prototype.onExecute=function(){if(this.isOutputConnected(0)){var fr=this.getInputOrProperty("sides"),yr=this.getInputOrProperty("radius");fr=Math.max(3,fr)|0,(this.last_info.sides!=fr||this.last_info.radius!=yr)&&this.updateGeometry(fr,yr),this.setOutputData(0,this.geometry)}},or.prototype.updateGeometry=function(fr,yr){var Er=3*fr,wr=this.geometry.vertices;(!wr||wr.length!=Er)&&(wr=this.geometry.vertices=new Float32Array(3*fr));var Dr=Math.PI*2/fr,kr=this.properties.uvs;kr&&(uvs=this.geometry.coords=new Float32Array(3*fr));for(var zr=0;zr<fr;++zr){var Vr=Dr*-zr,Hr=Math.cos(Vr)*yr,Sr=0,Ar=Math.sin(Vr)*yr;wr[zr*3]=Hr,wr[zr*3+1]=Sr,wr[zr*3+2]=Ar}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=fr,this.last_info.radius=yr},t.registerNodeType("geometry/polygon",or);function ur(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}ur.title="extrude",ur.prototype.onPropertyChanged=function(fr,yr){this._must_update=!0},ur.prototype.onExecute=function(){var fr=this.getInputData(0);!fr||!this.isOutputConnected(0)||((fr.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(fr,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))},ur.prototype.extrudeGeometry=function(fr){var yr=fr.vertices,Er=yr.length/3,wr=vec3.create(),Dr=vec3.create(),kr=vec3.create(),zr=vec3.create(),Vr=new Float32Array(this.properties.offset);if(fr.type=="line_loop")for(var Hr=new Float32Array(Er*6*3),Sr=0,Ar=0,_r=yr.length;Ar<_r;Ar+=3)wr[0]=yr[Ar],wr[1]=yr[Ar+1],wr[2]=yr[Ar+2],Ar+3<_r?(Dr[0]=yr[Ar+3],Dr[1]=yr[Ar+4],Dr[2]=yr[Ar+5]):(Dr[0]=yr[0],Dr[1]=yr[1],Dr[2]=yr[2]),vec3.add(kr,wr,Vr),vec3.add(zr,Dr,Vr),Hr.set(wr,Sr),Sr+=3,Hr.set(Dr,Sr),Sr+=3,Hr.set(kr,Sr),Sr+=3,Hr.set(Dr,Sr),Sr+=3,Hr.set(zr,Sr),Sr+=3,Hr.set(kr,Sr),Sr+=3;var Nr={_id:ir(),type:"triangles",vertices:Hr};return Nr},t.registerNodeType("geometry/extrude",ur);function hr(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}hr.title="geoeval",hr.desc="eval code",hr.widgets_info={code:{widget:"code"}},hr.prototype.onConfigure=function(fr){this.compileCode()},hr.prototype.compileCode=function(){if(this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch{this.boxcolor="red"}},hr.prototype.onPropertyChanged=function(fr,yr){fr=="code"&&(this.properties.code=yr,this.compileCode())},hr.prototype.onExecute=function(){var fr=this.getInputData(0);if(fr){if(!this.func){this.setOutputData(0,fr);return}if(this.geometry_id!=fr._id||this.version!=fr._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=fr._id,this.properties.execute_every_frame?this.version++:this.version=fr._version;var yr=this.func,Er=getTime();this.geometry||(this.geometry={});for(var wr in fr)fr[wr]!=null&&(fr[wr].constructor==Float32Array?this.geometry[wr]=new Float32Array(fr[wr]):this.geometry[wr]=fr[wr]);this.geometry._id=fr._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=fr._version+1;var Dr=vec3.create(),kr=this.vertices;!kr||this.vertices.length!=fr.vertices.length?kr=this.vertices=new Float32Array(fr.vertices):kr.set(fr.vertices);for(var wr=0;wr<kr.length;wr+=3)Dr[0]=kr[wr],Dr[1]=kr[wr+1],Dr[2]=kr[wr+2],yr(Dr,wr/3,Er),kr[wr]=Dr[0],kr[wr+1]=Dr[1],kr[wr+2]=Dr[2];this.geometry.vertices=kr}this.setOutputData(0,this.geometry)}},t.registerNodeType("geometry/eval",hr);function cr(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}if(cr.title="connect points",cr.desc="adds indices between near points",cr.prototype.onPropertyChanged=function(fr,yr){this.must_update=!0},cr.prototype.onExecute=function(){var fr=this.getInputData(0);if(fr){if(this.geometry_id!=fr._id||this.version!=fr._version||this.must_update){this.must_update=!1,this.geometry_id=fr._id,this.version=fr._version,this.geometry={};for(var yr in fr)this.geometry[yr]=fr[yr];this.geometry._id=ir(),this.geometry._version=this.my_version++;for(var Er=fr.vertices,wr=Er.length,Dr=this.properties.min_dist,kr=this.properties.max_dist,zr=this.properties.probability,Vr=this.properties.max_connections,Hr=[],yr=0;yr<wr;yr+=3)for(var Sr=Er[yr],Ar=Er[yr+1],_r=Er[yr+2],Nr=0,Tr=yr+3;Tr<wr;Tr+=3){var Lr=Er[Tr],Ir=Er[Tr+1],Gr=Er[Tr+2],Br=Math.sqrt((Sr-Lr)*(Sr-Lr)+(Ar-Ir)*(Ar-Ir)+(_r-Gr)*(_r-Gr));if(!(Br>kr||Br<Dr||zr<1&&zr<Math.random())&&(Hr.push(yr/3,Tr/3),Nr+=1,Vr&&Nr>Vr))break}this.geometry.indices=this.indices=new Uint32Array(Hr)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}},t.registerNodeType("geometry/connectPoints",cr),typeof GL>"u")return;function vr(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}vr.title="to geometry",vr.desc="converts a mesh to geometry",vr.prototype.onExecute=function(){var fr=this.getInputData(0);if(fr){if(fr!=this.last_mesh){this.last_mesh=fr;for(i in fr.vertexBuffers){var yr=fr.vertexBuffers[i];this.geometry[i]=yr.data}fr.indexBuffers.triangles&&(this.geometry.indices=fr.indexBuffers.triangles.data),this.geometry._id=ir(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}},t.registerNodeType("geometry/toGeometry",vr);function mr(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}mr.title="Geo to Mesh",mr.prototype.updateMesh=function(fr){this.mesh||(this.mesh=new GL.Mesh);for(var yr in fr)if(yr[0]!="_"){var Er=fr[yr],wr=GL.Mesh.common_buffers[yr];if(!(!wr&&yr!="indices")){var Dr=wr?wr.spacing:3,kr=this.mesh.vertexBuffers[yr];!kr||kr.data.length!=Er.length?kr=new GL.Buffer(yr=="indices"?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,Er,Dr,GL.DYNAMIC_DRAW):(kr.data.set(Er),kr.upload(GL.DYNAMIC_DRAW)),this.mesh.addBuffer(yr,kr)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){for(var zr=new Float32Array([0,1,0]),Vr=new Float32Array(this.mesh.vertexBuffers.vertices.data.length),yr=0;yr<Vr.length;yr+=3)Vr.set(zr,yr);kr=new GL.Buffer(GL.ARRAY_BUFFER,Vr,3),this.mesh.addBuffer("normals",kr)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=fr._id,this.version=this.mesh.version=fr._version,this.mesh},mr.prototype.onExecute=function(){var fr=this.getInputData(0);fr&&((this.version!=fr._version||this.geometry_id!=fr._id)&&this.updateMesh(fr),this.setOutputData(0,this.mesh))},t.registerNodeType("geometry/toMesh",mr);function dr(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}dr.title="Render Mesh",dr.desc="renders a mesh flat",dr.PRIMITIVE_VALUES={points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP},dr.widgets_info={primitive:{widget:"combo",values:dr.PRIMITIVE_VALUES},color:{widget:"color"}},dr.prototype.onExecute=function(){if(this.properties.enabled){var fr=this.getInputData(0);if(fr){if(!t.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}t.LGraphRender.onRequestCameraMatrices(n,Ae,Ne);var yr=null,Er=this.getInputData(2);Er?(yr=gl.shaders.textured,yr||(yr=gl.shaders.textured=new GL.Shader(gr.vertex_shader_code,gr.fragment_shader_code,{USE_TEXTURE:""}))):(yr=gl.shaders.flat,yr||(yr=gl.shaders.flat=new GL.Shader(gr.vertex_shader_code,gr.fragment_shader_code))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var wr=this.model_matrix,Dr=this.getInputData(1);Dr?wr.set(Dr):mat4.identity(wr),this.uniforms.u_point_size=1;var kr=this.properties.primitive;yr.uniforms(er),yr.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);var zr="indices";fr.indexBuffers.triangles&&(zr="triangles"),yr.draw(fr,kr,zr),gl.disable(gl.BLEND),gl.depthMask(!0)}}},t.registerNodeType("geometry/render_mesh",dr);function lr(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=Math.random()*1e5|0,this.last_info={type:-1,size:-1,subdivisions:-1}}lr.title="Primitive",lr.VALID={CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9},lr.widgets_info={type:{widget:"combo",values:lr.VALID}},lr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var fr=this.getInputOrProperty("size");(this.last_info.type!=this.properties.type||this.last_info.size!=fr||this.last_info.subdivisions!=this.properties.subdivisions)&&this.updateMesh(this.properties.type,fr,this.properties.subdivisions),this.setOutputData(0,this._mesh)}},lr.prototype.updateMesh=function(fr,yr,Er){switch(Er=Math.max(0,Er)|0,fr){case 1:this._mesh=GL.Mesh.cube({size:yr,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:yr,xz:!0,detail:Er,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:yr,subdivisions:Er,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:yr,long:Er,lat:Er,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:yr,slices:Er,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:yr,long:Er,lat:Er,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:yr,subdivisions:Er});break;case 8:this._mesh=GL.Mesh.cone({radius:yr,height:yr,subdivisions:Er});break;case 9:this._mesh=GL.Mesh.plane({size:yr,xz:!1,detail:Er,normals:!0,coords:!0});break}this.last_info.type=fr,this.last_info.size=yr,this.last_info.subdivisions=Er,this._mesh.version=this.version++},t.registerNodeType("geometry/mesh_primitive",lr);function gr(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}gr.title="renderPoints",gr.desc="render points with a texture",gr.widgets_info={color:{widget:"color"}},gr.prototype.updateMesh=function(fr){this.buffer,!this.buffer||!this.buffer.data||this.buffer.data.length!=fr.vertices.length?this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,fr.vertices,3,GL.DYNAMIC_DRAW):(this.buffer.data.set(fr.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=fr._id,this.version=this.mesh.version=fr._version},gr.prototype.onExecute=function(){if(this.properties.enabled){var fr=this.getInputData(0);if(fr){if((this.version!=fr._version||this.geometry_id!=fr._id)&&this.updateMesh(fr),!t.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}t.LGraphRender.onRequestCameraMatrices(n,Ae,Ne);var yr=null,Er=this.getInputData(2);Er?(yr=gl.shaders.textured_points,yr||(yr=gl.shaders.textured_points=new GL.Shader(gr.vertex_shader_code,gr.fragment_shader_code,{USE_TEXTURED_POINTS:""}))):(yr=gl.shaders.points,yr||(yr=gl.shaders.points=new GL.Shader(gr.vertex_shader_code,gr.fragment_shader_code,{USE_POINTS:""}))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var wr=this.getInputData(1);wr?tr.set(wr):mat4.identity(tr),this.uniforms.u_point_size=this.properties.point_size,this.uniforms.u_point_perspective=this.properties.fixed_size?0:1,this.uniforms.u_perspective=gl.viewport_data[3]*Ae[5],yr.uniforms(er),yr.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),yr.draw(this.mesh,GL.POINTS),gl.disable(gl.BLEND),gl.depthMask(!0)}}},t.registerNodeType("geometry/render_points",gr),gr.vertex_shader_code=`			precision mediump float;
			attribute vec3 a_vertex;
			varying vec3 v_vertex;
			attribute vec3 a_normal;
			varying vec3 v_normal;
			#ifdef USE_COLOR
				attribute vec4 a_color;
				varying vec4 v_color;
			#endif
			attribute vec2 a_coord;
			varying vec2 v_coord;
			#ifdef USE_SIZE
				attribute float a_extra;
			#endif
			#ifdef USE_INSTANCING
				attribute mat4 u_model;
			#else
				uniform mat4 u_model;
			#endif
			uniform mat4 u_viewprojection;
			uniform float u_point_size;
			uniform float u_perspective;
			uniform float u_point_perspective;
			float computePointSize(float radius, float w)
			{
				if(radius < 0.0)
					return -radius;
				return u_perspective * radius / w;
			}
			void main() {
				v_coord = a_coord;
				#ifdef USE_COLOR
					v_color = a_color;
				#endif
				v_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;
				v_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;
				gl_Position = u_viewprojection * vec4(v_vertex,1.0);
				gl_PointSize = u_point_size;
				#ifdef USE_SIZE
					gl_PointSize = a_extra;
				#endif
				if(u_point_perspective != 0.0)
					gl_PointSize = computePointSize( gl_PointSize, gl_Position.w );
			}		`,gr.fragment_shader_code=`			precision mediump float;
			uniform vec4 u_color;
			#ifdef USE_COLOR
				varying vec4 v_color;
			#endif
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			void main() {
				vec4 color = u_color;
				#ifdef USE_TEXTURED_POINTS
					color *= texture2D(u_texture, gl_PointCoord.xy);
				#else
					#ifdef USE_TEXTURE
					  color *= texture2D(u_texture, v_coord);
					  if(color.a < 0.1)
						discard;
					#endif
					#ifdef USE_POINTS
						float dist = length( gl_PointCoord.xy - vec2(0.5) );
						if( dist > 0.45 )
							discard;
					#endif
				#endif
				#ifdef USE_COLOR
					color *= v_color;
				#endif
				gl_FragColor = color;
			}		`}(commonjsGlobal),function(s){var t=s.LiteGraph,n=s.LGraphTexture;if(typeof GL<"u"){let Ae=function(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:n.DEFAULT},Ae._shader||(Ae._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Ae.pixel_shader),Ae._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))},Ne=function(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}},tr=function(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:n.DEFAULT}},er=function(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:n.DEFAULT},er._shader||(er._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,er.pixel_shader))};Ae.title="Lens",Ae.desc="Camera Lens distortion",Ae.widgets_info={precision:{widget:"combo",values:n.MODE_VALUES}},Ae.prototype.onExecute=function(){var ir=this.getInputData(0);if(this.properties.precision===n.PASS_THROUGH){this.setOutputData(0,ir);return}if(ir){this._tex=n.getTargetTexture(ir,this._tex,this.properties.precision);var sr=this.properties.aberration;this.isInputConnected(1)&&(sr=this.getInputData(1),this.properties.aberration=sr);var rr=this.properties.distortion;this.isInputConnected(2)&&(rr=this.getInputData(2),this.properties.distortion=rr);var nr=this.properties.blur;this.isInputConnected(3)&&(nr=this.getInputData(3),this.properties.blur=nr),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var ar=Mesh.getScreenQuad(),or=Ae._shader;this._tex.drawTo(function(){ir.bind(0),or.uniforms({u_texture:0,u_aberration:sr,u_distortion:rr,u_blur:nr}).draw(ar)}),this.setOutputData(0,this._tex)}},Ae.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform float u_aberration;
				uniform float u_distortion;
				uniform float u_blur;
				
				void main() {
					vec2 coord = v_coord;
					float dist = distance(vec2(0.5), coord);
					vec2 dist_coord = coord - vec2(0.5);
					float percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;
					dist_coord *= percent;
					coord = dist_coord + vec2(0.5);
					vec4 color = texture2D(u_texture,coord, u_blur * dist);
					color.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;
					color.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;
					gl_FragColor = color;
				}
				`,t.registerNodeType("fx/lens",Ae),s.LGraphFXLens=Ae,Ne.title="Bokeh",Ne.desc="applies an Bokeh effect",Ne.widgets_info={shape:{widget:"texture"}},Ne.prototype.onExecute=function(){var ir=this.getInputData(0),sr=this.getInputData(1),rr=this.getInputData(2);if(!ir||!rr||!this.properties.shape){this.setOutputData(0,ir);return}sr||(sr=ir);var nr=n.getTexture(this.properties.shape);if(nr){var ar=this.properties.threshold;this.isInputConnected(3)&&(ar=this.getInputData(3),this.properties.threshold=ar);var or=gl.UNSIGNED_BYTE;this.properties.high_precision&&(or=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=or||this._temp_texture.width!=ir.width||this._temp_texture.height!=ir.height)&&(this._temp_texture=new GL.Texture(ir.width,ir.height,{type:or,format:gl.RGBA,filter:gl.LINEAR})),this.properties.size;var ur=Ne._first_shader;ur||(ur=Ne._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Ne._first_pixel_shader));var hr=Ne._second_shader;hr||(hr=Ne._second_shader=new GL.Shader(Ne._second_vertex_shader,Ne._second_pixel_shader));var cr=this._points_mesh;(!cr||cr._width!=ir.width||cr._height!=ir.height||cr._spacing!=2)&&(cr=this.createPointsMesh(ir.width,ir.height,2));var vr=Mesh.getScreenQuad(),mr=this.properties.size;this.properties.min_light;var dr=this.properties.alpha;gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){ir.bind(0),sr.bind(1),rr.bind(2),ur.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[ir.width,ir.height]}).draw(vr)}),this._temp_texture.drawTo(function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),ir.bind(0),nr.bind(3),hr.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:dr,u_threshold:ar,u_pointSize:mr,u_itexsize:[1/ir.width,1/ir.height]}).draw(cr,gl.POINTS)}),this.setOutputData(0,this._temp_texture)}},Ne.prototype.createPointsMesh=function(ir,sr,rr){for(var nr=Math.round(ir/rr),ar=Math.round(sr/rr),or=new Float32Array(nr*ar*2),ur=-1,hr=2/ir*rr,cr=2/sr*rr,vr=0;vr<ar;++vr){for(var mr=-1,dr=0;dr<nr;++dr){var lr=vr*nr*2+dr*2;or[lr]=mr,or[lr+1]=ur,mr+=hr}ur+=cr}return this._points_mesh=GL.Mesh.load({vertices2D:or}),this._points_mesh._width=ir,this._points_mesh._height=sr,this._points_mesh._spacing=rr,this._points_mesh},Ne._first_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_texture_blur;
				uniform sampler2D u_mask;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					vec4 blurred_color = texture2D(u_texture_blur, v_coord);
					float mask = texture2D(u_mask, v_coord).x;
				   gl_FragColor = mix(color, blurred_color, mask);
				}
				`,Ne._second_vertex_shader=`precision highp float;
				attribute vec2 a_vertex2D;
				varying vec4 v_color;
				uniform sampler2D u_texture;
				uniform sampler2D u_mask;
				uniform vec2 u_itexsize;
				uniform float u_pointSize;
				uniform float u_threshold;
				void main() {
					vec2 coord = a_vertex2D * 0.5 + 0.5;
					v_color = texture2D( u_texture, coord );
					v_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );
					v_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));
					v_color += texture2D( u_texture, coord + u_itexsize);
					v_color *= 0.25;
					float mask = texture2D(u_mask, coord).x;
					float luminance = length(v_color) * mask;
					/*luminance /= (u_pointSize*u_pointSize)*0.01 */;
					luminance -= u_threshold;
					if(luminance < 0.0)
					{
						gl_Position.x = -100.0;
						return;
					}
					gl_PointSize = u_pointSize;
					gl_Position = vec4(a_vertex2D,0.0,1.0);
				}
				`,Ne._second_pixel_shader=`precision highp float;
				varying vec4 v_color;
				uniform sampler2D u_shape;
				uniform float u_alpha;
				
				void main() {
					vec4 color = texture2D( u_shape, gl_PointCoord );
					color *= v_color * u_alpha;
					gl_FragColor = color;
				}
`,t.registerNodeType("fx/bokeh",Ne),s.LGraphFXBokeh=Ne,tr.title="FX",tr.desc="applies an FX from a list",tr.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:n.MODE_VALUES}},tr.shaders={},tr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var ir=this.getInputData(0);if(this.properties.precision===n.PASS_THROUGH){this.setOutputData(0,ir);return}if(ir){this._tex=n.getTargetTexture(ir,this._tex,this.properties.precision);var sr=this.properties.value1;this.isInputConnected(1)&&(sr=this.getInputData(1),this.properties.value1=sr);var rr=this.properties.value2;this.isInputConnected(2)&&(rr=this.getInputData(2),this.properties.value2=rr);var nr=this.properties.fx,ar=tr.shaders[nr];if(!ar){var or=tr["pixel_shader_"+nr];if(!or)return;ar=tr.shaders[nr]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,or)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var ur=Mesh.getScreenQuad(),hr=s.LS?LS.Renderer._current_camera:null,cr;hr?cr=[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:cr=[1,100];var vr=null;nr=="noise"&&(vr=n.getNoiseTexture()),this._tex.drawTo(function(){ir.bind(0),nr=="noise"&&vr.bind(1),ar.uniforms({u_texture:0,u_noise:1,u_size:[ir.width,ir.height],u_rand:[Math.random(),Math.random()],u_value1:sr,u_value2:rr,u_camera_planes:cr}).draw(ur)}),this.setOutputData(0,this._tex)}}},tr.pixel_shader_halftone=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				float pattern() {
					float s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);
					vec2 tex = v_coord * u_size.xy;
					vec2 point = vec2(
					   c * tex.x - s * tex.y ,
					   s * tex.x + c * tex.y 
					) * u_value2;
					return (sin(point.x) * sin(point.y)) * 4.0;
				}
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					float average = (color.r + color.g + color.b) / 3.0;
					gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);
				}
`,tr.pixel_shader_pixelate=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				void main() {
					vec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );
					vec4 color = texture2D(u_texture, coord);
					gl_FragColor = color;
				}
`,tr.pixel_shader_lowpalette=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					gl_FragColor = floor(color * u_value1) / u_value1;
				}
`,tr.pixel_shader_noise=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_noise;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				uniform vec2 u_rand;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					vec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);
					gl_FragColor = vec4( color.xyz + noise * u_value1, color.a );
				}
`,tr.pixel_shader_gamma=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_value1;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					float gamma = 1.0 / u_value1;
					gl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );
				}
`,t.registerNodeType("fx/generic",tr),s.LGraphFXGeneric=tr,er.title="Vigneting",er.desc="Vigneting",er.widgets_info={precision:{widget:"combo",values:n.MODE_VALUES}},er.prototype.onExecute=function(){var ir=this.getInputData(0);if(this.properties.precision===n.PASS_THROUGH){this.setOutputData(0,ir);return}if(ir){this._tex=n.getTargetTexture(ir,this._tex,this.properties.precision);var sr=this.properties.intensity;this.isInputConnected(1)&&(sr=this.getInputData(1),this.properties.intensity=sr),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var rr=Mesh.getScreenQuad(),nr=er._shader,ar=this.properties.invert;this._tex.drawTo(function(){ir.bind(0),nr.uniforms({u_texture:0,u_intensity:sr,u_isize:[1/ir.width,1/ir.height],u_invert:ar?1:0}).draw(rr)}),this.setOutputData(0,this._tex)}},er.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_intensity;
				uniform int u_invert;
				
				void main() {
					float luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;
					vec4 color = texture2D(u_texture, v_coord);
					if(u_invert == 1)
						luminance = 1.0 - luminance;
					luminance = mix(1.0, luminance, u_intensity);
				   gl_FragColor = vec4( luminance * color.xyz, color.a);
				}
				`,t.registerNodeType("fx/vigneting",er),s.LGraphFXVigneting=er}}(commonjsGlobal),function(s){var t=s.LiteGraph,n="#243";function Ae(dr){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),dr&&this.setup(dr)}t.MIDIEvent=Ae,Ae.prototype.fromJSON=function(dr){this.setup(dr.data)},Ae.prototype.setup=function(dr){var lr=dr;dr.constructor===Object&&(lr=dr.data),this.data.set(lr);var gr=lr[0];this.status=gr;var fr=gr&240;gr>=240?this.cmd=gr:this.cmd=fr,this.cmd==Ae.NOTEON&&this.velocity==0&&(this.cmd=Ae.NOTEOFF),this.cmd_str=Ae.commands[this.cmd]||"",(fr>=Ae.NOTEON||fr<=Ae.NOTEOFF)&&(this.channel=gr&15)},Object.defineProperty(Ae.prototype,"velocity",{get:function(){return this.cmd==Ae.NOTEON?this.data[2]:-1},set:function(dr){this.data[2]=dr},enumerable:!0}),Ae.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],Ae.note_to_index={A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11},Object.defineProperty(Ae.prototype,"note",{get:function(){return this.cmd!=Ae.NOTEON?-1:Ae.toNoteString(this.data[1],!0)},set:function(dr){throw"notes cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Object.defineProperty(Ae.prototype,"octave",{get:function(){if(this.cmd!=Ae.NOTEON)return-1;var dr=this.data[1]-24;return Math.floor(dr/12+1)},set:function(dr){throw"octave cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Ae.prototype.getPitch=function(){return Math.pow(2,(this.data[1]-69)/12)*440},Ae.computePitch=function(dr){return Math.pow(2,(dr-69)/12)*440},Ae.prototype.getCC=function(){return this.data[1]},Ae.prototype.getCCValue=function(){return this.data[2]},Ae.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},Ae.computePitchBend=function(dr,lr){return dr+(lr<<7)-8192},Ae.prototype.setCommandFromString=function(dr){this.cmd=Ae.computeCommandFromString(dr)},Ae.computeCommandFromString=function(dr){if(!dr)return 0;if(dr&&dr.constructor===Number)return dr;switch(dr=dr.toUpperCase(),dr){case"NOTE ON":case"NOTEON":return Ae.NOTEON;case"NOTE OFF":case"NOTEOFF":return Ae.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return Ae.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return Ae.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return Ae.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return Ae.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return Ae.PITCHBEND;case"TIME TICK":case"TIMETICK":return Ae.TIMETICK;default:return Number(dr)}},Ae.toNoteString=function(dr,lr){dr=Math.round(dr);var gr=dr-21,fr=Math.floor((dr-24)/12+1);return gr=gr%12,gr<0&&(gr=12+gr),Ae.notes[gr]+(lr?"":fr)},Ae.NoteStringToPitch=function(dr){dr=dr.toUpperCase();var lr=dr[0],gr=4;dr[1]=="#"?(lr+="#",dr.length>2&&(gr=Number(dr[2]))):dr.length>1&&(gr=Number(dr[1]));var fr=Ae.note_to_index[lr];return fr==null?null:(gr-1)*12+fr+21},Ae.prototype.toString=function(){var dr=""+this.channel+". ";switch(this.cmd){case Ae.NOTEON:dr+="NOTEON "+Ae.toNoteString(this.data[1]);break;case Ae.NOTEOFF:dr+="NOTEOFF "+Ae.toNoteString(this.data[1]);break;case Ae.CONTROLLERCHANGE:dr+="CC "+this.data[1]+" "+this.data[2];break;case Ae.PROGRAMCHANGE:dr+="PC "+this.data[1];break;case Ae.PITCHBEND:dr+="PITCHBEND "+this.getPitchBend();break;case Ae.KEYPRESSURE:dr+="KEYPRESS "+this.data[1];break}return dr},Ae.prototype.toHexString=function(){for(var dr="",lr=0;lr<this.data.length;lr++)dr+=this.data[lr].toString(16)+" "},Ae.prototype.toJSON=function(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}},Ae.NOTEOFF=128,Ae.NOTEON=144,Ae.KEYPRESSURE=160,Ae.CONTROLLERCHANGE=176,Ae.PROGRAMCHANGE=192,Ae.CHANNELPRESSURE=208,Ae.PITCHBEND=224,Ae.TIMETICK=248,Ae.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},Ae.commands_short={128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"},Ae.commands_reversed={};for(var Ne in Ae.commands)Ae.commands_reversed[Ae.commands[Ne]]=Ne;function tr(dr,lr){if(!navigator.requestMIDIAccess){this.error="not suppoorted",lr?lr("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags");return}this.on_ready=dr,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}tr.input=null,tr.MIDIEvent=Ae,tr.prototype.onMIDISuccess=function(dr){console.log("MIDI ready!"),console.log(dr),this.midi=dr,this.updatePorts(),this.on_ready&&this.on_ready(this)},tr.prototype.updatePorts=function(){var dr=this.midi;this.input_ports=dr.inputs,this.input_ports_info=[],this.output_ports=dr.outputs,this.output_ports_info=[];for(var lr=0,fr=this.input_ports.values(),yr=fr.next();yr&&yr.done===!1;){var gr=yr.value;this.input_ports_info.push(gr),console.log("Input port [type:'"+gr.type+"'] id:'"+gr.id+"' manufacturer:'"+gr.manufacturer+"' name:'"+gr.name+"' version:'"+gr.version+"'"),lr++,yr=fr.next()}this.num_input_ports=lr,lr=0;for(var fr=this.output_ports.values(),yr=fr.next();yr&&yr.done===!1;){var gr=yr.value;this.output_ports_info.push(gr),console.log("Output port [type:'"+gr.type+"'] id:'"+gr.id+"' manufacturer:'"+gr.manufacturer+"' name:'"+gr.name+"' version:'"+gr.version+"'"),lr++,yr=fr.next()}this.num_output_ports=lr},tr.prototype.onMIDIFailure=function(dr){console.error("Failed to get MIDI access - "+dr)},tr.prototype.openInputPort=function(dr,lr){var gr=this.input_ports.get("input-"+dr);if(!gr)return!1;tr.input=this;var fr=this;return gr.onmidimessage=function(yr){var Er=new Ae(yr.data);fr.updateState(Er),lr&&lr(yr.data,Er),tr.on_message&&tr.on_message(yr.data,Er)},console.log("port open: ",gr),!0},tr.parseMsg=function(dr){},tr.prototype.updateState=function(dr){switch(dr.cmd){case Ae.NOTEON:this.state.note[dr.value1|0]=dr.value2;break;case Ae.NOTEOFF:this.state.note[dr.value1|0]=0;break;case Ae.CONTROLLERCHANGE:this.state.cc[dr.getCC()]=dr.getCCValue();break}},tr.prototype.sendMIDI=function(dr,lr){if(lr){var gr=this.output_ports_info[dr];gr&&(tr.output=this,lr.constructor===Ae?gr.send(lr.data):gr.send(lr))}};function er(){this.addOutput("on_midi",t.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var dr=this;new tr(function(lr){dr._midi=lr,dr._waiting&&dr.onStart(),dr._waiting=!1})}er.MIDIInterface=tr,er.title="MIDI Input",er.desc="Reads MIDI from a input port",er.color=n,er.prototype.getPropertyInfo=function(dr){if(this._midi&&dr=="port"){for(var lr={},gr=0;gr<this._midi.input_ports_info.length;++gr){var fr=this._midi.input_ports_info[gr];lr[gr]=gr+".- "+fr.name+" version:"+fr.version}return{type:"enum",values:lr}}},er.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},er.prototype.onMIDIEvent=function(dr,lr){this._last_midi_event=lr,this.boxcolor="#AFA",this._last_time=t.getTime(),this.trigger("on_midi",lr),lr.cmd==Ae.NOTEON?this.trigger("on_noteon",lr):lr.cmd==Ae.NOTEOFF?this.trigger("on_noteoff",lr):lr.cmd==Ae.CONTROLLERCHANGE?this.trigger("on_cc",lr):lr.cmd==Ae.PROGRAMCHANGE?this.trigger("on_pc",lr):lr.cmd==Ae.PITCHBEND&&this.trigger("on_pitchbend",lr)},er.prototype.onDrawBackground=function(dr){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){dr.fillStyle="white";var lr=t.getTime(),gr=1-Math.max(0,(lr-this._last_time)*.001);if(gr>0){var fr=dr.globalAlpha;dr.globalAlpha*=gr,dr.font="12px Tahoma",dr.fillText(this._last_midi_event.toString(),2,this.size[1]*.5+3),dr.globalAlpha=fr}}},er.prototype.onExecute=function(){if(this.outputs)for(var dr=this._last_midi_event,lr=0;lr<this.outputs.length;++lr){var gr=this.outputs[lr],fr=null;switch(gr.name){case"midi":fr=this._midi;break;case"last_midi":fr=dr;break;default:continue}this.setOutputData(lr,fr)}},er.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",t.EVENT],["on_noteon",t.EVENT],["on_noteoff",t.EVENT],["on_cc",t.EVENT],["on_pc",t.EVENT],["on_pitchbend",t.EVENT]]},t.registerNodeType("midi/input",er);function ir(){this.addInput("send",t.EVENT),this.properties={port:0};var dr=this;new tr(function(lr){dr._midi=lr,dr.widget.options.values=dr.getMIDIOutputs()}),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}ir.MIDIInterface=tr,ir.title="MIDI Output",ir.desc="Sends MIDI to output channel",ir.color=n,ir.prototype.onGetPropertyInfo=function(dr){if(this._midi&&dr=="port"){var lr=this.getMIDIOutputs();return{type:"enum",values:lr}}},ir.default_ports={0:"unknown"},ir.prototype.getMIDIOutputs=function(){var dr={};if(!this._midi)return ir.default_ports;if(this._midi.output_ports_info)for(var lr=0;lr<this._midi.output_ports_info.length;++lr){var gr=this._midi.output_ports_info[lr];if(gr){var fr=lr+".- "+gr.name+" version:"+gr.version;dr[lr]=fr}}return dr},ir.prototype.onAction=function(dr,lr){this._midi&&(dr=="send"&&this._midi.sendMIDI(this.properties.port,lr),this.trigger("midi",lr))},ir.prototype.onGetInputs=function(){return[["send",t.ACTION]]},ir.prototype.onGetOutputs=function(){return[["on_midi",t.EVENT]]},t.registerNodeType("midi/output",ir);function sr(){this.addInput("on_midi",t.EVENT),this._str="",this.size=[200,40]}sr.title="MIDI Show",sr.desc="Shows MIDI in the graph",sr.color=n,sr.prototype.getTitle=function(){return this.flags.collapsed?this._str:this.title},sr.prototype.onAction=function(dr,lr){lr&&(lr.constructor===Ae?this._str=lr.toString():this._str="???")},sr.prototype.onDrawForeground=function(dr){!this._str||this.flags.collapsed||(dr.font="30px Arial",dr.fillText(this._str,10,this.size[1]*.8))},sr.prototype.onGetInputs=function(){return[["in",t.ACTION]]},sr.prototype.onGetOutputs=function(){return[["on_midi",t.EVENT]]},t.registerNodeType("midi/show",sr);function rr(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var dr=this;this._learning=!1,this.addWidget("button","Learn","",function(){dr._learning=!0,dr.boxcolor="#FA3"}),this.addInput("in",t.EVENT),this.addOutput("on_midi",t.EVENT),this.boxcolor="#AAA"}rr.title="MIDI Filter",rr.desc="Filters MIDI messages",rr.color=n,rr["@cmd"]={type:"enum",title:"Command",values:Ae.commands_reversed},rr.prototype.getTitle=function(){var dr=null;return this.properties.cmd==-1?dr="Nothing":dr=Ae.commands_short[this.properties.cmd]||"Unknown",this.properties.min_value!=-1&&this.properties.max_value!=-1&&(dr+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+dr},rr.prototype.onPropertyChanged=function(dr,lr){if(dr=="cmd"){var gr=Number(lr);isNaN(gr)&&(gr=Ae.commands[lr]||0),this.properties.cmd=gr}},rr.prototype.onAction=function(dr,lr){if(!(!lr||lr.constructor!==Ae)){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=lr.channel,this.properties.cmd=lr.cmd,this.properties.min_value=this.properties.max_value=lr.data[1];else if(this.properties.channel!=-1&&lr.channel!=this.properties.channel||this.properties.cmd!=-1&&lr.cmd!=this.properties.cmd||this.properties.min_value!=-1&&lr.data[1]<this.properties.min_value||this.properties.max_value!=-1&&lr.data[1]>this.properties.max_value)return;this.trigger("on_midi",lr)}},t.registerNodeType("midi/filter",rr);function nr(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",t.EVENT),this.addInput("assign",t.EVENT),this.addOutput("on_midi",t.EVENT),this.midi_event=new Ae,this.gate=!1}nr.title="MIDIEvent",nr.desc="Create a MIDI Event",nr.color=n,nr.prototype.onAction=function(dr,gr){if(dr=="assign"){this.properties.channel=gr.channel,this.properties.cmd=gr.cmd,this.properties.value1=gr.data[1],this.properties.value2=gr.data[2],gr.cmd==Ae.NOTEON?this.gate=!0:gr.cmd==Ae.NOTEOFF&&(this.gate=!1);return}var gr=this.midi_event;gr.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?gr.setCommandFromString(this.properties.cmd):gr.cmd=this.properties.cmd,gr.data[0]=gr.cmd|gr.channel,gr.data[1]=Number(this.properties.value1),gr.data[2]=Number(this.properties.value2),this.trigger("on_midi",gr)},nr.prototype.onExecute=function(){var dr=this.properties;if(this.inputs)for(var lr=0;lr<this.inputs.length;++lr){var gr=this.inputs[lr];if(gr.link!=-1)switch(gr.name){case"note":var fr=this.getInputData(lr);fr!=null&&(fr.constructor===String&&(fr=Ae.NoteStringToPitch(fr)),this.properties.value1=(fr|0)%255);break;case"cmd":var fr=this.getInputData(lr);fr!=null&&(this.properties.cmd=fr);break;case"value1":var fr=this.getInputData(lr);fr!=null&&(this.properties.value1=clamp(fr|0,0,127));break;case"value2":var fr=this.getInputData(lr);fr!=null&&(this.properties.value2=clamp(fr|0,0,127));break}}if(this.outputs)for(var lr=0;lr<this.outputs.length;++lr){var yr=this.outputs[lr],fr=null;switch(yr.name){case"midi":fr=new Ae,fr.setup([dr.cmd,dr.value1,dr.value2]),fr.channel=dr.channel;break;case"command":fr=dr.cmd;break;case"cc":fr=dr.value1;break;case"cc_value":fr=dr.value2;break;case"note":fr=dr.cmd==Ae.NOTEON||dr.cmd==Ae.NOTEOFF?dr.value1:null;break;case"velocity":fr=dr.cmd==Ae.NOTEON?dr.value2:null;break;case"pitch":fr=dr.cmd==Ae.NOTEON?Ae.computePitch(dr.value1):null;break;case"pitchbend":fr=dr.cmd==Ae.PITCHBEND?Ae.computePitchBend(dr.value1,dr.value2):null;break;case"gate":fr=this.gate;break;default:continue}fr!==null&&this.setOutputData(lr,fr)}},nr.prototype.onPropertyChanged=function(dr,lr){dr=="cmd"&&(this.properties.cmd=Ae.computeCommandFromString(lr))},nr.prototype.onGetInputs=function(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]},nr.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",t.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]},t.registerNodeType("midi/event",nr);function ar(){this.properties={cc:1,value:0},this.addOutput("value","number")}ar.title="MIDICC",ar.desc="gets a Controller Change",ar.color=n,ar.prototype.onExecute=function(){this.properties,tr.input&&(this.properties.value=tr.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},t.registerNodeType("midi/cc",ar);function or(){this.addInput("generate",t.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",t.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=or.processScale(this.properties.notes),this.sequence_index=0}or.title="MIDI Generator",or.desc="Generates a random MIDI note",or.color=n,or.processScale=function(dr){for(var lr=dr.split(","),gr=0;gr<lr.length;++gr){var fr=lr[gr];fr.length==2&&fr[1]!="#"||fr.length>2?lr[gr]=-t.MIDIEvent.NoteStringToPitch(fr):lr[gr]=Ae.note_to_index[fr]||0}return lr},or.prototype.onPropertyChanged=function(dr,lr){dr=="notes"&&(this.notes_pitches=or.processScale(lr))},or.prototype.onExecute=function(){var dr=this.getInputData(2);dr!=null&&(this.properties.octave=dr);var lr=this.getInputData(1);lr&&(this.notes_pitches=or.processScale(lr))},or.prototype.onAction=function(dr,wr){var gr=0,fr=this.notes_pitches.length,yr=0;this.properties.mode=="sequence"?yr=this.sequence_index=(this.sequence_index+1)%fr:this.properties.mode=="random"&&(yr=Math.floor(Math.random()*fr));var Er=this.notes_pitches[yr];Er>=0?gr=Er+(this.properties.octave-1)*12+33:gr=-Er;var wr=new Ae;wr.setup([Ae.NOTEON,gr,10]);var Dr=this.properties.duration||1;this.trigger("note",wr),setTimeout((function(){var kr=new Ae;kr.setup([Ae.NOTEOFF,gr,0]),this.trigger("note",kr)}).bind(this),Dr*1e3)},t.registerNodeType("midi/generator",or);function ur(){this.properties={amount:0},this.addInput("in",t.ACTION),this.addInput("amount","number"),this.addOutput("out",t.EVENT),this.midi_event=new Ae}ur.title="MIDI Transpose",ur.desc="Transpose a MIDI note",ur.color=n,ur.prototype.onAction=function(dr,lr){!lr||lr.constructor!==Ae||(lr.data[0]==Ae.NOTEON||lr.data[0]==Ae.NOTEOFF?(this.midi_event=new Ae,this.midi_event.setup(lr.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",lr))},ur.prototype.onExecute=function(){var dr=this.getInputData(1);dr!=null&&(this.properties.amount=dr)},t.registerNodeType("midi/transpose",ur);function hr(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",t.ACTION),this.addInput("scale","string"),this.addOutput("out",t.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}hr.title="MIDI Quantize Pitch",hr.desc="Transpose a MIDI note tp fit an scale",hr.color=n,hr.prototype.onPropertyChanged=function(dr,lr){dr=="scale"&&this.processScale(lr)},hr.prototype.processScale=function(dr){this._current_scale=dr,this.notes_pitches=or.processScale(dr);for(var lr=0;lr<12;++lr)this.valid_notes[lr]=this.notes_pitches.indexOf(lr)!=-1;for(var lr=0;lr<12;++lr){if(this.valid_notes[lr]){this.offset_notes[lr]=0;continue}for(var gr=1;gr<12;++gr){if(this.valid_notes[(lr-gr)%12]){this.offset_notes[lr]=-gr;break}if(this.valid_notes[(lr+gr)%12]){this.offset_notes[lr]=gr;break}}}},hr.prototype.onAction=function(dr,lr){if(!(!lr||lr.constructor!==Ae))if(lr.data[0]==Ae.NOTEON||lr.data[0]==Ae.NOTEOFF){this.midi_event=new Ae,this.midi_event.setup(lr.data);var gr=lr.note,fr=Ae.note_to_index[gr],yr=this.offset_notes[fr];this.midi_event.data[1]+=yr,this.trigger("out",this.midi_event)}else this.trigger("out",lr)},hr.prototype.onExecute=function(){var dr=this.getInputData(1);dr!=null&&dr!=this._current_scale&&this.processScale(dr)},t.registerNodeType("midi/quantize",hr);function cr(){this.properties={url:"",autoplay:!0},this.addInput("play",t.ACTION),this.addInput("pause",t.ACTION),this.addOutput("note",t.EVENT),this._midi=null,this._current_time=0,this._playing=!1,typeof MidiParser>"u"&&(console.error("midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}cr.title="MIDI fromFile",cr.desc="Plays a MIDI file",cr.color=n,cr.prototype.onAction=function(dr){dr=="play"?this.play():dr=="pause"&&(this._playing=!this._playing)},cr.prototype.onPropertyChanged=function(dr,lr){dr=="url"&&this.loadMIDIFile(lr)},cr.prototype.onExecute=function(){if(this._midi&&this._playing){this._current_time+=this.graph.elapsed_time;for(var dr=this._current_time*100,lr=0;lr<this._midi.tracks;++lr){var gr=this._midi.track[lr];gr._last_pos||(gr._last_pos=0,gr._time=0);var fr=gr.event[gr._last_pos];if(fr&&gr._time+fr.deltaTime<=dr&&(gr._last_pos++,gr._time+=fr.deltaTime,fr.data)){var yr=fr.type<<4+fr.channel,Er=new Ae;Er.setup([yr,fr.data[0],fr.data[1]]),this.trigger("note",Er)}}}},cr.prototype.play=function(){if(this._playing=!0,this._current_time=0,!!this._midi)for(var dr=0;dr<this._midi.tracks;++dr){var lr=this._midi.track[dr];lr._last_pos=0,lr._time=0}},cr.prototype.loadMIDIFile=function(dr){var lr=this;t.fetchFile(dr,"arraybuffer",function(gr){lr.boxcolor="#AFA",lr._midi=MidiParser.parse(new Uint8Array(gr)),lr.properties.autoplay&&lr.play()},function(gr){lr.boxcolor="#FAA",lr._midi=null})},cr.prototype.onDropFile=function(dr){this.properties.url="",this.loadMIDIFile(dr)},t.registerNodeType("midi/fromFile",cr);function vr(){if(this.properties={volume:.5,duration:1},this.addInput("note",t.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",t.EVENT),typeof AudioSynth>"u")console.error("Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var dr=this.synth=new AudioSynth;this.instrument=dr.createInstrument("piano")}}vr.title="MIDI Play",vr.desc="Plays a MIDI note",vr.color=n,vr.prototype.onAction=function(dr,lr){if(!(!lr||lr.constructor!==Ae)){if(this.instrument&&lr.data[0]==Ae.NOTEON){var gr=lr.note;if(!gr||gr=="undefined"||gr.constructor!==String)return;this.instrument.play(gr,lr.octave,this.properties.duration,this.properties.volume)}this.trigger("note",lr)}},vr.prototype.onExecute=function(){var dr=this.getInputData(1);dr!=null&&(this.properties.volume=dr);var lr=this.getInputData(2);lr!=null&&(this.properties.duration=lr)},t.registerNodeType("midi/play",vr);function mr(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",t.ACTION),this.addInput("reset",t.ACTION),this.addOutput("note",t.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}mr.title="MIDI Keys",mr.desc="Keyboard to play notes",mr.color=n,mr.keys=[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}],mr.prototype.onDrawForeground=function(dr){if(!this.flags.collapsed){var lr=this.properties.num_octaves*12;this.keys.length=lr;var gr=this.size[0]/(this.properties.num_octaves*7),fr=this.size[1];dr.globalAlpha=1;for(var yr=0;yr<2;yr++)for(var Er=0;Er<lr;++Er){var wr=mr.keys[Er%12];if(wr.t==yr){var Dr=Math.floor(Er/12),kr=Dr*7*gr+wr.x*gr;yr==0?dr.fillStyle=this.keys[Er]?"#CCC":"white":dr.fillStyle=this.keys[Er]?"#333":"black",dr.fillRect(kr+1,0,gr*wr.w-2,fr*wr.h)}}}},mr.prototype.getKeyIndex=function(dr){this.properties.num_octaves*12;for(var lr=this.size[0]/(this.properties.num_octaves*7),gr=this.size[1],fr=1;fr>=0;fr--)for(var yr=0;yr<this.keys.length;++yr){var Er=mr.keys[yr%12];if(Er.t==fr){var wr=Math.floor(yr/12),Dr=wr*7*lr+Er.x*lr,kr=lr*Er.w,zr=gr*Er.h;if(!(dr[0]<Dr||dr[0]>Dr+kr||dr[1]>zr))return yr}}return-1},mr.prototype.onAction=function(dr,lr){if(dr=="reset"){for(var gr=0;gr<this.keys.length;++gr)this.keys[gr]=!1;return}if(!(!lr||lr.constructor!==Ae)){var fr=lr,yr=(this.properties.start_octave-1)*12+29,Er=fr.data[1]-yr;Er>=0&&Er<this.keys.length&&(fr.data[0]==Ae.NOTEON?this.keys[Er]=!0:fr.data[0]==Ae.NOTEOFF&&(this.keys[Er]=!1)),this.trigger("note",fr)}},mr.prototype.onMouseDown=function(dr,lr){if(!(lr[1]<0)){var gr=this.getKeyIndex(lr);this.keys[gr]=!0,this._last_key=gr;var fr=(this.properties.start_octave-1)*12+29+gr,yr=new Ae;return yr.setup([Ae.NOTEON,fr,100]),this.trigger("note",yr),!0}},mr.prototype.onMouseMove=function(dr,lr){if(!(lr[1]<0||this._last_key==-1)){this.setDirtyCanvas(!0);var gr=this.getKeyIndex(lr);if(this._last_key==gr)return!0;this.keys[this._last_key]=!1;var fr=(this.properties.start_octave-1)*12+29+this._last_key,yr=new Ae;yr.setup([Ae.NOTEOFF,fr,100]),this.trigger("note",yr),this.keys[gr]=!0;var fr=(this.properties.start_octave-1)*12+29+gr,yr=new Ae;return yr.setup([Ae.NOTEON,fr,100]),this.trigger("note",yr),this._last_key=gr,!0}},mr.prototype.onMouseUp=function(dr,lr){if(!(lr[1]<0)){var gr=this.getKeyIndex(lr);this.keys[gr]=!1,this._last_key=-1;var fr=(this.properties.start_octave-1)*12+29+gr,yr=new Ae;return yr.setup([Ae.NOTEOFF,fr,100]),this.trigger("note",yr),!0}},t.registerNodeType("midi/keys",mr)}(commonjsGlobal),function(s){var t=s.LiteGraph,n={};s.LGAudio=n,n.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(lr){console.log("msg",lr)},this._audio_context.onended=function(lr){console.log("ended",lr)},this._audio_context.oncomplete=function(lr){console.log("complete",lr)}}return this._audio_context},n.connect=function(lr,gr){try{lr.connect(gr)}catch(fr){console.warn("LGraphAudio:",fr)}},n.disconnect=function(lr,gr){try{lr.disconnect(gr)}catch(fr){console.warn("LGraphAudio:",fr)}},n.changeAllAudiosConnections=function(lr,gr){if(lr.inputs)for(var fr=0;fr<lr.inputs.length;++fr){var yr=lr.inputs[fr],Er=lr.graph.links[yr.link];if(Er){var wr=lr.graph.getNodeById(Er.origin_id),Dr=null;wr.getAudioNodeInOutputSlot?Dr=wr.getAudioNodeInOutputSlot(Er.origin_slot):Dr=wr.audionode;var kr=null;lr.getAudioNodeInInputSlot?kr=lr.getAudioNodeInInputSlot(fr):kr=lr.audionode,gr?n.connect(Dr,kr):n.disconnect(Dr,kr)}}if(lr.outputs)for(var fr=0;fr<lr.outputs.length;++fr)for(var zr=lr.outputs[fr],Vr=0;Vr<zr.links.length;++Vr){var Er=lr.graph.links[zr.links[Vr]];if(Er){var Dr=null;lr.getAudioNodeInOutputSlot?Dr=lr.getAudioNodeInOutputSlot(fr):Dr=lr.audionode;var Hr=lr.graph.getNodeById(Er.target_id),kr=null;Hr.getAudioNodeInInputSlot?kr=Hr.getAudioNodeInInputSlot(Er.target_slot):kr=Hr.audionode,gr?n.connect(Dr,kr):n.disconnect(Dr,kr)}}},n.onConnectionsChange=function(lr,gr,fr,yr){if(lr==t.OUTPUT){var Er=null;if(yr&&(Er=this.graph.getNodeById(yr.target_id)),!!Er){var wr=null;this.getAudioNodeInOutputSlot?wr=this.getAudioNodeInOutputSlot(gr):wr=this.audionode;var Dr=null;Er.getAudioNodeInInputSlot?Dr=Er.getAudioNodeInInputSlot(yr.target_slot):Dr=Er.audionode,fr?n.connect(wr,Dr):n.disconnect(wr,Dr)}}},n.createAudioNodeWrapper=function(lr){var gr=lr.prototype.onPropertyChanged;lr.prototype.onPropertyChanged=function(fr,yr){gr&&gr.call(this,fr,yr),this.audionode&&this.audionode[fr]!==void 0&&(this.audionode[fr].value!==void 0?this.audionode[fr].value=yr:this.audionode[fr]=yr)},lr.prototype.onConnectionsChange=n.onConnectionsChange},n.cached_audios={},n.loadSound=function(lr,gr,fr){if(n.cached_audios[lr]&&lr.indexOf("blob:")==-1){gr&&gr(n.cached_audios[lr]);return}n.onProcessAudioURL&&(lr=n.onProcessAudioURL(lr));var yr=new XMLHttpRequest;yr.open("GET",lr,!0),yr.responseType="arraybuffer";var Er=n.getAudioContext();yr.onload=function(){console.log("AudioSource loaded"),Er.decodeAudioData(yr.response,function(Dr){console.log("AudioSource decoded"),n.cached_audios[lr]=Dr,gr&&gr(Dr)},wr)},yr.send();function wr(Dr){console.log("Audio loading sample error:",Dr),fr&&fr(Dr)}return yr};function Ae(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var lr=n.getAudioContext();this.audionode=lr.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}Ae.desc="Plays an audio file",Ae["@src"]={widget:"resource"},Ae.supported_extensions=["wav","ogg","mp3"],Ae.prototype.onAdded=function(lr){lr.status===LGraph.STATUS_RUNNING&&this.onStart()},Ae.prototype.onStart=function(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)},Ae.prototype.onStop=function(){this.stopAllSounds()},Ae.prototype.onPause=function(){this.pauseAllSounds()},Ae.prototype.onUnpause=function(){this.unpauseAllSounds()},Ae.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},Ae.prototype.stopAllSounds=function(){for(var lr=0;lr<this._audionodes.length;++lr)this._audionodes[lr].started&&(this._audionodes[lr].started=!1,this._audionodes[lr].stop());this._audionodes.length=0},Ae.prototype.pauseAllSounds=function(){n.getAudioContext().suspend()},Ae.prototype.unpauseAllSounds=function(){n.getAudioContext().resume()},Ae.prototype.onExecute=function(){if(this.inputs)for(var lr=0;lr<this.inputs.length;++lr){var gr=this.inputs[lr];if(gr.link!=null){var fr=this.getInputData(lr);if(fr!==void 0){if(gr.name=="gain")this.audionode.gain.value=fr;else if(gr.name=="src")this.setProperty("src",fr);else if(gr.name=="playbackRate"){this.properties.playbackRate=fr;for(var yr=0;yr<this._audionodes.length;++yr)this._audionodes[yr].playbackRate.value=fr}}}}if(this.outputs)for(var lr=0;lr<this.outputs.length;++lr){var Er=this.outputs[lr];Er.name=="buffer"&&this._audiobuffer&&this.setOutputData(lr,this._audiobuffer)}},Ae.prototype.onAction=function(lr){this._audiobuffer&&(lr=="Play"?this.playBuffer(this._audiobuffer):lr=="Stop"&&this.stopAllSounds())},Ae.prototype.onPropertyChanged=function(lr,gr){if(lr=="src")this.loadSound(gr);else if(lr=="gain")this.audionode.gain.value=gr;else if(lr=="playbackRate")for(var fr=0;fr<this._audionodes.length;++fr)this._audionodes[fr].playbackRate.value=gr},Ae.prototype.playBuffer=function(lr){var gr=this,fr=n.getAudioContext(),yr=fr.createBufferSource();return this._last_sourcenode=yr,yr.graphnode=this,yr.buffer=lr,yr.loop=this.properties.loop,yr.playbackRate.value=this.properties.playbackRate,this._audionodes.push(yr),yr.connect(this.audionode),this._audionodes.push(yr),this.trigger("start"),yr.onended=function(){gr.trigger("ended");var Er=gr._audionodes.indexOf(yr);Er!=-1&&gr._audionodes.splice(Er,1)},yr.started||(yr.started=!0,yr.start()),yr},Ae.prototype.loadSound=function(lr){var gr=this;if(this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,!lr)return;this._request=n.loadSound(lr,fr),this._loading_audio=!0,this.boxcolor="#AA4";function fr(yr){this.boxcolor=t.NODE_DEFAULT_BOXCOLOR,gr._audiobuffer=yr,gr._loading_audio=!1,gr.graph&&gr.graph.status===LGraph.STATUS_RUNNING&&gr.onStart()}},Ae.prototype.onConnectionsChange=n.onConnectionsChange,Ae.prototype.onGetInputs=function(){return[["playbackRate","number"],["src","string"],["Play",t.ACTION],["Stop",t.ACTION]]},Ae.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["start",t.EVENT],["ended",t.EVENT]]},Ae.prototype.onDropFile=function(lr){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var gr=URL.createObjectURL(lr);this.properties.src=gr,this.loadSound(gr),this._dropped_url=gr},Ae.title="Source",Ae.desc="Plays audio",t.registerNodeType("audio/source",Ae);function Ne(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var lr=n.getAudioContext();this.audionode=lr.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}Ne.prototype.onAdded=function(lr){lr.status===LGraph.STATUS_RUNNING&&this.onStart()},Ne.prototype.onStart=function(){this._media_stream==null&&!this._waiting_confirmation&&this.openStream()},Ne.prototype.onStop=function(){this.audionode.gain.value=0},Ne.prototype.onPause=function(){this.audionode.gain.value=0},Ne.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},Ne.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var lr=this._media_stream.getTracks();lr.length&&lr[0].stop()}},Ne.prototype.openStream=function(){if(!navigator.mediaDevices){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(gr);var lr=this;function gr(fr){console.log("Media rejected",fr),lr._media_stream=!1,lr.boxcolor="red"}},Ne.prototype.streamReady=function(lr){this._media_stream=lr,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var gr=n.getAudioContext();this.audiosource_node=gr.createMediaStreamSource(lr),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},Ne.prototype.onExecute=function(){if(this._media_stream==null&&!this._waiting_confirmation&&this.openStream(),this.inputs)for(var lr=0;lr<this.inputs.length;++lr){var gr=this.inputs[lr];if(gr.link!=null){var fr=this.getInputData(lr);fr!==void 0&&gr.name=="gain"&&(this.audionode.gain.value=this.properties.gain=fr)}}},Ne.prototype.onAction=function(lr){lr=="Play"?this.audionode.gain.value=this.properties.gain:lr=="Stop"&&(this.audionode.gain.value=0)},Ne.prototype.onPropertyChanged=function(lr,gr){lr=="gain"&&(this.audionode.gain.value=gr)},Ne.prototype.onConnectionsChange=n.onConnectionsChange,Ne.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",t.ACTION],["Stop",t.ACTION]]},Ne.title="MediaSource",Ne.desc="Plays microphone",t.registerNodeType("audio/media_source",Ne);function tr(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var lr=n.getAudioContext();this.audionode=lr.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}tr.prototype.onPropertyChanged=function(lr,gr){this.audionode[lr]=gr},tr.prototype.onExecute=function(){if(this.isOutputConnected(0)){var lr=this.audionode.frequencyBinCount;(!this._freq_bin||this._freq_bin.length!=lr)&&(this._freq_bin=new Uint8Array(lr)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}if(this.isOutputConnected(1)){var lr=this.audionode.frequencyBinCount;(!this._time_bin||this._time_bin.length!=lr)&&(this._time_bin=new Uint8Array(lr)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin)}for(var gr=1;gr<this.inputs.length;++gr){var fr=this.inputs[gr];if(fr.link!=null){var yr=this.getInputData(gr);yr!==void 0&&(this.audionode[fr.name].value=yr)}}},tr.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},tr.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},tr.title="Analyser",tr.desc="Audio Analyser",t.registerNodeType("audio/analyser",tr);function er(){this.properties={gain:1},this.audionode=n.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}er.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var lr=1;lr<this.inputs.length;++lr){var gr=this.inputs[lr],fr=this.getInputData(lr);fr!==void 0&&(this.audionode[gr.name].value=fr)}},n.createAudioNodeWrapper(er),er.title="Gain",er.desc="Audio gain",t.registerNodeType("audio/gain",er);function ir(){this.properties={impulse_src:"",normalize:!0},this.audionode=n.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}n.createAudioNodeWrapper(ir),ir.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},ir.prototype.onPropertyChanged=function(lr,gr){lr=="impulse_src"?this.loadImpulse(gr):lr=="normalize"&&(this.audionode.normalize=gr)},ir.prototype.onDropFile=function(lr){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(lr),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},ir.prototype.loadImpulse=function(lr){var gr=this;if(this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,!lr)return;this._request=n.loadSound(lr,fr),this._loading_impulse=!0;function fr(yr){gr._impulse_buffer=yr,gr.audionode.buffer=yr,console.log("Impulse signal set"),gr._loading_impulse=!1}},ir.title="Convolver",ir.desc="Convolves the signal (used for reverb)",t.registerNodeType("audio/convolver",ir);function sr(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=n.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}n.createAudioNodeWrapper(sr),sr.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var lr=1;lr<this.inputs.length;++lr){var gr=this.inputs[lr];if(gr.link!=null){var fr=this.getInputData(lr);fr!==void 0&&(this.audionode[gr.name].value=fr)}}},sr.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},sr.title="DynamicsCompressor",sr.desc="Dynamics Compressor",t.registerNodeType("audio/dynamicsCompressor",sr);function rr(){this.properties={},this.audionode=n.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}rr.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length)){var lr=this.getInputData(1);lr!==void 0&&(this.audionode.curve=lr)}},rr.prototype.setWaveShape=function(lr){this.audionode.curve=lr},n.createAudioNodeWrapper(rr);function nr(){this.properties={gain1:.5,gain2:.5},this.audionode=n.getAudioContext().createGain(),this.audionode1=n.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=n.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}nr.prototype.getAudioNodeInInputSlot=function(lr){if(lr==0)return this.audionode1;if(lr==2)return this.audionode2},nr.prototype.onPropertyChanged=function(lr,gr){lr=="gain1"?this.audionode1.gain.value=gr:lr=="gain2"&&(this.audionode2.gain.value=gr)},nr.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var lr=1;lr<this.inputs.length;++lr){var gr=this.inputs[lr];if(!(gr.link==null||gr.type=="audio")){var fr=this.getInputData(lr);fr!==void 0&&(lr==1?this.audionode1.gain.value=fr:lr==3&&(this.audionode2.gain.value=fr))}}},n.createAudioNodeWrapper(nr),nr.title="Mixer",nr.desc="Audio mixer",t.registerNodeType("audio/mixer",nr);function ar(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=n.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}ar.prototype.onExecute=function(){var lr=n.getAudioContext(),gr=lr.currentTime,fr=this.audionode,yr=fr.gain,Er=this.getInputData(1),wr=this.getInputOrProperty("A"),Dr=this.getInputOrProperty("D"),kr=this.getInputOrProperty("S"),zr=this.getInputOrProperty("R");!this.gate&&Er?(yr.cancelScheduledValues(0),yr.setValueAtTime(0,gr),yr.linearRampToValueAtTime(1,gr+wr),yr.linearRampToValueAtTime(kr,gr+wr+Dr)):this.gate&&!Er&&(yr.cancelScheduledValues(0),yr.setValueAtTime(yr.value,gr),yr.linearRampToValueAtTime(0,gr+zr)),this.gate=Er},ar.prototype.onGetInputs=function(){return[["A","number"],["D","number"],["S","number"],["R","number"]]},n.createAudioNodeWrapper(ar),ar.title="ADSR",ar.desc="Audio envelope",t.registerNodeType("audio/adsr",ar);function or(){this.properties={delayTime:.5},this.audionode=n.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}n.createAudioNodeWrapper(or),or.prototype.onExecute=function(){var lr=this.getInputData(1);lr!==void 0&&(this.audionode.delayTime.value=lr)},or.title="Delay",or.desc="Audio delay",t.registerNodeType("audio/delay",or);function ur(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=n.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}ur.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var lr=1;lr<this.inputs.length;++lr){var gr=this.inputs[lr];if(gr.link!=null){var fr=this.getInputData(lr);fr!==void 0&&(this.audionode[gr.name].value=fr)}}},ur.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},n.createAudioNodeWrapper(ur),ur.title="BiquadFilter",ur.desc="Audio filter",t.registerNodeType("audio/biquadfilter",ur);function hr(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=n.getAudioContext().createOscillator(),this.addOutput("out","audio")}hr.prototype.onStart=function(){if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch{}}},hr.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},hr.prototype.onPause=function(){this.onStop()},hr.prototype.onUnpause=function(){this.onStart()},hr.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var lr=0;lr<this.inputs.length;++lr){var gr=this.inputs[lr];if(gr.link!=null){var fr=this.getInputData(lr);fr!==void 0&&(this.audionode[gr.name].value=fr)}}},hr.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},n.createAudioNodeWrapper(hr),hr.title="Oscillator",hr.desc="Oscillator",t.registerNodeType("audio/oscillator",hr);function cr(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}cr.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var lr=this.getInputData(1);lr!==void 0&&(this.properties.mark=lr),this.setDirtyCanvas(!0,!1)},cr.prototype.onDrawForeground=function(lr){if(this._last_buffer){var gr=this._last_buffer,fr=gr.length/this.size[0],yr=this.size[1];lr.fillStyle="black",lr.fillRect(0,0,this.size[0],this.size[1]),lr.strokeStyle="white",lr.beginPath();var Er=0;if(this.properties.continuous){lr.moveTo(Er,yr);for(var wr=0;wr<gr.length;wr+=fr)lr.lineTo(Er,yr-gr[wr|0]/255*yr),Er++}else for(var wr=0;wr<gr.length;wr+=fr)lr.moveTo(Er+.5,yr),lr.lineTo(Er+.5,yr-gr[wr|0]/255*yr),Er++;if(lr.stroke(),this.properties.mark>=0){var Dr=n.getAudioContext().sampleRate,kr=Dr/gr.length,Er=2*(this.properties.mark/kr)/fr;Er>=this.size[0]&&(Er=this.size[0]-1),lr.strokeStyle="red",lr.beginPath(),lr.moveTo(Er,yr),lr.lineTo(Er,0),lr.stroke()}}},cr.title="Visualization",cr.desc="Audio Visualization",t.registerNodeType("audio/visualization",cr);function vr(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}vr.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),!!this._freqs){var lr=this.properties.band,Er=this.getInputData(1);Er!==void 0&&(lr=Er);var gr=n.getAudioContext().sampleRate,fr=gr/this._freqs.length,yr=2*(lr/fr),Er=0;if(yr<0&&(Er=this._freqs[0]),yr>=this._freqs.length)Er=this._freqs[this._freqs.length-1];else{var wr=yr|0,Dr=this._freqs[wr],kr=this._freqs[wr+1],zr=yr-wr;Er=Dr*(1-zr)+kr*zr}this.setOutputData(0,Er/255*this.properties.amplitude)}},vr.prototype.onGetInputs=function(){return[["band","number"]]},vr.title="Signal",vr.desc="extract the signal of some frequency",t.registerNodeType("audio/signal",vr);function mr(){if(!mr.default_code){var lr=mr.default_function.toString(),gr=lr.indexOf("{")+1,fr=lr.lastIndexOf("}");mr.default_code=lr.substr(gr,fr-gr)}this.properties={code:mr.default_code};var yr=n.getAudioContext();yr.createScriptProcessor?this.audionode=yr.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=yr.createGain()),this.processCode(),mr._bypass_function||(mr._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}mr.prototype.onAdded=function(lr){lr.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},mr["@code"]={widget:"code",type:"code"},mr.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},mr.prototype.onStop=function(){this.audionode.onaudioprocess=mr._bypass_function},mr.prototype.onPause=function(){this.audionode.onaudioprocess=mr._bypass_function},mr.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},mr.prototype.onExecute=function(){},mr.prototype.onRemoved=function(){this.audionode.onaudioprocess=mr._bypass_function},mr.prototype.processCode=function(){try{var lr=new Function("properties",this.properties.code);this._script=new lr(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(gr){console.error("Error in onaudioprocess code",gr),this._callback=mr._bypass_function,this.audionode.onaudioprocess=this._callback}},mr.prototype.onPropertyChanged=function(lr,gr){lr=="code"&&(this.properties.code=gr,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},mr.default_function=function(){this.onaudioprocess=function(lr){for(var gr=lr.inputBuffer,fr=lr.outputBuffer,yr=0;yr<fr.numberOfChannels;yr++)for(var Er=gr.getChannelData(yr),wr=fr.getChannelData(yr),Dr=0;Dr<gr.length;Dr++)wr[Dr]=Er[Dr]}},n.createAudioNodeWrapper(mr),mr.title="Script",mr.desc="apply script to signal",t.registerNodeType("audio/script",mr);function dr(){this.audionode=n.getAudioContext().destination,this.addInput("in","audio")}dr.title="Destination",dr.desc="Audio output",t.registerNodeType("audio/destination",dr)}(commonjsGlobal),function(s){var t=s.LiteGraph;function n(){this.size=[60,20],this.addInput("send",t.ACTION),this.addOutput("received",t.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}n.title="WebSocket",n.desc="Send data through a websocket",n.prototype.onPropertyChanged=function(tr,er){tr=="url"&&this.connectSocket()},n.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){for(var tr=this.properties.room,er=this.properties.only_send_changes,ir=1;ir<this.inputs.length;++ir){var sr=this.getInputData(ir);if(sr!=null){var rr;try{rr=JSON.stringify({type:0,room:tr,channel:ir,data:sr})}catch{continue}er&&this._last_sent_data[ir]==rr||(this._last_sent_data[ir]=rr,this._ws.send(rr))}}for(var ir=1;ir<this.outputs.length;++ir)this.setOutputData(ir,this._last_received_data[ir]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},n.prototype.connectSocket=function(){var tr=this,er=this.properties.url;er.substr(0,2)!="ws"&&(er="ws://"+er),this._ws=new WebSocket(er),this._ws.onopen=function(){console.log("ready"),tr.boxcolor="#6C6"},this._ws.onmessage=function(ir){tr.boxcolor="#AFA";var sr=JSON.parse(ir.data);if(!(sr.room&&sr.room!=tr.properties.room))if(sr.type==1)if(sr.data.object_class&&t[sr.data.object_class]){var rr=null;try{rr=new t[sr.data.object_class](sr.data),tr.triggerSlot(0,rr)}catch{return}}else tr.triggerSlot(0,sr.data);else tr._last_received_data[sr.channel||0]=sr.data},this._ws.onerror=function(ir){console.log("couldnt connect to websocket"),tr.boxcolor="#E88"},this._ws.onclose=function(ir){console.log("connection closed"),tr.boxcolor="#000"}},n.prototype.send=function(tr){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:tr}))},n.prototype.onAction=function(tr,er){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:tr,data:er})},n.prototype.onGetInputs=function(){return[["in",0]]},n.prototype.onGetOutputs=function(){return[["out",0]]},t.registerNodeType("network/websocket",n);function Ae(){this.room_widget=this.addWidget("text","Room","lgraph",this.setRoom.bind(this)),this.addWidget("button","Reconnect",null,this.connectSocket.bind(this)),this.addInput("send",t.ACTION),this.addOutput("received",t.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",only_send_changes:!0},this._server=null,this.connectSocket(),this._last_sent_data=[],this._last_received_data=[],typeof SillyClient>"u"&&console.warn("remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js")}Ae.title="SillyClient",Ae.desc="Connects to SillyServer to broadcast messages",Ae.prototype.onPropertyChanged=function(tr,er){tr=="room"&&(this.room_widget.value=er),this.connectSocket()},Ae.prototype.setRoom=function(tr){this.properties.room=tr,this.room_widget.value=tr,this.connectSocket()},Ae.prototype.onDrawForeground=function(){for(var tr=1;tr<this.inputs.length;++tr){var er=this.inputs[tr];er.label="in_"+tr}for(var tr=1;tr<this.outputs.length;++tr){var er=this.outputs[tr];er.label="out_"+tr}},Ae.prototype.onExecute=function(){if(!(!this._server||!this._server.is_connected)){for(var tr=this.properties.only_send_changes,er=1;er<this.inputs.length;++er){var ir=this.getInputData(er),sr=this._last_sent_data[er];if(ir!=null){if(tr){var rr=!0;if(ir&&ir.length&&sr&&sr.length==ir.length&&ir.constructor!==String){for(var nr=0;nr<ir.length;++nr)if(sr[nr]!=ir[nr]){rr=!1;break}}else this._last_sent_data[er]!=ir&&(rr=!1);if(rr)continue}if(this._server.sendMessage({type:0,channel:er,data:ir}),ir.length&&ir.constructor!==String)if(this._last_sent_data[er]){this._last_sent_data[er].length=ir.length;for(var nr=0;nr<ir.length;++nr)this._last_sent_data[er][nr]=ir[nr]}else ir.constructor===Array?this._last_sent_data[er]=ir.concat():this._last_sent_data[er]=new ir.constructor(ir);else this._last_sent_data[er]=ir}}for(var er=1;er<this.outputs.length;++er)this.setOutputData(er,this._last_received_data[er]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},Ae.prototype.connectSocket=function(){var tr=this;if(typeof SillyClient>"u"){this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),this._error=!0;return}if(this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),tr.boxcolor="#6C6"},this._server.on_message=function(er,ir){var sr=null;try{sr=JSON.parse(ir)}catch{return}if(sr.type==1)if(sr.data.object_class&&t[sr.data.object_class]){var rr=null;try{rr=new t[sr.data.object_class](sr.data),tr.triggerSlot(0,rr)}catch{return}}else tr.triggerSlot(0,sr.data);else tr._last_received_data[sr.channel||0]=sr.data;tr.boxcolor="#AFA"},this._server.on_error=function(er){console.log("couldnt connect to websocket"),tr.boxcolor="#E88"},this._server.on_close=function(er){console.log("connection closed"),tr.boxcolor="#000"},this.properties.url&&this.properties.room){try{this._server.connect(this.properties.url,this.properties.room)}catch(er){console.error("SillyServer error: "+er),this._server=null;return}this._final_url=this.properties.url+"/"+this.properties.room}},Ae.prototype.send=function(tr){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,data:tr})},Ae.prototype.onAction=function(tr,er){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,action:tr,data:er})},Ae.prototype.onGetInputs=function(){return[["in",0]]},Ae.prototype.onGetOutputs=function(){return[["out",0]]},t.registerNodeType("network/sillyclient",Ae);function Ne(){this.addInput("request",t.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",t.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}Ne.title="HTTP Request",Ne.desc="Fetch data through HTTP",Ne.prototype.fetch=function(){var tr=this.properties.url;if(tr){this.boxcolor="#FF0";var er=this;this._fetching=fetch(tr).then(ir=>{if(!ir.ok)this.boxcolor="#F00",er.trigger("error");else return this.boxcolor="#0F0",ir.text()}).then(ir=>{er._data=ir,er._fetching=null,er.trigger("ready")})}},Ne.prototype.onAction=function(tr){tr=="request"&&this.fetch()},Ne.prototype.onExecute=function(){this.setOutputData(1,this._data)},Ne.prototype.onGetOutputs=function(){return[["error",t.EVENT]]},t.registerNodeType("network/httprequest",Ne)}(commonjsGlobal)})(litegraph);litegraph.LiteGraph.clearRegisteredTypes();function GetOpenNode(){this.addOutput("open","column"),this.serialize_widgets=!0}GetOpenNode.title="Get open price";litegraph.LiteGraph.registerNodeType("get/open",GetOpenNode);function GetHighNode(){this.addOutput("high","column"),this.serialize_widgets=!0}GetHighNode.title="Get high price";litegraph.LiteGraph.registerNodeType("get/high",GetHighNode);function GetLowNode$1(){this.addOutput("low","column"),this.serialize_widgets=!0}GetLowNode$1.title="Get low price";litegraph.LiteGraph.registerNodeType("get/low",GetLowNode$1);function GetCloseNode(){this.addOutput("close","column"),this.serialize_widgets=!0}GetCloseNode.title="Get close price";litegraph.LiteGraph.registerNodeType("get/close",GetCloseNode);function GetVolumeNode(){this.addOutput("volume","column"),this.serialize_widgets=!0}GetVolumeNode.title="Get volume";litegraph.LiteGraph.registerNodeType("get/volume",GetVolumeNode);function GetLowNode(){this.addInput("Column","column"),this.addOutput("Value","float"),this.serialize_widgets=!0}GetLowNode.title="Get last value";litegraph.LiteGraph.registerNodeType("get/last_value",GetLowNode);function SetFloatNode(){this.addOutput("Float","float"),this.properties={value:1},this.addWidget("number","Value",this.properties.value,s=>{const t=parseFloat(s);isNaN(t)||(this.properties.value=t)},{property:"value",step:.01,min:-1/0,max:1/0,precision:3}),this.title_color="#87CEFA",this.serialize_widgets=!0}SetFloatNode.title="Set float";litegraph.LiteGraph.registerNodeType("set/float",SetFloatNode);function SetIntegerNode(){this.addOutput("Integer","integer"),this.properties={value:3},this.addWidget("number","Value",this.properties.value,s=>{const t=parseInt(s,10);isNaN(t)||(this.properties.value=t)},{property:"value",step:10,min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,precision:0}),this.serialize_widgets=!0}SetIntegerNode.title="Set integer";SetIntegerNode.description="Set integer";litegraph.LiteGraph.registerNodeType("set/integer",SetIntegerNode);function SetStringNode(){this.addOutput("String","string"),this.properties={value:"String"},this.addWidget("text","Value",this.properties.value,s=>{this.properties.value=s}),this.serialize_widgets=!0}SetStringNode.title="Set string";litegraph.LiteGraph.registerNodeType("set/string",SetStringNode);function AddColumnNode(){this.addInput("Column","column"),this.addInput("Name","string"),this.serialize_widgets=!0}AddColumnNode.title="Add column";litegraph.LiteGraph.registerNodeType("tools/add_column",AddColumnNode);function AddConditionNode(){this.addInput("Condition","boolean"),this.addInput("Name","string"),this.serialize_widgets=!0}AddConditionNode.title="Add condition";litegraph.LiteGraph.registerNodeType("tools/add_condition",AddConditionNode);function GetColumnNode(){this.addOutput("Column","column"),this.addInput("Name","string"),this.serialize_widgets=!0}GetColumnNode.title="Get column";litegraph.LiteGraph.registerNodeType("tools/get_column",GetColumnNode);function GetConditionNode(){this.addOutput("Condition","boolean"),this.addInput("Name","string"),this.serialize_widgets=!0}GetConditionNode.title="Get condition";litegraph.LiteGraph.registerNodeType("tools/get_condition",GetConditionNode);function MultiplyColumnNode(){this.addInput("Column","column"),this.addInput("Coefficient","float"),this.addOutput("Result","column"),this.serialize_widgets=!0}MultiplyColumnNode.title="Multiply column";litegraph.LiteGraph.registerNodeType("math/multiply_column",MultiplyColumnNode);function IfNode(){this.addInput("Condition","boolean"),this.addOutput("True","exec"),this.addOutput("False","exec"),this.serialize_widgets=!0}IfNode.title="IF";litegraph.LiteGraph.registerNodeType("logic/if",IfNode);function AndNode(){this.addInput("Condition","boolean"),this.addInput("Condition","boolean"),this.addOutput("Condition","boolean"),this.serialize_widgets=!0}AndNode.title="AND";litegraph.LiteGraph.registerNodeType("logic/and",AndNode);function OrNode(){this.addInput("Condition","boolean"),this.addInput("Condition","boolean"),this.addOutput("Condition","boolean"),this.serialize_widgets=!0}OrNode.title="OR";litegraph.LiteGraph.registerNodeType("logic/or",OrNode);function NotNode(){this.addInput("Condition","boolean"),this.addOutput("Condition","boolean"),this.serialize_widgets=!0}NotNode.title="NOT";litegraph.LiteGraph.registerNodeType("logic/not",NotNode);function CrossOverNode(){this.addInput("Column","column"),this.addInput("Column","column"),this.addOutput("Condition","boolean"),this.serialize_widgets=!0}CrossOverNode.title="Cross Over";litegraph.LiteGraph.registerNodeType("compare/cross_over",CrossOverNode);function EqualNode(){this.addInput("Column","column"),this.addInput("Column","column"),this.addOutput("Condition","boolean"),this.serialize_widgets=!0}EqualNode.title="Equal";litegraph.LiteGraph.registerNodeType("compare/equal",EqualNode);function SmallerNode(){this.addInput("Column","column"),this.addInput("Column","column"),this.addOutput("Condition","boolean"),this.serialize_widgets=!0}SmallerNode.title="Smaller";litegraph.LiteGraph.registerNodeType("compare/smaller",SmallerNode);function MaNode(){this.addInput("Column","column"),this.addInput("Length","integer"),this.addWidget("combo","MA Type","ema",s=>{this.properties.ma_type=s},{values:["dema","ema","fwma","hma","linreg","midpoint","pwma","rma","sinwma","sma","swma","t3","tema","trima","vidya","wma","zlma"]}),this.properties={ma_type:"ema"},this.addOutput("MA","column"),this.addOutput("Default name","string"),this.serialize_widgets=!0}MaNode.title="MA";litegraph.LiteGraph.registerNodeType("indicators/ma",MaNode);function BollingerNode(){this.addInput("Close","column"),this.addInput("Window","integer"),this.addOutput("Lower","column"),this.addOutput("Mid","column"),this.addOutput("Upper","column"),this.addOutput("Bandwidth","column"),this.addOutput("Percent","column"),this.serialize_widgets=!0}BollingerNode.title="Bollinger";litegraph.LiteGraph.registerNodeType("indicators/bollinger",BollingerNode);function SuperTrendNode(){this.addInput("High","column"),this.addInput("Low","column"),this.addInput("Close","column"),this.addInput("Window","integer"),this.addOutput("Trend","column"),this.addOutput("Direction","column"),this.addOutput("Long","column"),this.addOutput("Short","column"),this.serialize_widgets=!0}SuperTrendNode.title="SuperTrend";litegraph.LiteGraph.registerNodeType("indicators/super_trend",SuperTrendNode);function SendMessageNode(){this.addInput("Exec","exec"),this.addInput("Message","string"),this.addInput("UserID","integer"),this.addOutput("Exec","exec"),this.serialize_widgets=!0}SendMessageNode.title="Send Message";litegraph.LiteGraph.registerNodeType("telegram/send_message",SendMessageNode);function SimpleBacktestNode(){this.addInput("Signals","boolean"),this.addInput("Profit target","float"),this.addInput("Candles to close","integer"),this.addInput("First order size","integer"),this.serialize_widgets=!0}SimpleBacktestNode.title="Simple Backtest";litegraph.LiteGraph.registerNodeType("backtest/simple_backtest",SimpleBacktestNode);function AdvancedBacktestNode(){this.addInput("Signals","boolean"),this.addInput("Profit target","float"),this.addInput("Number of orders","integer"),this.addInput("Martingale","float"),this.addInput("Candles to close","integer"),this.addInput("Step %","float"),this.addInput("First order size","integer"),this.serialize_widgets=!0}AdvancedBacktestNode.title="Advanced Backtest";litegraph.LiteGraph.registerNodeType("backtest/advanced_backtest",AdvancedBacktestNode);const pve={position:i$2.POSITION.BOTTOM_RIGHT},useGraphStore=defineStore("graph",()=>{const s=ref(null),t=ref(null),n=ref(""),Ae=ref([]),Ne=ref(""),tr=ref(["BTCUSDT","ETHUSDT","BNBUSDT"]),er=ref(""),ir=ref(""),sr=ref("1min"),rr=ref(""),nr=yr=>{const Er={integer:"#d2ffb0",string:"#f3b0ff",boolean:"#F77",float:"#b0e0ff",column:"#fffdb0",exec:"#dff4fb"};s.value=new litegraph.LGraph,t.value=new litegraph.LGraphCanvas(yr,s.value),t.value&&(t.value.default_connection_color_byType=Er,t.value.default_connection_color_byTypeOff=Er),Object.assign(litegraph.LGraphCanvas.link_type_colors,Er),s.value.start()},ar=()=>{if(t.value&&s.value){const yr=t.value.canvas,Er=yr.parentElement;if(Er){const wr=getComputedStyle(Er),Dr=Er.clientWidth-parseFloat(wr.paddingLeft)-parseFloat(wr.paddingRight),kr=Er.clientHeight-parseFloat(wr.paddingTop)-parseFloat(wr.paddingBottom);yr.width=Dr,yr.height=kr}t.value.resize()}},or=async yr=>{try{const Er=await axios.get("https://api.bybit.com/v5/market/tickers",{params:{category:"linear"}});return Er.data.retCode!==0?(i$2.error("Failed to get tickers info",pve),[]):Er.data.result.list.filter(kr=>parseFloat(kr.turnover24h)>yr).map(kr=>kr.symbol)}catch{return i$2.error("Error fetching symbols",pve),[]}},ur=async()=>{const yr=await or(5e7);tr.value=yr.length>0?yr:["BTCUSDT","ETHUSDT","BNBUSDT"]},hr=async()=>{const yr=localStorage.getItem("userId"),Er=localStorage.getItem("userToken");if(!yr||!Er){i$2.error("User is not authorised",pve);return}try{const wr=await axios.get("https://pve.finance/api/get-saved-graphs",{params:{id:yr,token:Er}});if(wr.data.status==="success"&&wr.data.graphs){Ae.value=wr.data.graphs;const Dr=Ae.value.sort((kr,zr)=>new Date(zr.modified_at).getTime()-new Date(kr.modified_at).getTime());Dr.length>0&&(Ne.value=Dr[0].name,n.value=Dr[0].name,await cr())}else i$2.error("Error fetching saved graphs.",pve)}catch{i$2.error("Error fetching saved graphs.",pve)}},cr=async()=>{const yr=localStorage.getItem("userId"),Er=localStorage.getItem("userToken");if(!yr||!Er){i$2.error("User is not authorised",pve);return}if(!Ne.value){i$2.error("Please select a graph to load",pve);return}const wr={user_id:yr,token:Er,name:Ne.value};try{const Dr=await axios.post("https://pve.finance/api/load-graph",wr,{headers:{"Content-Type":"application/json"}});Dr.data.status==="success"&&Dr.data.graph_data?(s.value&&(s.value.clear(),s.value.configure(Dr.data.graph_data),s.value.start()),Dr.data.start_date&&(er.value=Dr.data.start_date.split("T")[0]),Dr.data.end_date&&(ir.value=Dr.data.end_date.split("T")[0]),Dr.data.symbol&&(rr.value=Dr.data.symbol),Dr.data.timeframe&&(sr.value=Dr.data.timeframe)):i$2.error("Error loading graph",pve)}catch{i$2.error("Error loading graph",pve)}};return{graph:s,graphCanvas:t,graphName:n,savedGraphs:Ae,selectedGraph:Ne,symbolOptions:tr,startDate:er,endDate:ir,timeframe:sr,symbol:rr,initializeGraph:nr,resizeCanvas:ar,populateSymbolDropdown:ur,fetchSavedGraphs:hr,loadGraphFromServer:cr,saveGraphToServer:async()=>{if(!n.value){i$2.error("Please enter a graph name.",pve);return}if(!s.value){i$2.error("Graph not initialized.",pve);return}const yr=s.value.serialize(),Er=localStorage.getItem("userId"),wr=localStorage.getItem("userToken");if(!Er||!wr){i$2.error("User is not authorised",pve);return}const Dr=er.value,kr=ir.value,zr=sr.value,Vr=rr.value,Hr={user_id:Er,token:wr,name:n.value,graph_data:yr,start_date:Dr,end_date:kr,timeframe:zr,symbol:Vr};try{(await axios.post("https://pve.finance/api/save-graph",Hr,{headers:{"Content-Type":"application/json"}})).data.status==="success"?await hr():i$2.error("Error saving graph.",pve),i$2.success("Graph saved successfully.",pve)}catch{i$2.error("Error saving graph.",pve)}},deleteGraphToServer:async()=>{if(!Ne.value){i$2.error("Please select a graph to delete",pve);return}const yr=localStorage.getItem("userId"),Er=localStorage.getItem("userToken");if(!yr||!Er){i$2.error("User is not authorised",pve);return}const wr={user_id:yr,token:Er,name:Ne.value};try{(await axios.post("https://pve.finance/api/delete-graph",wr,{headers:{"Content-Type":"application/json"}})).data.status==="success"?(i$2.success("Graph deleted successfully.",pve),await hr()):i$2.error("Error, graph is not deleted",pve)}catch{i$2.error("Error deleting graph:",pve)}},compileGraph:async()=>{const yr=localStorage.getItem("userId"),Er=localStorage.getItem("userToken");if(!yr||!Er){i$2.error("User not authenticated",pve);return}const wr=er.value,Dr=ir.value,kr=sr.value,zr=rr.value;if(!Ne.value){i$2.error("Please select a graph to compile",pve);return}const Vr={user_id:yr,token:Er,name:Ne.value,start_date:wr,end_date:Dr,timeframe:kr,symbol:zr};try{i$2.info("Compilation started...",pve),(await axios.post("/api/compile-graph",Vr,{headers:{"Content-Type":"application/json"}})).data.status==="success"?i$2.info("Compilation finished successfully",pve):i$2.error("Error compiling graph.",pve)}catch{i$2.error("Error compiling graph.",pve)}},setDefaultDates:()=>{const yr=new Date,Er=new Date(yr);Er.setDate(yr.getDate()-3);const wr=new Date(yr);wr.setDate(yr.getDate()+1),er.value=Er.toISOString().split("T")[0],ir.value=wr.toISOString().split("T")[0]},downloadGraph:()=>{if(!s.value){i$2.error("Graph is not initialized.");return}const Er={graph:s.value.serialize(),startDate:er.value,endDate:ir.value,timeframe:sr.value,symbol:rr.value},wr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(Er,null,2)),Dr=document.createElement("a");Dr.setAttribute("href",wr),Dr.setAttribute("download",(n.value||"graph")+".json"),document.body.appendChild(Dr),Dr.click(),Dr.remove()},loadGraphFromFile:yr=>{s.value&&(s.value.clear(),s.value.configure(yr.graph),s.value.start()),yr.startDate&&(er.value=yr.startDate),yr.endDate&&(ir.value=yr.endDate),yr.symbol&&(rr.value=yr.symbol),yr.timeframe&&(sr.value=yr.timeframe),yr.graphName&&(n.value=yr.graphName)}}}),_hoisted_1$3={key:0,class:"graph-container"},_hoisted_2$3={key:1,class:"unauthorized"},_sfc_main$4={__name:"Nodes",setup(s){i$2.POSITION.BOTTOM_RIGHT;const t=ref(null),n=useGraphStore(),Ae=useAuthStore(),Ne=()=>{n.resizeCanvas()};return onMounted(async()=>{Ae.isAuthenticated&&(n.initializeGraph(t.value),n.populateSymbolDropdown(),n.setDefaultDates(),n.fetchSavedGraphs(),Ne(),await n.fetchSavedGraphs(),n.selectedGraph&&await n.compileGraph(),window.addEventListener("resize",Ne))}),onBeforeUnmount(()=>{window.removeEventListener("resize",Ne),n.graph&&n.graph.stop()}),(tr,er)=>unref(Ae).isAuthenticated?(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("canvas",{ref_key:"canvas",ref:t},null,512)])):(openBlock(),createElementBlock("div",_hoisted_2$3,er[0]||(er[0]=[createBaseVNode("p",null,"You must be logged in to view this page.",-1)])))}},Nodes=_export_sfc(_sfc_main$4,[["__scopeId","data-v-7474c45e"]]),_hoisted_1$2={class:"logs-container"},_hoisted_2$2={class:"toggle-icon"},_hoisted_3$2={class:"message"},_sfc_main$3=defineComponent({__name:"Logs",setup(s){const t=useWebSocketStore(),n=computed(()=>t.logs);function Ae(nr){return isNaN(nr.getTime())?"":nr.toLocaleTimeString()}function Ne(nr,ar){if(ar.startsWith("Executing"))return"#b0e0ff";switch(nr.toUpperCase()){case"INFO":return"#fff";case"WARNING":return"#fffdb0";case"ERROR":return"#F77";default:return"#fff"}}const tr=["#FF8A80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#80D8FF","#84FFFF","#A7FFEB","#B9F6CA","#CCFF90","#FFFF8D","#FFE57F","#FFD180","#FF9E80"];function er(nr){const ar=nr%tr.length;return tr[ar]}const ir=ref(!1);function sr(){ir.value=!ir.value}const rr=ref(null);return watch(()=>n.value.length,()=>{rr.value&&(rr.value.scrollTop=rr.value.scrollHeight)}),(nr,ar)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",{class:"logs-header",onClick:sr},[ar[0]||(ar[0]=createBaseVNode("span",null,"Logs",-1)),createBaseVNode("span",_hoisted_2$2,toDisplayString(ir.value?"▼":"▲"),1)]),withDirectives(createBaseVNode("div",{class:"logs-content",ref_key:"logsContent",ref:rr},[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(or,ur)=>(openBlock(),createElementBlock("div",{key:ur,class:"log-message",style:normalizeStyle({color:Ne(or.level,or.message)})},[createBaseVNode("span",{class:"timestamp",style:normalizeStyle({color:er(ur)})},toDisplayString(Ae(or.timestamp)),5),createBaseVNode("span",_hoisted_3$2,toDisplayString(or.message),1)],4))),128))],512),[[vShow,ir.value]])]))}}),Logs=_export_sfc(_sfc_main$3,[["__scopeId","data-v-4c7b93a4"]]),_hoisted_1$1={class:"main-content"},_hoisted_2$1={class:"factory-page"},_hoisted_3$1={class:"chart-container"},_hoisted_4={key:0,class:"other-content"},_hoisted_5={class:"buttons-container"},_hoisted_6={class:"graph-container"},_hoisted_7={class:"console-container"},_sfc_main$2=defineComponent({__name:"Factory",setup(s){const t=useAuthStore(),n=ref(!1);function Ae(){n.value=!n.value}const Ne=computed(()=>t.isAuthenticated?defineAsyncComponent(()=>__vitePreload(()=>import("./NodesSettings-BjQwavf3.js"),__vite__mapDeps([0,1]))):{template:"<div></div>"});return(tr,er)=>(openBlock(),createElementBlock("main",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createVNode(Chart,{"is-fullscreen":n.value,onToggleFullscreen:Ae},null,8,["is-fullscreen"])]),n.value?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[(openBlock(),createBlock(resolveDynamicComponent(Ne.value)))]),createBaseVNode("div",_hoisted_6,[createVNode(Nodes)]),createBaseVNode("div",_hoisted_7,[createVNode(Logs)])]))])]))}}),Factory=_export_sfc(_sfc_main$2,[["__scopeId","data-v-37205469"]]),_hoisted_1={class:"main-content"},_hoisted_2={class:"port-page"},_hoisted_3={class:"chart-container"},_sfc_main$1=defineComponent({__name:"Port",setup(s){const t=ref(!1);function n(){t.value=!t.value}return(Ae,Ne)=>(openBlock(),createElementBlock("main",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(Chart,{"is-fullscreen":t.value,onToggleFullscreen:n},null,8,["is-fullscreen"])])])]))}}),Port=_export_sfc(_sfc_main$1,[["__scopeId","data-v-4371a2f3"]]),_sfc_main={};function _sfc_render(s,t){return openBlock(),createElementBlock("div")}const Docs=_export_sfc(_sfc_main,[["render",_sfc_render]]),routes=[{path:"/",name:"Home",component:Home},{path:"/profile",name:"UserProfile",component:UserProfile,meta:{requiresAuth:!0}},{path:"/factory",name:"Factory",component:Factory,meta:{requiresAuth:!0}},{path:"/port",name:"Port",component:Port,meta:{requiresAuth:!0}},{path:"/docs",name:"Docs",component:Docs,meta:{requiresAuth:!1}}],router=createRouter({history:createWebHistory("/"),routes});router.beforeEach(async(s,t,n)=>{if(s.meta.requiresAuth){const Ae=useAuthStore();if(await Ae.initializeAuth(),!Ae.isAuthenticated){setTimeout(()=>{n({name:"Home"})},2e3),Ae.silent_logout();return}}n()});const app=createApp(App),pinia=createPinia();app.use(pinia);app.use(router);app.use(ct$1,{autoClose:3e3});app.mount("#app");export{Fragment as F,_export_sfc as _,useAuthStore as a,openBlock as b,createElementBlock as c,unref as d,createBaseVNode as e,vModelSelect as f,renderList as g,onMounted as o,ref as r,toDisplayString as t,useGraphStore as u,vModelText as v,withDirectives as w};
